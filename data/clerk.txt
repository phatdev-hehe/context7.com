TITLE: Implementing Error Handling in Next.js Sign-in Form
DESCRIPTION: A React component for Next.js App Router that implements email/password sign-in with comprehensive error handling. Uses Clerk's useSignIn hook and displays validation errors to users.

LANGUAGE: typescript
CODE:
'use client'

import * as React from 'react'
import { useSignIn } from '@clerk/nextjs'
import { useRouter } from 'next/navigation'
import { ClerkAPIError } from '@clerk/types'
import { isClerkAPIResponseError } from '@clerk/nextjs/errors'

export default function SignInForm() {
  const { isLoaded, signIn, setActive } = useSignIn()
  const [email, setEmail] = React.useState('')
  const [password, setPassword] = React.useState('')
  const [errors, setErrors] = React.useState<ClerkAPIError[]>()

  const router = useRouter()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setErrors(undefined)
    if (!isLoaded) return
    try {
      const signInAttempt = await signIn.create({
        identifier: email,
        password,
      })
      if (signInAttempt.status === 'complete') {
        await setActive({ session: signInAttempt.createdSessionId })
        router.push('/')
      } else {
        console.error(JSON.stringify(signInAttempt, null, 2))
      }
    } catch (err) {
      if (isClerkAPIResponseError(err)) setErrors(err.errors)
      console.error(JSON.stringify(err, null, 2))
    }
  }

  return (
    <>
      <h1>Sign in</h1>
      <form onSubmit={(e) => handleSubmit(e)}>
        <div>
          <label htmlFor="email">Enter email address</label>
          <input
            onChange={(e) => setEmail(e.target.value)}
            id="email"
            name="email"
            type="email"
            value={email}
          />
        </div>
        <div>
          <label htmlFor="password">Enter password</label>
          <input
            onChange={(e) => setPassword(e.target.value)}
            id="password"
            name="password"
            type="password"
            value={password}
          />
        </div>
        <button type="submit">Sign in</button>
      </form>

      {errors && (
        <ul>
          {errors.map((el, index) => (
            <li key={index}>{el.longMessage}</li>
          ))}
        </ul>
      )}
    </>
  )

----------------------------------------

TITLE: Accessing User Data in Next.js Pages Router getServerSideProps
DESCRIPTION: This example shows how to use getAuth(), clerkClient(), and buildClerkProps() helpers in a Next.js Pages Router getServerSideProps function to protect routes and access user data.

LANGUAGE: tsx
CODE:
import { getAuth, buildClerkProps } from '@clerk/nextjs/server'
import { GetServerSideProps } from 'next'

export const getServerSideProps: GetServerSideProps = async (ctx) => {
  // Use `getAuth()` to get the user's ID
  const { userId } = getAuth(ctx.req)

  // Protect the route by checking if the user is signed in
  if (!userId) {
    // Handle when the user is not signed in
  }

  // Initialize the Backend SDK
  const client = await clerkClient()

  // Get the user's full `Backend User` object
  const user = userId ? await client.users.getUser(userId) : undefined

  return { props: { ...buildClerkProps(ctx.req, { user }) } }
}

----------------------------------------

TITLE: Preparing Email Verification with SignUp Class
DESCRIPTION: Method to initiate email verification process by sending a verification code or link to the user's email address. Supports both email_code and email_link strategies with optional parameters.

LANGUAGE: typescript
CODE:
function prepareEmailAddressVerification(
  params?: PrepareEmailAddressVerificationParams,
): Promise<SignUpResource>

----------------------------------------

TITLE: Creating Protected tRPC Procedure with Authentication Middleware
DESCRIPTION: Demonstrates how to create a protected tRPC procedure using middleware that checks for user authentication.

LANGUAGE: typescript
CODE:
const isAuthed = t.middleware(({ next, ctx }) => {
  if (!ctx.auth.userId) {
    throw new TRPCError({ code: 'UNAUTHORIZED' })
  }
  return next({
    ctx: {
      auth: ctx.auth,
    },
  })
})

export const router = t.router
export const publicProcedure = t.procedure
export const protectedProcedure = t.procedure.use(isAuthed)

----------------------------------------

TITLE: Verifying Session with Clerk Backend SDK in TypeScript
DESCRIPTION: This snippet demonstrates how to use the deprecated `verifySession()` method from Clerk's Backend SDK to verify a session. It requires a session ID and token as input parameters.

LANGUAGE: tsx
CODE:
const sessionId = 'my-session-id'

const token = 'my-session-token'

const session = await clerkClient.sessions.verifySession(sessionId, token)

----------------------------------------

TITLE: Expo React Native Authentication Flow
DESCRIPTION: React Native implementation of authentication flow for Expo applications using Clerk. Includes both sign-up and sign-in functionality.

LANGUAGE: typescript
CODE:
import * as React from 'react'
import { Text, TextInput, Button, View } from 'react-native'
// Expo implementation...

----------------------------------------

TITLE: Implementing Clerk Middleware
DESCRIPTION: Setting up Clerk middleware to handle authentication state and route protection in Next.js application.

LANGUAGE: tsx
CODE:
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware()

export const config = {
  matcher: [
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Integrating ClerkProvider in Next.js App Router
DESCRIPTION: This snippet demonstrates how to wrap a Next.js application with ClerkProvider using the App Router. It provides session and user context to the entire application.

LANGUAGE: tsx
CODE:
import React from 'react'
import { ClerkProvider } from '@clerk/nextjs'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Implementing Sign-in Flow with Clerk Elements and shadcn/ui
DESCRIPTION: React component for a custom sign-in flow using Clerk Elements and shadcn/ui components. Includes social login options, email/password fields, and multiple authentication strategies.

LANGUAGE: tsx
CODE:
'use client'
import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'
import Link from 'next/link'
import { Button } from '@/components/ui/button'
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Icons } from '@/components/ui/icons'
import { cn } from '@/lib/utils'

export default function SignInPage() {
  return (
    <div className="grid w-full grow items-center px-4 sm:justify-center">
      <SignIn.Root>
        <Clerk.Loading>
          {(isGlobalLoading) => (
            <>
              <SignIn.Step name="start">
                <Card className="w-full sm:w-96">
                  <CardHeader>
                    <CardTitle>Sign in to Acme Co</CardTitle>
                    <CardDescription>Welcome back! Please sign in to continue</CardDescription>
                  </CardHeader>
                  <CardContent className="grid gap-y-4">
                    <div className="grid grid-cols-2 gap-x-4">
                      <Clerk.Connection name="github" asChild>
                        <Button
                          size="sm"
                          variant="outline"
                          type="button"
                          disabled={isGlobalLoading}
                        >
                          <Clerk.Loading scope="provider:github">
                            {(isLoading) =>
                              isLoading ? (
                                <Icons.spinner className="size-4 animate-spin" />
                              ) : (
                                <>
                                  <Icons.gitHub className="mr-2 size-4" />
                                  GitHub
                                </>
                              )
                            }
                          </Clerk.Loading>
                        </Button>
                      </Clerk.Connection>
                      <Clerk.Connection name="google" asChild>
                        <Button
                          size="sm"
                          variant="outline"
                          type="button"
                          disabled={isGlobalLoading}
                        >
                          <Clerk.Loading scope="provider:google">
                            {(isLoading) =>
                              isLoading ? (
                                <Icons.spinner className="size-4 animate-spin" />
                              ) : (
                                <>
                                  <Icons.google className="mr-2 size-4" />
                                  Google
                                </>
                              )
                            }
                          </Clerk.Loading>
                        </Button>
                      </Clerk.Connection>
                    </div>
                    <p className="flex items-center gap-x-3 text-sm text-muted-foreground before:h-px before:flex-1 before:bg-border after:h-px after:flex-1 after:bg-border">
                      or
                    </p>
                    <Clerk.Field name="identifier" className="space-y-2">
                      <Clerk.Label asChild>
                        <Label>Email address</Label>
                      </Clerk.Label>
                      <Clerk.Input type="email" required asChild>
                        <Input />
                      </Clerk.Input>
                      <Clerk.FieldError className="block text-sm text-destructive" />
                    </Clerk.Field>
                  </CardContent>
                  <CardFooter>
                    <div className="grid w-full gap-y-4">
                      <SignIn.Action submit asChild>
                        <Button disabled={isGlobalLoading}>
                          <Clerk.Loading>
                            {(isLoading) => {
                              return isLoading ? (
                                <Icons.spinner className="size-4 animate-spin" />
                              ) : (
                                'Continue'
                              )
                            }}
                          </Clerk.Loading>
                        </Button>
                      </SignIn.Action>

                      <Button variant="link" size="sm" asChild>
                        <Clerk.Link navigate="sign-up">
                          Don&apos;t have an account? Sign up
                        </Clerk.Link>
                      </Button>
                    </div>
                  </CardFooter>
                </Card>
              </SignIn.Step>

              <SignIn.Step name="choose-strategy">
                <Card className="w-full sm:w-96">
                  <CardHeader>
                    <CardTitle>Use another method</CardTitle>
                    <CardDescription>
                      Facing issues? You can use any of these methods to sign in.
                    </CardDescription>
                  </CardHeader>
                  <CardContent className="grid gap-y-4">
                    <SignIn.SupportedStrategy name="email_code" asChild>
                      <Button type="button" variant="link" disabled={isGlobalLoading}>
                        Email code
                      </Button>
                    </SignIn.SupportedStrategy>
                    <SignIn.SupportedStrategy name="password" asChild>
                      <Button type="button" variant="link" disabled={isGlobalLoading}>
                        Password
                      </Button>
                    </SignIn.SupportedStrategy>
                  </CardContent>
                  <CardFooter>
                    <div className="grid w-full gap-y-4">
                      <SignIn.Action navigate="previous" asChild>
                        <Button disabled={isGlobalLoading}>
                          <Clerk.Loading>
                            {(isLoading) => {
                              return isLoading ? (
                                <Icons.spinner className="size-4 animate-spin" />
                              ) : (
                                'Go back'
                              )
                            }}
                          </Clerk.Loading>
                        </Button>
                      </SignIn.Action>
                    </div>
                  </CardFooter>
                </Card>
              </SignIn.Step>

              <SignIn.Step name="verifications">
                <SignIn.Strategy name="password">
                  <Card className="w-full sm:w-96">
                    <CardHeader>
                      <CardTitle>Check your email</CardTitle>
                      <CardDescription>
                        Enter the verification code sent to your email
                      </CardDescription>
                      <p className="text-sm text-muted-foreground">
                        Welcome back <SignIn.SafeIdentifier />
                      </p>
                    </CardHeader>
                    <CardContent className="grid gap-y-4">
                      <Clerk.Field name="password" className="space-y-2">
                        <Clerk.Label asChild>
                          <Label>Password</Label>
                        </Clerk.Label>
                        <Clerk.Input type="password" asChild>
                          <Input />
                        </Clerk.Input>
                        <Clerk.FieldError className="block text-sm text-destructive" />
                      </Clerk.Field>
                    </CardContent>
                    <CardFooter>
                      <div className="grid w-full gap-y-4">
                        <SignIn.Action submit asChild>
                          <Button disabled={isGlobalLoading}>
                            <Clerk.Loading>
                              {(isLoading) => {
                                return isLoading ? (
                                  <Icons.spinner className="size-4 animate-spin" />
                                ) : (
                                  'Continue'
                                )
                              }}
                            </Clerk.Loading>
                          </Button>
                        </SignIn.Action>
                        <SignIn.Action navigate="choose-strategy" asChild>
                          <Button type="button" size="sm" variant="link">
                            Use another method
                          </Button>
                        </SignIn.Action>
                      </div>
                    </CardFooter>
                  </Card>
                </SignIn.Strategy>

                <SignIn.Strategy name="email_code">
                  <Card className="w-full sm:w-96">
                    <CardHeader>
                      <CardTitle>Check your email</CardTitle>
                      <CardDescription>
                        Enter the verification code sent to your email
                      </CardDescription>
                      <p className="text-sm text-muted-foreground">
                        Welcome back <SignIn.SafeIdentifier />
                      </p>
                    </CardHeader>
                    <CardContent className="grid gap-y-4">
                      <Clerk.Field name="code">
                        <Clerk.Label className="sr-only">Email verification code</Clerk.Label>
                        <div className="grid gap-y-2 items-center justify-center">
                          <div className="flex justify-center text-center">
                            <Clerk.Input
                              type="otp"
                              autoSubmit
                              className="flex justify-center has-[:disabled]:opacity-50"
                              render={({ value, status }) => {
                                return (
                                  <div
                                    data-status={status}
                                    className="relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md data-[status=selected]:ring-1 data-[status=selected]:ring-ring data-[status=cursor]:ring-1 data-[status=cursor]:ring-ring"
                                  >
                                    {value}
                                  </div>
                                )
                              }}
                            />
                          </div>
                          <Clerk.FieldError className="block text-sm text-destructive text-center" />
                          <SignIn.Action
                            asChild
                            resend
                            className="text-muted-foreground"
                            fallback={({ resendableAfter }) => (
                              <Button variant="link" size="sm" disabled>
                                Didn&apos;t receive a code? Resend (
                                <span className="tabular-nums">{resendableAfter}</span>)
                              </Button>
                            )}
                          >
                            <Button variant="link" size="sm">
                              Didn&apos;t receive a code? Resend
                            </Button>
                          </SignIn.Action>
                        </div>
                      </Clerk.Field>
                    </CardContent>
                    <CardFooter>
                      <div className="grid w-full gap-y-4">
                        <SignIn.Action submit asChild>
                          <Button disabled={isGlobalLoading}>
                            <Clerk.Loading>
                              {(isLoading) => {
                                return isLoading ? (
                                  <Icons.spinner className="size-4 animate-spin" />
                                ) : (
                                  'Continue'
                                )
                              }}
                            </Clerk.Loading>
                          </Button>
                        </SignIn.Action>
                        <SignIn.Action navigate="choose-strategy" asChild>
                          <Button size="sm" variant="link">
                            Use another method
                          </Button>
                        </SignIn.Action>
                      </div>
                    </CardFooter>
                  </Card>
                </SignIn.Strategy>
              </SignIn.Step>
            </>
          )}
        </Clerk.Loading>
      </SignIn.Root>
    </div>
  )
}

----------------------------------------

TITLE: Implementing Clerk Middleware in Next.js
DESCRIPTION: Setting up Clerk middleware to handle authentication state throughout the app. This code exports the clerkMiddleware and configures the matcher for specific routes.

LANGUAGE: tsx
CODE:
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware()

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Implementing Username/Password Sign-in with Clerk Elements
DESCRIPTION: A complete implementation of a username/password sign-in flow using Clerk Elements. Features styled form inputs for username and password with error handling and navigation to sign-up.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'

export default function SignInPage() {
  return (
    <div className="grid w-full flex-grow items-center bg-zinc-100 px-4 sm:justify-center">
      <SignIn.Root>
        <SignIn.Step
          name="start"
          className="w-full space-y-6 rounded-2xl bg-white px-4 py-10 shadow-md ring-1 ring-black/5 sm:w-96 sm:px-8"
        >
          <!-- Component implementation details -->
        </SignIn.Step>
      </SignIn.Root>
    </div>
  )
}

----------------------------------------

TITLE: Protecting Server Actions with Clerk Auth in Next.js
DESCRIPTION: This snippet shows how to use the auth() helper from Clerk to protect a server action in a Server Component. It checks if the user is signed in before allowing the action to proceed.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'

export default function AddToCart() {
  async function addItem(formData: FormData) {
    'use server'

    const { userId } = await auth()

    if (!userId) {
      throw new Error('You must be signed in to add an item to your cart')
    }

    console.log('add item server action', formData)
  }

  return (
    <form action={addItem}>
      <input value={'test'} type="text" name="name" />
      <button type="submit">Add to Cart</button>
    </form>
  )
}

----------------------------------------

TITLE: Using auth() Helper in Next.js Server Components
DESCRIPTION: Demonstrates how to use Clerk's auth() helper function in a Next.js server component to access authentication data dynamically at request time. This approach opts the entire route into dynamic rendering.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'

// This page will be dynamically rendered at request time
export default async function Page() {
  const { userId } = await auth()

  return <p>Hello, {userId}</p>
}

----------------------------------------

TITLE: Basic Clerk Middleware Configuration in Next.js
DESCRIPTION: Basic setup of clerkMiddleware() in a Next.js application with route matcher configuration to skip static files and include API routes.

LANGUAGE: typescript
CODE:
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware()

export const config = {
  matcher: [
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: State-Based Styling with Data Attributes in CSS
DESCRIPTION: Demonstrates how to use data attributes for state-based styling of Clerk Elements components. This approach allows for styling based on the validity state of form fields.

LANGUAGE: css
CODE:
.input {
  --border-color: gray;
  border: 1px solid var(--border-color);

  &[data-invalid] {
    --border-color: red;
  }
}

----------------------------------------

TITLE: Using Clerk Backend SDK Standalone in TypeScript
DESCRIPTION: Example of using the Clerk Backend SDK on its own to authenticate a request. It demonstrates creating a Clerk client with environment variables and using it to authenticate an incoming request.

LANGUAGE: tsx
CODE:
import { createClerkClient } from '@clerk/backend'

export async function GET(req: Request) {
  const clerkClient = createClerkClient({
    secretKey: process.env.CLERK_SECRET_KEY,
    publishableKey: process.env.CLERK_PUBLISHABLE_KEY,
  })

  const { isSignedIn } = await clerkClient.authenticateRequest(req, {
    authorizedParties: ['https://example.com'],
  })

  if (!isSignedIn) {
    return Response.json({ status: 401 })
  }

  // Add logic to perform protected actions

  return Response.json({ message: 'This is a reply' })
}

----------------------------------------

TITLE: Importing Auth Object in Next.js App Router
DESCRIPTION: Demonstrates how to import and use the auth() function in the Next.js App Router. This function returns an Auth object containing important user session information.

LANGUAGE: javascript
CODE:
import { auth } from "@clerk/nextjs";

----------------------------------------

TITLE: React Custom Hook for Authenticated Fetch
DESCRIPTION: Custom hook implementation for making authenticated requests in React applications. Uses the useAuth hook to get the session token and includes it in the Authorization header.

LANGUAGE: jsx
CODE:
export default async function useFetch() {
  const { getToken } = useAuth()

  const token = await getToken()

  const authenticatedFetch = async (...args) => {
    return fetch(...args, {
      headers: { Authorization: `Bearer ${token}` },
    }).then((res) => res.json())
  }
  return authenticatedFetch
}

----------------------------------------

TITLE: Adding Phone Numbers in Next.js with Clerk
DESCRIPTION: A Next.js implementation for adding and verifying phone numbers using Clerk's API. The component handles phone number creation, verification code sending, and verification confirmation using the useUser hook and Clerk's phone number methods.

LANGUAGE: typescript
CODE:
'use client'

import * as React from 'react'
import { useUser } from '@clerk/nextjs'
import { PhoneNumberResource } from '@clerk/types'

export default function Page() {
  const { isLoaded, user } = useUser()
  const [phone, setPhone] = React.useState('')
  const [code, setCode] = React.useState('')
  const [isVerifying, setIsVerifying] = React.useState(false)
  const [successful, setSuccessful] = React.useState(false)
  const [phoneObj, setPhoneObj] = React.useState<PhoneNumberResource | undefined>()

  if (!isLoaded) return null

  if (isLoaded && !user?.id) {
    return <p>You must be logged in to access this page</p>
  }

  // Handle addition of the phone number
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    try {
      // Add unverified phone number to user
      const res = await user.createPhoneNumber({ phoneNumber: phone })
      // Reload user to get updated User object
      await user.reload()

      // Create a reference to the new phone number to use related methods
      const phoneNumber = user.phoneNumbers.find((a) => a.id === res.id)
      setPhoneObj(phoneNumber)

      // Send the user an SMS with the verification code
      phoneNumber?.prepareVerification()

      // Set to true to display second form
      // and capture the OTP code
      setIsVerifying(true)
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }

  // Handle the submission of the verification form
  const verifyCode = async (e: React.FormEvent) => {
    e.preventDefault()
    try {
      // Verify that the provided code matches the code sent to the user
      const phoneVerifyAttempt = await phoneObj?.attemptVerification({ code })

      if (phoneVerifyAttempt?.verification.status === 'verified') {
        setSuccessful(true)
      } else {
        // If the status is not complete, check why. User may need to
        // complete further steps.
        console.error(JSON.stringify(phoneVerifyAttempt, null, 2))
      }
    } catch (err) {
      console.error(JSON.stringify(err, null, 2))
    }
  }

  // Display a success message if the phone number was added successfully
  if (successful) {
    return (
      <>
        <h1>Phone added</h1>
      </>
    )
  }

  // Display the verification form to capture the OTP code
  if (isVerifying) {
    return (
      <>
        <h1>Verify phone</h1>
        <div>
          <form onSubmit={(e) => verifyCode(e)}>
            <div>
              <label htmlFor="code">Enter code</label>
              <input
                onChange={(e) => setCode(e.target.value)}
                id="code"
                name="code"
                type="text"
                value={code}
              />
            </div>
            <div>
              <button type="submit">Verify</button>
            </div>
          </form>
        </div>
      </>
    )
  }

  // Display the initial form to capture the phone number
  return (
    <>
      <h1>Add phone</h1>
      <div>
        <form onSubmit={(e) => handleSubmit(e)}>
          <div>
            <label htmlFor="phone">Enter phone number</label>
            <input
              onChange={(e) => setPhone(e.target.value)}
              id="phone"
              name="phone"
              type="phone"
              value={phone}
            />
          </div>
          <div>
            <button type="submit">Continue</button>
          </div>
        </form>
      </div>
    </>
  )
}

----------------------------------------

TITLE: Creating tRPC Context with Clerk Authentication
DESCRIPTION: Demonstrates how to create a tRPC context that includes Clerk's auth object for authentication state access.

LANGUAGE: typescript
CODE:
import { auth } from '@clerk/nextjs/server'

export const createContext = async () => {
  return { auth: await auth() }
}

export type Context = Awaited<ReturnType<typeof createContext>>

----------------------------------------

TITLE: Implementing SMS OTP Sign-Up Flow in JavaScript
DESCRIPTION: This code snippet shows how to implement a custom SMS OTP sign-up flow using Clerk in a vanilla JavaScript application. It includes HTML markup and JavaScript code to handle the sign-up process, OTP verification, and session management.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="signed-in"></div>

    <div id="sign-up">
      <h2>Sign up</h2>
      <form id="sign-up-form">
        <label for="phone">Enter phone number</label>
        <input type="tel" name="phone" id="sign-up-phone" />
        <button type="submit">Continue</button>
      </form>
    </div>

    <form id="verifying" hidden>
      <h2>Verify your phone number</h2>
      <label for="code">Enter your verification code</label>
      <input id="code" name="code" />
      <button type="submit" id="verify-button">Verify</button>
    </form>

    <script type="module" src="/src/main.js" async crossorigin="anonymous"></script>
  </body>
</html>

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(pubKey)
await clerk.load()

if (clerk.user) {
  // Mount user button component
  document.getElementById('signed-in').innerHTML = `
    <div id="user-button"></div>
  `

  const userbuttonDiv = document.getElementById('user-button')

  clerk.mountUserButton(userbuttonDiv)
} else {
  // Handle the sign-up form
  document.getElementById('sign-up-form').addEventListener('submit', async (e) => {
    e.preventDefault()

    const formData = new FormData(e.target)
    const phoneNumber = formData.get('phone')

    try {
      // Start the sign-up process using the phone number method
      await clerk.client.signUp.create({ phoneNumber })
      await clerk.client.signUp.preparePhoneNumberVerification()
      // Hide sign-up form
      document.getElementById('sign-up').setAttribute('hidden', '')
      // Show verification form
      document.getElementById('verifying').removeAttribute('hidden')
    } catch (error) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(error)
    }
  })

  // Handle the verification form
  document.getElementById('verifying').addEventListener('submit', async (e) => {
    const formData = new FormData(e.target)
    const code = formData.get('code')

    try {
      // Verify the phone number
      const verify = await clerk.client.signUp.attemptPhoneNumberVerification({
        code,
      })

      // Now that the user is created, set the session to active.
      await clerk.setActive({ session: verify.createdSessionId })
    } catch (error) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(error)
    }
  })
}

----------------------------------------

TITLE: Checking Sign-Up State with useSignUp() in React
DESCRIPTION: This snippet demonstrates how to use the useSignUp() hook to access the current sign-up attempt status in a React application. It handles the loading state and displays the current status.

LANGUAGE: tsx
CODE:
import { useSignUp } from '@clerk/clerk-react'

export default function SignUpPage() {
  const { isLoaded, signUp } = useSignUp()

  if (!isLoaded) {
    // Handle loading state
    return null
  }

  return <div>The current sign-up attempt status is {signUp?.status}.</div>
}

----------------------------------------

TITLE: Installing Clerk Next.js SDK
DESCRIPTION: Command line instructions for installing the @clerk/nextjs package using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/nextjs

LANGUAGE: bash
CODE:
yarn add @clerk/nextjs

LANGUAGE: bash
CODE:
pnpm add @clerk/nextjs

LANGUAGE: bash
CODE:
bun add @clerk/nextjs

----------------------------------------

TITLE: Implementing MFA Enforcement Middleware in Next.js
DESCRIPTION: Update clerkMiddleware() to check if the user has MFA enabled and redirect to the MFA setup page if necessary. This middleware also handles sign-in page redirection for authenticated users.

LANGUAGE: tsx
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'
import { NextResponse } from 'next/server'

const isMFARoute = createRouteMatcher(['/account/manage-mfa/add(.*)'])
const isSignInRoute = createRouteMatcher(['/sign-in(.*)'])

export default clerkMiddleware(async (auth, req) => {
  const { userId, sessionClaims } = await auth()

  // Redirect to homepage if the user is signed in and on the sign-in page
  if (userId !== null && isSignInRoute(req)) {
    return NextResponse.redirect(new URL('/', req.url))
  }

  // Redirect to MFA setup page if MFA is not enabled
  if (userId !== null && !isMFARoute(req)) {
    if (sessionClaims.isMfa === undefined) {
      console.error('You need to add the `isMfa` claim to your session token.')
    }
    if (sessionClaims.isMfa === false) {
      return NextResponse.redirect(new URL('/account/manage-mfa/add', req.url))
    }
  }
})

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Implementing Form Fields and Social Connection
DESCRIPTION: Adds input fields for username, email, and password, along with social connection options and error handling using Clerk.Field components.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignUp from '@clerk/elements/sign-up'

export default function SignUpPage() {
  return (
    <SignUp.Root>
      <SignUp.Step name="start">
        <h1>Create an account</h1>

        <Clerk.Connection name="google">Sign up with Google</Clerk.Connection>

        <Clerk.Field name="username">
          <Clerk.Label>Username</Clerk.Label>
          <Clerk.Input />
          <Clerk.FieldError />
        </Clerk.Field>

        <Clerk.Field name="emailAddress">
          <Clerk.Label>Email</Clerk.Label>
          <Clerk.Input />
          <Clerk.FieldError />
        </Clerk.Field>

        <Clerk.Field name="password">
          <Clerk.Label>Password</Clerk.Label>
          <Clerk.Input />
          <Clerk.FieldError />
        </Clerk.Field>

        <SignUp.Captcha />

        <SignUp.Action submit>Sign up</SignUp.Action>
      </SignUp.Step>
    </SignUp.Root>
  )
}

----------------------------------------

TITLE: Next.js Email/Password Sign-up Implementation
DESCRIPTION: React component for handling email/password sign-up flow in Next.js using Clerk. Includes email verification with OTP code and session management.

LANGUAGE: typescript
CODE:
'use client'

import * as React from 'react'
import { useSignUp } from '@clerk/nextjs'
import { useRouter } from 'next/navigation'

// Component implementation...

----------------------------------------

TITLE: Next.js MFA Sign-in Implementation
DESCRIPTION: Custom sign-in form component using Next.js and Clerk hooks to handle both email/password authentication and second factor verification via TOTP or backup codes.

LANGUAGE: typescript
CODE:
'use client'

import * as React from 'react'
import { useSignIn } from '@clerk/nextjs'
import { useRouter } from 'next/navigation'

export default function SignInForm() {
  const { isLoaded, signIn, setActive } = useSignIn()
  const [email, setEmail] = React.useState('')
  const [password, setPassword] = React.useState('')
  const [code, setCode] = React.useState('')
  const [useBackupCode, setUseBackupCode] = React.useState(false)
  const [displayTOTP, setDisplayTOTP] = React.useState(false)
  const router = useRouter()
  //... rest of implementation

----------------------------------------

TITLE: Fetching User List and Rendering Impersonation Dashboard in Next.js
DESCRIPTION: This code fetches a list of application users using Clerk's Backend SDK and renders a client component for user impersonation. It includes permission checks and data parsing for client-side use.

LANGUAGE: tsx
CODE:
import { auth, clerkClient } from '@clerk/nextjs/server'
import ImpersonateUsers from './_components'

export default async function AccountPage() {
  const { has } = await auth()

  // Protect the page
  if (!has({ permission: 'org:admin:impersonate' })) {
    return <p>You do not have permission to access this page.</p>
  }

  const client = await clerkClient()

  // Fetch list of application's users using Clerk's Backend SDK
  const users = await client.users.getUserList()

  // This page needs to be a server component to use clerkClient.users.getUserList()
  // You must pass the list of users to the client for the rest of the logic
  // But you cannot pass the entire User object to the client,
  // because its too complex. So grab the data you need, like so:
  const parsedUsers = []
  for (const user of users.data) {
    parsedUsers.push({
      id: user.id,
      email: user.primaryEmailAddress?.emailAddress,
    })
  }

  // Pass the parsed users to the Client Component
  return <ImpersonateUsers users={parsedUsers} />
}

----------------------------------------

TITLE: Creating Organizations with Next.js and Clerk
DESCRIPTION: React component using Clerk's useOrganizationList hook to create organizations. Implements a form handling submission and error cases in a Next.js App Router context.

LANGUAGE: typescript
CODE:
'use client'

import { useOrganizationList } from '@clerk/nextjs'
import { FormEventHandler, useState } from 'react'

export default function CreateOrganization() {
  const { isLoaded, createOrganization } = useOrganizationList()
  const [organizationName, setOrganizationName] = useState('')

  if (!isLoaded) return null

  const handleSubmit: FormEventHandler<HTMLFormElement> = async (e) => {
    e.preventDefault()
    createOrganization({ name: organizationName })
      .then((res) => {
        console.log(res)
      })
      .catch((err) => {
        console.error(JSON.stringify(err, null, 2))
      })
    setOrganizationName('')
  }

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        name="organizationName"
        value={organizationName}
        onChange={(e) => setOrganizationName(e.currentTarget.value)}
      />
      <button type="submit">Create organization</button>
    </form>
  )
}

----------------------------------------

TITLE: Vanilla JavaScript Email/Password Authentication
DESCRIPTION: Pure JavaScript implementation of email/password authentication using Clerk's JavaScript SDK. Includes HTML structure and client-side logic.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    // HTML structure...

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY
// JavaScript implementation...

----------------------------------------

TITLE: Protecting Server Components with Clerk's auth.protect() in Next.js
DESCRIPTION: Shows how to use auth.protect() to protect a Next.js React Server Component from unauthorized access, throwing a 404 error for unauthorized users.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'

export default async function Page() {
  const { userId } = await auth.protect({ permission: 'org:team_settings:read' })

  return <p>{userId} is authorized to access this page.</p>
}

----------------------------------------

TITLE: Adding Start Step to Sign-up Flow
DESCRIPTION: Implements the initial step of the sign-up flow using SignUp.Step component to allow users to create a sign-up attempt.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignUp from '@clerk/elements/sign-up'

export default function SignUpPage() {
  return (
    <SignUp.Root>
      <SignUp.Step name="start">
        <h1>Create an account</h1>
      </SignUp.Step>
    </SignUp.Root>
  )
}

----------------------------------------

TITLE: Retrieving Current User in Next.js Route Handler with Clerk
DESCRIPTION: Demonstrates how to use the currentUser() helper to retrieve the current Backend User object in a Route Handler.

LANGUAGE: typescript
CODE:
import { NextResponse } from 'next/server'
import { currentUser } from '@clerk/nextjs/server'
export async function GET() {
  const user = await currentUser()

  if (!user) {
    return new Response('Unauthorized', { status: 401 })
  }

  return NextResponse.json({ user })
}

----------------------------------------

TITLE: Implementing SignIn Component in Next.js
DESCRIPTION: Example showing how to use the SignIn component in a Next.js application on a public page. The component conditionally renders based on user authentication status.

LANGUAGE: tsx
CODE:
import { SignIn, useUser } from '@clerk/nextjs'

export default function Home() {
  const { user } = useUser()

  if (!user) return <SignIn />

  return <div>Welcome!</div>
}

----------------------------------------

TITLE: Creating Clerk Client in TypeScript
DESCRIPTION: This snippet demonstrates how to create a default Clerk client using the createClerkClient function from @clerk/backend. It sets up configuration options including API version, secret key, and SDK metadata.

LANGUAGE: typescript
CODE:
import { createClerkClient } from '@clerk/backend'

const API_VERSION = process.env.CLERK_API_VERSION || 'v1'
const SECRET_KEY = process.env.CLERK_SECRET_KEY || ''
const PUBLISHABLE_KEY = process.env.CLERK_PUBLISHABLE_KEY || ''
const API_URL = process.env.CLERK_API_URL || ''
const JWT_KEY = process.env.CLERK_JWT_KEY || ''
const SDK_METADATA = {
  name: PACKAGE_NAME,
  version: PACKAGE_VERSION,
  environment: process.env.NODE_ENV,
}

export const clerkClient = createClerkClient({
  secretKey: SECRET_KEY,
  apiUrl: API_URL,
  apiVersion: API_VERSION,
  jwtKey: JWT_KEY,
  userAgent: `${PACKAGE_NAME}@${PACKAGE_VERSION}`,
  sdkMetadata: SDK_METADATA,
})

----------------------------------------

TITLE: Implementing Custom Sign-Out in Next.js with Clerk
DESCRIPTION: This snippet demonstrates how to create a custom sign-out button component in Next.js using Clerk's useClerk() hook. The component calls the signOut() function when clicked, signing out the user and redirecting them to the home page.

LANGUAGE: jsx
CODE:
'use client'

import { useClerk } from '@clerk/nextjs'

export const SignOutButton = () => {
  const { signOut } = useClerk()

  return (
    // Clicking this button signs out a user
    // and redirects them to the home page "/".
    <button onClick={() => signOut({ redirectUrl: '/' })}>Sign out</button>
  )
}

----------------------------------------

TITLE: Implementing Authentication State and Token Retrieval in Vue with Clerk
DESCRIPTION: This snippet demonstrates how to use the useAuth() composable to access the current auth state and retrieve a session token for API requests. It includes conditional rendering based on authentication status and a method to fetch protected data.

LANGUAGE: vue
CODE:
<script setup>
import { useAuth } from '@clerk/vue'

const { getToken, isLoaded, isSignedIn } = useAuth()

const fetchProtectedData = async () => {
  const token = await getToken.value()

  // Fetch data from an external API
  const response = await fetch('https://api.example.com/data', {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  })

  return response.json()
}
</script>

<template>
  <div v-if="!isLoaded">Loading...</div>
  <div v-else-if="!isSignedIn">Sign in to view this page</div>
  <div v-else>
    <!-- Your protected content here -->
  </div>
</template>

----------------------------------------

TITLE: Defining verifyToken Function Signature in TypeScript
DESCRIPTION: TypeScript function signature for verifyToken method that validates Clerk-generated tokens.

LANGUAGE: typescript
CODE:
function verifyToken(
  token: string,
  options: VerifyTokenOptions,
): Promise<JwtReturnType<JwtPayload, TokenVerificationError>>

----------------------------------------

TITLE: Accessing Current User Data with useUser() Hook in React
DESCRIPTION: This snippet demonstrates how to use the useUser() hook to get the current user's data in a React component. It handles loading states and checks if the user is signed in.

LANGUAGE: tsx
CODE:
import { useUser } from '@clerk/clerk-react'

export default function Home() {
  const { isLoaded, isSignedIn, user } = useUser()

  if (!isLoaded) {
    return null
  }

  if (isSignedIn) {
    return <div>Hello {user.firstName}!</div>
  }

  return <div>Not signed in</div>
}

----------------------------------------

TITLE: Authorization in Next.js Server Actions with Clerk
DESCRIPTION: Demonstrates how to perform authorization checks in a Next.js Server Action using Clerk's has() function.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'

export default async function ExampleServerComponent() {
  async function myServerAction(formData: FormData) {
    'use server'
    const { has } = await auth()

    const canManage = has({ permission: 'org:team_settings:manage' })

    if (!canManage)
      return Response.json({ error: 'User does not have the correct permissions' }, { status: 403 })

    return users.getTeams(userId)
  }

  return (
    <form action={myServerAction}>
      {/* Add UI for managing team settings */}
      <button type="submit">Submit</button>
    </form>
  )
}

----------------------------------------

TITLE: Implementing SMS OTP Sign-In Flow in JavaScript
DESCRIPTION: This code snippet demonstrates how to implement a custom SMS OTP sign-in flow using Clerk in a vanilla JavaScript application. It includes HTML markup and JavaScript code to handle the sign-in process, OTP verification, and session management.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="signed-in"></div>

    <div id="sign-in">
      <h2>Sign in</h2>
      <form id="sign-in-form">
        <label for="phone">Enter phone number</label>
        <input type="tel" name="phone" id="sign-in-phone" />
        <button type="submit">Continue</button>
      </form>
    </div>

    <form id="verifying" hidden>
      <h2>Verify your phone number</h2>
      <label for="code">Enter your verification code</label>
      <input id="code" name="code" />
      <button type="submit" id="verify-button">Verify</button>
    </form>

    <script type="module" src="/src/main.js" async crossorigin="anonymous"></script>
  </body>
</html>

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(pubKey)
await clerk.load()

if (clerk.user) {
  // Mount user button component
  document.getElementById('signed-in').innerHTML = `
    <div id="user-button"></div>
  `

  const userbuttonDiv = document.getElementById('user-button')

  clerk.mountUserButton(userbuttonDiv)
} else {
  // Handle the sign-in form
  document.getElementById('sign-in-form').addEventListener('submit', async (e) => {
    e.preventDefault()

    const formData = new FormData(e.target)
    const phone = formData.get('phone')

    try {
      // Start the sign-in process using the user's identifier.
      // In this case, it's their phone number.
      const { supportedFirstFactors } = await clerk.client.signIn.create({
        identifier: phone,
      })

      // Find the phoneNumberId from all the available first factors for the current sign-in
      const firstPhoneFactor = supportedFirstFactors.find((factor) => {
        return factor.strategy === 'phone_code'
      })

      const { phoneNumberId } = firstPhoneFactor

      // Prepare first factor verification, specifying
      // the phone code strategy.
      await clerk.client.signIn.prepareFirstFactor({
        strategy: 'phone_code',
        phoneNumberId,
      })

      // Hide sign-in form
      document.getElementById('sign-in').setAttribute('hidden', '')
      // Show verification form
      document.getElementById('verifying').removeAttribute('hidden')
    } catch (error) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(error)
    }
  })

  // Handle the verification form
  document.getElementById('verifying').addEventListener('submit', async (e) => {
    const formData = new FormData(e.target)
    const code = formData.get('code')

    try {
      // Verify the phone number
      const verify = await clerk.client.signIn.attemptFirstFactor({
        strategy: 'phone_code',
        code,
      })

      // Now that the user is created, set the session to active.
      await clerk.setActive({ session: verify.createdSessionId })
    } catch (error) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(error)
    }
  })
}

----------------------------------------

TITLE: Manually Verifying Clerk Session Token in TypeScript
DESCRIPTION: This code snippet demonstrates how to manually verify a Clerk session token in a TypeScript environment. It retrieves the token from either a cookie or the Authorization header, verifies the signature using a public key, and validates the token's expiration, validity period, and authorized party claim.

LANGUAGE: typescript
CODE:
import Cookies from 'cookies'
import jwt from 'jsonwebtoken'

export default async function (req: Request, res: Response) {
  // Your public key should be set as an environment variable
  const publicKey = process.env.CLERK_PEM_PUBLIC_KEY
  // Retrieve session token from either `__session` cookie for a same-origin request
  // or from the `Authorization` header for cross-origin requests
  const cookies = new Cookies(req, res)
  const tokenSameOrigin = cookies.get('__session')
  const tokenCrossOrigin = req.headers.authorization

  if (!tokenSameOrigin && !tokenCrossOrigin) {
    res.status(401).json({ error: 'Not signed in' })
    return
  }

  try {
    let decoded
    const options = { algorithms: ['RS256'] } // The algorithm used to sign the token. Optional.
    const permittedOrigins = ['http://localhost:3000', 'https://example.com'] // Replace with your permitted origins

    if (tokenSameOrigin) {
      decoded = jwt.verify(tokenSameOrigin, publicKey, options)
    } else {
      decoded = jwt.verify(tokenCrossOrigin, publicKey, options)
    }

    // Validate the token's expiration (exp) and not before (nbf) claims
    const currentTime = Math.floor(Date.now() / 1000)
    if (decoded.exp < currentTime || decoded.nbf > currentTime) {
      throw new Error('Token is expired or not yet valid')
    }

    // Validate the token's authorized party (azp) claim
    if (decoded.azp && !permittedOrigins.includes(decoded.azp)) {
      throw new Error("Invalid 'azp' claim")
    }

    res.status(200).json({ sessionToken: decoded })
  } catch (error) {
    res.status(400).json({
      error: error.message,
    })
  }
}

----------------------------------------

TITLE: HTML Structure for Clerk Organization Creation
DESCRIPTION: Basic HTML structure for implementing Clerk's organization creation functionality with vanilla JavaScript.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="app"></div>

    <h1>Create an organization</h1>
    <form id="create-organization">
      <label for="name">Name</label>
      <input id="name" name="name" />
      <button>Create organization</button>
    </form>

    <script type="module" src="/src/main.js" async crossorigin="anonymous"></script>
  </body>
</html>

----------------------------------------

TITLE: Implementing User Authentication with Clerk useUser Hook in React TSX
DESCRIPTION: A React component that handles three states: loading, unauthenticated, and authenticated. It uses Clerk's useUser hook to access user data and authentication state. The component shows a loading message while authenticating, prompts for sign-in if not authenticated, and displays a personalized greeting using the user's first name when authenticated.

LANGUAGE: tsx
CODE:
export default function Example() {
  const { isSignedIn, user, isLoaded } = useUser()

  if (!isLoaded) {
    return <div>Loading...</div>
  }

  if (!isSignedIn) {
    return <div>Sign in to view this page</div>
  }

  return <div>Hello {user.firstName}!</div>
}

----------------------------------------

TITLE: Route Protection with Authentication in Next.js
DESCRIPTION: Implementation of protected routes using auth.protect() to handle authentication status and redirect unauthenticated users.

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

const isProtectedRoute = createRouteMatcher(['/dashboard(.*)', '/forum(.*)'])

export default clerkMiddleware(async (auth, req) => {
  if (isProtectedRoute(req)) await auth.protect()
})

export const config = {
  matcher: [
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Implementing Public tRPC Procedure with Clerk Auth
DESCRIPTION: Example of a public tRPC procedure that uses Clerk authentication context to provide different responses for authenticated and unauthenticated users.

LANGUAGE: typescript
CODE:
export const exampleRouter = router({
  hello: publicProcedure.query(({ ctx }) => {
    const { userId } = ctx.auth

    if (!userId) {
      return {
        greeting: 'Hello! You are not signed in.',
      }
    }

    return {
      greeting: `Hello ${userId}!`,
    }
  }),
})

export type exampleRouter = typeof exampleRouter

----------------------------------------

TITLE: Using AuthenticateWithRedirectCallback Component in React
DESCRIPTION: The AuthenticateWithRedirectCallback component handles OAuth callbacks and manages user sessions. It should be rendered on the route specified as redirectUrl in authenticateWithRedirect() calls. The component accepts various URL configuration properties for different authentication scenarios.

LANGUAGE: jsx
CODE:
<AuthenticateWithRedirectCallback />

----------------------------------------

TITLE: Implementing Enterprise SSO Sign-in with Next.js
DESCRIPTION: Next.js implementation of an enterprise SSO sign-in page using Clerk's useSignIn hook. Handles form submission and authentication redirect flow with proper error handling.

LANGUAGE: typescript
CODE:
'use client'

import * as React from 'react'
import { useSignIn } from '@clerk/nextjs'

export default function Page() {
  const { signIn, isLoaded } = useSignIn()

  const signInWithEnterpriseSSO = (e: React.FormEvent) => {
    e.preventDefault()

    if (!isLoaded) return null

    const email = (e.target as HTMLFormElement).email.value

    signIn
      .authenticateWithRedirect({
        identifier: email,
        strategy: 'enterprise_sso',
        redirectUrl: '/sign-in/sso-callback',
        redirectUrlComplete: '/',
      })
      .then((res) => {
        console.log(res)
      })
      .catch((err: any) => {
        console.log(err.errors)
        console.error(err, null, 2)
      })
  }

  return (
    <form onSubmit={(e) => signInWithEnterpriseSSO(e)}>
      <input id="email" type="email" name="email" placeholder="Enter email address" />
      <button>Sign in with Enterprise SSO</button>
    </form>
  )
}

----------------------------------------

TITLE: Integrating ClerkProvider in Next.js Pages Router
DESCRIPTION: This snippet shows how to integrate ClerkProvider into a Next.js application using the Pages Router. It wraps the entire application to provide authentication context.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/nextjs'
import type { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider {...pageProps}>
      <Component {...pageProps} />
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Creating User with Clerk Backend SDK in TypeScript
DESCRIPTION: This snippet demonstrates how to create a user using the JavaScript Backend SDK's createUser() method from the users sub-api of the clerkClient instance. It includes error handling and returns a JSON response.

LANGUAGE: typescript
CODE:
export async function POST() {
  try {
    const user = await clerkClient.users.createUser({
      emailAddress: ['test@example.com'],
      password: 'password',
    })
    return Response.json({ message: 'User created', user })
  } catch (error) {
    console.log(error)
    return Response.json({ error: 'Error creating user' })
  }
}

----------------------------------------

TITLE: Creating User Passkeys with Clerk API in React
DESCRIPTION: This code snippet demonstrates how to create a passkey for a user using the Clerk API. It uses the useUser hook to access the current user and calls the createPasskey() method.

LANGUAGE: tsx
CODE:
export function CreatePasskeyButton() {
  const { user } = useUser()

  const createClerkPasskey = async () => {
    if (!user) return

    try {
      await user?.createPasskey()
    } catch (err) {
      console.error('Error:', JSON.stringify(err, null, 2))
    }
  }

  return <button onClick={createClerkPasskey}>Create a passkey</button>
}

----------------------------------------

TITLE: Implementing Sign-in with Biometric Authentication
DESCRIPTION: React Native component implementing a sign-in form with biometric authentication support using Clerk's useLocalCredentials hook. Handles both traditional and biometric sign-in flows.

LANGUAGE: tsx
CODE:
import { useSignIn } from '@clerk/clerk-expo'
import { Link, useRouter } from 'expo-router'
import { Text, TextInput, Button, View } from 'react-native'
import { useState } from 'react'
import { useLocalCredentials } from '@clerk/clerk-expo/local-credentials'

export default function Page() {
  const router = useRouter()
  const { signIn, setActive, isLoaded } = useSignIn()
  const { hasCredentials, setCredentials, authenticate, biometricType } = useLocalCredentials()

  const [emailAddress, setEmailAddress] = useState('')
  const [password, setPassword] = useState('')

  const onSignInPress = async (useLocal: boolean) => {
    if (!isLoaded) return

    try {
      const signInAttempt =
        hasCredentials && useLocal
          ? await authenticate()
          : await signIn.create({
              identifier: emailAddress,
              password,
            })

      if (signInAttempt.status === 'complete') {
        console.log('status is complete?', signInAttempt.status)

        if (!useLocal) {
          await setCredentials({
            identifier: emailAddress,
            password,
          })
        }

        await setActive({ session: signInAttempt.createdSessionId })
        router.replace('/')
      } else {
        console.error(JSON.stringify(signInAttempt, null, 2))
      }
    } catch (err) {
      console.error(JSON.stringify(err, null, 2))
    }
  }

  return (
    <View>
      <TextInput
        autoCapitalize="none"
        value={emailAddress}
        placeholder="Enter email"
        onChangeText={(emailAddress: string) => setEmailAddress(emailAddress)}
      />

      <TextInput
        value={password}
        placeholder="Enter password"
        secureTextEntry={true}
        onChangeText={(password: string) => setPassword(password)}
      />

      <Button title="Sign In" onPress={() => onSignInPress(false)} />

      {hasCredentials && biometricType && (
        <Button
          title={
            biometricType === 'face-recognition' ? 'Sign in with Face ID' : 'Sign in with Touch ID'
          }
          onPress={() => onSignInPress(true)}
        />
      )}

      <View>
        <Text>Don't have an account?</Text>

        <Link href="/sign-up">
          <Text>Sign up</Text>
        </Link>
      </View>
    </View>
  )

----------------------------------------

TITLE: Protecting Routes with Clerk Authentication
DESCRIPTION: Example of implementing protected routes using Clerk's requireAuth middleware and accessing user data.

LANGUAGE: typescript
CODE:
import 'dotenv/config'
import express from 'express'
import { clerkClient, requireAuth, getAuth } from '@clerk/express'

const app = express()
const PORT = 3000

// Use requireAuth() to protect this route
// If user isn't authenticated, requireAuth() will redirect back to the homepage
app.get('/protected', requireAuth(), async (req, res) => {
  // Use `getAuth()` to get the user's `userId`
  const { userId } = getAuth(req)

  // Use Clerk's JavaScript Backend SDK to get the user's User object
  const user = await clerkClient.users.getUser(userId)

  return res.json({ user })
})

// Start the server and listen on the specified port
app.listen(PORT, () => {
  console.log(`Example app listening at http://localhost:${PORT}`)
})

----------------------------------------

TITLE: Implementing Email Code Verification in Next.js
DESCRIPTION: This code snippet demonstrates how to implement email code verification for adding a new email address to a user's account using Clerk in a Next.js application. It includes handling the addition of the email, sending a verification code, and verifying the code entered by the user.

LANGUAGE: typescript
CODE:
'use client'

import * as React from 'react'
import { useUser } from '@clerk/nextjs'
import { EmailAddressResource } from '@clerk/types'

export default function Page() {
  const { isLoaded, user } = useUser()
  const [email, setEmail] = React.useState('')
  const [code, setCode] = React.useState('')
  const [isVerifying, setIsVerifying] = React.useState(false)
  const [successful, setSuccessful] = React.useState(false)
  const [emailObj, setEmailObj] = React.useState<EmailAddressResource | undefined>()

  if (!isLoaded) return null

  if (isLoaded && !user?.id) {
    return <p>You must be logged in to access this page</p>
  }

  // Handle addition of the email address
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    try {
      // Add an unverified email address to user
      const res = await user.createEmailAddress({ email })
      // Reload user to get updated User object
      await user.reload()

      // Find the email address that was just added
      const emailAddress = user.emailAddresses.find((a) => a.id === res.id)
      // Create a reference to the email address that was just added
      setEmailObj(emailAddress)

      // Send the user an email with the verification code
      emailAddress?.prepareVerification({ strategy: 'email_code' })

      // Set to true to display second form
      // and capture the OTP code
      setIsVerifying(true)
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }

  // Handle the submission of the verification form
  const verifyCode = async (e: React.FormEvent) => {
    e.preventDefault()
    try {
      // Verify that the code entered matches the code sent to the user
      const emailVerifyAttempt = await emailObj?.attemptVerification({ code })

      if (emailVerifyAttempt?.verification.status === 'verified') {
        setSuccessful(true)
      } else {
        // If the status is not complete, check why. User may need to
        // complete further steps.
        console.error(JSON.stringify(emailVerifyAttempt, null, 2))
      }
    } catch (err) {
      console.error(JSON.stringify(err, null, 2))
    }
  }

  // Display a success message if the email was added successfully
  if (successful) {
    return (
      <>
        <h1>Email added!</h1>
      </>
    )
  }

  // Display the verification form to capture the OTP code
  if (isVerifying) {
    return (
      <>
        <h1>Verify email</h1>
        <div>
          <form onSubmit={(e) => verifyCode(e)}>
            <div>
              <label htmlFor="code">Enter code</label>
              <input
                onChange={(e) => setCode(e.target.value)}
                id="code"
                name="code"
                type="text"
                value={code}
              />
            </div>
            <div>
              <button type="submit">Verify</button>
            </div>
          </form>
        </div>
      </>
    )
  }

  // Display the initial form to capture the email address
  return (
    <>
      <h1>Add Email</h1>
      <div>
        <form onSubmit={(e) => handleSubmit(e)}>
          <div>
            <label htmlFor="email">Enter email address</label>
            <input
              onChange={(e) => setEmail(e.target.value)}
              id="email"
              name="email"
              type="email"
              value={email}
            />
          </div>
          <div>
            <button type="submit">Continue</button>
          </div>
        </form>
      </div>
    </>
  )
}

----------------------------------------

TITLE: Configuring Clerk Middleware for Public Routes
DESCRIPTION: Implementation of Clerk middleware to handle public and protected routes, specifically allowing access to the sign-in page while protecting other routes.

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

const isPublicRoute = createRouteMatcher(['/sign-in(.*)'])

export default clerkMiddleware(async (auth, req) => {
  if (!isPublicRoute(req)) {
    await auth.protect()
  }
})

export const config = {
  matcher: [
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Implementing Custom Google One Tap Component in Next.js
DESCRIPTION: A React component that implements Google One Tap authentication using Clerk and Next.js. The component initializes the Google Sign In client, handles authentication callbacks, and manages the authentication flow with error handling. Requires Google Client ID and Clerk configuration.

LANGUAGE: tsx
CODE:
'use client'
import { useClerk } from '@clerk/nextjs'
import { useRouter } from 'next/navigation'
import Script from 'next/script'
import { useEffect } from 'react'

declare global {
  interface Window {
    google: any
  }
}

export function CustomGoogleOneTap({ children }: { children: React.ReactNode }) {
  const clerk = useClerk()
  const router = useRouter()

  useEffect(() => {
    const timeout = setTimeout(() => oneTap(), 2000)
    return () => {
      clearTimeout(timeout)
    }
  }, [])

  const oneTap = () => {
    const { google } = window
    if (google) {
      google.accounts.id.initialize({
        client_id: 'xxx-xxx-xxx',
        callback: async (response: any) => {
          call(response.credential)
        },
      })

      return google.accounts.id.prompt((notification: any) => {
        console.log('Notification ::', notification)
        if (notification.isNotDisplayed()) {
          console.log('getNotDisplayedReason ::', notification.getNotDisplayedReason())
        } else if (notification.isSkippedMoment()) {
          console.log('getSkippedReason  ::', notification.getSkippedReason())
        } else if (notification.isDismissedMoment()) {
          console.log('getDismissedReason ::', notification.getDismissedReason())
        }
      })
    }
  }

  const call = async (token: any) => {
    try {
      const res = await clerk.authenticateWithGoogleOneTap({
        token,
      })

      await clerk.handleGoogleOneTapCallback(res, {
        signInFallbackRedirectUrl: '/example-fallback-path',
      })
    } catch (error) {
      router.push('/sign-in')
    }
  }

  return (
    <>
      <Script src="https://accounts.google.com/gsi/client" strategy="beforeInteractive">
        {children}
      </Script>
    </>
  )
}

----------------------------------------

TITLE: Manually Verifying Clerk Session Tokens in Go
DESCRIPTION: This snippet shows how to manually verify a Clerk session token in a Go application. It extracts the token from the Authorization header, verifies it, and returns user information if valid.

LANGUAGE: go
CODE:
package main

import (
	"fmt"
	"net/http"
	"strings"

	"github.com/clerk/clerk-sdk-go/v2"
	"github.com/clerk/clerk-sdk-go/v2/jwt"
	"github.com/clerk/clerk-sdk-go/v2/user"
)

func main() {
  clerk.SetKey("{{secret}}")

	mux := http.NewServeMux()
	mux.HandleFunc("/", publicRoute)
	mux.HandleFunc("/protected", protectedRoute)

	http.ListenAndServe(":3000", mux)
}

func publicRoute(w http.ResponseWriter, r *http.Request) {
	w.Write([]byte(`{"access": "public"}`))
}

func protectedRoute(w http.ResponseWriter, r *http.Request) {
	// Get the session JWT from the Authorization header
	sessionToken := strings.TrimPrefix(r.Header.Get("Authorization"), "Bearer ")

	// Verify the session
	claims, err := jwt.Verify(r.Context(), &jwt.VerifyParams{
		Token: sessionToken,
	})
	if err != nil {
		// handle the error
		w.WriteHeader(http.StatusUnauthorized)
		w.Write([]byte(`{"access": "unauthorized"}`))
		return
	}

	usr, err := user.Get(r.Context(), claims.Subject)
	if err != nil {
		// handle the error
	}
	fmt.Fprintf(w, `{"user_id": "%s", "user_banned": "%t"}`, usr.ID, usr.Banned)
}

----------------------------------------

TITLE: Implementing Organization Invitation Flow in Next.js
DESCRIPTION: A Next.js component that handles organization invitations using Clerk. The component processes invitation tokens, manages sign-up and sign-in flows, and includes a form for collecting user information during sign-up. It uses Clerk hooks for authentication and organization management.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useOrganization, useSignIn, useSignUp } from '@clerk/nextjs'
import { useSearchParams } from 'next/navigation'

export default function Page() {
  const { isLoaded, signUp, setActive: setActiveSignUp } = useSignUp()
  const { signIn, setActive: setActiveSignIn } = useSignIn()
  const { organization } = useOrganization()
  const [firstName, setFirstName] = React.useState('')
  const [lastName, setLastName] = React.useState('')
  const [password, setPassword] = React.useState('')

  // Get the token and account status from the query params
  const token = useSearchParams().get('__clerk_ticket')
  const accountStatus = useSearchParams().get('__clerk_status')

  // If there is no invitation token, restrict access to this page
  if (!token) {
    return <p>No invitation token found.</p>
  }

  // Handle sign-in
  React.useEffect(() => {
    if (!signIn || !setActiveSignIn || !token || organization || accountStatus !== 'sign_in') {
      return
    }

    const createSignIn = async () => {
      try {
        // Create a new `SignIn` with the supplied invitation token.
        // Make sure you're also passing the ticket strategy.
        const signInAttempt = await signIn.create({
          strategy: 'ticket',
          ticket: token as string,
        })

        // If the sign-in was successful, set the session to active
        if (signInAttempt.status === 'complete') {
          await setActiveSignIn({
            session: signInAttempt.createdSessionId,
          })
        } else {
          // If the sign-in attempt is not complete, check why.
          // User may need to complete further steps.
          console.error(JSON.stringify(signInAttempt, null, 2))
        }
      } catch (err) {
        // See https://clerk.com/docs/custom-flows/error-handling
        // for more info on error handling
        console.error('Error:', JSON.stringify(err, null, 2))
      }
    }

    createSignIn()
  }, [signIn])

  // Handle submission of the sign-up form
  const handleSignUp = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!isLoaded) return

    try {
      // Create a new sign-up with the supplied invitation token.
      // Make sure you're also passing the ticket strategy.
      // After the below call, the user's email address will be
      // automatically verified because of the invitation token.
      const signUpAttempt = await signUp.create({
        strategy: 'ticket',
        ticket: token,
        firstName,
        lastName,
        password,
      })

      // If the sign-up was successful, set the session to active
      if (signUpAttempt.status === 'complete') {
        await setActiveSignUp({ session: signUpAttempt.createdSessionId })
      } else {
        // If the sign-in attempt is not complete, check why.
        // User may need to complete further steps.
        console.error(JSON.stringify(signUpAttempt, null, 2))
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }

  if (accountStatus === 'sign_in' && !organization) {
    return <div>Signing you in...</div>
  }

  if (accountStatus === 'sign_up' && !organization) {
    return (
      <>
        <h1>Sign up</h1>
        <form onSubmit={handleSignUp}>
          <div>
            <label htmlFor="firstName">Enter first name</label>
            <input
              id="firstName"
              type="text"
              name="firstName"
              value={firstName}
              onChange={(e) => setFirstName(e.target.value)}
            />
          </div>
          <div>
            <label htmlFor="lastName">Enter last name</label>
            <input
              id="lastName"
              type="text"
              name="lastName"
              value={lastName}
              onChange={(e) => setLastName(e.target.value)}
            />
          </div>
          <div>
            <label htmlFor="password">Enter password</label>
            <input
              id="password"
              type="password"
              name="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
            />
          </div>
          <div>
            <button type="submit">Next</button>
          </div>
        </form>
      </>
    )
  }

  return <div>Organization invitation accepted!</div>
}

----------------------------------------

TITLE: Checking User Permissions with Clerk's has() Function in Next.js
DESCRIPTION: Demonstrates how to use the has() function to check user permissions in a Next.js client component and conditionally render content.

LANGUAGE: tsx
CODE:
'use client'
import { useAuth } from '@clerk/nextjs'

export default function SettingsForm() {
  const { has } = useAuth()

  if (!has) return null

  const canManageSettings = has({ permission: 'org:team_settings:manage' })

  if (!canManageSettings) return null

  return <form>{/* Add UI for managing team settings */}</form>
}

----------------------------------------

TITLE: Accessing User Data in Next.js App Router Route Handler
DESCRIPTION: This example demonstrates how to use the auth() and currentUser() helpers in a Next.js App Router route handler to protect routes and access user data.

LANGUAGE: tsx
CODE:
import { NextResponse } from 'next/server'
import { currentUser, auth } from '@clerk/nextjs/server'

export async function GET() {
  // Use `auth()` to get the user's ID
  const { userId } = await auth()

  // Protect the route by checking if the user is signed in
  if (!userId) {
    return new NextResponse('Unauthorized', { status: 401 })
  }

  // Use `currentUser()` to get the Backend API User object
  const user = await currentUser()

  // Add your Route Handler's logic with the returned `user` object

  return NextResponse.json({ user: user }, { status: 200 })
}

----------------------------------------

TITLE: Adding Start Step to Sign-In Flow
DESCRIPTION: Implements the initial step of the sign-in flow by adding the SignIn.Step component with a start name property.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'

export default function SignInPage() {
  return (
    <SignIn.Root>
      <SignIn.Step name="start">
        <h1>Sign in to your account</h1>
      </SignIn.Step>
    </SignIn.Root>
  )
}

----------------------------------------

TITLE: Implementing OAuth Sign-In with Next.js
DESCRIPTION: This snippet shows how to create a custom OAuth sign-in flow using Clerk in a Next.js application. It uses the useSignIn hook to authenticate with a redirect and handles the OAuth callback.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { OAuthStrategy } from '@clerk/types'
import { useSignIn } from '@clerk/nextjs'

export default function OauthSignIn() {
  const { signIn } = useSignIn()

  if (!signIn) return null

  const signInWith = (strategy: OAuthStrategy) => {
    return signIn
      .authenticateWithRedirect({
        strategy,
        redirectUrl: '/sign-up/sso-callback',
        redirectUrlComplete: '/',
      })
      .then((res) => {
        console.log(res)
      })
      .catch((err: any) => {
        // See https://clerk.com/docs/custom-flows/error-handling
        // for more info on error handling
        console.log(err.errors)
        console.error(err, null, 2)
      })
  }

  // Render a button for each supported OAuth provider
  // you want to add to your app. This example uses only Google.
  return (
    <div>
      <button onClick={() => signInWith('oauth_google')}>Sign in with Google</button>
    </div>
  )
}

LANGUAGE: tsx
CODE:
import { AuthenticateWithRedirectCallback } from '@clerk/nextjs'

export default function Page() {
  // Handle the redirect flow by calling the Clerk.handleRedirectCallback() method
  // or rendering the prebuilt <AuthenticateWithRedirectCallback/> component.
  // This is the final step in the custom OAuth flow.
  return <AuthenticateWithRedirectCallback />
}

----------------------------------------

TITLE: Accessing User Data in Next.js App Router Server Components
DESCRIPTION: This snippet shows how to use the auth() and currentUser() helpers in a Next.js App Router server component to protect routes and access user data.

LANGUAGE: tsx
CODE:
import { auth, currentUser } from '@clerk/nextjs/server'

export default async function Page() {
  // Get the userId from auth() -- if null, the user is not signed in
  const { userId } = await auth()

  // Protect the route by checking if the user is signed in
  if (!userId) {
    return <div>Sign in to view this page</div>
  }

  // Get the Backend API User object when you need access to the user's information
  const user = await currentUser()

  // Use `user` to render user details or create UI elements
  return <div>Welcome, {user.firstName}!</div>
}

----------------------------------------

TITLE: Initializing Clerk Client with Backend SDK
DESCRIPTION: Creates a Clerk client instance using the createClerkClient function with a secret key from environment variables.

LANGUAGE: typescript
CODE:
import { createClerkClient } from '@clerk/backend'

const clerkClient = createClerkClient({ secretKey: process.env.CLERK_SECRET_KEY })

----------------------------------------

TITLE: Protecting Route Handlers with Clerk in Next.js
DESCRIPTION: Demonstrates two methods to protect Route Handlers using Clerk: auth.protect() for automatic 404 errors, and auth().userId for custom error handling.

LANGUAGE: typescript
CODE:
import { auth } from '@clerk/nextjs/server'

export async function GET() {
  // If there is no signed in user, this will return a 404 error
  await auth.protect()

  // Add your Route Handler logic here

  return Response.json({ message: 'Hello world!' })
}

LANGUAGE: typescript
CODE:
import { auth } from '@clerk/nextjs/server'
import { NextResponse } from 'next/server'

export async function GET() {
  const { userId } = await auth()

  if (!userId) {
    return NextResponse.json({ error: 'Error: No signed in user' }, { status: 401 })
  }

  // Add your Route Handler logic here

  return NextResponse.json({ userId })
}

----------------------------------------

TITLE: Initializing Clerk Middleware in Express
DESCRIPTION: Demonstrates how to use the clerkMiddleware() function in an Express application. It can be used without parameters or with options for customization.

LANGUAGE: javascript
CODE:
import { clerkMiddleware } from '@clerk/express'

const app = express()

// Pass no parameters
app.use(clerkMiddleware())

// Pass options
app.use(clerkMiddleware(options))

----------------------------------------

TITLE: Same-Origin Request with Vanilla JavaScript Fetch
DESCRIPTION: Simple example of making an authenticated request to a same-origin endpoint using the native Fetch API. The session token is automatically included in cookies.

LANGUAGE: javascript
CODE:
fetch('/api/foo').then((res) => res.json())

----------------------------------------

TITLE: Configuring rootAuthLoader() with options in React Router
DESCRIPTION: This snippet illustrates how to pass configuration options to rootAuthLoader() in a React Router setup, including both a callback function and additional options like signInUrl.

LANGUAGE: tsx
CODE:
import { rootAuthLoader } from '@clerk/react-router/ssr.server'
import type { Route } from './+types/root'

export async function loader(args: Route.LoaderArgs) {
  return rootAuthLoader(
    args,
    ({ req, context, params }) => {
      const { sessionId, userId, getToken } = req.auth
      // Add logic to fetch data
      return { yourData: 'here' }
    },
    { signInUrl: '/sign-in' }, // Options
  )
}

----------------------------------------

TITLE: iOS Swift MFA Sign-in Implementation
DESCRIPTION: SwiftUI implementation of MFA sign-in flow using Clerk's iOS SDK, providing email/password authentication with TOTP second factor verification.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct MFASignInView: View {
  @State private var email = ""
  @State private var password = ""
  @State private var code = ""
  @State private var displayTOTP = false
  //... rest of implementation

----------------------------------------

TITLE: Creating User with Clerk in Express
DESCRIPTION: This snippet shows how to create a user using the Clerk client in an Express application. It handles POST requests to the /createUser endpoint, creates a user with the provided data, and returns a JSON response with the result or error message.

LANGUAGE: typescript
CODE:
import { clerkClient } from '@clerk/express'

app.post('/createUser', async (req, res) => {
  const userData = req.body

  try {
    const user = await clerkClient.users.createUser(userData)
    res.status(200).json({ message: 'User created', user })
  } catch (error) {
    console.log(error)
    res.status(500).json({ error: 'Error creating user' })
  }
})

----------------------------------------

TITLE: Loading Clerk Configuration
DESCRIPTION: Initializes the Clerk object and loads all necessary environment configuration and instance settings from the Frontend API. This method must be called before using the Clerk object in your code.

LANGUAGE: TypeScript
CODE:
function load(options?: ClerkOptions): Promise<void>

----------------------------------------

TITLE: Implementing TOTP MFA Management in Expo
DESCRIPTION: This code snippet demonstrates how to create a page for managing TOTP-based MFA settings in an Expo application. It includes components for enabling/disabling TOTP and generating backup codes.

LANGUAGE: tsx
CODE:
import React from 'react'
import { useUser } from '@clerk/clerk-expo'
import { useRouter } from 'expo-router'
import { View, Text, Button, FlatList } from 'react-native'
import { BackupCodeResource } from '@clerk/types'

export default function ManageTOTPMfa() {
  const router = useRouter()
  const [backupCodes, setBackupCodes] = React.useState<BackupCodeResource | undefined>(undefined)
  const [loading, setLoading] = React.useState(false)

  const { isLoaded, user } = useUser()

  if (!isLoaded || !user) return null

  const generateBackupCodes = () => {
    setLoading(true)
    void user
      ?.createBackupCode()
      .then((backupCodes: BackupCodeResource) => {
        setBackupCodes(backupCodes)
        setLoading(false)
      })
      .catch((error) => {
        console.log('Error:', error)
        setLoading(false)
      })
  }

  const disableTOTP = async () => {
    await user.disableTOTP()
  }

  const MFAEnabled = () => {
    return (
      <View style={{ flexDirection: 'row', alignItems: 'center' }}>
        <Text>TOTP via authentication app enabled - </Text>
        <Button onPress={() => disableTOTP()} title="Remove" />
      </View>
    )
  }

  const MFADisabled = () => {
    return (
      <View style={{ flexDirection: 'row', alignItems: 'center' }}>
        <Text>Add TOTP via authentication app - </Text>
        <Button onPress={() => router.push('/add-mfa')} title="Add" />
      </View>
    )
  }

  return (
    <>
      <Text>Current MFA Settings</Text>

      <Text>Authenticator App</Text>

      {user.totpEnabled ? <MFAEnabled /> : <MFADisabled />}

      {user.backupCodeEnabled && (
        <View>
          <Text>Backup Codes</Text>
          {loading && <Text>Loading...</Text>}
          {backupCodes && !loading && (
            <FlatList
              data={backupCodes.codes}
              renderItem={(code) => <Text>{code.item}</Text>}
              keyExtractor={(item) => item}
            />
          )}
          <Button onPress={() => generateBackupCodes()} title="Regenerate Codes" />
        </View>
      )}
    </>
  )
}

----------------------------------------

TITLE: Implementing Sign-In Page Component in React Router with Clerk
DESCRIPTION: Creates a basic sign-in page component using Clerk's SignIn component. This component provides a unified interface for both sign-in and sign-up functionality.

LANGUAGE: typescript
CODE:
import { SignIn } from '@clerk/react-router'

export default function SignInPage() {
  return (
    <div>
      <h1>Sign in or up route</h1>
      <SignIn />
    </div>
  )
}

----------------------------------------

TITLE: Implementing Custom Sign-Up with CAPTCHA in Next.js
DESCRIPTION: This code snippet shows a Next.js component for a custom sign-up flow using Clerk. It includes email and password input, email verification, and integration of the Clerk CAPTCHA widget for bot protection.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useSignUp } from '@clerk/nextjs'
import { useRouter } from 'next/navigation'

export default function Page() {
  const { isLoaded, signUp, setActive } = useSignUp()
  const [emailAddress, setEmailAddress] = React.useState('')
  const [password, setPassword] = React.useState('')
  const [verifying, setVerifying] = React.useState(false)
  const [code, setCode] = React.useState('')
  const router = useRouter()

  // Handle submission of the sign-up form
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!isLoaded) return

    // Start the sign-up process using the email and password provided
    try {
      await signUp.create({
        emailAddress,
        password,
      })

      // Send the user an email with the verification code
      await signUp.prepareEmailAddressVerification({
        strategy: 'email_code',
      })

      // Set 'verifying' true to display second form
      // and capture the OTP code
      setVerifying(true)
    } catch (err: any) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }

  // Handle the submission of the verification form
  const handleVerify = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!isLoaded) return

    try {
      // Use the code the user provided to attempt verification
      const completeSignUp = await signUp.attemptEmailAddressVerification({
        code,
      })

      // If verification was completed, set the session to active
      // and redirect the user
      if (completeSignUp.status === 'complete') {
        await setActive({ session: completeSignUp.createdSessionId })
        router.push('/')
      } else {
        // If the status is not complete, check why. User may need to
        // complete further steps.
        console.error(JSON.stringify(completeSignUp, null, 2))
      }
    } catch (err: any) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error('Error:', JSON.stringify(err, null, 2))
    }
  }

  // Display the verification form to capture the OTP code
  if (verifying) {
    return (
      <>
        <h1>Verify your email</h1>
        <form onSubmit={handleVerify}>
          <label id="code">Enter your verification code</label>
          <input value={code} id="code" name="code" onChange={(e) => setCode(e.target.value)} />
          <button type="submit">Verify</button>
        </form>
      </>
    )
  }

  // Display the initial sign-up form to capture the email and password
  return (
    <>
      <h1>Sign up</h1>
      <form onSubmit={handleSubmit}>
        <div>
          <label htmlFor="email">Enter email address</label>
          <input
            id="email"
            type="email"
            name="email"
            value={emailAddress}
            onChange={(e) => setEmailAddress(e.target.value)}
          />
        </div>
        <div>
          <label htmlFor="password">Enter password</label>
          <input
            id="password"
            type="password"
            name="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
          />
        </div>

        {/* CAPTCHA Widget */}
        <div id="clerk-captcha"></div>

        <div>
          <button type="submit">Next</button>
        </div>
      </form>
    </>
  )
}

----------------------------------------

TITLE: Retrieving Auth State with getAuth() - Clerk TypeScript
DESCRIPTION: Function signature for retrieving authentication state from a Next.js request object. Accepts an optional configuration object that can include a custom secretKey for session token signing.

LANGUAGE: typescript
CODE:
getAuth(req: NextRequest, opts?: { secretKey?: string }): Auth

----------------------------------------

TITLE: Implementing ClerkProvider in JSX for Global Authentication Context
DESCRIPTION: This snippet demonstrates the basic usage of the ClerkProvider component to wrap an entire application. It provides session and user context to Clerk's hooks and components, making authentication globally accessible.

LANGUAGE: jsx
CODE:
<ClerkProvider>

----------------------------------------

TITLE: Implementing OrganizationSwitcher in Next.js
DESCRIPTION: Example of how to use the OrganizationSwitcher component in a Next.js application. This code snippet demonstrates the basic implementation within a page component.

LANGUAGE: jsx
CODE:
import { OrganizationSwitcher } from '@clerk/nextjs'

export default function OrganizationSwitcherPage() {
  return <OrganizationSwitcher />
}

----------------------------------------

TITLE: Using Clerk SDK Without Client
DESCRIPTION: Demonstrates how to use the Clerk SDK without instantiating a client, including basic CRUD operations. This approach is recommended for applications using a single API key.

LANGUAGE: go
CODE:
import (
  "github.com/clerk/clerk-sdk-go/v2"
  "github.com/clerk/clerk-sdk-go/v2/$resource$"
)

// Each operation requires a context.Context as the first argument.
ctx := context.Background()

// Set the API key with your Clerk Secret Key
clerk.SetKey("sk_live_xxx")

// Create
resource, err := $resource$.Create(ctx, &$resource$.CreateParams{})

// Get
resource, err := $resource$.Get(ctx, id)

// Update
resource, err := $resource$.Update(ctx, id, &$resource$.UpdateParams{})

// Delete
resource, err := $resource$.Delete(ctx, id)

// List
list, err := $resource$.List(ctx, &$resource$.ListParams{})
for _, resource := range list.$Resource$s {
    // do something with the resource
}

----------------------------------------

TITLE: Implementing Authentication with useAuth() in Next.js
DESCRIPTION: Example of using the useAuth() hook in a Next.js client component to manage authentication state and make authenticated API requests. Includes handling of loading states and authenticated data fetching.

LANGUAGE: tsx
CODE:
'use client'

import { useAuth } from '@clerk/nextjs'

export default function ExternalDataPage() {
  const { userId, sessionId, getToken, isLoaded, isSignedIn } = useAuth()

  const fetchExternalData = async () => {
    const token = await getToken()

    // Fetch data from an external API
    const response = await fetch('https://api.example.com/data', {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    })

    return response.json()
  }

  if (!isLoaded) {
    return <div>Loading...</div>
  }

  if (!isSignedIn) {
    return <div>Sign in to view this page</div>
  }

  return (
    <div>
      <p>
        Hello, {userId}! Your current active session is {sessionId}.
      </p>
      <button onClick={fetchExternalData}>Fetch Data</button>
    </div>
  )
}

----------------------------------------

TITLE: Implementing ClerkProvider with Suspense Boundary
DESCRIPTION: Shows how to implement the ClerkProvider with dynamic prop wrapped in a Suspense boundary for optimal partial prerendering support. This pattern allows for static content while maintaining dynamic auth data access.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/nextjs'

export default async function Page() {
  return (
    <>
      <header>
        <Logo />
        <Suspense fallback={<Skeleton />}>
          <ClerkProvider dynamic>
            <UserGreeting />
          </ClerkProvider>
        </Suspense>
      </header>
      <main>Hello world!</main>
    </>
  )
}

----------------------------------------

TITLE: Using Protected tRPC Procedure
DESCRIPTION: Shows how to implement a protected tRPC procedure that requires authentication to access sensitive data.

LANGUAGE: typescript
CODE:
export const protectedRouter = router({
  hello: protectedProcedure.query(({ ctx }) => {
    const { userId } = ctx.auth

    return {
      secret: `${userId} is using a protected procedure`,
    }
  }),
})

----------------------------------------

TITLE: Server-side Data Loading with Clerk in React Router
DESCRIPTION: Demonstrates how to use getAuth() helper and Backend SDK to fetch user data during route loading. The code protects routes and retrieves the full Backend User object using Clerk's client.

LANGUAGE: tsx
CODE:
import { redirect } from 'react-router'
import { getAuth } from '@clerk/react-router/ssr.server'
import { createClerkClient } from '@clerk/react-router/api.server'
import type { Route } from './+types/profile'

export async function loader(args: Route.LoaderArgs) {
  // Use `getAuth()` to get the user's ID
  const { userId } = await getAuth(args)

  // Protect the route by checking if the user is signed in
  if (!userId) {
    return redirect('/sign-in?redirect_url=' + args.request.url)
  }

  // Instantiate the Backend SDK and get the user's full `Backend User` object
  const user = await createClerkClient({ secretKey: process.env.CLERK_SECRET_KEY }).users.getUser(
    userId,
  )

  return {
    user: JSON.stringify(user),
  }
}

export default function Profile({ loaderData }: Route.ComponentProps) {
  return (
    <div>
      <h1>Profile Data</h1>
      <pre>
        <code>{JSON.stringify(loaderData, null, 2)}</code>
      </pre>
    </div>
  )
}

----------------------------------------

TITLE: Accessing Current User Data in Next.js Server Component with Clerk
DESCRIPTION: This code snippet demonstrates how to use the currentUser() helper from Clerk in a Next.js Server Component. It fetches the current user's data and renders a greeting if the user is signed in, or a message if not signed in.

LANGUAGE: tsx
CODE:
import { currentUser } from '@clerk/nextjs/server'

export default async function Page() {
  const user = await currentUser()

  if (!user) return <div>Not signed in</div>

  return <div>Hello {user?.firstName}</div>
}

----------------------------------------

TITLE: Email-based Password Reset Implementation in Next.js
DESCRIPTION: A React component implementing email-based password reset flow using Clerk's API in Next.js. Handles sending reset codes, password updates, and 2FA scenarios.

LANGUAGE: typescript
CODE:
'use client'
import React, { useEffect, useState } from 'react'
import { useAuth, useSignIn } from '@clerk/nextjs'
import type { NextPage } from 'next'
import { useRouter } from 'next/navigation'

const ForgotPasswordPage: NextPage = () => {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [code, setCode] = useState('')
  const [successfulCreation, setSuccessfulCreation] = useState(false)
  const [secondFactor, setSecondFactor] = useState(false)
  const [error, setError] = useState('')

  const router = useRouter()
  const { isSignedIn } = useAuth()
  const { isLoaded, signIn, setActive } = useSignIn()

  useEffect(() => {
    if (isSignedIn) {
      router.push('/')
    }
  }, [isSignedIn, router])

  if (!isLoaded) {
    return null
  }

  async function create(e: React.FormEvent) {
    e.preventDefault()
    await signIn
      ?.create({
        strategy: 'reset_password_email_code',
        identifier: email,
      })
      .then((_) => {
        setSuccessfulCreation(true)
        setError('')
      })
      .catch((err) => {
        console.error('error', err.errors[0].longMessage)
        setError(err.errors[0].longMessage)
      })
  }

  async function reset(e: React.FormEvent) {
    e.preventDefault()
    await signIn
      ?.attemptFirstFactor({
        strategy: 'reset_password_email_code',
        code,
        password,
      })
      .then((result) => {
        if (result.status === 'needs_second_factor') {
          setSecondFactor(true)
          setError('')
        } else if (result.status === 'complete') {
          setActive({ session: result.createdSessionId })
          setError('')
        } else {
          console.log(result)
        }
      })
      .catch((err) => {
        console.error('error', err.errors[0].longMessage)
        setError(err.errors[0].longMessage)
      })
  }

  return (
    <div>
      <h1>Forgot Password?</h1>
      <form onSubmit={!successfulCreation ? create : reset}>
        {!successfulCreation && (
          <>
            <label htmlFor="email">Provide your email address</label>
            <input
              type="email"
              placeholder="e.g john@doe.com"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
            />

            <button>Send password reset code</button>
            {error && <p>{error}</p>}
          </>
        )}

        {successfulCreation && (
          <>
            <label htmlFor="password">Enter your new password</label>
            <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} />

            <label htmlFor="password">
              Enter the password reset code that was sent to your email
            </label>
            <input type="code" value={code} onChange={(e) => setCode(e.target.value)} />

            <button>Reset</button>
            {error && <p>{error}</p>}
          </>
        )}

        {secondFactor && <p>2FA is required, but this UI does not handle that</p>}
      </form>
    </div>
  )
}

export default ForgotPasswordPage

----------------------------------------

TITLE: Implementing ClerkLoading in Next.js App Router
DESCRIPTION: Example of using ClerkLoading component in Next.js App Router layout file to show loading state while Clerk initializes. Demonstrates usage with ClerkProvider and ClerkLoaded components.

LANGUAGE: tsx
CODE:
import { ClerkProvider, ClerkLoaded, ClerkLoading } from '@clerk/nextjs'
import './globals.css'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body>
          <ClerkLoading>
            <div>Clerk is loading...</div>
          </ClerkLoading>
          <ClerkLoaded>{children}</ClerkLoaded>
        </body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Implementing Clerk Middleware in Express
DESCRIPTION: Basic Express server setup with Clerk middleware integration for session handling.

LANGUAGE: typescript
CODE:
import 'dotenv/config'
import express from 'express'
import { clerkMiddleware } from '@clerk/express'

const app = express()
const PORT = 3000

app.use(clerkMiddleware())

// Start the server and listen on the specified port
app.listen(PORT, () => {
  console.log(`Example app listening at http://localhost:${PORT}`)
})

----------------------------------------

TITLE: Phone-based Password Reset Implementation in Next.js
DESCRIPTION: A React component implementing phone-based password reset flow using Clerk's API in Next.js. Handles sending SMS codes, password updates, and 2FA scenarios.

LANGUAGE: typescript
CODE:
'use client'
import React, { useState, useEffect } from 'react'
import { useAuth, useSignIn } from '@clerk/nextjs'
import type { NextPage } from 'next'
import { useRouter } from 'next/navigation'

const ForgotPasswordPage: NextPage = () => {
  const [phoneNumber, setPhoneNumber] = useState('')
  const [password, setPassword] = useState('')
  const [code, setCode] = useState('')
  const [successfulCreation, setSuccessfulCreation] = useState(false)
  const [secondFactor, setSecondFactor] = useState(false)
  const [error, setError] = useState('')

  const router = useRouter()
  const { isSignedIn } = useAuth()
  const { isLoaded, signIn, setActive } = useSignIn()

  useEffect(() => {
    if (isSignedIn) {
      router.push('/')
    }
  }, [isSignedIn, router])

  if (!isLoaded) {
    return null
  }

  async function create(e: React.FormEvent) {
    e.preventDefault()
    await signIn
      ?.create({
        strategy: 'reset_password_phone_code',
        identifier: phoneNumber,
      })
      .then((_) => {
        setSuccessfulCreation(true)
        setError('')
      })
      .catch((err) => {
        console.error('error', err.errors[0].longMessage)
        setError(err.errors[0].longMessage)
      })
  }

  async function reset(e: React.FormEvent) {
    e.preventDefault()
    await signIn
      ?.attemptFirstFactor({
        strategy: 'reset_password_phone_code',
        code,
        password,
      })
      .then((result) => {
        if (result.status === 'needs_second_factor') {
          setSecondFactor(true)
          setError('')
        } else if (result.status === 'complete') {
          setActive({ session: result.createdSessionId })
          setError('')
        } else {
          console.log(result)
        }
      })
      .catch((err) => {
        console.error('error', err.errors[0].longMessage)
        setError(err.errors[0].longMessage)
      })
  }

  return (
    <div>
      <h1>Forgot Password?</h1>
      <form onSubmit={!successfulCreation ? create : reset}>
        {!successfulCreation && (
          <>
            <label htmlFor="phoneNumber">Provide your phone number</label>
            <input
              type="tel"
              placeholder="e.g +1234567890"
              value={phoneNumber}
              onChange={(e) => setPhoneNumber(e.target.value)}
            />

            <button>Send password reset code</button>
            {error && <p>{error}</p>}
          </>
        )}

        {successfulCreation && (
          <>
            <label htmlFor="password">Enter your new password</label>
            <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} />

            <label htmlFor="code">
              Enter the password reset code that was sent to your phone number
            </label>
            <input type="text" value={code} onChange={(e) => setCode(e.target.value)} />

            <button>Reset</button>
            {error && <p>{error}</p>}
          </>
        )}

        {secondFactor && <p>2FA is required, but this UI does not handle that</p>}
      </form>
    </div>
  )
}

export default ForgotPasswordPage

----------------------------------------

TITLE: Using useClerk() Composable to Open Sign-in Modal in Vue
DESCRIPTION: This snippet demonstrates how to use the useClerk() composable to access the clerk object and open a sign-in modal. It imports the composable from '@clerk/vue', uses it in the setup script, and binds the openSignIn method to a button click event.

LANGUAGE: vue
CODE:
<script setup>
import { useClerk } from '@clerk/vue'

const clerk = useClerk()
</script>

<template>
  <button @click="clerk.openSignIn">Sign in</button>
</template>

----------------------------------------

TITLE: Implementing Form Fields with Social Connection
DESCRIPTION: Adds input fields for user identification and social connection options using Clerk.Field and Connection components.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'

export default function SignInPage() {
  return (
    <SignIn.Root>
      <SignIn.Step name="start">
        <h1>Sign in to your account</h1>

        <Clerk.Connection name="google">Sign in with Google</Clerk.Connection>

        <Clerk.Field name="identifier">
          <Clerk.Label>Email</Clerk.Label>
          <Clerk.Input />
          <Clerk.FieldError />
        </Clerk.Field>

        <SignIn.Action submit>Continue</SignIn.Action>
      </SignIn.Step>
    </SignIn.Root>
  )
}

----------------------------------------

TITLE: Implementing Sign-In Button with useClerk() in React
DESCRIPTION: This snippet demonstrates how to use the useClerk() hook to access the clerk object and implement a sign-in button in a React component.

LANGUAGE: tsx
CODE:
import { useClerk } from '@clerk/clerk-react'

export default function Home() {
  const clerk = useClerk()

  return <button onClick={() => clerk.openSignIn({})}>Sign in</button>
}

----------------------------------------

TITLE: Creating User with Basic Information
DESCRIPTION: Example showing how to create a new user with first name, last name, email address, and password using the Clerk Backend SDK.

LANGUAGE: tsx
CODE:
const response = await clerkClient.users.createUser({
  firstName: 'Test',
  lastName: 'User',
  emailAddress: ['testclerk123@gmail.com'],
  password: 'password',
})

----------------------------------------

TITLE: Implementing SMS OTP Sign-Up Flow in Next.js
DESCRIPTION: This code snippet demonstrates how to implement a custom SMS OTP sign-up flow using Clerk in a Next.js application. It handles collecting the phone number, sending the OTP, verifying the code, and setting the active session.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useSignUp } from '@clerk/nextjs'
import { useRouter } from 'next/navigation'

export default function Page() {
  const { isLoaded, signUp, setActive } = useSignUp()
  const [verifying, setVerifying] = React.useState(false)
  const [phone, setPhone] = React.useState('')
  const [code, setCode] = React.useState('')
  const router = useRouter()

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault()

    if (!isLoaded && !signUp) return null

    try {
      // Start the sign-up process using the phone number method
      await signUp.create({
        phoneNumber: phone,
      })

      // Start the verification - a SMS message will be sent to the
      // number with a one-time code
      await signUp.preparePhoneNumberVerification()

      // Set verifying to true to display second form and capture the OTP code
      setVerifying(true)
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error('Error:', JSON.stringify(err, null, 2))
    }
  }

  async function handleVerification(e: React.FormEvent) {
    e.preventDefault()

    if (!isLoaded && !signUp) return null

    try {
      // Use the code provided by the user and attempt verification
      const signUpAttempt = await signUp.attemptPhoneNumberVerification({
        code,
      })

      // If verification was completed, set the session to active
      // and redirect the user
      if (signUpAttempt.status === 'complete') {
        await setActive({ session: signUpAttempt.createdSessionId })

        router.push('/')
      } else {
        // If the status is not complete, check why. User may need to
        // complete further steps.
        console.error(signUpAttempt)
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error('Error:', JSON.stringify(err, null, 2))
    }
  }

  if (verifying) {
    return (
      <>
        <h1>Verify your phone number</h1>
        <form onSubmit={handleVerification}>
          <label htmlFor="code">Enter your verification code</label>
          <input value={code} id="code" name="code" onChange={(e) => setCode(e.target.value)} />
          <button type="submit">Verify</button>
        </form>
      </>
    )
  }

  return (
    <>
      <h1>Sign up</h1>
      <form onSubmit={handleSubmit}>
        <label htmlFor="phone">Enter phone number</label>
        <input
          value={phone}
          id="phone"
          name="phone"
          type="tel"
          onChange={(e) => setPhone(e.target.value)}
        />
        <button type="submit">Continue</button>
      </form>
    </>
  )
}

----------------------------------------

TITLE: Implementing UserButton in Next.js App Router
DESCRIPTION: Example showing how to implement the UserButton component in a Next.js application using the App Router pattern, including header integration with SignedIn/SignedOut states

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, SignInButton, UserButton } from '@clerk/nextjs'

function Header() {
  return (
    <header style={{ display: 'flex', justifyContent: 'space-between', padding: 20 }}>
      <h1>My App</h1>
      <SignedIn>
        <UserButton />
      </SignedIn>
      <SignedOut>
        <SignInButton />
      </SignedOut>
    </header>
  )
}

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <ClerkProvider>
        <Header />
        {children}
      </ClerkProvider>
    </html>
  )
}

----------------------------------------

TITLE: Clerk Middleware for Role-Based Route Protection
DESCRIPTION: Middleware implementation to protect admin routes using Clerk's middleware functionality.

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'
import { NextResponse } from 'next/server'

const isAdminRoute = createRouteMatcher(['/admin(.*)'])

export default clerkMiddleware(async (auth, req) => {
  if (isAdminRoute(req) && (await auth()).sessionClaims?.metadata?.role !== 'admin') {
    const url = new URL('/', req.url)
    return NextResponse.redirect(url)
  }
})

export const config = {
  matcher: [
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Updating User Data with useUser() Hook in React
DESCRIPTION: This example shows how to update the current user's information using the useUser() hook in a React component. It uses the User object's update() method to modify the user's first and last name.

LANGUAGE: tsx
CODE:
import { useUser } from '@clerk/clerk-react'

export default function Home() {
  const { isLoaded, user } = useUser()

  if (!isLoaded) {
    // Handle loading state
    return null
  }

  if (!user) return null

  const updateUser = async () => {
    await user.update({
      firstName: 'John',
      lastName: 'Doe',
    })
  }

  return (
    <>
      <button onClick={updateUser}>Update your name</button>
      <p>user.firstName: {user?.firstName}</p>
      <p>user.lastName: {user?.lastName}</p>
    </>
  )
}

----------------------------------------

TITLE: Implementing useSignIn Hook in React
DESCRIPTION: Example of using useSignIn() hook to check sign-in status in a React application. The code demonstrates proper handling of loading states and accessing the current sign-in attempt status.

LANGUAGE: tsx
CODE:
import { useSignIn } from '@clerk/clerk-react'

export default function SignInPage() {
  const { isLoaded, signIn } = useSignIn()

  if (!isLoaded) {
    // Handle loading state
    return null
  }

  return <div>The current sign-in attempt status is {signIn?.status}.</div>
}

----------------------------------------

TITLE: Adding Verification Steps
DESCRIPTION: Implements verification steps for phone and email codes using SignUp.Strategy components to handle different verification methods.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignUp from '@clerk/elements/sign-up'

export default function SignUpPage() {
  return (
    <SignUp.Root>
      {/* Previous start step code */}

      <SignUp.Step name="verifications">
        <SignUp.Strategy name="phone_code">
          <h1>Check your phone for an SMS</h1>

          <Clerk.Field name="code">
            <Clerk.Label>Phone Code</Clerk.Label>
            <Clerk.Input />
            <Clerk.FieldError />
          </Clerk.Field>

          <SignUp.Action submit>Verify</SignUp.Action>
        </SignUp.Strategy>

        <SignUp.Strategy name="email_code">
          <h1>Check your email</h1>

          <Clerk.Field name="code">
            <Clerk.Label>Email Code</Clerk.Label>
            <Clerk.Input />
            <Clerk.FieldError />
          </Clerk.Field>

          <SignUp.Action submit>Verify</SignUp.Action>
        </SignUp.Strategy>
      </SignUp.Step>
    </SignUp.Root>
  )
}

----------------------------------------

TITLE: Implementing Authentication Requirements with requireAuth()
DESCRIPTION: Shows how to use the requireAuth() middleware to protect routes and redirect unauthenticated users. It includes examples of applying the middleware globally and to specific routes with custom sign-in URLs.

LANGUAGE: javascript
CODE:
import { requireAuth } from '@clerk/express'
import express from 'express'

const app = express()
const PORT = 3000

// Apply middleware to all routes
app.use(requireAuth())

// Apply middleware to a specific route
// Redirects to the homepage if the user is not authenticated
app.get('/protected', requireAuth(), (req, res) => {
  res.send('This is a protected route.')
})

// Redirects to a custom URL if the user is not authenticated
// Requires `CLERK_SIGN_IN_URL` to be set in env vars
app.get('/protected', requireAuth({ signInUrl: process.env.CLERK_SIGN_IN_URL }), (req, res) => {
  res.send('This is a protected route.')
})

// Redirects to a custom URL if the user is not authenticated
// Uses the `signInUrl` option instead of the environment variable
app.get('/protected', requireAuth({ signInUrl: '/sign-in' }), (req, res) => {
  res.send('This is a protected route.')
})

// Start the server and listen on the specified port
app.listen(PORT, () => {
  console.log(`Server is running on http://localhost:${PORT}`)
})

----------------------------------------

TITLE: Defining Backend User Object Properties in TypeScript
DESCRIPTION: This snippet defines the structure and properties of the Backend User object used in Clerk's Backend API. It includes various user attributes such as identification, authentication status, metadata, and associated data like email addresses and phone numbers.

LANGUAGE: typescript
CODE:
interface BackendUser {
  id: string;
  passwordEnabled: boolean;
  totpEnabled: boolean;
  backupCodeEnabled: boolean;
  twoFactorEnabled: boolean;
  banned: boolean;
  createdAt: number;
  updatedAt: number;
  imageUrl: string;
  hasImage: boolean;
  primaryEmailAddressId: string;
  primaryPhoneNumberId: string;
  primaryWeb3WalletId: string;
  lastSignInAt: number;
  externalId: string;
  username: string;
  firstName: string;
  lastName: string;
  publicMetadata: UserPublicMetadata;
  privateMetadata: UserPrivateMetadata;
  unsafeMetadata: UserUnsafeMetadata;
  emailAddresses: EmailAddress[];
  phoneNumbers: PhoneNumber[];
  hasVerifiedPhoneNumber: boolean;
  web3Wallets: Web3Wallet[];
  externalAccounts: ExternalAccount[];
  lastActiveAt: number;
  createOrganizationEnabled: boolean;
  createOrganizationsLimit?: number;
  legalAcceptedAt?: number | null;
}

----------------------------------------

TITLE: Next.js Route Handler with Auth Example
DESCRIPTION: Complete example of using Clerk authentication and user retrieval in a Next.js route handler.

LANGUAGE: typescript
CODE:
import { auth, clerkClient } from '@clerk/nextjs/server'

export async function GET() {
  // Use `auth()` to get the user's ID
  const { userId } = await auth()

  // Protect the route by checking if the user is signed in
  if (!userId) {
    return new NextResponse('Unauthorized', { status: 401 })
  }

  const client = await clerkClient()

  // Use the Backend SDK's `getUser()` method to get the Backend User object
  const user = await client.users.getUser(userId)

  // Return the Backend User object
  return NextResponse.json({ user: user }, { status: 200 })
}

----------------------------------------

TITLE: Implementing rootAuthLoader() with callback in React Router
DESCRIPTION: This example shows how to use rootAuthLoader() with a callback function to handle custom data loading while having access to auth state in a React Router application.

LANGUAGE: tsx
CODE:
import { rootAuthLoader } from '@clerk/react-router/ssr.server'
import type { Route } from './+types/root'

export async function loader(args: Route.LoaderArgs) {
  return rootAuthLoader(args, ({ req, context, params }) => {
    const { sessionId, userId, getToken } = req.auth
    // Add logic to fetch data
    return { yourData: 'here' }
  })
}

----------------------------------------

TITLE: Simple Pagination with useOrganization in React
DESCRIPTION: Implementation of simple pagination with previous/next navigation for organization memberships using the useOrganization hook.

LANGUAGE: jsx
CODE:
import { useOrganization } from '@clerk/clerk-react'

export default function MemberList() {
  const { memberships } = useOrganization({
    memberships: {
      keepPreviousData: true, // Persist the cached data until the new data has been fetched
    },
  })

  if (!memberships) {
    // Handle loading state
    return null
  }

  return (
    <div>
      <h2>Organization members</h2>
      <ul>
        {memberships.data?.map((membership) => (
          <li key={membership.id}>
            {membership.publicUserData.firstName} {membership.publicUserData.lastName} &lt;
            {membership.publicUserData.identifier}&gt; :: {membership.role}
          </li>
        ))}
      </ul>

      <button disabled={!memberships.hasPreviousPage} onClick={memberships.fetchPrevious}>
        Previous page
      </button>

      <button disabled={!memberships.hasNextPage} onClick={memberships.fetchNext}>
        Next page
      </button>
    </div>
  )

----------------------------------------

TITLE: Implementing Custom Sign-In Flow with Clerk in Next.js (App Router)
DESCRIPTION: This React component for Next.js App Router handles sign-in with a token from URL query params. It uses Clerk's useSignIn and useUser hooks to create a sign-in attempt and set the active session. The component handles loading states and displays the user ID upon successful sign-in.

LANGUAGE: tsx
CODE:
'use client'
import { useUser, useSignIn } from '@clerk/nextjs'
import { useEffect, useState } from 'react'
import { useSearchParams } from 'next/navigation'

export default function Page() {
  const [loading, setLoading] = useState<boolean>(false)
  const { signIn, setActive } = useSignIn()
  const { user } = useUser()

  // Get the token from the query params
  const signInToken = useSearchParams().get('token')

  useEffect(() => {
    if (!signIn || !setActive || !signInToken || user || loading) {
      return
    }

    const createSignIn = async () => {
      setLoading(true)
      try {
        // Create the `SignIn` with the token
        const signInAttempt = await signIn.create({
          strategy: 'ticket',
          ticket: signInToken as string,
        })

        // If the sign-in was successful, set the session to active
        if (signInAttempt.status === 'complete') {
          setActive({
            session: signInAttempt.createdSessionId,
          })
        } else {
          // If the sign-in attempt is not complete, check why.
          // User may need to complete further steps.
          console.error(JSON.stringify(signInAttempt, null, 2))
        }
      } catch (err) {
        // See https://clerk.com/docs/custom-flows/error-handling
        // for more info on error handling
        console.error('Error:', JSON.stringify(err, null, 2))
      } finally {
        setLoading(false)
      }
    }

    createSignIn()
  }, [signIn, setActive, signInToken, user, loading])

  if (!signInToken) {
    return <div>No token provided.</div>
  }

  if (!user) {
    return null
  }

  if (loading) {
    return <div>Signing you in...</div>
  }

  return <div>Signed in as {user.id}</div>
}

----------------------------------------

TITLE: Setting Private Metadata with Clerk SDKs
DESCRIPTION: Examples of setting private metadata (like Stripe customer ID) using different Clerk SDKs. Private metadata is only accessible from the backend.

LANGUAGE: typescript
CODE:
export async function POST(req) {
  const { stripeId, userId } = await req.json()

  await clerkClient.users.updateUserMetadata(userId, {
    privateMetadata: {
      stripeId: stripeId,
    },
  })

  return Response.json({ success: true })
}

----------------------------------------

TITLE: Implementing User Authentication Check with Next.js App Router
DESCRIPTION: Example showing how to use auth() and redirectToSignIn() to protect a page by checking user authentication status. The code demonstrates checking for userId and redirecting unauthenticated users to the sign-in page.

LANGUAGE: typescript
CODE:
import { auth } from '@clerk/nextjs/server'

export default async function Page() {
  const { userId, redirectToSignIn } = await auth()

  if (!userId) return redirectToSignIn()

  return <h1>Hello, {userId}</h1>
}

----------------------------------------

TITLE: Declaring User Creation Function Signature in TypeScript
DESCRIPTION: TypeScript function signature for creating a new user, which takes CreateUserParams and returns a Promise containing the created User object.

LANGUAGE: typescript
CODE:
function createUser(params: CreateUserParams): Promise<User>

----------------------------------------

TITLE: Retrieving Organization by Slug Example
DESCRIPTION: Example demonstrating how to retrieve an organization using its slug instead of ID.

LANGUAGE: tsx
CODE:
const slug = 'my-organization-slug'

const response = await clerkClient.organizations.getOrganization({ slug })

----------------------------------------

TITLE: Implementing Authentication with useAuth() in React
DESCRIPTION: Example of using the useAuth() hook in a React application to manage authentication state and make authenticated API requests. Shows how to access user ID, session ID, and implement token-based API calls.

LANGUAGE: tsx
CODE:
import { useAuth } from '@clerk/clerk-react'

export default function ExternalDataPage() {
  const { userId, sessionId, getToken, isLoaded, isSignedIn } = useAuth()

  const fetchExternalData = async () => {
    const token = await getToken()

    // Fetch data from an external API
    const response = await fetch('https://api.example.com/data', {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    })

    return response.json()
  }

  if (!isLoaded) {
    return <div>Loading...</div>
  }

  if (!isSignedIn) {
    return <div>Sign in to view this page</div>
  }

  return (
    <div>
      <p>
        Hello, {userId}! Your current active session is {sessionId}.
      </p>
      <button onClick={fetchExternalData}>Fetch Data</button>
    </div>
  )
}

----------------------------------------

TITLE: Reloading User Data with useUser() Hook in React
DESCRIPTION: This snippet demonstrates how to reload the latest user data using the useUser() hook in a React component. It updates user metadata via an API endpoint and then uses the User object's reload() method to fetch the updated information.

LANGUAGE: tsx
CODE:
import { useUser } from '@clerk/clerk-react'

export default function Home() {
  const { isLoaded, user } = useUser()

  if (!isLoaded) {
    // Handle loading state
    return null
  }

  if (!user) return null

  const updateUser = async () => {
    // Update data via an API endpoint
    const updateMetadata = await fetch('/api/updateMetadata')

    // Check if the update was successful
    if (updateMetadata.message !== 'success') {
      throw new Error('Error updating')
    }

    // If the update was successful, reload the user data
    await user.reload()
  }

  return (
    <>
      <button onClick={updateUser}>Update your metadata</button>
      <p>user role: {user?.publicMetadata.role}</p>
    </>
  )
}

----------------------------------------

TITLE: Configuring Clerk in iOS App Entry Point
DESCRIPTION: Sets up the main app configuration for Clerk authentication, including initialization, environment injection, and loading the Clerk instance with a publishable key.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

@main
struct ClerkQuickstartApp: App {
  @State private var clerk = Clerk.shared

  var body: some Scene {
    WindowGroup {
      ZStack {
        if clerk.isLoaded {
          ContentView()
        } else {
          ProgressView()
        }
      }
      .environment(clerk)
      .task {
        clerk.configure(publishableKey: "{{pub_key}}")
        try? await clerk.load()
      }
    }
  }
}

----------------------------------------

TITLE: SWR Integration with Clerk Authentication
DESCRIPTION: Implementation of authenticated data fetching using SWR (React Hooks library for data fetching). Includes session token handling and TypeScript support.

LANGUAGE: typescript
CODE:
import useSWR from 'swr'

export default async function useClerkSWR(url: string) {
  const { getToken } = useAuth()

  const token = await getToken()

  const fetcher = async (...args: [RequestInfo]) => {
    return fetch(...args, {
      headers: { Authorization: `Bearer ${token}` },
    }).then((res) => res.json())
  }

  return useSWR(url, fetcher)
}

----------------------------------------

TITLE: Initializing Clerk Instance
DESCRIPTION: Create an instance of the Clerk class with dedicated options. This method is only available when importing Clerk from @clerk/clerk-js, rather than using a Window script.

LANGUAGE: TypeScript
CODE:
class Clerk {
  constructor(key: string, options?: DomainOrProxyUrl)
}

----------------------------------------

TITLE: Using Clerk Middleware to Verify Sessions in Go
DESCRIPTION: This snippet demonstrates how to use Clerk middleware to protect routes in a Go HTTP server. It sets up public and protected routes, using WithHeaderAuthorization() middleware for authentication.

LANGUAGE: go
CODE:
package main

import (
  "fmt"
  "net/http"

  "github.com/clerk/clerk-sdk-go/v2"
  clerkhttp "github.com/clerk/clerk-sdk-go/v2/http"
  "github.com/clerk/clerk-sdk-go/v2/user"
)

func main() {
  clerk.SetKey("{{secret}}")

  mux := http.NewServeMux()
  mux.HandleFunc("/", publicRoute)
  protectedHandler := http.HandlerFunc(protectedRoute)
  mux.Handle(
    "/protected",
    clerkhttp.WithHeaderAuthorization()(protectedHandler),
  )

  http.ListenAndServe(":3000", mux)
}

func publicRoute(w http.ResponseWriter, r *http.Request) {
  w.Write([]byte(`{"access": "public"}`))
}

func protectedRoute(w http.ResponseWriter, r *http.Request) {
  claims, ok := clerk.SessionClaimsFromContext(r.Context())
  if !ok {
    w.WriteHeader(http.StatusUnauthorized)
    w.Write([]byte(`{"access": "unauthorized"}`))
    return
  }

  usr, err := user.Get(r.Context(), claims.Subject)
  if err != nil {
    // handle the error
  }
  fmt.Fprintf(w, `{"user_id": "%s", "user_banned": "%t"}`, usr.ID, usr.Banned)
}

----------------------------------------

TITLE: Organization Selection Page Implementation
DESCRIPTION: Implementation of the organization selection page with redirect handling.

LANGUAGE: tsx
CODE:
'use client'

import { OrganizationList } from '@clerk/nextjs'
import { useSearchParams } from 'next/navigation'

export default function OrganizationSelection() {
  const searchParams = useSearchParams()
  const redirectUrl = searchParams.get('redirectUrl') ?? '/'

  return (
    <section>
      <h1>Welcome to the Organization Selection page.</h1>
      <p>
        This part of the application requires the user to select an organization in order to
        proceed. If you are not part of an organization, you can accept an invitation or create your
        own organization.
      </p>
      <OrganizationList
        hidePersonal={true}
        afterCreateOrganizationUrl={redirectUrl}
        afterSelectOrganizationUrl={redirectUrl}
      />
    </section>
  )
}

----------------------------------------

TITLE: Authenticating with Redirect in Clerk
DESCRIPTION: This method signs up a user via a Single Sign On (SSO) connection, such as OAuth or SAML, where an external account is used for verifying the user's identity.

LANGUAGE: typescript
CODE:
function authenticateWithRedirect(params: AuthenticateWithRedirectParams): Promise<void>

----------------------------------------

TITLE: Implementing Server-Side Route Protection
DESCRIPTION: Example of protecting routes using getAuth() for server-side authentication checks

LANGUAGE: typescript
CODE:
import { UserButton } from '@clerk/remix'
import { getAuth } from '@clerk/remix/ssr.server'
import { LoaderFunction, redirect } from '@remix-run/node'

export const loader: LoaderFunction = async (args) => {
  const { userId } = await getAuth(args)
  if (!userId) {
    return redirect('/sign-in')
  }
  return {}
}

export default function Index() {
  return (
    <div>
      <h1>Index route</h1>
      <p>You are signed in!</p>
      <UserButton />
    </div>
  )
}

----------------------------------------

TITLE: Configuring tRPC Request Handler with Clerk Context
DESCRIPTION: Shows how to set up the tRPC request handler with the Clerk authentication context for API routes.

LANGUAGE: typescript
CODE:
const handler = (req: Request) =>
  fetchRequestHandler({
    endpoint: '/api/trpc',
    req,
    router: appRouter,
    createContext,
  })

export { handler as GET, handler as POST }

----------------------------------------

TITLE: Switching Between Sessions in Clerk
DESCRIPTION: Shows how to switch between different user sessions using Clerk's setActive method across platforms.

LANGUAGE: jsx
CODE:
import { useClerk } from '@clerk/clerk-react'

const { client, setActive } = useClerk()

// You can get all the available sessions through the client
const availableSessions = client.sessions

// Use setActive to set the active session.
setActive({ session: availableSessions[0].id })

LANGUAGE: javascript
CODE:
// You can get all the available sessions through the client
const availableSessions = window.Clerk.client.sessions

// Use setActive to set the active session.
window.Clerk.setActive({ session: availableSessions[0].id })

LANGUAGE: swift
CODE:
// You can get all the available sessions through the client
var availableSessions: [Session] { Clerk.shared.client?.sessions ?? [] }

// Use setActive to set the active session.
try await Clerk.shared.setActive(sessionId: session.id)

----------------------------------------

TITLE: Implementing ClerkLoaded in Next.js Pages Router
DESCRIPTION: Demonstrates how to integrate ClerkLoaded in a Next.js application using the Pages Router pattern, including both the app wrapper and page implementation.

LANGUAGE: tsx
CODE:
import '@/styles/globals.css'
import { ClerkLoaded, ClerkProvider } from '@clerk/nextjs'
import { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider {...pageProps}>
      <ClerkLoaded>
        <Component {...pageProps} />
      </ClerkLoaded>
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Implementing Custom Sign-In Flow with Clerk in Next.js (Pages Router)
DESCRIPTION: This React component for Next.js Pages Router handles sign-in with a token passed through props. It uses Clerk's useSignIn and useUser hooks to create a sign-in attempt and set the active session. The component handles loading states and displays the user ID upon successful sign-in.

LANGUAGE: tsx
CODE:
import { InferGetServerSidePropsType, GetServerSideProps } from 'next'
import { useUser, useSignIn } from '@clerk/nextjs'
import { useEffect, useState } from 'react'

// Get the token from the query param server-side, and pass through props
export const getServerSideProps: GetServerSideProps = async (context) => {
  return {
    props: { signInToken: context.query.token ? context.query.token : null },
  }
}

export default function AcceptTokenPage({
  signInToken,
}: InferGetServerSidePropsType<typeof getServerSideProps>) {
  const [loading, setLoading] = useState<boolean>(false)
  const { signIn, setActive } = useSignIn()
  const { user } = useUser()

  useEffect(() => {
    if (!signIn || !setActive || !signInToken || user || loading) {
      return
    }

    const createSignIn = async () => {
      setLoading(true)
      try {
        // Create the `SignIn` with the token
        const signInAttempt = await signIn.create({
          strategy: 'ticket',
          ticket: signInToken as string,
        })

        // If the sign-in was successful, set the session to active
        if (signInAttempt.status === 'complete') {
          setActive({
            session: signInAttempt.createdSessionId,
          })
        } else {
          // If the sign-in attempt is not complete, check why.
          // User may need to complete further steps.
          console.error(JSON.stringify(signInAttempt, null, 2))
        }
      } catch (err) {
        // See https://clerk.com/docs/custom-flows/error-handling
        // for more info on error handling
        console.error('Error:', JSON.stringify(err, null, 2))
        setLoading(true)
      } finally {
        setLoading(false)
      }
    }

    createSignIn()
  }, [signIn, setActive, signInToken, user, loading])

  if (!signInToken) {
    return <div>No token provided.</div>
  }

  if (loading) {
    return <div>Loading...</div>
  }

  if (!user) {
    return null
  }

  return <div>Signed in as {user.id}</div>
}

----------------------------------------

TITLE: Integrating SignedOut Component in Astro
DESCRIPTION: This snippet illustrates how to use the SignedOut component in an Astro application. It shows the component usage within an Astro template file.

LANGUAGE: astro
CODE:
---
import { SignedOut } from '@clerk/astro/components'
---

<SignedOut>
  <div>You are signed out</div>
</SignedOut>
<p>This content is always visible.</p>

----------------------------------------

TITLE: Applying Global Theme in Next.js App Router
DESCRIPTION: Implementation of a global theme using ClerkProvider in Next.js App Router layout file.

LANGUAGE: typescript
CODE:
import { ClerkProvider } from '@clerk/nextjs'
import { dark } from '@clerk/themes'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider
      appearance={{
        baseTheme: dark,
      }}
    >
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Defining verifyClient Function in TypeScript
DESCRIPTION: This snippet defines the `verifyClient` function signature in TypeScript. It takes a session token as a string parameter and returns a Promise that resolves to a Client object.

LANGUAGE: typescript
CODE:
function verifyClient(token: string): Promise<Client>

----------------------------------------

TITLE: Importing ClerkMiddleware in Next.js
DESCRIPTION: Illustrates how to import the clerkMiddleware() helper function. This middleware integrates Clerk authentication into your Next.js application for both client and server-side authorization.

LANGUAGE: javascript
CODE:
import { clerkMiddleware } from "@clerk/nextjs";

----------------------------------------

TITLE: Integrating ClerkProvider in React Application
DESCRIPTION: This snippet demonstrates how to integrate ClerkProvider into a React application using Vite. It includes error handling for missing environment variables and sets up the root component.

LANGUAGE: tsx
CODE:
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import { ClerkProvider } from '@clerk/clerk-react'

// Import your Publishable Key
const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Add your Clerk Publishable Key to the .env file')
}

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <ClerkProvider publishableKey={PUBLISHABLE_KEY} afterSignOutUrl="/">
      <App />
    </ClerkProvider>
  </React.StrictMode>,
)

----------------------------------------

TITLE: Accessing Session Object with useSession() in React
DESCRIPTION: This snippet demonstrates how to use the useSession() hook to access the Session object in a React component. It shows how to handle loading and signed-out states, and display the last active time of the session.

LANGUAGE: tsx
CODE:
import { useSession } from '@clerk/clerk-react'

export default function Home() {
  const { isLoaded, session, isSignedIn } = useSession()

  if (!isLoaded) {
    // Handle loading state
    return null
  }
  if (!isSignedIn) {
    // Handle signed out state
    return null
  }

  return (
    <div>
      <p>This session has been active since {session.lastActiveAt.toLocaleString()}</p>
    </div>
  )
}

----------------------------------------

TITLE: Implementing Protected Server Actions in Client Components with Clerk in Next.js
DESCRIPTION: This set of snippets demonstrates how to implement a protected server action that can be used in a Client Component, using prop drilling to ensure headers are available.

LANGUAGE: tsx
CODE:
'use server'
import { auth } from '@clerk/nextjs/server'

export async function addItem(formData: FormData) {
  const { userId } = await auth()

  if (!userId) {
    throw new Error('You must be signed in to add an item to your cart')
  }

  console.log('add item server action', formData)
}

LANGUAGE: tsx
CODE:
'use client'

export default function AddItem({ addItem }) {
  return (
    <form action={addItem}>
      <input value={'test'} type="text" name="name" />
      <button type="submit">Add to Cart</button>
    </form>
  )
}

LANGUAGE: tsx
CODE:
import AddItem from './components/AddItem'
import { addItem } from './actions'
export default function Hobby() {
  return <AddItem addItem={addItem} />
}

----------------------------------------

TITLE: Role-based Authorization with Clerk's auth.protect()
DESCRIPTION: Shows how to use auth.protect() for role-based authorization in a Next.js React Server Component.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'

export default async function Page() {
  const { userId } = await auth.protect(
    (has) => has({ role: 'org:admin' }) || has({ role: 'org:billing_manager' }),
  )

  return <p>{userId} is authorized to access this page.</p>
}

----------------------------------------

TITLE: Configuring Cypress with Clerk
DESCRIPTION: Setup code for integrating Clerk with Cypress in the cypress.config.ts file. Configures the testing environment and sets up Testing Token retrieval.

LANGUAGE: typescript
CODE:
import { clerkSetup } from '@clerk/testing/cypress'
import { defineConfig } from 'cypress'

export default defineConfig({
  e2e: {
    setupNodeEvents(on, config) {
      return clerkSetup({ config })
    },
    baseUrl: 'http://localhost:3000', // your app's URL
  },
})

----------------------------------------

TITLE: Configuring OrganizationSwitcher Component in Next.js
DESCRIPTION: This snippet shows how to configure the OrganizationSwitcher component to handle slug-based navigation in a Next.js application using Clerk.

LANGUAGE: tsx
CODE:
import { OrganizationSwitcher } from '@clerk/nextjs'

export default function Header() {
  return (
    <OrganizationSwitcher
      hideSlug={false} // Allow users to customize the org's URL slug
      hidePersonal={false} // Allow users to select their personal account
      afterCreateOrganizationUrl="/orgs/:slug" // Navigate to the org's slug after creating an org
      afterSelectOrganizationUrl="/orgs/:slug" // Navigate to the org's slug after selecting  it
      afterSelectPersonalUrl="/me" // Navigate to the personal account after selecting it
    />
  )
}

----------------------------------------

TITLE: Signing Out User
DESCRIPTION: Signs out the active user from all sessions in a multi-session application or from the current session in a single-session context. The current client will be deleted.

LANGUAGE: TypeScript
CODE:
function signOut(options?: SignOutOptions): Promise<void>
// OR
function signOut(
  signOutCallback?: () => void | Promise<any>,
  options?: SignOutOptions,
): Promise<void>

----------------------------------------

TITLE: Adding Custom Pages in Next.js
DESCRIPTION: Example showing how to add custom pages to UserProfile component in Next.js using UserButton.UserProfilePage or UserProfile.Page components. Demonstrates both modal and dedicated page implementations.

LANGUAGE: typescript
CODE:
'use client'

import { UserButton } from '@clerk/nextjs'

const DotIcon = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" />
    </svg>
  )
}

const CustomPage = () => {
  return (
    <div>
      <h1>Custom page</h1>
      <p>This is the content of the custom page.</p>
    </div>
  )
}

export default function Home() {
  return (
    <header>
      <UserButton>
        <UserButton.UserProfilePage label="Custom Page" url="custom" labelIcon={<DotIcon />}>
          <CustomPage />
        </UserButton.UserProfilePage>
      </UserButton>
    </header>
  )
}

----------------------------------------

TITLE: Handling throwOnCancel in Next.js
DESCRIPTION: Shows error handling implementation with throwOnCancel option in Next.js, including handling of ClerkRuntimeError for reverification cancellation.

LANGUAGE: tsx
CODE:
'use client'

import { useReverification } from '@clerk/nextjs'
import { isClerkRuntimeError } from '@clerk/nextjs/errors'

export function MyButton() {
  const [enhancedFetcher] = useReverification(myFetcher, { throwOnCancel: true })

  const handleClick = async () => {
    try {
      const myData = await enhancedFetcher()
    } catch (e) {
      // Handle if user cancels the reverification process
      if (isClerkRuntimeError(e) && e.code === 'reverification_cancelled') {
        console.error('User cancelled reverification', e.code)
      }
    }
  }

  return <button onClick={handleClick}>Update user</button>
}

----------------------------------------

TITLE: Handling Organization-related Operations with Clerk in Next.js
DESCRIPTION: This example demonstrates how to use Clerk's auth() helper to check both user authentication and organization membership before performing an action. It also shows interaction with Clerk's API for organization operations.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'

export default function AddVerifiedDomain() {
  async function addVerifiedDomain(formData: FormData) {
    'use server'

    const { userId, orgId } = await auth()

    if (!userId) {
      throw new Error('You must be signed in to add a verified domain')
    }

    if (!orgId) {
      throw new Error('No active organization found. Set one as active or create/join one')
    }

    const domain = formData.get('domain')?.toString()
    if (!domain) {
      throw new Error('Domain is required')
    }

    await clerkClient().organizations.createOrganizationDomain({
      organizationId: orgId,
      name: domain,
      enrollmentMode: 'automatic_invitation',
    })

    console.log(`Added domain ${domain} to organization ${orgId}`)
  }

  return (
    <form action={addVerifiedDomain}>
      <input placeholder="example.com" type="text" name="domain" />
      <button type="submit">Add Domain</button>
    </form>
  )
}

----------------------------------------

TITLE: Configuring Clerk in React Entry Point
DESCRIPTION: Implementation of Clerk initialization in the main React entry file, including environment variable validation and ClerkProvider setup.

LANGUAGE: typescript
CODE:
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import './index.css'
import { ClerkProvider } from '@clerk/clerk-react'

const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Add your Clerk Publishable Key to the .env file')
}

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <ClerkProvider publishableKey={PUBLISHABLE_KEY} afterSignOutUrl="/">
      <App />
    </ClerkProvider>
  </React.StrictMode>,
)

----------------------------------------

TITLE: Next.js App Router Token Generation Implementation
DESCRIPTION: Example showing token generation in Next.js App Router with authentication checks and error handling.

LANGUAGE: javascript
CODE:
import { auth, clerkClient } from '@clerk/nextjs/server'

export async function GET() {
  const { sessionId } = await auth()

  if (!sessionId) {
    return Response.json({ message: 'Unauthorized' }, { status: 401 })
  }

  const template = 'test'
  const client = await clerkClient()
  const token = await client.sessions.getToken(sessionId, template)

  return Response.json({ token })
}

----------------------------------------

TITLE: Creating a Sign-Up in Clerk
DESCRIPTION: This method returns a new SignUp object based on the params passed to it, stores the sign-up lifecycle state in the status property, and deactivates any existing sign-up process the client may already have in progress.

LANGUAGE: typescript
CODE:
function create(params: SignUpCreateParams): Promise<SignUpResource>

----------------------------------------

TITLE: Implementing Organization Member Role Management in Next.js
DESCRIPTION: This TypeScript code for Next.js App Router uses the useOrganization hook to fetch and display organization memberships. It allows updating member roles and removing members from the organization.

LANGUAGE: tsx
CODE:
'use client'

import { useState, useEffect, ChangeEventHandler, useRef } from 'react'
import { useOrganization, useUser } from '@clerk/nextjs'
import type { OrganizationCustomRoleKey } from '@clerk/types'

export const OrgMembersParams = {
  memberships: {
    pageSize: 5,
    keepPreviousData: true,
  },
}

// List of organization memberships. Administrators can
// change member roles or remove members from the organization.
export const ManageRoles = () => {
  const { user } = useUser()
  const { isLoaded, memberships } = useOrganization(OrgMembersParams)

  if (!isLoaded) {
    return <>Loading</>
  }

  return (
    <>
      <h1>Memberships List</h1>
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Joined</th>
            <th>Role</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {memberships?.data?.map((mem) => (
            <tr key={mem.id}>
              <td>
                {mem.publicUserData.identifier} {mem.publicUserData.userId === user?.id && '(You)'}
              </td>
              <td>{mem.createdAt.toLocaleDateString()}</td>
              <td>
                <SelectRole
                  defaultRole={mem.role}
                  onChange={async (e) => {
                    await mem.update({
                      role: e.target.value as OrganizationCustomRoleKey,
                    })
                    await memberships?.revalidate()
                  }}
                />
              </td>
              <td>
                <button
                  onClick={async () => {
                    await mem.destroy()
                    await memberships?.revalidate()
                  }}
                >
                  Remove
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      <div>
        <button
          disabled={!memberships?.hasPreviousPage || memberships?.isFetching}
          onClick={() => memberships?.fetchPrevious?.()}
        >
          Previous
        </button>

        <button
          disabled={!memberships?.hasNextPage || memberships?.isFetching}
          onClick={() => memberships?.fetchNext?.()}
        >
          Next
        </button>
      </div>
    </>
  )
}

type SelectRoleProps = {
  fieldName?: string
  isDisabled?: boolean
  onChange?: ChangeEventHandler<HTMLSelectElement>
  defaultRole?: string
}

const SelectRole = (props: SelectRoleProps) => {
  const { fieldName, isDisabled = false, onChange, defaultRole } = props
  const { organization } = useOrganization()
  const [fetchedRoles, setRoles] = useState<OrganizationCustomRoleKey[]>([])
  const isPopulated = useRef(false)

  useEffect(() => {
    if (isPopulated.current) return
    organization
      ?.getRoles({
        pageSize: 20,
        initialPage: 1,
      })
      .then((res) => {
        isPopulated.current = true
        setRoles(res.data.map((roles) => roles.key as OrganizationCustomRoleKey))
      })
  }, [organization?.id])

  if (fetchedRoles.length === 0) return null

  return (
    <select
      name={fieldName}
      disabled={isDisabled}
      aria-disabled={isDisabled}
      onChange={onChange}
      defaultValue={defaultRole}
    >
      {fetchedRoles?.map((roleKey) => (
        <option key={roleKey} value={roleKey}>
          {roleKey}
        </option>
      ))}
    </select>
  )
}

----------------------------------------

TITLE: Cross-Origin Request with Vanilla JavaScript
DESCRIPTION: Example of making authenticated requests to cross-origin endpoints using vanilla JavaScript. Demonstrates how to include the session token in the Authorization header.

LANGUAGE: javascript
CODE:
(async () => {
  fetch('/api/foo', {
    headers: {
      Authorization: `Bearer ${await Clerk.session.getToken()}`,
    },
  }).then((res) => res.json())
})()

----------------------------------------

TITLE: Integrating ClerkProvider in React Router Application
DESCRIPTION: This snippet demonstrates how to integrate ClerkProvider into a React Router application. It includes SignedIn and SignedOut components for conditional rendering based on authentication state.

LANGUAGE: tsx
CODE:
// Other imports

import { ClerkProvider, SignedIn, SignedOut, UserButton, SignInButton } from '@clerk/react-router'

export default function App({ loaderData }: Route.ComponentProps) {
  return (
    <ClerkProvider
      loaderData={loaderData}
      signUpFallbackRedirectUrl="/"
      signInFallbackRedirectUrl="/"
    >
      <header className="flex items-center justify-center py-8 px-4">
        <SignedOut>
          <SignInButton />
        </SignedOut>
        <SignedIn>
          <UserButton />
        </SignedIn>
      </header>
      <main>
        <Outlet />
      </main>
    </ClerkProvider>
  )
}

// Rest of the root.tsx code

----------------------------------------

TITLE: Configuring Firebase with Clerk in Next.js
DESCRIPTION: This code snippet shows how to integrate Firebase with Clerk in a Next.js application. It includes initializing Firebase, signing in with a Clerk-generated token, and fetching data from Firestore.

LANGUAGE: tsx
CODE:
'use client'
import { useAuth } from '@clerk/nextjs'
import { initializeApp } from 'firebase/app'
import { getAuth, signInWithCustomToken } from 'firebase/auth'
import { getFirestore } from 'firebase/firestore'
import { doc, getDoc } from 'firebase/firestore'

// Add your Firebase config object
const firebaseConfig = {
  apiKey: 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
  authDomain: 'clerk-example-xxxxx.firebaseapp.com',
  databaseURL: 'https://clerk-example-xxxxx-default-xxxx.firebaseio.com',
  projectId: 'clerk-test-xxxx',
  storageBucket: 'clerk-test-xxxx.appspot.com',
  messagingSenderId: '012345678910',
  appId: '1:012345678:web:abcdef123456hijklm',
  measurementId: 'G-ABC123DEF',
}

// Connect to your Firebase app
const app = initializeApp(firebaseConfig)
// Connect to your Firestore database
const db = getFirestore(app)
// Connect to Firebase auth
const auth = getAuth(app)

// Remove this if you do not have Firestore set up
// for your Firebase app
const getFirestoreData = async () => {
  const docRef = doc(db, 'example', 'example-document')
  const docSnap = await getDoc(docRef)
  if (docSnap.exists()) {
    console.log('Document data:', docSnap.data())
  } else {
    // docSnap.data() will be undefined in this case
    console.log('No such document!')
  }
}

export default function FirebaseUI() {
  const { getToken, userId } = useAuth()

  // Handle if the user is not signed in
  // You could display content, or redirect them to a sign-in page
  if (!userId) {
    return <p>You need to sign in with Clerk to access this page.</p>
  }

  const signIntoFirebaseWithClerk = async () => {
    const token = await getToken({ template: 'integration_firebase' })

    const userCredentials = await signInWithCustomToken(auth, token || '')
    // The userCredentials.user object can call the methods of
    // the Firebase platform as an authenticated user.
    console.log('User:', userCredentials.user)
  }

  return (
    <main style={{ display: 'flex', flexDirection: 'column', rowGap: '1rem' }}>
      <button onClick={signIntoFirebaseWithClerk}>Sign in</button>

      {/* Remove this button if you do not have Firestore set up */}
      <button onClick={getFirestoreData}>Get document</button>
    </main>
  )
}

----------------------------------------

TITLE: Implementing Clerk Middleware in Astro
DESCRIPTION: Setup of Clerk middleware in a middleware.ts file to handle authentication state and route protection.

LANGUAGE: typescript
CODE:
import { clerkMiddleware } from '@clerk/astro/server'

export const onRequest = clerkMiddleware()

----------------------------------------

TITLE: Clerk Sign-In Verifications Step
DESCRIPTION: Implements the verification step of the sign-in flow, including password strategy and alternative method navigation.

LANGUAGE: tsx
CODE:
<SignIn.Step name="verifications">
  <SignIn.Strategy name="password">
    <Clerk.Field name="password">
      <Clerk.Label>password</Clerk.Label>
      <Clerk.Input />
      <Clerk.FieldError />
    </Clerk.Field>
    <SignIn.Action submit>Sign In</SignIn.Action>
  </SignIn.Strategy>
  <SignIn.Action navigate="choose-strategy">Use another method</SignIn.Action>
</SignIn.Step>

----------------------------------------

TITLE: Getting Provider Slug in TypeScript
DESCRIPTION: Getter method signature for retrieving the provider attribute.

LANGUAGE: typescript
CODE:
function providerSlug(): string

----------------------------------------

TITLE: Accessing Session Object with useSession() in Next.js
DESCRIPTION: This snippet shows how to use the useSession() hook in a Next.js application to access the Session object. It demonstrates handling loading and signed-out states, and displaying the last active time of the session.

LANGUAGE: tsx
CODE:
'use client'

import { useSession } from '@clerk/nextjs'

export default function HomePage() {
  const { isLoaded, session, isSignedIn } = useSession()

  if (!isLoaded) {
    // Handle loading state
    return null
  }
  if (!isSignedIn) {
    // Handle signed out state
    return null
  }

  return (
    <div>
      <p>This session has been active since {session.lastActiveAt.toLocaleString()}</p>
    </div>
  )
}

----------------------------------------

TITLE: Disabling User MFA Example in React/TypeScript
DESCRIPTION: Example usage of the disableUserMFA function showing how to disable MFA for a specific user using their user ID.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const response = await clerkClient.users.disableUserMFA(userId)

----------------------------------------

TITLE: Accessing User Data in Next.js Pages Router API Route
DESCRIPTION: This snippet illustrates how to use getAuth() and clerkClient() helpers in a Next.js Pages Router API route to protect routes and access user data.

LANGUAGE: tsx
CODE:
import { getAuth, clerkClient } from '@clerk/nextjs/server'
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  // Use `getAuth()` to get the user's ID
  const { userId } = getAuth(req)

  // Protect the route by checking if the user is signed in
  if (!userId) {
    return res.status(401).json({ error: 'Unauthorized' })
  }

  // Initialize the Backend SDK
  const client = await clerkClient()

  // Get the user's full `Backend User` object
  const user = await client.users.getUser(userId)

  return res.status(200).json({ user })
}

----------------------------------------

TITLE: Adding Custom Action to UserButton in Next.js
DESCRIPTION: This snippet shows how to add a custom 'Open chat' action to the UserButton component in a Next.js application using Clerk.

LANGUAGE: tsx
CODE:
'use client'

import { UserButton } from '@clerk/nextjs'

const DotIcon = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" />
    </svg>
  )
}

export default function Home() {
  return (
    <header>
      <UserButton>
        <UserButton.MenuItems>
          <UserButton.Action
            label="Open chat"
            labelIcon={<DotIcon />}
            onClick={() => alert('init chat')}
          />
        </UserButton.MenuItems>
      </UserButton>
    </header>
  )
}

----------------------------------------

TITLE: Authenticating with Coinbase Wallet in Clerk
DESCRIPTION: This method initiates an authentication flow using the Coinbase Wallet browser extension, allowing users to authenticate via their Web3 wallet address.

LANGUAGE: javascript
CODE:
const signUp = await clerk.signUp.authenticateWithCoinbaseWallet()

----------------------------------------

TITLE: Protecting Pages with SSR Authentication in Next.js
DESCRIPTION: This example demonstrates how to protect pages using SSR authentication in Next.js. It uses getAuth to check for a userId and clerkClient to fetch user data if authenticated.

LANGUAGE: tsx
CODE:
import { clerkClient, getAuth, buildClerkProps } from '@clerk/nextjs/server'
import { GetServerSideProps } from 'next'

export const getServerSideProps: GetServerSideProps = async (ctx) => {
  const { userId } = getAuth(ctx.req)

  const client = await clerkClient()

  const user = userId ? await client.users.getUser(userId) : undefined

  return { props: { ...buildClerkProps(ctx.req, { user }) } }
}

----------------------------------------

TITLE: Updating User Data with $userStore in Vue
DESCRIPTION: This example shows how to update the current user's data using the $userStore in a Vue component. It includes a button to trigger the update and displays the user's first and last name.

LANGUAGE: vue
CODE:
<script setup>
import { useStore } from '@nanostores/vue'
import { $userStore } from '@clerk/astro/client'

const user = useStore($userStore)

const updateUser = async () => {
  await user.value.update({
    firstName: 'John',
    lastName: 'Doe',
  })
}
</script>

<template>
  <div v-if="user === undefined">
    <!-- Handle loading state however you like -->
  </div>

  <div v-else-if="user !== null">
    <button @click="updateUser">Click me to update your name</button>
    <p>user.firstName: {{ user.firstName }}</p>
    <p>user.lastName: {{ user.lastName }}</p>
  </div>
</template>

----------------------------------------

TITLE: Implementing TOTP MFA Addition in Next.js
DESCRIPTION: This code snippet shows how to create a page for adding TOTP-based MFA in a Next.js application. It includes steps for generating a QR code, verifying the TOTP, and generating backup codes.

LANGUAGE: tsx
CODE:
'use client'

import { useUser } from '@clerk/nextjs'
import { TOTPResource } from '@clerk/types'
import Link from 'next/link'
import * as React from 'react'
import { QRCodeSVG } from 'qrcode.react'
import { GenerateBackupCodes } from '../page'

type AddTotpSteps = 'add' | 'verify' | 'backupcodes' | 'success'

type DisplayFormat = 'qr' | 'uri'

function AddTotpScreen({
  setStep,
}: {
  setStep: React.Dispatch<React.SetStateAction<AddTotpSteps>>
}) {
  const { user } = useUser()
  const [totp, setTOTP] = React.useState<TOTPResource | undefined>(undefined)
  const [displayFormat, setDisplayFormat] = React.useState<DisplayFormat>('qr')

  React.useEffect(() => {
    void user
      ?.createTOTP()
      .then((totp: TOTPResource) => {
        setTOTP(totp)
      })
      .catch((err) =>
        // See https://clerk.com/docs/custom-flows/error-handling
        // for more info on error handling
        console.error(JSON.stringify(err, null, 2)),
      )
  }, [])

  return (
    <>
      <h1>Add TOTP MFA</h1>

      {totp && displayFormat === 'qr' && (
        <>
          <div>
            <QRCodeSVG value={totp?.uri || ''} size={200} />
          </div>
          <button onClick={() => setDisplayFormat('uri')}>Use URI instead</button>
        </>
      )}
      {totp && displayFormat === 'uri' && (
        <>
          <div>
            <p>{totp.uri}</p>
          </div>
          <button onClick={() => setDisplayFormat('qr')}>Use QR Code instead</button>
        </>
      )}
      <button onClick={() => setStep('add')}>Reset</button>

      <p>Once you have set up your authentication app, verify your code</p>
      <button onClick={() => setStep('verify')}>Verify</button>
    </>
  )
}

function VerifyTotpScreen({
  setStep,
}: {
  setStep: React.Dispatch<React.SetStateAction<AddTotpSteps>>
}) {
  const { user } = useUser()
  const [code, setCode] = React.useState('')

  const verifyTotp = async (e: React.FormEvent) => {
    e.preventDefault()
    try {
      await user?.verifyTOTP({ code })
      setStep('backupcodes')
    } catch (err) {
      console.error(JSON.stringify(err, null, 2))
    }
  }

  return (
    <>
      <h1>Verify TOTP</h1>
      <form onSubmit={(e) => verifyTotp(e)}>
        <label htmlFor="totp-code">Enter the code from your authentication app</label>
        <input type="text" id="totp-code" onChange={(e) => setCode(e.currentTarget.value)} />
        <button type="submit">Verify code</button>
        <button onClick={() => setStep('add')}>Reset</button>
      </form>
    </>
  )
}

function BackupCodeScreen({
  setStep,
}: {
  setStep: React.Dispatch<React.SetStateAction<AddTotpSteps>>
}) {
  return (
    <>
      <h1>Verification was a success!</h1>
      <div>
        <p>
          Save this list of backup codes somewhere safe in case you need to access your account in
          an emergency
        </p>
        <GenerateBackupCodes />
        <button onClick={() => setStep('success')}>Finish</button>
      </div>
    </>
  )
}

function SuccessScreen() {
  return (
    <>
      <h1>Success!</h1>
      <p>You have successfully added TOTP MFA via an authentication application.</p>
    </>
  )
}

export default function AddMFaScreen() {
  const [step, setStep] = React.useState<AddTotpSteps>('add')
  const { isLoaded, user } = useUser()

  if (!isLoaded) return null

  if (!user) {
    return <p>You must be logged in to access this page</p>
  }

  return (
    <>
      {step === 'add' && <AddTotpScreen setStep={setStep} />}
      {step === 'verify' && <VerifyTotpScreen setStep={setStep} />}
      {step === 'backupcodes' && <BackupCodeScreen setStep={setStep} />}
      {step === 'success' && <SuccessScreen />}
      <Link href="/account/manage-mfa">Manage MFA</Link>
    </>
  )
}

----------------------------------------

TITLE: Configuring CSP Headers in Next.js for Clerk Integration
DESCRIPTION: This snippet demonstrates how to set up Content-Security-Policy headers in a Next.js configuration file to allow Clerk integration while maintaining security. It includes necessary directives for script sources, connections, images, workers, styles, and frames.

LANGUAGE: javascript
CODE:
const cspHeader = `
  default-src 'self';
  script-src 'self' 'unsafe-inline' 'unsafe-eval' https://{{fapi_url}} https://challenges.cloudflare.com;
  connect-src 'self' https://{{fapi_url}};
  img-src 'self' https://img.clerk.com;
  worker-src 'self' blob:;
  style-src 'self' 'unsafe-inline';
  frame-src 'self' https://challenges.cloudflare.com;
  form-action 'self';
`

/** @type {import('next').NextConfig} */
const nextConfig = {
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'Content-Security-Policy',
            value: cspHeader.replace(/\n/g, ''),
          },
        ],
      },
    ]
  },
}

module.exports = nextConfig

----------------------------------------

TITLE: JavaScript Implementation for Organization Invitations
DESCRIPTION: Vanilla JavaScript implementation for managing organization invitations using Clerk, including invitation creation, listing, and revocation functionality.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!pubKey) {
  throw new Error('Add your VITE_CLERK_PUBLISHABLE_KEY to .env file')
}

const clerk = new Clerk('{{pub_key}}')
await clerk.load()

if (clerk.user) {
  // Check for an active organization
  if (clerk.organization) {
    // Render list of organization invitations
    async function renderInvitations(organization, isAdmin) {
      const list = document.getElementById('invitations_list')
      try {
        const { data } = await organization.getInvitations()

        const invitations = data

        if (invitations.length === 0) {
          list.textContent = 'No invitations'
        }

        invitations.map((invitation) => {
          const li = document.createElement('li')
          li.textContent = `${invitation.emailAddress} - ${invitation.role}`

          // Add administrative actions; revoke invitation
          if (isAdmin) {
            const revokeBtn = document.createElement('button')
            revokeBtn.textContent = 'Revoke'
            revokeBtn.addEventListener('click', async function (e) {
              e.preventDefault()
              await invitation.revoke()
            })
            li.appendChild(revokeBtn)
          }
          // Add the entry to the list
          list.appendChild(li)
        })
      } catch (err) {
        console.error(err)
      }
    }

    // Gets the current org, checks if the current user is an admin,
    // renders invitations, and sets up the new invitation form.
    async function checkAdminAndRenderInvitations() {
      // This is the current organization ID.
      const organizationId = clerk.organization.id

      const { data } = await clerk.user.getOrganizationMemberships()
      const organizationMemberships = data

      const currentMembership = organizationMemberships.find(
        (membership) => membership.organization.id === organizationId,
      )
      const currentOrganization = currentMembership.organization

      if (!currentOrganization) return

      const isAdmin = currentMembership.role === 'org:admin'

      renderInvitations(currentOrganization, isAdmin)

      if (isAdmin) {
        const form = document.getElementById('new_invitation')
        form.addEventListener('submit', async function (e) {
          e.preventDefault()

          const inputEl = document.getElementById('email_address')

          if (!inputEl) return

          try {
            await currentOrganization.inviteMember({
              emailAddress: inputEl.value,
              role: 'org:member',
            })
          } catch (err) {
            console.error(err)
          }
        })
      }
    }

    checkAdminAndRenderInvitations()
  } else {
    // If there is no active organization,
    // mount Clerk's <OrganizationSwitcher />
    // to allow the user to set an organization as active
    document.getElementById('app').innerHTML = `
      <h2>Select an organization to set it as active</h2>
      <div id="org-switcher"></div>
    `

    const orgSwitcherDiv = document.getElementById('org-switcher')

    clerk.mountOrganizationSwitcher(orgSwitcherDiv)
  }
} else {
  // If there is no active user, mount Clerk's <SignIn />
  document.getElementById('app').innerHTML = `
    <div id="sign-in"></div>
  `

  const signInDiv = document.getElementById('sign-in')

  clerk.mountSignIn(signInDiv)
}

----------------------------------------

TITLE: Infinite Pagination with React Implementation
DESCRIPTION: Implementation of infinite pagination using the useOrganizationList hook in a React component, showing how to load and display organization memberships with a 'Load more' functionality.

LANGUAGE: tsx
CODE:
import { useOrganizationList } from '@clerk/clerk-react'
import React from 'react'

const JoinedOrganizations = () => {
  const { isLoaded, setActive, userMemberships } = useOrganizationList({
    userMemberships: {
      infinite: true,
    },
  })

  if (!isLoaded) {
    return <>Loading</>
  }

  return (
    <>
      <ul>
        {userMemberships.data?.map((mem) => (
          <li key={mem.id}>
            <span>{mem.organization.name}</span>
            <button onClick={() => setActive({ organization: mem.organization.id })}>Select</button>
          </li>
        ))}
      </ul>

      <button disabled={!userMemberships.hasNextPage} onClick={() => userMemberships.fetchNext()}>
        Load more
      </button>
    </>
  )
}

----------------------------------------

TITLE: Adding Custom Pages to OrganizationProfile in Next.js
DESCRIPTION: Demonstrates how to add custom pages to the OrganizationProfile component using Next.js. It shows two methods: passing content as a component and as direct children.

LANGUAGE: tsx
CODE:
'use client'

import { OrganizationSwitcher } from '@clerk/nextjs'

const DotIcon = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" />
    </svg>
  )
}

const CustomPage = () => {
  return (
    <div>
      <h1>Custom page</h1>
      <p>This is the content of the custom page.</p>
    </div>
  )
}

const Header = () => (
  <header>
    <OrganizationSwitcher>
      {/* You can pass the content as a component */}
      <OrganizationSwitcher.OrganizationProfilePage
        label="Custom Page"
        url="custom"
        labelIcon={<DotIcon />}
      >
        <CustomPage />
      </OrganizationSwitcher.OrganizationProfilePage>

      {/* You can also pass the content as direct children */}
      <OrganizationSwitcher.OrganizationProfilePage
        label="Terms"
        labelIcon={<DotIcon />}
        url="terms"
      >
        <div>
          <h1>Custom Terms Page</h1>
          <p>This is the content of the custom terms page.</p>
        </div>
      </OrganizationSwitcher.OrganizationProfilePage>
    </OrganizationSwitcher>
  </header>
)

export default Header

----------------------------------------

TITLE: Attempting Email Address Verification in Clerk
DESCRIPTION: This method attempts to verify an email address by validating a one-time verification code provided by the user against the code sent during the prepare verification step.

LANGUAGE: typescript
CODE:
function attemptEmailAddressVerification(
  params: AttemptEmailAddressVerificationParams,
): Promise<SignUpResource>

----------------------------------------

TITLE: Example Payload for Clerk User Created Webhook Event
DESCRIPTION: This JSON snippet demonstrates the structure of a webhook payload for a 'user.created' event in Clerk. It includes user details such as email, name, and metadata, along with event-specific information like timestamp and instance ID.

LANGUAGE: json
CODE:
{
  "data": {
    "birthday": "",
    "created_at": 1654012591514,
    "email_addresses": [
      {
        "email_address": "example@example.org",
        "id": "idn_29w83yL7CwVlJXylYLxcslromF1",
        "linked_to": [],
        "object": "email_address",
        "verification": {
          "status": "verified",
          "strategy": "ticket"
        }
      }
    ],
    "external_accounts": [],
    "external_id": "567772",
    "first_name": "Example",
    "gender": "",
    "id": "user_29w83sxmDNGwOuEthce5gg56FcC",
    "image_url": "https://img.clerk.com/xxxxxx",
    "last_name": "Example",
    "last_sign_in_at": 1654012591514,
    "object": "user",
    "password_enabled": true,
    "phone_numbers": [],
    "primary_email_address_id": "idn_29w83yL7CwVlJXylYLxcslromF1",
    "primary_phone_number_id": null,
    "primary_web3_wallet_id": null,
    "private_metadata": {},
    "profile_image_url": "https://www.gravatar.com/avatar?d=mp",
    "public_metadata": {},
    "two_factor_enabled": false,
    "unsafe_metadata": {},
    "updated_at": 1654012591835,
    "username": null,
    "web3_wallets": []
  },
  "instance_id": "ins_123",
  "object": "event",
  "timestamp": 1654012591835,
  "type": "user.created"
}

----------------------------------------

TITLE: Implementing User Impersonation Client Component in Next.js
DESCRIPTION: This client component handles the UI for displaying users and initiating the impersonation process. It uses Clerk's hooks for user management and authentication, and includes functions for creating actor tokens and signing in as the impersonated user.

LANGUAGE: tsx
CODE:
'use client'

import React from 'react'
import { useUser, useSignIn } from '@clerk/nextjs'
import { generateActorToken } from './_actions'
import { useRouter } from 'next/navigation'

type ParsedUser = {
  id: string
  email: string | undefined
}

export type Actor = {
  object: string
  id: string
  status: 'pending' | 'accepted' | 'revoked'
  user_id: string
  actor: object
  token: string | null
  url: string | null
  created_at: Number
  updated_at: Number
}

// Create an actor token for the impersonation
async function createActorToken(actorId: string, userId: string) {
  const res = await generateActorToken(actorId, userId) // The Server Action to generate the actor token

  if (!res.ok) console.log('Error', res.message)

  return res.token
}

export default function ImpersonateUsers({ users }: { users: ParsedUser[] }) {
  const { isLoaded, signIn, setActive } = useSignIn()
  const router = useRouter()
  const { user } = useUser()

  if (!user?.id) return null

  // Handle "Impersonate" button click
  async function impersonateUser(actorId: string, userId: string) {
    if (!isLoaded) return

    const actorToken = await createActorToken(actorId, userId)

    // Sign in as the impersonated user
    if (actorToken) {
      try {
        const { createdSessionId } = await signIn.create({
          strategy: 'ticket',
          ticket: actorToken,
        })

        await setActive({ session: createdSessionId })

        router.push('/')
      } catch (err) {
        // See https://clerk.com/docs/custom-flows/error-handling
        // for more info on error handling
        console.error(JSON.stringify(err, null, 2))
      }
    }
  }

  return (
    <>
      <p>Hello {user?.primaryEmailAddress?.emailAddress}</p>

      <h1>Users</h1>
      <ul>
        {users?.map((userFromUserList) => {
          return (
            <li key={userFromUserList.id} style={{ display: 'flex', gap: '4px' }}>
              <p>{userFromUserList?.email ? userFromUserList.email : userFromUserList.id}</p>
              <button onClick={async () => await impersonateUser(user.id, userFromUserList.id)}>
                Impersonate
              </button>
            </li>
          )
        })}
      </ul>
    </>
  )
}

----------------------------------------

TITLE: Implementing Sign-In Button with useClerk() in Next.js
DESCRIPTION: This snippet shows how to use the useClerk() hook to create a sign-in button in a Next.js application, with the 'use client' directive for client-side rendering.

LANGUAGE: tsx
CODE:
'use client'

import { useClerk } from '@clerk/nextjs'

export default function HomePage() {
  const clerk = useClerk()

  return <button onClick={() => clerk.openSignIn({})}>Sign in</button>
}

----------------------------------------

TITLE: Session Reverification in Sinatra
DESCRIPTION: Implements session reverification for enhanced security on sensitive routes. Shows how to use different presets (STRICT and LAX) for controlling reverification requirements.

LANGUAGE: ruby
CODE:
require "clerk/sinatra"
require "sinatra/base"

class App < Sinatra::Base
  register Sinatra::Clerk

  get "/" do
    erb :index, format: :html5
  end

  # Protect the "/super-secret-admin" route with the `auth` and `reverify` filters
  # Reverification preset defaults to `STRICT`
  post "/super-secret-admin", auth: true, reverify: true do
    {message: clerk.user? ? "Valid session" : "Not logged in"}.to_json
  end

  # Protect the "/chill-admin" route with the `auth` and `reverify` filters
  # Reverification preset is set to `LAX`
  post "/chill-admin", auth: true, reverify: Clerk::StepUp::Preset::LAX do
    {message: clerk.user? ? "Valid session" : "Not logged in"}.to_json
  end

  run! if app_file == $0
end

----------------------------------------

TITLE: Implementing Custom Sign-up Flow with Email Links in Next.js
DESCRIPTION: This code snippet demonstrates how to create a custom sign-up flow using email links in a Next.js application. It utilizes Clerk's useSignUp hook and handles the email link verification process.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useSignUp } from '@clerk/nextjs'

export default function SignInPage() {
  const [emailAddress, setEmailAddress] = React.useState('')
  const [verified, setVerified] = React.useState(false)
  const [verifying, setVerifying] = React.useState(false)
  const [error, setError] = React.useState('')
  const { signUp, isLoaded } = useSignUp()

  if (!isLoaded) return null

  const { startEmailLinkFlow } = signUp.createEmailLinkFlow()

  async function submit(e: React.FormEvent) {
    e.preventDefault()
    // Reset states in case user resubmits form mid sign-up
    setVerified(false)
    setError('')

    setVerifying(true)

    if (!isLoaded && !signUp) return null

    // Start the sign-up process using the email provided
    try {
      await signUp.create({
        emailAddress,
      })

      // Dynamically set the host domain for dev and prod
      // You could instead use an environment variable or other source for the host domain
      const protocol = window.location.protocol
      const host = window.location.host

      // Send the user an email with the email link
      const signUpAttempt = await startEmailLinkFlow({
        // URL to navigate to after the user visits the link in their email
        redirectUrl: `${protocol}//${host}/sign-up/verify`,
      })

      // Check the verification result
      const verification = signUpAttempt.verifications.emailAddress

      // Handle if user visited the link and completed sign-up from /sign-up/verify
      if (verification.verifiedFromTheSameClient()) {
        setVerifying(false)
        setVerified(true)
      }
    } catch (err: any) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))

      if (err.errors?.[0]?.longMessage) {
        console.log('Clerk error:', err.errors[0].longMessage)
        setError(err.errors[0].longMessage)
      } else {
        setError('An error occurred.')
      }
    }
  }

  async function reset(e: React.FormEvent) {
    e.preventDefault()
    setVerifying(false)
  }

  if (error) {
    return (
      <div>
        <p>Error: {error}</p>
        <button onClick={() => setError('')}>Try again</button>
      </div>
    )
  }

  if (verifying) {
    return (
      <div>
        <p>Check your email and visit the link that was sent to you.</p>
        <form onSubmit={reset}>
          <button type="submit">Restart</button>
        </form>
      </div>
    )
  }

  if (verified) {
    return <div>Signed up successfully!</div>
  }

  return (
    <div>
      <h1>Sign up</h1>
      <form onSubmit={submit}>
        <input
          type="email"
          placeholder="Enter email address"
          value={emailAddress}
          onChange={(e) => setEmailAddress(e.target.value)}
        />
        <button type="submit">Continue</button>
      </form>
    </div>
  )
}

----------------------------------------

TITLE: Retrieving Current User Data with $userStore in React
DESCRIPTION: This snippet demonstrates how to use the $userStore to access the User object in a React component. It handles loading and signed-out states, displaying the user's full name when signed in.

LANGUAGE: tsx
CODE:
import { useStore } from '@nanostores/react'
import { $userStore } from '@clerk/astro/client'

export default function User() {
  const user = useStore($userStore)

  if (user === undefined) {
    // Handle loading state however you like
    return null
  }

  if (user === null) {
    return <div>Not signed in</div>
  }

  return <div>Hello {user.fullName}!</div>
}

----------------------------------------

TITLE: Implementing Paginated Organization Switcher in Next.js
DESCRIPTION: React component that implements a paginated list of organizations with switching functionality using Clerk's useOrganizationList hook. Includes pagination controls and handles empty states.

LANGUAGE: jsx
CODE:
'use client'

import { useAuth, useOrganizationList } from '@clerk/nextjs'
import CreateOrganization from '../components/create-organization'

export default function JoinedOrganizations() {
  const { isLoaded, setActive, userMemberships } = useOrganizationList({
    userMemberships: {
      pageSize: 5,
      keepPreviousData: true,
    },
  })
  const { orgId } = useAuth()

  if (!isLoaded) {
    return <p>Loading...</p>
  }

  return (
    // ... component JSX
  )
}

----------------------------------------

TITLE: Retrieving User Data with useUser() in Expo
DESCRIPTION: This example demonstrates how to use the useUser() hook to access the User object and display personalized information. It checks if the user is signed in and shows their first name if authenticated.

LANGUAGE: tsx
CODE:
import { useUser } from '@clerk/clerk-expo'
import { Text } from 'react-native'

export default function Example() {
  const { isSignedIn, user, isLoaded } = useUser()

  if (!isLoaded) {
    return <Text>Loading...</Text>
  }

  if (!isSignedIn) {
    return <Text>Sign in to view this page</Text>
  }

  return <Text>Hello {user.firstName}!</Text>
}

----------------------------------------

TITLE: Checking User Permissions in Next.js Server Components
DESCRIPTION: Demonstrates how to use the has() function to check user permissions in a Next.js React Server Component and conditionally render content.

LANGUAGE: tsx
CODE:
import type { PropsWithChildren } from 'react'
import { auth } from '@clerk/nextjs/server'

export default async function SettingsLayout(props: PropsWithChildren) {
  const { has } = await auth()

  const canAccessSettings = has({ permission: 'org:team_settings:read' })

  if (!canAccessSettings) return null

  return props.children
}

----------------------------------------

TITLE: Global Route Protection with Public Exceptions
DESCRIPTION: Implementation of global route protection while keeping specific routes public using inverted route matching logic.

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/astro/server'

const isPublicRoute = createRouteMatcher(['/sign-in(.*)', '/sign-up(.*)'])

export const onRequest = clerkMiddleware((auth, context) => {
  const { redirectToSignIn, userId } = auth()

  if (!isPublicRoute(context.request) && !userId) {
    return redirectToSignIn()
  }
})

----------------------------------------

TITLE: Implementing SSO Connection Management in Next.js with Clerk
DESCRIPTION: This code snippet shows how to create a React component for managing SSO connections. It uses Clerk's useUser hook to access user data, handles adding new external accounts, and displays existing connections with options to remove or reverify them.

LANGUAGE: tsx
CODE:
'use client'

import { useUser } from '@clerk/nextjs'
import { OAuthStrategy } from '@clerk/types'
import { useRouter } from 'next/navigation'

// Capitalize the first letter of the provider name
// E.g. 'discord' -> 'Discord'
const capitalize = (provider: string) => {
  return `${provider.slice(0, 1).toUpperCase()}${provider.slice(1)}`
}

// Remove the prefix from the provider name
// E.g. 'oauth_discord' -> 'discord'
const normalizeProvider = (provider: string) => {
  return provider.split('_')[1]
}

export default function AddAccount() {
  const router = useRouter()
  // Use Clerk's `useUser()` hook to get the current user's `User` object
  const { isLoaded, user } = useUser()

  // List the options the user can select when adding a new external account
  // Edit this array to include all of your enabled SSO connections
  const options: OAuthStrategy[] = ['oauth_discord', 'oauth_google', 'oauth_github']

  // Handle adding the new external account
  const addSSO = async (strategy: OAuthStrategy) => {
    await user
      ?.createExternalAccount({
        strategy,
        redirectUrl: '/account/manage-external-accounts',
      })
      .then((res) => {
        if (res.verification?.externalVerificationRedirectURL) {
          router.push(res.verification.externalVerificationRedirectURL.href)
        }
      })
      .catch((err) => {
        console.log('ERROR', err)
      })
      .finally(() => {
        console.log('Redirected user to oauth provider')
      })
  }

  // Show a loading message until Clerk loads
  if (!isLoaded) return <p>Loading...</p>

  // Find the external accounts from the options array that the user has not yet added to their account
  // This prevents showing an 'add' button for existing external account types
  const unconnectedOptions = options.filter(
    (option) =>
      !user?.externalAccounts.some((account) => account.provider === normalizeProvider(option)),
  )

  return (
    <>
      <div>
        <p>Connected accounts</p>
        {user?.externalAccounts.map((account) => {
          return (
            <ul key={account.id}>
              <li>Provider: {capitalize(account.provider)}</li>
              <li>Scopes: {account.approvedScopes}</li>
              <li>
                Status:{' '}
                {/* This example uses the `longMessage` returned by the API. You can use account.verification.error.code to determine the error and then provide your own message to the user. */}
                {account.verification?.status === 'verified'
                  ? capitalize(account.verification?.status)
                  : account.verification?.error?.longMessage}
              </li>
              {account.verification?.status !== 'verified' &&
                account.verification?.externalVerificationRedirectURL && (
                  <li>
                    <a href={account.verification?.externalVerificationRedirectURL?.href}>
                      Reverify {capitalize(account.provider)}
                    </a>
                  </li>
                )}
              <li>
                <button onClick={() => account.destroy()}>
                  Remove {capitalize(account.provider)}
                </button>
              </li>
            </ul>
          )
        })}
      </div>
      {unconnectedOptions.length > 0 && (
        <div>
          <p>Add a new external account</p>
          <ul>
            {unconnectedOptions.map((strategy) => {
              return (
                <li key={strategy}>
                  <button onClick={() => addSSO(strategy)}>
                    Add {capitalize(normalizeProvider(strategy))}
                  </button>
                </li>
              )
            })}
          </ul>
        </div>
      )}
    </>
  )
}

----------------------------------------

TITLE: Implementing OrganizationList in Next.js
DESCRIPTION: Example of using the OrganizationList component in a Next.js application with URL navigation configuration.

LANGUAGE: jsx
CODE:
import { OrganizationList } from '@clerk/nextjs'

export default function OrganizationListPage() {
  return (
    <OrganizationList
      afterCreateOrganizationUrl="/organization/:slug"
      afterSelectPersonalUrl="/user/:id"
      afterSelectOrganizationUrl="/organization/:slug"
    />
  )
}

----------------------------------------

TITLE: Defining CaptchaNotEnabled Error in JSON for Clerk
DESCRIPTION: This snippet defines the JSON structure for the CaptchaNotEnabled error in Clerk. It includes a short message, a long message explaining the requirement for CAPTCHA, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "CAPTCHA not enabled",
  "longMessage": "Bot detection can be applied only for instances which have enabled CAPTCHA.",
  "code": "captcha_not_enabled"
}

----------------------------------------

TITLE: Rendering SignUp Component in Next.js
DESCRIPTION: This snippet shows how to create a dedicated sign-up page using Clerk's SignUp component in a Next.js application. It uses the Next.js optional catch-all route for flexibility.

LANGUAGE: tsx
CODE:
import { SignUp } from '@clerk/nextjs'

export default function Page() {
  return <SignUp />
}

----------------------------------------

TITLE: Implementing Image Optimization in Next.js with Clerk
DESCRIPTION: Demonstrates how to optimize user profile images using query parameters in a Next.js server component. Uses currentUser hook from @clerk/nextjs/server to fetch the user's image URL and apply optimization parameters for width, height, quality, and fit.

LANGUAGE: tsx
CODE:
import { currentUser } from '@clerk/nextjs/server'

export default async function ImageOptimization() {
  const user = await currentUser()
  if (!user) return <p>No Image URL found</p>

  const { imageUrl } = user
  const params = new URLSearchParams()

  params.set('height', '200')
  params.set('width', '200')
  params.set('quality', '100')
  params.set('fit', 'crop')

  const imageSrc = `${imageUrl}?${params.toString()}`

  return (
    <div>
      <h1>Image source:</h1>
      <p>{imageSrc}</p>
      <h2>Image:</h2>
      <img src={imageSrc} alt="User image" />
    </div>
  )
}

----------------------------------------

TITLE: Accessing Organization Data with $organizationStore in Svelte
DESCRIPTION: This snippet demonstrates how to use the $organizationStore store in a Svelte component to access the current active organization's attributes. It handles loading and null states using if-else blocks, and displays the organization name when available.

LANGUAGE: svelte
CODE:
<script>
  // The $ prefix is reserved in Svelte for its own reactivity system.
  // Alias the imports to avoid conflicts.
  import { $organizationStore as organization } from '@clerk/astro/client'
</script>

{#if $organization === undefined}
  <!-- Add logic to handle loading state -->
{:else if $organization === null}
  <!-- Add logic to handle no active organization state -->
{:else}
  <div>
    <p>This current organization is {$organization.name}</p>
  </div>
{/if}

----------------------------------------

TITLE: Complete Sign-In Flow with Password Support
DESCRIPTION: Implements full sign-in functionality including password authentication, password reset flow, and email verification steps.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'

export default function SignInPage() {
  return (
    <SignIn.Root>
      <SignIn.Step name="start">
        <h1>Sign in to your account</h1>

        <Clerk.Connection name="google">Sign in with Google</Clerk.Connection>

        <Clerk.Field name="identifier">
          <Clerk.Label>Email</Clerk.Label>
          <Clerk.Input />
          <Clerk.FieldError />
        </Clerk.Field>

        <SignIn.Action submit>Continue</SignIn.Action>
      </SignIn.Step>

      <SignIn.Step name="verifications">
        <SignIn.Strategy name="email_code">
          <h1>Check your email</h1>
          <p>
            We sent a code to <SignIn.SafeIdentifier />.
          </p>

          <Clerk.Field name="code">
            <Clerk.Label>Email code</Clerk.Label>
            <Clerk.Input />
            <Clerk.FieldError />
          </Clerk.Field>

          <SignIn.Action submit>Continue</SignIn.Action>
        </SignIn.Strategy>

        <SignIn.Strategy name="password">
          <h1>Enter your password</h1>

          <Clerk.Field name="password">
            <Clerk.Label>Password</Clerk.Label>
            <Clerk.Input />
            <Clerk.FieldError />
          </Clerk.Field>

          <SignIn.Action submit>Continue</SignIn.Action>
          <SignIn.Action navigate="forgot-password">Forgot password?</SignIn.Action>
        </SignIn.Strategy>

        <SignIn.Strategy name="reset_password_email_code">
          <h1>Check your email</h1>
          <p>
            We sent a code to <SignIn.SafeIdentifier />.
          </p>

          <Clerk.Field name="code">
            <Clerk.Label>Email code</Clerk.Label>
            <Clerk.Input />
            <Clerk.FieldError />
          </Clerk.Field>

          <SignIn.Action submit>Continue</SignIn.Action>
        </SignIn.Strategy>
      </SignIn.Step>

      <SignIn.Step name="forgot-password">
        <h1>Forgot your password?</h1>

        <SignIn.SupportedStrategy name="reset_password_email_code">
          Reset password
        </SignIn.SupportedStrategy>

        <SignIn.Action navigate="previous">Go back</SignIn.Action>
      </SignIn.Step>

      <SignIn.Step name="reset-password">
        <h1>Reset your password</h1>

        <Clerk.Field name="password">
          <Clerk.Label>New password</Clerk.Label>
          <Clerk.Input />
          <Clerk.FieldError />
        </Clerk.Field>

        <Clerk.Field name="confirmPassword">
          <Clerk.Label>Confirm password</Clerk.Label>
          <Clerk.Input />
          <Clerk.FieldError />
        </Clerk.Field>

        <SignIn.Action submit>Reset password</SignIn.Action>
      </SignIn.Step>
    </SignIn.Root>
  )
}

----------------------------------------

TITLE: Implementing Authentication-based Protection with clerkMiddleware
DESCRIPTION: This snippet demonstrates how to use clerkMiddleware to protect routes based on user authentication status, checking if the user is signed in for admin routes.

LANGUAGE: typescript
CODE:
import { clerkMiddleware } from '@clerk/nuxt/server'

export default clerkMiddleware((event) => {
  const { userId } = event.context.auth
  const isAdminRoute = event.path.startsWith('/api/admin')

  if (!userId && isAdminRoute) {
    throw createError({
      statusCode: 401,
      statusMessage: 'Unauthorized: User not signed in',
    })
  }
})

----------------------------------------

TITLE: Asserting Clerk Loading in Playwright Tests
DESCRIPTION: Demonstrates how to use the clerk.loaded() function to assert that Clerk has been loaded in a Playwright test. It includes navigating to an unprotected page and then asserting that Clerk has loaded.

LANGUAGE: typescript
CODE:
import { clerk } from '@clerk/testing/playwright'

test('ensure that clerk has loaded', async ({ page }) => {
  // Navigate to an unprotected page that loads Clerk
  await page.goto('/')

  await clerk.loaded({ page })
  // clerk has loaded
})

----------------------------------------

TITLE: Creating Webhook Route Handler in Next.js
DESCRIPTION: Set up a Route Handler in Next.js to verify and process incoming Clerk webhooks using svix.

LANGUAGE: TypeScript
CODE:
import { Webhook } from 'svix'
import { headers } from 'next/headers'
import { WebhookEvent } from '@clerk/nextjs/server'

export async function POST(req: Request) {
  const SIGNING_SECRET = process.env.SIGNING_SECRET

  if (!SIGNING_SECRET) {
    throw new Error('Error: Please add SIGNING_SECRET from Clerk Dashboard to .env or .env')
  }

  // Create new Svix instance with secret
  const wh = new Webhook(SIGNING_SECRET)

  // Get headers
  const headerPayload = await headers()
  const svix_id = headerPayload.get('svix-id')
  const svix_timestamp = headerPayload.get('svix-timestamp')
  const svix_signature = headerPayload.get('svix-signature')

  // If there are no headers, error out
  if (!svix_id || !svix_timestamp || !svix_signature) {
    return new Response('Error: Missing Svix headers', {
      status: 400,
    })
  }

  // Get body
  const payload = await req.json()
  const body = JSON.stringify(payload)

  let evt: WebhookEvent

  // Verify payload with headers
  try {
    evt = wh.verify(body, {
      'svix-id': svix_id,
      'svix-timestamp': svix_timestamp,
      'svix-signature': svix_signature,
    }) as WebhookEvent
  } catch (err) {
    console.error('Error: Could not verify webhook:', err)
    return new Response('Error: Verification error', {
      status: 400,
    })
  }

  // Do something with payload
  // For this guide, log payload to console
  const { id } = evt.data
  const eventType = evt.type
  console.log(`Received webhook with ID ${id} and event type of ${eventType}`)
  console.log('Webhook payload:', body)

  return new Response('Webhook received', { status: 200 })
}

----------------------------------------

TITLE: Authenticating Requests with Clerk Backend SDK in TypeScript
DESCRIPTION: Function signature for authenticateRequest(), which verifies a token passed from the frontend. It can operate networkless if a jwtKey is provided, otherwise it fetches JWKS from the Backend API.

LANGUAGE: typescript
CODE:
function authenticateRequest(
  request: Request,
  options: AuthenticateRequestOptions,
): Promise<RequestState>

----------------------------------------

TITLE: Next.js Server Action Reverification Implementation
DESCRIPTION: Demonstrates how to implement reverification checks in a Next.js server action using the auth.has() helper. The code checks if a user has verified their credentials within 10 minutes using the 'strict' configuration.

LANGUAGE: typescript
CODE:
'use server'

import { auth, reverificationError } from '@clerk/nextjs/server'

export const myAction = async () => {
  const { has } = await auth.protect()

  // Check if the user has *not* verified their credentials within the past 10 minutes
  const shouldUserRevalidate = !has({ reverification: 'strict' })

  // If the user hasn't reverified, return an error with the matching configuration (e.g. `strict`)
  if (shouldUserRevalidate) {
    return reverificationError('strict')
  }

  // If the user has verified credentials, return a successful response
  return { success: true }
}

----------------------------------------

TITLE: Adding Member to Organization - JavaScript Example
DESCRIPTION: Example of adding a member to an organization with a specific role.

LANGUAGE: javascript
CODE:
await organization.addMember({ userId: 'user_123', role: 'org:admin' })

----------------------------------------

TITLE: IdentificationExists Error JSON Response for Phone Number
DESCRIPTION: JSON response structure for an existing phone number error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "already exists",
  "longMessage": "This phone number already exists.",
  "code": "phone_number_exists_code"
}

----------------------------------------

TITLE: Integrating ClerkProvider in Expo Application
DESCRIPTION: This snippet shows how to integrate ClerkProvider into an Expo application. It wraps the Slot component from expo-router to provide authentication context to the entire app.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/clerk-expo'
import { Slot } from 'expo-router'

export default function Layout() {
  return (
    <ClerkProvider>
      <Slot />
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Utilizing clerkClient for User Information Retrieval
DESCRIPTION: Illustrates how to use clerkClient to access Clerk's Backend SDK methods. This example retrieves information about the currently signed-in user using the users.getUser() method.

LANGUAGE: javascript
CODE:
import { clerkClient, requireAuth } from '@clerk/express'
import express from 'express'

const app = express()
const PORT = 3000

app.get('/user', async (req, res) => {
  // Get the `userId` from the `Auth` object
  const userId = req.auth.userId

  // If user isn't authenticated, return a 401 error
  if (!userId) {
    res.status(401).json({ error: 'User not authenticated' })
  }

  // Use `clerkClient` to access Clerk's Backend SDK methods
  // and get the user's User object
  const user = await clerkClient.users.getUser(userId)

  res.json(user)
})

// Start the server and listen on the specified port
app.listen(PORT, () => {
  console.log(`Server is running on http://localhost:${PORT}`)
})

----------------------------------------

TITLE: Complete Account Portal Authentication Test in TypeScript
DESCRIPTION: A comprehensive example showing how to test the full authentication flow, including visiting a protected page, signing in through the Account Portal, and verifying successful authentication.

LANGUAGE: typescript
CODE:
import { setupClerkTestingToken } from '@clerk/testing/cypress'

describe('Testing Tokens', () => {
  it('sign in with Account Portal redirects', () => {
    setupClerkTestingToken()

    cy.origin('https://verb-noun-00.accounts.dev', () => {
      cy.visit('http://localhost:3000/protected')
      cy.contains('h1', 'Sign in')
      cy.get('.cl-signIn-root').should('exist')
      cy.get('input[name=identifier]').type(Cypress.env('test_user'))

      cy.get('.cl-formButtonPrimary').contains('button', 'Continue').click()
      cy.get('input[name=password]').type(Cypress.env('test_password'))

      cy.get('.cl-formButtonPrimary').contains('button', 'Continue').click()
    })

    cy.url().should('include', '/protected')
    // Ensure the user has successfully accessed the protected page
    // by checking an element on the page that only the authenticated user can access
    cy.contains('h1', 'This is a PROTECTED page')
  })
})

----------------------------------------

TITLE: Accessing Current User Data with useUser() in Vue
DESCRIPTION: This snippet demonstrates how to use the useUser() composable to access the current user's data, handle loading state, and check if the user is signed in. It displays a greeting with the user's full name if signed in.

LANGUAGE: vue
CODE:
<script setup>
import { useUser } from '@clerk/vue'

const { isSignedIn, user, isLoaded } = useUser()
</script>

<template>
  <div v-if="!isLoaded">
    <!-- Handle loading state -->
  </div>

  <div v-else-if="isSignedIn">Hello {{ user?.fullName }}!</div>

  <div v-else>Not signed in</div>
</template>

----------------------------------------

TITLE: Implementing RedirectToSignIn in Next.js App Router
DESCRIPTION: This snippet demonstrates how to use the RedirectToSignIn component within a Next.js application using the App Router. It shows the component usage within a root layout file.

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, RedirectToSignIn } from '@clerk/nextjs'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html>
      <body>
        <ClerkProvider>
          <SignedIn>{children}</SignedIn>
          <SignedOut>
            <RedirectToSignIn />
          </SignedOut>
        </ClerkProvider>
      </body>
    </html>
  )
}

----------------------------------------

TITLE: Authenticating with Web3 in Clerk
DESCRIPTION: This method initiates a Web3 authentication flow by verifying the user's ownership of a blockchain wallet address through cryptographic signature verification.

LANGUAGE: javascript
CODE:
const signUp = await clerk.signUp.authenticateWithWeb3({
  identifier: '0x1234567890123456789012345678901234567890',
})

----------------------------------------

TITLE: Defining User-related Metadata Interfaces in TypeScript
DESCRIPTION: Defines TypeScript interfaces for user-related metadata, including public, private, and unsafe metadata for users, as well as sign-up and user organization invitation metadata.

LANGUAGE: typescript
CODE:
interface SignUpUnsafeMetadata {
  [k: string]: unknown
}

LANGUAGE: typescript
CODE:
interface UserOrganizationInvitationPublicMetadata {
  [k: string]: unknown
}

LANGUAGE: typescript
CODE:
interface UserPublicMetadata {
  [k: string]: unknown
}

LANGUAGE: typescript
CODE:
interface UserPrivateMetadata {
  [k: string]: unknown
}

LANGUAGE: typescript
CODE:
interface UserUnsafeMetadata {
  [k: string]: unknown
}

----------------------------------------

TITLE: Handling Email Link Verification
DESCRIPTION: Handles the completion of an email link verification flow by processing the verification results from the redirect URL query parameters. This method should be called after the user is redirected back from visiting the verification link in their email.

LANGUAGE: TypeScript
CODE:
function handleEmailLinkVerification(
  params: handleEmailLinkVerificationParams,
  customNavigate?: ((to: string) => Promise<unknown>) | undefined,
): Promise<unknown>

----------------------------------------

TITLE: JSON Error Structure for Invalid Cookie in Clerk
DESCRIPTION: Specifies the JSON structure for an 'InvalidCookie' error, which is thrown when a provided cookie is invalid. It includes a short message and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "The provided cookie is invalid.",
  "code": "cookie_invalid_code"
}

----------------------------------------

TITLE: Implementing SignUp Component in Astro
DESCRIPTION: Basic implementation of the SignUp component in an Astro application.

LANGUAGE: astro
CODE:
---
import { SignUp } from '@clerk/astro/components'
---

<SignUp />

----------------------------------------

TITLE: Preparing First Factor Authentication in Clerk
DESCRIPTION: Example of preparing the first factor authentication using an email link strategy in Clerk's SignIn object.

LANGUAGE: javascript
CODE:
const signIn = await clerk.signIn.prepareFirstFactor({
  strategy: 'email_link',
  identifier: 'test@example.com',
})

----------------------------------------

TITLE: Updating User Data with useUser() in Vue
DESCRIPTION: This example shows how to update the current user's information using the useUser() composable. It accesses the User object and calls the update() method to change the user's first and last name.

LANGUAGE: vue
CODE:
<script setup>
import { useUser } from '@clerk/vue'

const { isLoaded, user } = useUser()

const updateUser = async () => {
  await user.value?.update({
    firstName: 'John',
    lastName: 'Doe',
  })
}
</script>

<template>
  <div v-if="!isLoaded">
    <!-- Handle loading state -->
  </div>

  <div v-else-if="user">
    <button @click="updateUser">Update your name</button>
    <p>user.firstName: {{ user?.firstName }}</p>
    <p>user.lastName: {{ user?.lastName }}</p>
  </div>
</template>

----------------------------------------

TITLE: Creating SQL Function for User ID Retrieval in Supabase
DESCRIPTION: This SQL function extracts the user ID from the JWT claims in Supabase, used for Row Level Security policies.

LANGUAGE: sql
CODE:
CREATE OR REPLACE FUNCTION requesting_user_id()
RETURNS TEXT AS $$
    SELECT NULLIF(
        current_setting('request.jwt.claims', true)::json->>'sub',
        ''
    )::text;
$$ LANGUAGE SQL STABLE;

----------------------------------------

TITLE: Implementing ClerkLoading in Expo
DESCRIPTION: Example of using ClerkLoading component in a React Native Expo application. Shows integration with React Native components and proper loading state handling.

LANGUAGE: tsx
CODE:
import { ClerkLoading } from '@clerk/clerk-expo'
import { Text, View } from 'react-native'

export default function Screen() {
  return (
    <View>
      <ClerkLoading>
        <Text>Clerk is loading</Text>
      </ClerkLoading>
    </View>
  )
}

----------------------------------------

TITLE: Retrieving External Data with Clerk Token in Next.js Route Handler
DESCRIPTION: Shows how to use auth().getToken() to retrieve a JWT token and use it to fetch data from an external source like Supabase.

LANGUAGE: typescript
CODE:
import { NextResponse } from 'next/server'
import { auth } from '@clerk/nextjs/server'
export async function GET() {
  const { userId, getToken } = await auth()

  if (!userId) {
    return new Response('Unauthorized', { status: 401 })
  }

  const token = await getToken({ template: 'supabase' })

  // Fetch data from Supabase and return it.
  const data = { supabaseData: 'Hello World' }

  return NextResponse.json({ data })
}

----------------------------------------

TITLE: Backend Session Object Type Definition
DESCRIPTION: Type definition for the Backend Session object showing all available properties including session identifiers, timing information, user associations, and activity data.

LANGUAGE: typescript
CODE:
interface BackendSession {
  id: string;
  clientId: string;
  userId: string;
  status: string;
  lastActiveAt: number;
  lastActiveOrganizationId?: string;
  actor: ActJWTClaim | null;
  latestActivity: SessionActivity;
  expireAt: number;
  abandonAt: number;
  createdAt: number;
  updatedAt: number;
}

----------------------------------------

TITLE: Using getAuth() Function in Clerk for Authentication
DESCRIPTION: The getAuth() function retrieves authentication state from the request object. It accepts a request parameter and an optional configuration object. It returns an Auth object containing the authentication state.

LANGUAGE: typescript
CODE:
getAuth(request: any, opts?: {
  secretKey?: string
}): Auth

----------------------------------------

TITLE: Adding Phone Numbers for MFA in Next.js
DESCRIPTION: React component for adding and verifying new phone numbers for MFA purposes. Implements a two-step form process for phone number input and OTP verification using Clerk's API.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useUser } from '@clerk/nextjs'
import { PhoneNumberResource } from '@clerk/types'

export default function Page() {
  const { isLoaded, user } = useUser()
  const [phone, setPhone] = React.useState('')
  const [code, setCode] = React.useState('')
  const [isVerifying, setIsVerifying] = React.useState(false)
  const [successful, setSuccessful] = React.useState(false)
  const [phoneObj, setPhoneObj] = React.useState<PhoneNumberResource | undefined>()

  if (!isLoaded) return null

  if (!user) {
    return <p>You must be logged in to access this page</p>
  }

  // Handle addition of the phone number
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    try {
      const res = await user.createPhoneNumber({ phoneNumber: phone })
      await user.reload()
      const phoneNumber = user.phoneNumbers.find((a) => a.id === res.id)
      setPhoneObj(phoneNumber)
      phoneNumber?.prepareVerification()
      setIsVerifying(true)
    } catch (err) {
      console.error(JSON.stringify(err, null, 2))
    }
  }

  // Rest of the component implementation...

----------------------------------------

TITLE: Server-side Authentication and User Data Access in Astro
DESCRIPTION: Demonstrates how to validate authentication and access user data on the server side using Astro's locals.auth() and locals.currentUser() helpers. Includes both component and API route implementations.

LANGUAGE: astro
CODE:
---
if (!Astro.locals.auth().userId) {
  return Astro.redirect('/login')
}

const user = await Astro.locals.currentUser()
---

<div>{JSON.stringify(user)}</div>

LANGUAGE: tsx
CODE:
export async function GET({ locals }) {
  if (!locals.auth().userId) {
    return new Response('Unauthorized', { status: 401 })
  }

  const currentUser = await locals.currentUser()

  return new Response(JSON.stringify(currentUser))
}

----------------------------------------

TITLE: Configuring Clerk and Convex Providers in React
DESCRIPTION: This code snippet shows how to set up the Clerk and Convex providers in a React application's entry point. It demonstrates wrapping the app with ClerkProvider and ConvexProviderWithClerk for authentication and client context.

LANGUAGE: typescript
CODE:
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './index.css'
import { ClerkProvider, useAuth } from '@clerk/clerk-react'
import { ConvexProviderWithClerk } from 'convex/react-clerk'
import { ConvexReactClient } from 'convex/react'

// Import your Publishable Key
const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Missing Publishable Key')
}

const convex = new ConvexReactClient(import.meta.env.VITE_CONVEX_URL as string)

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <ClerkProvider publishableKey={PUBLISHABLE_KEY}>
      <ConvexProviderWithClerk client={convex} useAuth={useAuth}>
        <App />
      </ConvexProviderWithClerk>
    </ClerkProvider>
  </React.StrictMode>,
)

----------------------------------------

TITLE: Integrating ClerkProvider in Tanstack Start Application
DESCRIPTION: This snippet shows how to integrate ClerkProvider into a Tanstack Start application. It wraps the root component to provide authentication context to the entire app.

LANGUAGE: tsx
CODE:
import { Outlet, createRootRoute } from '@tanstack/react-router'
import { Meta, Scripts } from '@tanstack/start'
import * as React from 'react'
import { ClerkProvider } from '@clerk/tanstack-start'

export const Route = createRootRoute({
  component: () => {
    return (
      <RootDocument>
        <Outlet />
      </RootDocument>
    )
  },
})

function RootDocument({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider>
      <html>
        <head>
          <Meta />
        </head>
        <body>
          {children}
          <Scripts />
        </body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Accessing Session Object with useSession() in Vue
DESCRIPTION: This snippet demonstrates how to use the useSession() composable to access the Session object and display the last active time. It handles loading and signed-out states, and shows the session's last active time when the user is signed in.

LANGUAGE: vue
CODE:
<script setup>
import { useSession } from '@clerk/vue'

const { isLoaded, session, isSignedIn } = useSession()
</script>

<template>
  <div v-if="!isLoaded">
    <!-- Handle loading state -->
  </div>

  <div v-else-if="!isSignedIn">
    <!-- Handle signed out state -->
  </div>

  <div v-else>
    <p>This session has been active since {{ session.lastActiveAt.toLocaleString() }}</p>
  </div>
</template>

----------------------------------------

TITLE: Defining getOrganization Function TypeScript Interface
DESCRIPTION: TypeScript function signature for retrieving a single organization, defining the return type as a Promise of Organization type.

LANGUAGE: typescript
CODE:
function getOrganization(params: GetOrganizationParams): Promise<Organization>

----------------------------------------

TITLE: Generating Actor Token using Clerk's Backend API in Next.js
DESCRIPTION: This server action generates an actor token for user impersonation using Clerk's Backend API. It includes permission checks and error handling for the token generation process.

LANGUAGE: tsx
CODE:
'use server'

import { auth } from '@clerk/nextjs/server'

export async function generateActorToken(actorId: string, userId: string) {
  // Check if the user has the permission to impersonate
  if (!auth().has({ permission: 'org:admin:impersonate' })) {
    return {
      ok: false,
      message: 'You do not have permission to access this page.',
    }
  }

  const params = JSON.stringify({
    user_id: userId,
    actor: {
      sub: actorId,
    },
  })

  // Create an actor token using Clerk's Backend API
  const res = await fetch('https://api.clerk.com/v1/actor_tokens', {
    method: 'POST',
    headers: {
      Authorization: `Bearer ${process.env.CLERK_SECRET_KEY}`,
      'Content-type': 'application/json',
    },
    body: params,
  })

  if (!res.ok) {
    return { ok: false, message: 'Failed to generate actor token' }
  }
  const data = await res.json()

  return { ok: true, token: data.token }
}

----------------------------------------

TITLE: Using RedirectToSignUp in React with Clerk
DESCRIPTION: This snippet illustrates how to use the RedirectToSignUp component in a React application with Clerk. It includes setting up the ClerkProvider with a publishable key and conditional rendering based on user authentication status.

LANGUAGE: tsx
CODE:
import {
  ClerkProvider,
  SignedIn,
  SignedOut,
  RedirectToSignUp,
  UserButton,
} from '@clerk/clerk-react'

// Import your Publishable Key
const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Add your Clerk Publishable Key to the .env file')
}

function PrivatePage() {
  return (
    <ClerkProvider publishableKey={PUBLISHABLE_KEY}>
      <SignedIn>
        <UserButton />
      </SignedIn>
      <SignedOut>
        <RedirectToSignUp />
      </SignedOut>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Defining SamlAccountConnection Interface in TypeScript
DESCRIPTION: This code snippet defines the SamlAccountConnection interface with various properties related to SAML account connections. It includes boolean flags for configuration, string identifiers, and Date objects for timestamps.

LANGUAGE: typescript
CODE:
interface SamlAccountConnection {
  active: boolean;
  allowIdpInitiated: boolean;
  allowSubdomains: boolean;
  createdAt: Date;
  disableAdditionalIdentifications: boolean;
  domain: string;
  id: string;
  name: string;
  provider: string;
  syncUserAttributes: boolean;
  updatedAt: Date;
}

----------------------------------------

TITLE: Using useSessionList() Hook in Next.js
DESCRIPTION: This example shows how to implement the useSessionList() hook in a Next.js application, displaying the number of user sessions.

LANGUAGE: tsx
CODE:
'use client'

import { useSessionList } from '@clerk/nextjs'

export default function HomePage() {
  const { isLoaded, sessions } = useSessionList()

  if (!isLoaded) {
    // Handle loading state
    return null
  }

  return (
    <div>
      <p>Welcome back. You've been here {sessions.length} times before.</p>
    </div>
  )
}

----------------------------------------

TITLE: Managing Organization Domains with Clerk API in TypeScript
DESCRIPTION: Example demonstrating how to create, verify, and manage organization domains using Clerk's API. Shows domain creation, email verification preparation, verification attempt, and enrollment mode updates.

LANGUAGE: tsx
CODE:
const { organization, domains } = useOrganization()

// create domain
const domain = await organization.createDomain('example.com')

// prepare email verification
domain.prepareAffiliationVerification({ affiliationEmailAddress: 'foo@example.com' })

// attempt email verification
domain.attemptAffiliationVerification({ code: '123456' })

// update domain enrollment mode
domain.updateEnrollmentMode({ enrollmentMode: 'automatic_invitation' })

----------------------------------------

TITLE: Backend Organization Object Type Definition
DESCRIPTION: Defines the type structure for the Backend Organization object including all available properties like ID, name, metadata, and organizational settings.

LANGUAGE: typescript
CODE:
interface BackendOrganization {
  id: string;
  name: string;
  slug: string;
  createdBy?: string;
  createdAt: number;
  updatedAt: number;
  imageUrl: string;
  hasImage: boolean;
  publicMetadata: OrganizationPublicMetadata;
  privateMetadata: OrganizationPrivateMetadata;
  maxAllowedMemberships: number;
  adminDeleteEnabled: boolean;
  membersCount?: number;
}

----------------------------------------

TITLE: Attempting First Factor Authentication in Clerk
DESCRIPTION: Example of attempting the first factor authentication using an email code strategy in Clerk's SignIn object.

LANGUAGE: javascript
CODE:
const signIn = await clerk.signIn.attemptFirstFactor({
  strategy: 'email_code',
  code: '123456',
})

----------------------------------------

TITLE: Integrating Clerk Provider and Components in Next.js Layout
DESCRIPTION: Implementing the ClerkProvider and Clerk components in the Next.js app layout. This code sets up the authentication context and adds sign-in, sign-up, and user button components to the header.

LANGUAGE: tsx
CODE:
import type { Metadata } from 'next'
import {
  ClerkProvider,
  SignInButton,
  SignUpButton,
  SignedIn,
  SignedOut,
  UserButton,
} from '@clerk/nextjs'
import { Geist, Geist_Mono } from 'next/font/google'
import './globals.css'

const geistSans = Geist({
  variable: '--font-geist-sans',
  subsets: ['latin'],
})

const geistMono = Geist_Mono({
  variable: '--font-geist-mono',
  subsets: ['latin'],
})

export const metadata: Metadata = {
  title: 'Clerk Next.js Quickstart',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
          <header className="flex justify-end items-center p-4 gap-4 h-16">
            <SignedOut>
              <SignInButton />
              <SignUpButton />
            </SignedOut>
            <SignedIn>
              <UserButton />
            </SignedIn>
          </header>
          {children}
        </body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Using banUser Function with Clerk Backend SDK in TypeScript
DESCRIPTION: Example usage of the `banUser()` function from the Clerk Backend SDK. It demonstrates how to ban a user by their ID using the `clerkClient.users.banUser()` method.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const response = await clerkClient.users.banUser(userId)

----------------------------------------

TITLE: Accessing Current User in Server Actions for Client Components with Clerk in Next.js
DESCRIPTION: This set of snippets shows how to access the current user's data in a server action that is used within a Client Component, demonstrating the separation of server-side and client-side code.

LANGUAGE: tsx
CODE:
'use server'
import { currentUser } from '@clerk/nextjs/server'

export async function addHobby(formData: FormData) {
  const user = await currentUser()

  if (!user) {
    throw new Error('You must be signed in to use this feature')
  }

  const serverData = {
    usersHobby: formData.get('hobby'),
    userId: user.id,
    profileImage: user.imageUrl,
  }

  console.log('add Hobby completed with user details ', serverData)
}

LANGUAGE: tsx
CODE:
'use client'

export default function UI({ addHobby }) {
  return (
    <form action={addHobby}>
      <input value={'soccer'} type="text" name="hobby" />
      <button type="submit">Submit your hobby</button>
    </form>
  )
}

LANGUAGE: tsx
CODE:
import AddHobby from './components/AddHobby'
import { addHobby } from './actions'
export default function Hobby() {
  return <AddHobby addHobby={addHobby} />
}

----------------------------------------

TITLE: Creating New Client Instance in TypeScript
DESCRIPTION: Asynchronous method to create a new client instance and its associated cookie.

LANGUAGE: typescript
CODE:
function create(): Promise<Client>

----------------------------------------

TITLE: Basic Usage of SignOutButton in Next.js
DESCRIPTION: Demonstrates how to use the SignOutButton component in a Next.js application. The component is imported from '@clerk/nextjs' and rendered in a functional component.

LANGUAGE: jsx
CODE:
import { SignOutButton } from '@clerk/nextjs'

export default function Home() {
  return <SignOutButton />
}

----------------------------------------

TITLE: Resetting Password in Clerk
DESCRIPTION: Example of resetting a user's password using Clerk's SignIn object.

LANGUAGE: javascript
CODE:
await clerk.signIn.resetPassword({
  password: 'new-password',
})

----------------------------------------

TITLE: Defining BackupCodeResource Interface in TypeScript
DESCRIPTION: This interface defines the structure for a backup code resource. It includes an id, an array of codes, and creation/update timestamps.

LANGUAGE: typescript
CODE:
interface BackupCodeResource {
  id: string;
  codes: string[];
  createdAt: Date;
  updatedAt: Date;
}

----------------------------------------

TITLE: Defining updateOrganizationMembershipMetadata Function in TypeScript
DESCRIPTION: This snippet defines the function signature for updating organization membership metadata. It takes UpdateOrganizationMembershipMetadataParams as input and returns a Promise resolving to OrganizationMembership.

LANGUAGE: typescript
CODE:
function updateOrganizationMembershipMetadata(
  params: UpdateOrganizationMembershipMetadataParams,
): Promise<OrganizationMembership>

----------------------------------------

TITLE: Basic Clerk Middleware Setup in Astro
DESCRIPTION: Basic implementation of Clerk middleware in an Astro application using the clerkMiddleware() function.

LANGUAGE: typescript
CODE:
import { clerkMiddleware } from '@clerk/astro/server'

export const onRequest = clerkMiddleware()

----------------------------------------

TITLE: Using getAuth() for Authentication and Authorization
DESCRIPTION: Demonstrates how to use getAuth() helper to retrieve authentication state and implement authorization checks. It combines requireAuth() for authentication and a custom middleware for authorization.

LANGUAGE: javascript
CODE:
import { clerkMiddleware, getAuth, requireAuth } from '@clerk/express'
import express from 'express'

const app = express()
const PORT = 3000

// Apply `clerkMiddleware()` to all routes
app.use(clerkMiddleware())

// Use `getAuth()` to protect a route based on authorization status
const hasPermission = (req, res, next) => {
  const auth = getAuth(req)

  // Handle if the user is not authorized
  if (!auth.has({ permission: 'org:admin:example' })) {
    return res.status(403).send('Forbidden')
  }

  return next()
}

// Use `requireAuth()` to protect this route
// If user is not authenticated, requireAuth() will redirect back to the homepage
app.get('/path', requireAuth(), hasPermission, (req, res) => res.json(req.auth))

// Start the server and listen on the specified port
app.listen(PORT, () => {
  console.log(`Server is running on http://localhost:${PORT}`)
})

----------------------------------------

TITLE: Implementing Custom OTP Input with Clerk Elements and Framer Motion in TSX
DESCRIPTION: This code snippet shows how to create a custom OTP input field using Clerk.Input with the 'otp' type. It utilizes a render prop to customize the appearance and includes Framer Motion animations for enhanced user experience. The input is styled with Tailwind CSS classes.

LANGUAGE: tsx
CODE:
<Clerk.Input
  type="otp"
  required
  className="flex justify-center gap-1"
  render={({ value, status }) => (
    <div
      data-status={status}
      className="relative h-9 w-8 rounded-md bg-white ring-1 ring-inset ring-zinc-300 data-[status=selected]:bg-sky-400/10 data-[status=selected]:shadow-[0_0_8px_2px_theme(colors.sky.400/30%)] data-[status=selected]:ring-sky-400"
    >
      <AnimatePresence>
        {value && (
          <motion.span
            initial={{ opacity: 0, scale: 0.75 }}
            animate={{ opacity: 1, scale: 1 }}
            exit={{ opacity: 0, scale: 0.75 }}
            className="absolute inset-0 flex items-center justify-center text-zinc-950"
          >
            {value}
          </motion.span>
        )}
        {value}
      </AnimatePresence>
      {status === 'cursor' && (
        <motion.div
          layoutId="otp-input-focus"
          transition={{ ease: [0.2, 0.4, 0, 1], duration: 0.2 }}
          className="absolute inset-0 z-10 rounded-[inherit] border border-sky-400 bg-sky-400/10 shadow-[0_0_8px_2px_theme(colors.sky.400/30%)]"
        />
      )}
    </div>
  )}
/>

----------------------------------------

TITLE: Authorization in Remix Loaders with Clerk
DESCRIPTION: Demonstrates how to perform authorization checks in a Remix loader using Clerk's has() function.

LANGUAGE: tsx
CODE:
export const loader: LoaderFunction = async (args) => {
  const { has } = await getAuth(args)

  if (has({ permission: 'org:team_settings:manage' }) === false) {
    return redirect('/request-access')
  }

  return {}
}

export default function Settings() {
  return (
    <div>
      <h1>Settings Page</h1>
    </div>
  )
}

----------------------------------------

TITLE: Basic Clerk Integration in Sinatra
DESCRIPTION: Shows how to register the Clerk Sinatra extension and access the user object. This is the basic setup required to integrate Clerk authentication into a Sinatra application.

LANGUAGE: ruby
CODE:
require "clerk/sinatra"
require "sinatra/base"

class App < Sinatra::Base
  register Sinatra::Clerk

  # Access the user's `User` object
  get "/" do
    @user = clerk.user
    erb :index, format: :html5
  end

  run! if app_file == $0
end

----------------------------------------

TITLE: Installing Clerk SDK via Terminal
DESCRIPTION: Command to install the Clerk SDK package using go get.

LANGUAGE: sh
CODE:
go get -u github.com/clerk/clerk-sdk-go/v2

----------------------------------------

TITLE: Using OrganizationSwitcher in React
DESCRIPTION: Demonstration of how to implement the OrganizationSwitcher component in a React application. This snippet shows the basic usage within a functional component.

LANGUAGE: jsx
CODE:
import { OrganizationSwitcher } from '@clerk/clerk-react'

export default function OrganizationSwitcherPage() {
  return <OrganizationSwitcher />
}

----------------------------------------

TITLE: Using getUser Function with Clerk Backend SDK
DESCRIPTION: Example of how to use the getUser function from the Clerk Backend SDK. It demonstrates fetching a user with a specific ID using the clerkClient.users.getUser method.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const response = await clerkClient.users.getUser(userId)

----------------------------------------

TITLE: Vanilla JavaScript Clerk Sign-in Implementation
DESCRIPTION: HTML and JavaScript implementation of Clerk sign-in using the Clerk JavaScript SDK. Includes form handling and error display functionality.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="signed-in"></div>
    <div id="sign-in">
      <h2>Sign in</h2>
      <form id="sign-in-form">
        <label for="email">Enter email address</label>
        <input name="email" id="sign-in-email" />
        <label for="password">Enter password</label>
        <input name="password" id="sign-in-password" />
        <button type="submit">Continue</button>
      </form>
    </div>
    <p id="error"></p>
    <script type="module" src="/src/main.js" async crossorigin="anonymous"></script>
  </body>
</html>

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(pubKey)
await clerk.load()

if (clerk.user) {
  document.getElementById('signed-in').innerHTML = `
      <div id="user-button"></div>
    `
  const userbuttonDiv = document.getElementById('user-button')
  clerk.mountUserButton(userbuttonDiv)
} else {
  document.getElementById('sign-in-form').addEventListener('submit', async (e) => {
    e.preventDefault()
    const formData = new FormData(e.target)
    const emailAddress = formData.get('email')
    const password = formData.get('password')
    try {
      const signInAttempt = await clerk.client.signIn.create({
        identifier: emailAddress,
        password,
      })
      if (signInAttempt.status === 'complete') {
        await clerk.setActive({ session: signInAttempt.createdSessionId })
        location.reload()
      } else {
        console.error(JSON.stringify(signInAttempt, null, 2))
      }
    } catch (error) {
      if (isClerkAPIResponseError(err)) {
        const errors = err.errors
        document.getElementById('error').textContent = errors[0].longMessage
      }
      console.error(JSON.stringify(err, null, 2))
    }
  })
}

----------------------------------------

TITLE: Using unbanUser Function with Clerk Backend SDK in React
DESCRIPTION: Example of how to use the unbanUser function with Clerk's Backend SDK. It demonstrates unbanning a user with a specific userId.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const response = await clerkClient.users.unbanUser(userId)

----------------------------------------

TITLE: Implementing Sign-in Status Display with useSignIn in Vue
DESCRIPTION: Example showing how to implement a sign-in status component using Clerk's useSignIn() composable. The component handles loading states and displays the current sign-in attempt status.

LANGUAGE: vue
CODE:
<script setup>
import { useSignIn } from '@clerk/vue'

const { isLoaded, signIn } = useSignIn()
</script>

<template>
  <div v-if="!isLoaded">
    <!-- Add logic to handle loading state -->
  </div>

  <div v-else>The current sign in attempt status is {{ signIn?.status }}.</div>
</template>

----------------------------------------

TITLE: Creating User with Clerk API using cURL
DESCRIPTION: This curl command demonstrates how to create a user by making a POST request to the Clerk API. It includes the necessary headers for authorization and content type, along with the user data in the request body.

LANGUAGE: bash
CODE:
curl 'https://api.clerk.com/v1/users' -X POST -H 'Authorization:Bearer {{secret}}' -H 'Content-Type:application/json' -d '{
  "email_address": ["test@example.com"],
  "password": "my-secure-password"
}'

----------------------------------------

TITLE: Protecting Server Components with Clerk's Protect Component in Next.js
DESCRIPTION: Shows how to use the <Protect> component to conditionally render content in a Next.js React Server Component based on user permissions.

LANGUAGE: tsx
CODE:
import type { PropsWithChildren } from 'react'
import { Protect } from '@clerk/nextjs'

export default function SettingsLayout(props: PropsWithChildren) {
  return <Protect permission="org:team_settings:read">{props.children}</Protect>
}

----------------------------------------

TITLE: Basic SignInButton Usage in Next.js
DESCRIPTION: Demonstrates how to use the SignInButton component in a Next.js application. The component is imported from '@clerk/nextjs' and rendered in a functional component.

LANGUAGE: jsx
CODE:
import { SignInButton } from '@clerk/nextjs'

export default function Home() {
  return <SignInButton />
}

----------------------------------------

TITLE: Defining Custom JWT Session Claims in TypeScript
DESCRIPTION: TypeScript declaration to define custom JWT session claims globally. This adds type safety for the custom 'metadata' field in the session token.

LANGUAGE: typescript
CODE:
export {}

declare global {
  interface CustomJwtSessionClaims {
    metadata: {
      onboardingComplete?: boolean
    }
  }
}

----------------------------------------

TITLE: Creating Organization Invitation Function Signature
DESCRIPTION: TypeScript function signature for creating organization invitations, showing the required parameters and return type.

LANGUAGE: typescript
CODE:
function createOrganizationInvitation(
  params: CreateOrganizationInvitationParams,
): Promise<OrganizationInvitation>

----------------------------------------

TITLE: Importing Common Clerk Elements Components
DESCRIPTION: Shows how to import all common Clerk Elements components under the Clerk namespace.

LANGUAGE: tsx
CODE:
import * as Clerk from '@clerk/elements/common'

----------------------------------------

TITLE: Configuring Clerk Environment Variables
DESCRIPTION: Setting up required Clerk API keys in the .env file for authentication configuration.

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Integrating ClerkProvider and Components
DESCRIPTION: Adding ClerkProvider wrapper and authentication components to the Next.js _app.tsx file for user management functionality.

LANGUAGE: tsx
CODE:
import '@/styles/globals.css'
import { ClerkProvider, SignInButton, SignedIn, SignedOut, UserButton } from '@clerk/nextjs'
import type { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider {...pageProps}>
      <SignedOut>
        <SignInButton />
      </SignedOut>
      <SignedIn>
        <UserButton />
      </SignedIn>
      <Component {...pageProps} />
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Creating Authentication Header with Clerk Components in Vue
DESCRIPTION: Example of creating a header component in Vue using Clerk's prebuilt control components for authentication, including SignedIn, SignedOut, UserButton, and SignInButton.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { SignedIn, SignedOut, SignInButton, UserButton } from '@clerk/vue'
</script>

<template>
  <header>
    <SignedOut>
      <SignInButton />
    </SignedOut>
    <SignedIn>
      <UserButton />
    </SignedIn>
  </header>
</template>

----------------------------------------

TITLE: Caching JSON Web Keys for Clerk Session Verification in Go
DESCRIPTION: This snippet demonstrates how to cache JSON Web Keys when manually verifying Clerk session tokens in Go. It includes a custom JWKStore interface for key storage and retrieval.

LANGUAGE: go
CODE:
package main

import (
	"fmt"
	"net/http"
	"strings"

	"github.com/clerk/clerk-sdk-go/v2"
	"github.com/clerk/clerk-sdk-go/v2/jwks"
	"github.com/clerk/clerk-sdk-go/v2/jwt"
	"github.com/clerk/clerk-sdk-go/v2/user"
)

func main() {
	mux := http.NewServeMux()
	mux.HandleFunc("/", publicRoute)

	// Initialize storage for JSON Web Keys. You can cache/store
	// the key for as long as it's valid, and pass it to jwt.Verify.
	// This way jwt.Verify won't make requests to the Clerk
	// Backend API to refetch the JSON Web Key.
	// Make sure you refetch the JSON Web Key whenever your
	// Clerk Secret Key changes.
	jwkStore := NewJWKStore()

	config := &clerk.ClientConfig{}
	config.Key = clerk.String("{{secret}}")
	jwksClient := jwks.NewClient(config)
	mux.HandleFunc("/protected", protectedRoute(jwksClient, jwkStore))

	http.ListenAndServe(":3000", mux)
}

func publicRoute(w http.ResponseWriter, r *http.Request) {
	w.Write([]byte(`{"access": "public"}`))
}

func protectedRoute(jwksClient *jwks.Client, store JWKStore) func(http.ResponseWriter, *http.Request) {
	return func(w http.ResponseWriter, r *http.Request) {
		// Get the session JWT from the Authorization header
		sessionToken := strings.TrimPrefix(r.Header.Get("Authorization"), "Bearer ")

		// Attempt to get the JSON Web Key from your store.
		jwk := store.GetJWK()
		if jwk == nil {
			// Decode the session JWT so that we can find the key ID.
			unsafeClaims, err := jwt.Decode(r.Context(), &jwt.DecodeParams{
				Token: sessionToken,
			})
			if err != nil {
				// handle the error
				w.WriteHeader(http.StatusUnauthorized)
				w.Write([]byte(`{"access": "unauthorized"}`))
				return
			}

			// Fetch the JSON Web Key
			jwk, err = jwt.GetJSONWebKey(r.Context(), &jwt.GetJSONWebKeyParams{
				KeyID:      unsafeClaims.KeyID,
				JWKSClient: jwksClient,
			})
			if err != nil {
				// handle the error
				w.WriteHeader(http.StatusUnauthorized)
				w.Write([]byte(`{"access": "unauthorized"}`))
				return
			}
		}
		// Write the JSON Web Key to your store, so that next time
		// you can use the cached value.
		store.SetJWK(jwk)

		// Verify the session
		claims, err := jwt.Verify(r.Context(), &jwt.VerifyParams{
			Token: sessionToken,
			JWK:   jwk,
		})
		if err != nil {
			// handle the error
			w.WriteHeader(http.StatusUnauthorized)
			w.Write([]byte(`{"access": "unauthorized"}`))
			return
		}

		usr, err := user.Get(r.Context(), claims.Subject)
		if err != nil {
			// handle the error
		}
		fmt.Fprintf(w, `{"user_id": "%s", "user_banned": "%t"}`, usr.ID, usr.Banned)
	}
}

// Sample interface for JSON Web Key storage.
// Implementation may vary.
type JWKStore interface {
	GetJWK() *clerk.JSONWebKey
	SetJWK(*clerk.JSONWebKey)
}

func NewJWKStore() JWKStore {
	// Implementation may vary. This can be an
	// in-memory store, database, caching layer,...
	return nil
}

----------------------------------------

TITLE: Defining useOAuth() Hook Return Type in TypeScript
DESCRIPTION: This snippet shows the TypeScript definition for the startOAuthFlow method returned by the useOAuth() hook. It specifies the method's parameters and return type.

LANGUAGE: typescript
CODE:
const startOAuthFlow: (
  startOAuthFlowParams?: StartOAuthFlowParams,
) => Promise<StartOAuthFlowReturnType>

----------------------------------------

TITLE: Basic Clerk Sign-Up Component Structure
DESCRIPTION: Demonstrates the basic anatomy of a sign-up flow using Clerk Elements components with three main steps: start, continue, and verifications.

LANGUAGE: tsx
CODE:
import * as SignUp from '@clerk/elements/sign-up'

export default function SignUpPage() {
  return (
    <SignUp.Root>
      <SignUp.Step name="start" />
      <SignUp.Step name="continue" />
      <SignUp.Step name="verifications" />
    </SignUp.Root>
  )
}

----------------------------------------

TITLE: Implementing OrganizationList in React
DESCRIPTION: Example of using the OrganizationList component in a React application with dynamic URL navigation based on organization and user properties.

LANGUAGE: jsx
CODE:
import { OrganizationList } from '@clerk/clerk-react'

export default function OrganizationListPage() {
  return (
    <OrganizationList
      afterCreateOrganizationUrl={(org) => `/organization/${org.slug}`}
      afterSelectPersonalUrl={(user) => `/user/${user.id}`}
      afterSelectOrganizationUrl={(org) => `/organization/${org.slug}`}
    />
  )
}

----------------------------------------

TITLE: Session Token Retrieval Example - JavaScript
DESCRIPTION: Example showing how to retrieve a custom JWT template token.

LANGUAGE: javascript
CODE:
await clerk.session.getToken({ template: 'Test' })

----------------------------------------

TITLE: Creating a Header with Clerk Components in Vue
DESCRIPTION: Example of using Clerk components to create a header in a Vue template, showing different content for signed-in and signed-out users.

LANGUAGE: vue
CODE:
<script setup lang="ts">
// Components are automatically imported
</script>

<template>
  <header>
    <SignedOut>
      <SignInButton />
    </SignedOut>
    <SignedIn>
      <UserButton />
    </SignedIn>
  </header>

  <main>
    <NuxtPage />
  </main>
</template>

----------------------------------------

TITLE: Importing Clerk Nuxt SDK Components
DESCRIPTION: This snippet demonstrates how to import and use composables from the Clerk Vue SDK within a Nuxt application. These composables provide access to the Clerk object, User object, Organization object, and helper methods for authentication.

LANGUAGE: javascript
CODE:
<Include src="_partials/vue-nuxt/composables" />

----------------------------------------

TITLE: Using getSession with Clerk Client
DESCRIPTION: Example demonstrating how to retrieve a session using the Clerk client with a session ID. Shows practical usage of the getSession method.

LANGUAGE: tsx
CODE:
const sessionId = 'sess_123'

const response = await clerkClient.sessions.getSession(sessionId)

----------------------------------------

TITLE: Protecting Dashboard Route in Expo
DESCRIPTION: This code creates a protected layout for the dashboard in an Expo app. It uses Clerk's useAuth hook and Protect component to ensure only authorized users can access the dashboard.

LANGUAGE: tsx
CODE:
import { Redirect, Stack } from 'expo-router'
import { Protect, useAuth } from '@clerk/clerk-expo'
import { Text } from 'react-native'

export default function GuestLayout() {
  const { isSignedIn } = useAuth()

  if (!isSignedIn) {
    return <Redirect href={'/'} />
  }

  return (
    <Protect
      permission="org:dashboard:access"
      fallback={<Text>You don't have the permissions to access the dashboard.</Text>}
    >
      <Stack />
    </Protect>
  )
}

----------------------------------------

TITLE: Implementing CreateOrganization in Next.js
DESCRIPTION: Example of using the CreateOrganization component in a Next.js application. The component is imported from '@clerk/nextjs' and rendered in a page component.

LANGUAGE: jsx
CODE:
import { CreateOrganization } from '@clerk/nextjs'

export default function CreateOrganizationPage() {
  return <CreateOrganization />
}

----------------------------------------

TITLE: Defining updateUserMetadata Function in TypeScript
DESCRIPTION: This snippet defines the function signature for updateUserMetadata. It takes a userId and UpdateUserMetadataParams as input and returns a Promise resolving to a User object.

LANGUAGE: typescript
CODE:
function updateUserMetadata(userId: string, params: UpdateUserMetadataParams): Promise<User>

----------------------------------------

TITLE: Implementing useSignIn Hook in Next.js
DESCRIPTION: Example of using useSignIn() hook in a Next.js application with the 'use client' directive. Shows how to handle loading states and access sign-in status in a Next.js environment.

LANGUAGE: tsx
CODE:
'use client'

import { useSignIn } from '@clerk/nextjs'

export default function SignInPage() {
  const { isLoaded, signIn } = useSignIn()

  if (!isLoaded) {
    // Handle loading state
    return null
  }

  return <div>The current sign-in attempt status is {signIn?.status}.</div>
}

----------------------------------------

TITLE: Setting Unsafe Metadata with Clerk Frontend
DESCRIPTION: Examples showing how to set unsafe metadata that can be modified from both frontend and backend interfaces.

LANGUAGE: typescript
CODE:
export default function Page() {
  const { user } = useUser()
  const [birthday, setBirthday] = useState('')

  return (
    <div>
      <input type="text" value={birthday} onChange={(e) => setBirthday(e.target.value)} />

      <button
        onClick={() => {
          user?.update({
            unsafeMetadata: { birthday },
          })
        }}
      >
        Update birthday
      </button>
    </div>
  )
}

----------------------------------------

TITLE: Preparing Email Address Verification in Clerk
DESCRIPTION: This method initiates an email verification process by sending a one-time verification code to the email address associated with the current sign-up attempt.

LANGUAGE: typescript
CODE:
function prepareEmailAddressVerification(
  params?: PrepareEmailAddressVerificationParams,
): Promise<SignUpResource>

----------------------------------------

TITLE: Defining getUser Function in TypeScript
DESCRIPTION: Function signature for getUser, which retrieves a single User by their ID. It takes a userId string as a parameter and returns a Promise resolving to a User object.

LANGUAGE: typescript
CODE:
function getUser(userId: string): Promise<User>

----------------------------------------

TITLE: Retrieving Current Active Organization with useOrganization() in Vue
DESCRIPTION: This snippet demonstrates how to use the useOrganization() composable to access the current active Organization object and display its name. It also shows how to use the OrganizationSwitcher component.

LANGUAGE: vue
CODE:
<script setup>
import { OrganizationSwitcher, useOrganization } from '@clerk/vue'

const { organization, isLoaded } = useOrganization()
</script>

<template>
  <div v-if="!organization">
    <OrganizationSwitcher />
  </div>
  <div v-if="isLoaded">
    <p>This current organization is {{ organization?.name }}</p>
  </div>

  <div v-else>
    <p>Loading...</p>
  </div>
</template>

----------------------------------------

TITLE: Defining OrganizationCustomRoleKey Type in TypeScript
DESCRIPTION: OrganizationCustomRoleKey is a type that represents a user's role in an organization. By default, it is a string, but it can be customized using ClerkAuthorization. Clerk provides default roles 'org:admin' and 'org:member', and custom roles can be created.

LANGUAGE: typescript
CODE:
type OrganizationCustomRoleKey = string | CustomRoleType;

----------------------------------------

TITLE: Creating Clerk Client for Chrome Extension Content Scripts
DESCRIPTION: The createClerkClient() helper initializes a new Clerk instance on demand and refreshes the session token if there is a valid, signed-in user. It can be used in content scripts or background service workers to access user information or session tokens.

LANGUAGE: markdown
CODE:
```javascript
createClerkClient()
```

----------------------------------------

TITLE: Implementing RLS Policies for Tasks Table in Supabase
DESCRIPTION: SQL commands to create Row Level Security policies for SELECT and INSERT operations on the tasks table.

LANGUAGE: sql
CODE:
CREATE POLICY "Select tasks policy" ON "public"."tasks" AS PERMISSIVE FOR
SELECT
  TO authenticated USING (requesting_user_id () = user_id);

CREATE POLICY "Insert tasks policy" ON "public"."tasks" AS PERMISSIVE FOR INSERT TO authenticated
WITH
  CHECK (requesting_user_id () = user_id);

----------------------------------------

TITLE: Reloading User Data with useUser() in Vue
DESCRIPTION: This snippet demonstrates how to reload the latest user information using the useUser() composable. It updates user metadata via an API endpoint and then calls the reload() method to refresh the user data.

LANGUAGE: vue
CODE:
<script setup>
import { useUser } from '@clerk/vue'

const { isLoaded, user } = useUser()

const updateUser = async () => {
  // Update user data via an API endpoint
  const updateMetadata = await fetch('/api/updateMetadata')

  // Check if the update was successful
  if (updateMetadata.message !== 'success') {
    throw new Error('Error updating')
  }

  // If the update was successful, reload the user data
  await user.value?.reload()
}
</script>

<template>
  <div v-if="!isLoaded">
    <!-- Handle loading state -->
  </div>

  <div v-else-if="user">
    <button @click="updateUser">Update your metadata</button>
    <p>user role: {{ user.publicMetadata?.role }}</p>
  </div>
</template>

----------------------------------------

TITLE: Client-side Auth Store Usage in React/Astro
DESCRIPTION: Shows how to use the $authStore to access authentication information for the active user on the client side. Handles user session data and implements conditional rendering based on authentication status.

LANGUAGE: tsx
CODE:
import { useStore } from '@nanostores/react'
import { $authStore } from '@clerk/astro/client'

export default function Example() {
  const { userId, sessionId } = useStore($authStore)

  // In case the user signs out while on the page.
  if (!userId) {
    return null
  }

  return (
    <div>
      Hello, {userId} your current active session is {sessionId}
    </div>
  )
}

----------------------------------------

TITLE: Accessing SignIn State in Vue
DESCRIPTION: Example of using $signInStore with Vue to check the current sign-in state. Uses @nanostores/vue for state management and includes conditional rendering for loading states.

LANGUAGE: vue
CODE:
<script setup>
import { useStore } from '@nanostores/vue'
import { $signInStore } from '@clerk/astro/client'

const signIn = useStore($signInStore)
</script>

<template>
  <div v-if="signIn === undefined">
    <!-- Add logic to handle loading state -->
  </div>
  <div v-else>
    <div>The current sign in attempt status is {{ signIn.status }}.</div>
  </div>
</template>

----------------------------------------

TITLE: Handling OAuth Redirect Callback
DESCRIPTION: Completes a custom OAuth flow started by calling either SignIn.authenticateWithRedirect(params) or SignUp.authenticateWithRedirect(params).

LANGUAGE: TypeScript
CODE:
function handleRedirectCallback(
  params: HandleOAuthCallbackParams,
  customNavigate?: ((to: string) => Promise<unknown>) | undefined,
): Promise<unknown>

----------------------------------------

TITLE: Protecting Astro Endpoints with Clerk Authentication
DESCRIPTION: This snippet demonstrates how to protect an Astro endpoint using Clerk authentication. It checks for a userId in the auth() local and returns an error response if no user is signed in.

LANGUAGE: typescript
CODE:
export async function GET({ locals }) {
  const { userId } = locals.auth()

  if (!userId) {
    return new Response('Error: No signed in user', { status: 401 })
  }

  // Add your Endpoint logic here

  return new Response(JSON.stringify({ userId }))
}

----------------------------------------

TITLE: Creating a SignIn Instance in Clerk
DESCRIPTION: Example of creating a new SignIn instance using an email link strategy in Clerk.

LANGUAGE: javascript
CODE:
await clerk.signIn.create({
  strategy: 'email_link',
  identifier: 'test@example.com',
})

----------------------------------------

TITLE: Declaring getUserList Function in TypeScript
DESCRIPTION: Function signature for getUserList, which takes UserListParams and returns a Promise with PaginatedResourceResponse containing an array of User objects.

LANGUAGE: tsx
CODE:
function getUserList(): (params: UserListParams) => Promise<PaginatedResourceResponse<User[]>>

----------------------------------------

TITLE: Defining Database Schema with Drizzle ORM
DESCRIPTION: Database schema definition for user messages using Drizzle ORM with Postgres.

LANGUAGE: typescript
CODE:
import { pgTable, text, timestamp } from 'drizzle-orm/pg-core'

export const UserMessages = pgTable('user_messages', {
  user_id: text('user_id').primaryKey().notNull(),
  createTs: timestamp('create_ts').defaultNow().notNull(),
  message: text('message').notNull(),
})

----------------------------------------

TITLE: Configuring JWT Secret for Hasura Cloud
DESCRIPTION: JSON configuration for setting the HASURA_GRAPHQL_JWT_SECRET environment variable to use Clerk's JWKS endpoint

LANGUAGE: json
CODE:
{ "jwk_url": "https://{{fapi}}/.well-known/jwks.json" }

----------------------------------------

TITLE: Implementing RedirectToSignIn in Next.js Pages Router
DESCRIPTION: This snippet shows how to use the RedirectToSignIn component in a Next.js application using the Pages Router. It demonstrates the component usage within the _app.tsx file.

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, RedirectToSignIn } from '@clerk/nextjs'
import { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider>
      <SignedIn>
        <Component {...pageProps} />
      </SignedIn>
      <SignedOut>
        <RedirectToSignIn />
      </SignedOut>
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Server Actions for Role Management
DESCRIPTION: Server-side actions for managing user roles including setting and removing roles.

LANGUAGE: typescript
CODE:
'use server'

import { checkRole } from '@/utils/roles'
import { clerkClient } from '@clerk/nextjs/server'

export async function setRole(formData: FormData) {
  const client = await clerkClient()

  if (!checkRole('admin')) {
    return { message: 'Not Authorized' }
  }

  try {
    const res = await client.users.updateUserMetadata(formData.get('id') as string, {
      publicMetadata: { role: formData.get('role') },
    })
    return { message: res.publicMetadata }
  } catch (err) {
    return { message: err }
  }
}

export async function removeRole(formData: FormData) {
  const client = await clerkClient()

  try {
    const res = await client.users.updateUserMetadata(formData.get('id') as string, {
      publicMetadata: { role: null },
    })
    return { message: res.publicMetadata }
  } catch (err) {
    return { message: err }
  }
}

----------------------------------------

TITLE: Example Verified Token Response
DESCRIPTION: Sample JSON response showing the structure of a successfully verified token including claims like azp, exp, iat, iss, nbf, sid, and sub.

LANGUAGE: json
CODE:
{
  "verifiedToken": {
    "azp": "http://localhost:3000",
    "exp": 1687906422,
    "iat": 1687906362,
    "iss": "https://magical-marmoset-51.clerk.accounts.dev",
    "nbf": 1687906352,
    "sid": "sess_2Ro7e2IxrffdqBboq8KfB6eGbIy",
    "sub": "user_2RfWKJREkjKbHZy0Wqa5qrHeAnb"
  }
}

----------------------------------------

TITLE: Installing React App with Vite
DESCRIPTION: Commands to create and initialize a new React application using Vite with TypeScript template.

LANGUAGE: bash
CODE:
npm create vite@latest clerk-react -- --template react-ts
cd clerk-react
npm install
npm run dev

----------------------------------------

TITLE: Rendering Content by Role in Astro
DESCRIPTION: This example shows how to use the <Protect> component to render content only for users with the 'org:billing' role in an Astro application.

LANGUAGE: astro
CODE:
---
import { Protect } from '@clerk/astro/components'
---

<Protect role="org:billing">
  <p slot="fallback">Only a member of the Billing department can access this content.</p>
  <slot />
</Protect>

----------------------------------------

TITLE: Defining SignUpInitialValues Type in TypeScript
DESCRIPTION: This type definition specifies the structure for initial values in a sign-up form. It includes optional properties for email address, username, phone number, first name, and last name.

LANGUAGE: typescript
CODE:
type SignUpInitialValues = {
  emailAddress?: string;
  username?: string;
  phoneNumber?: string; // in E.164 format
  firstName?: string;
  lastName?: string;
}

----------------------------------------

TITLE: Basic Root Authentication Setup in Remix
DESCRIPTION: Basic implementation of rootAuthLoader as the root loader function without a callback. This setup provides authentication state to the Remix application.

LANGUAGE: tsx
CODE:
// Your other imports

// Import `rootAuthLoader`
import { rootAuthLoader } from '@clerk/remix/ssr.server'

// Export `rootAuthLoader()` as the root route `loader`
export const loader: LoaderFunction = (args) => rootAuthLoader(args)

// The rest of your code

----------------------------------------

TITLE: Limiting Results with getOrganizationList in TypeScript
DESCRIPTION: Example of using the getOrganizationList function with a limit parameter to restrict the number of results returned.

LANGUAGE: tsx
CODE:
const { data, totalCount } = await clerkClient.organizations.getOrganizationList({
  // returns the first 10 results
  limit: 10,
})

----------------------------------------

TITLE: Accessing Current User Data with Clerk in Astro
DESCRIPTION: This snippet illustrates how to use the currentUser() local to fetch and utilize the current user's data in an Astro page. It processes form data and combines it with user details.

LANGUAGE: astro
CODE:
---
if (Astro.request.method === 'POST') {
  const user = await Astro.locals.currentUser()

  if (!user) {
    throw new Error('You must be signed in to use this feature')
  }

  const data = await Astro.request.formData()
  const serverData = {
    usersHobby: data.get('hobby'),
    userId: user.id,
    profileImage: user.imageUrl,
  }

  console.log('add item action completed with user details ', serverData)
}
---

<form method="POST">
  <input value="soccer" type="text" name="hobby" />
  <button type="submit">Submit your hobby</button>
</form>

----------------------------------------

TITLE: Accessing SignIn State in Svelte
DESCRIPTION: Example of using $signInStore with Svelte to check the current sign-in state. Shows how to handle Svelte's reserved $ prefix and includes conditional rendering for undefined states.

LANGUAGE: svelte
CODE:
<script>
  // The $ prefix is reserved in Svelte for its own reactivity system.
  // Alias the imports to avoid conflicts.
  import { $signInStore as signIn } from '@clerk/astro/client'
</script>

{#if $signIn === undefined}
  <!-- Add logic to handle loading state -->
{:else}
  <div>The current sign in attempt status is {$signIn.status}.</div>
{/if}

----------------------------------------

TITLE: Implementing Clerk Authentication in Next.js API Route (TypeScript)
DESCRIPTION: This snippet shows how to create a Clerk client, authenticate a request, and handle the authentication result in a Next.js API route. It uses environment variables for Clerk credentials and includes logic for protected actions.

LANGUAGE: tsx
CODE:
import { createClerkClient } from '@clerk/backend'

export async function GET(req: Request) {
  const clerkClient = createClerkClient({
    secretKey: process.env.CLERK_SECRET_KEY,
    publishableKey: process.env.CLERK_PUBLISHABLE_KEY,
  })

  const { isSignedIn } = await clerkClient.authenticateRequest(req, {
    jwtKey: process.env.CLERK_JWT_KEY,
    authorizedParties: ['https://example.com'],
  })

  if (!isSignedIn) {
    return Response.json({ status: 401 })
  }

  // Add logic to perform protected actions

  return Response.json({ message: 'This is a reply' })
}

----------------------------------------

TITLE: Implementing Database Connection Setup
DESCRIPTION: Configuration for connecting to Neon database using Drizzle ORM and environment variables.

LANGUAGE: typescript
CODE:
import { loadEnvConfig } from '@next/env'
import { neon } from '@neondatabase/serverless'
import { drizzle } from 'drizzle-orm/neon-http'
import { UserMessages } from './schema'

loadEnvConfig(process.cwd())

if (!process.env.DATABASE_URL) {
  throw new Error('DATABASE_URL must be a Neon postgres connection string')
}

const sql = neon(process.env.DATABASE_URL)
export const db = drizzle(sql, {
  schema: { UserMessages },
})

----------------------------------------

TITLE: Custom SignUpButton Implementation - Vue
DESCRIPTION: Vue implementation of SignUpButton with custom button styling.

LANGUAGE: vue
CODE:
<script setup>
import { SignUpButton } from '@clerk/vue'
</script>

<template>
  <SignUpButton>
    <button>Custom sign up button</button>
  </SignUpButton>
</template>

----------------------------------------

TITLE: Creating an Organization with Clerk Backend SDK in TypeScript
DESCRIPTION: Example of using the createOrganization function to create a new organization. It demonstrates setting the organization name and the user ID of the creator, who will become an administrator.

LANGUAGE: tsx
CODE:
const name = 'test-org'

const createdBy = 'user_123'

const response = await clerkClient.organizations.createOrganization({ name, createdBy })

----------------------------------------

TITLE: Implementing RedirectToSignUp in Next.js App Router
DESCRIPTION: This snippet demonstrates how to use the RedirectToSignUp component in a Next.js application using the App Router. It shows the component usage within a ClerkProvider and conditional rendering based on user authentication status.

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, RedirectToSignUp } from '@clerk/nextjs'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html>
      <body>
        <ClerkProvider>
          <SignedIn>{children}</SignedIn>
          <SignedOut>
            <RedirectToSignUp />
          </SignedOut>
        </ClerkProvider>
      </body>
    </html>
  )
}

----------------------------------------

TITLE: Accessing SignIn State in React
DESCRIPTION: Example of using $signInStore with React to check the current sign-in state. Uses @nanostores/react for state management and handles undefined states during loading.

LANGUAGE: tsx
CODE:
import { useStore } from '@nanostores/react'
import { $signInStore } from '@clerk/astro/client'

export default function SignInStep() {
  const signIn = useStore($signInStore)

  if (signIn === undefined) {
    // Add logic to handle loading state
    return null
  }

  return <div>The current sign in attempt status is {signIn.status}.</div>
}

----------------------------------------

TITLE: Using clerkClient with buildClerkProps in Next.js
DESCRIPTION: This snippet shows how to use clerkClient along with buildClerkProps in a Next.js getServerSideProps function. It retrieves user data if authenticated and passes it to buildClerkProps.

LANGUAGE: tsx
CODE:
import { getAuth, buildClerkProps, clerkClient } from '@clerk/nextjs/server'
import { GetServerSideProps } from 'next'

export const getServerSideProps: GetServerSideProps = async (ctx) => {
  const { userId } = getAuth(ctx.req)

  const user = userId ? await clerkClient().users.getUser(userId) : undefined

  return { props: { ...buildClerkProps(ctx.req, { user }) } }
}

----------------------------------------

TITLE: PublicUserData Type Definition in TypeScript
DESCRIPTION: Interface defining publicly available user data properties including first/last name, profile image information, and user identifiers. Used for accessing basic user information that can be safely exposed publicly.

LANGUAGE: typescript
CODE:
interface PublicUserData {
  firstName: string | null;
  lastName: string | null;
  imageUrl: string;
  hasImage: boolean;
  identifier: string;
  userId?: string | null;
}

----------------------------------------

TITLE: TypeScript Function Definition for updateOrganizationMetadata
DESCRIPTION: Function signature for updating organization metadata, accepting an organization ID and metadata parameters, returning a Promise with the updated Organization object.

LANGUAGE: typescript
CODE:
function updateOrganizationMetadata(
  organizationId: string,
  params: UpdateOrganizationMetadataParams,
): Promise<Organization>

----------------------------------------

TITLE: Example User Update Implementation
DESCRIPTION: Practical example showing how to update a user's first and last name using the Clerk client.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const params = { firstName: 'John', lastName: 'Wick' }

const response = await clerkClient.users.updateUser(userId, params)

----------------------------------------

TITLE: Implementing RedirectToSignIn in React
DESCRIPTION: This snippet demonstrates how to use the RedirectToSignIn component in a React application. It shows the component usage within a private page component and includes initialization with a Clerk publishable key.

LANGUAGE: tsx
CODE:
import {
  ClerkProvider,
  SignedIn,
  SignedOut,
  RedirectToSignIn,
  UserButton,
} from '@clerk/clerk-react'

// Import your Publishable Key
const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Add your Clerk Publishable Key to the .env file')
}

function PrivatePage() {
  return (
    <ClerkProvider publishableKey={PUBLISHABLE_KEY}>
      <SignedIn>
        <UserButton />
      </SignedIn>
      <SignedOut>
        <RedirectToSignIn />
      </SignedOut>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Attempting Second Factor Authentication in Clerk
DESCRIPTION: Example of attempting the second factor authentication using a phone code strategy in Clerk's SignIn object.

LANGUAGE: javascript
CODE:
const signIn = await clerk.signIn.attemptSecondFactor({
  strategy: 'phone_code',
  code: '123456',
})

----------------------------------------

TITLE: Declaring Session Retrieval Function in TypeScript
DESCRIPTION: Function signature for retrieving a single session by its ID. Returns a Promise that resolves to a Session object.

LANGUAGE: typescript
CODE:
function getSession(sessionId: string): Promise<Session>

----------------------------------------

TITLE: Implementing Token Verification with Next.js
DESCRIPTION: Example showing how to verify a Clerk session token in a Next.js API route using the Backend SDK. Demonstrates token extraction from cookies or Authorization header and networkless verification.

LANGUAGE: typescript
CODE:
import { verifyToken } from '@clerk/backend'
import { cookies } from 'next/headers'

export async function GET(request: Request) {
  const cookieStore = cookies()
  const sessToken = cookieStore.get('__session')?.value
  const bearerToken = request.headers.get('Authorization')?.replace('Bearer ', '')
  const token = sessToken || bearerToken

  if (!token) {
    return Response.json({ error: 'Token not found. User must sign in.' }, { status: 401 })
  }

  try {
    const verifiedToken = await verifyToken(token, {
      jwtKey: process.env.CLERK_JWT_KEY,
      authorizedParties: ['http://localhost:3001', 'api.example.com'], // Replace with your authorized parties
    })

    return Response.json({ verifiedToken })
  } catch (error) {
    return Response.json({ error: 'Token not verified.' }, { status: 401 })
  }
}

----------------------------------------

TITLE: Rendering UserProfile Component in Next.js
DESCRIPTION: Example of how to embed the <UserProfile /> component in a Next.js application using both App Router and Pages Router.

LANGUAGE: jsx
CODE:
import { UserProfile } from '@clerk/nextjs'

const UserProfilePage = () => <UserProfile />

export default UserProfilePage

----------------------------------------

TITLE: Defining EnterpriseAccount Interface Properties in TypeScript
DESCRIPTION: Interface definition for EnterpriseAccount that includes properties for account status, user details, authentication settings, and metadata. This interface is used to represent enterprise accounts within the clerk system.

LANGUAGE: typescript
CODE:
interface EnterpriseAccount {
  active: boolean;
  emailAddress: string;
  enterpriseConnection: EnterpriseAccountConnection | null;
  firstName: string | null;
  lastName: string | null;
  protocol: 'saml' | 'oauth';
  provider: "saml_okta" | "saml_google" | "saml_microsoft" | "saml_custom" | `oauth_${OAuthProvider}`;
  providerUserId: string | null;
  publicMetadata: Record<string, unknown> | null;
  verification: Verification | null;
}

----------------------------------------

TITLE: Clerk Middleware Configuration
DESCRIPTION: Setting up Clerk middleware for route protection and authentication handling.

LANGUAGE: typescript
CODE:
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware()

export const config = {
  matcher: [
    '/((?!.*\\..*|_next).*)',
    '/',
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Defining ClerkAPIError Meta Property Structure in TypeScript
DESCRIPTION: This code snippet defines the structure of the meta property within the ClerkAPIError interface. It includes optional fields for additional error information such as paramName, sessionId, emailAddresses, identifiers, zxcvbn suggestions, and permissions.

LANGUAGE: typescript
CODE:
meta?: {
  paramName?: string
  sessionId?: string
  emailAddresses?: string[]
  identifiers?: string[]
  zxcvbn?: {
    suggestions: {
      code: string
      message: string
    }[]
  }
  permissions?: string[]
}

----------------------------------------

TITLE: Creating Organization Invitation with Redirect URL in Clerk
DESCRIPTION: This example shows how to create an organization invitation with a specified redirect URL using cURL. The redirect_url parameter is added to the request body to define where the user should be redirected after accepting the invitation.

LANGUAGE: bash
CODE:
curl 'https://api.clerk.com/v1/organizations/{org_123}/invitations' \
  -X POST \
  -H 'Authorization: Bearer {{secret}}' \
  -H 'Content-Type: application/json' \
  -d '{ "inviter_user_id": "user_123", "email_address": "email@example.com", "role": "org:member", "redirect_url": "https://www.example.com/accept-invitation" }'

----------------------------------------

TITLE: Configuring ClerkProvider with React Router
DESCRIPTION: Example of wrapping the React application with ClerkProvider and React Router components in the main entry point.

LANGUAGE: tsx
CODE:
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import { BrowserRouter, Routes, Route } from 'react-router'
import { ClerkProvider } from '@clerk/react-router'
import './index.css'
import App from './App.tsx'

const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <BrowserRouter>
      <ClerkProvider publishableKey={PUBLISHABLE_KEY}>
        <Routes>
          <Route path="/" element={<App />} />
        </Routes>
      </ClerkProvider>
    </BrowserRouter>
  </StrictMode>,
)

----------------------------------------

TITLE: Importing Clerk Publishable Key in Vue Main File
DESCRIPTION: Code snippet showing how to import and validate the Clerk Publishable Key in the main.ts file of a Vue application.

LANGUAGE: typescript
CODE:
import { createApp } from 'vue'
import './style.css'
import App from './App.vue'

const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Add your Clerk Publishable Key to the .env file')
}

createApp(App).mount('#app')

----------------------------------------

TITLE: Interacting with Clerk's Backend API in Next.js Route Handler
DESCRIPTION: Illustrates how to use clerkClient to interact with Clerk's Backend API, specifically updating a user's information.

LANGUAGE: typescript
CODE:
import { NextResponse, NextRequest } from 'next/server'
import { auth, clerkClient } from '@clerk/nextjs/server'

export async function POST(req: NextRequest) {
  const { userId } = await auth()

  if (!userId) return NextResponse.redirect(new URL('/sign-in', req.url))

  const params = { firstName: 'John', lastName: 'Wick' }

  const client = await clerkClient()

  const user = await client.users.updateUser(userId, params)

  return NextResponse.json({ user })
}

----------------------------------------

TITLE: Usage Example - Locking a User with Clerk Backend SDK
DESCRIPTION: Example showing how to use the lockUser function with the Clerk Backend SDK to lock a specific user by their ID.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const response = await clerkClient.users.lockUser(userId)

----------------------------------------

TITLE: Defining SetActiveParams Interface in TypeScript
DESCRIPTION: Type definition for setActive() method parameters including session and organization management, with support for redirection and deprecation notice for beforeEmit callback.

LANGUAGE: typescript
CODE:
interface SetActiveParams {
  session: Session | string | null;
  organization: Organization | string | null;
  beforeEmit?: (session?: Session | null) => void | Promise<any>; // deprecated
  redirectUrl?: string;
}

----------------------------------------

TITLE: Accessing Account Portal URLs in Production
DESCRIPTION: Standard URL patterns for accessing different pages of the Clerk Account Portal in a production environment. These URLs include sign-in, sign-up, user profile, unauthorized access, and organization management pages.

LANGUAGE: sh
CODE:
https://accounts.<your-domain>.com/sign-in
https://accounts.<your-domain>.com/sign-up
https://accounts.<your-domain>.com/user
https://accounts.<your-domain>.com/unauthorized-sign-in
https://accounts.<your-domain>.com/organization
https://accounts.<your-domain>.com/create-organization

----------------------------------------

TITLE: Defining PhoneCodeFactor Type in TypeScript
DESCRIPTION: This snippet defines the PhoneCodeFactor type, which represents the phone code strategy for first factor verification. It includes properties for strategy, phoneNumberId, safeIdentifier, primary status, and default status.

LANGUAGE: typescript
CODE:
type PhoneCodeFactor = {
  strategy: PhoneCodeStrategy
  phoneNumberId: string
  safeIdentifier: string
  primary?: boolean
  default?: boolean
}

----------------------------------------

TITLE: TypeScript Global Definitions for RBAC
DESCRIPTION: Global TypeScript definitions for role types and custom JWT session claims.

LANGUAGE: typescript
CODE:
export {}

// Create a type for the roles
export type Roles = 'admin' | 'moderator'

declare global {
  interface CustomJwtSessionClaims {
    metadata: {
      role?: Roles
    }
  }
}

----------------------------------------

TITLE: Defining Web3SignatureFactor Type in TypeScript
DESCRIPTION: This snippet defines the Web3SignatureFactor type, which represents the Web3 signature strategy for first factor verification. It includes properties for strategy, web3WalletId, and primary status.

LANGUAGE: typescript
CODE:
type Web3SignatureFactor = {
  strategy: Web3Strategy
  web3WalletId: string
  primary?: boolean
}

----------------------------------------

TITLE: Implementing OTP Input with Clerk Elements
DESCRIPTION: React component for a one-time password (OTP) input using Clerk Elements. This component is designed to be used within a sign-up or sign-in authentication flow.

LANGUAGE: tsx
CODE:
<Clerk.Input
  type="otp"
  className="flex justify-center has-[:disabled]:opacity-50"
  autoSubmit
  render={({ value, status }) => {
    return (
      <div
        data-status={status}
        className={cn(
          'relative flex size-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md',
          {
            'z-10 ring-2 ring-ring ring-offset-background':
              status === 'cursor' || status === 'selected',
          },
        )}
      >
        {value}
        {status === 'cursor' && (
          <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
            <div className="animate-caret-blink h-4 w-px bg-foreground duration-1000" />
          </div>
        )}
      </div>
    )
  }}
/>

----------------------------------------

TITLE: Handling Email Link Verification in TypeScript
DESCRIPTION: Method to handle completion of email link verification flow by processing verification status and session information from URL parameters. Accepts parameters for redirect URLs and custom navigation handling.

LANGUAGE: typescript
CODE:
function handleEmailLinkVerification(
  params: handleEmailLinkVerificationParams,
  customNavigate?: ((to: string) => Promise<unknown>) | undefined,
): Promise<unknown>

----------------------------------------

TITLE: Creating Sign-In Token Usage Example - TSX
DESCRIPTION: Example showing how to create a sign-in token with a custom expiration time of one week. Demonstrates using the clerkClient.signInTokens.createSignInToken method with userId and expiresInSeconds parameters.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const expiresInSeconds = 60 * 60 * 24 * 7 // 1 week

const response = await clerkClient.signInTokens.createSignInToken({
  userId,
  expiresInSeconds,
})

----------------------------------------

TITLE: Implementing UserButton in Vue
DESCRIPTION: Example showing how to implement the UserButton component in a Vue application with SignedIn/SignedOut states

LANGUAGE: vue
CODE:
<script setup>
import { SignedIn, UserButton, SignInButton, SignedOut } from '@clerk/vue'
</script>

<template>
  <header>
    <SignedIn>
      <UserButton />
    </SignedIn>
    <SignedOut>
      <SignInButton />
    </SignedOut>
  </header>
</template>

----------------------------------------

TITLE: Using Clerk SDK With Client
DESCRIPTION: Shows how to use the Clerk SDK by instantiating a client, which is recommended when working with multiple API keys. Includes examples of basic CRUD operations.

LANGUAGE: go
CODE:
import (
  "github.com/clerk/clerk-sdk-go/v2"
  "github.com/clerk/clerk-sdk-go/v2/$resource$"
)

// Each operation requires a context.Context as the first argument.
ctx := context.Background()

// Initialize a client with an API key
config := &clerk.ClientConfig{}
config.Key = "sk_live_xxx"
client := $resource$.NewClient(config)

// Create
resource, err := client.Create(ctx, &$resource$.CreateParams{})

// Get
resource, err := client.Get(ctx, id)

// Update
resource, err := client.Update(ctx, id, &$resource$.UpdateParams{})

// Delete
resource, err := client.Delete(ctx, id)

// List
list, err := client.List(ctx, &$resource$.ListParams{})
for _, resource := range list.$Resource$s {
    // do something with the resource
}

----------------------------------------

TITLE: Conditional Rendering in Vue
DESCRIPTION: This snippet illustrates how to use the <Protect> component with conditional logic to render content for users with either 'org:admin' or 'org:billing_manager' roles in a Vue application.

LANGUAGE: vue
CODE:
<script setup>
import { Protect } from '@clerk/vue'
</script>

<template>
  <Protect :condition="(has) => has({ role: 'org:admin' }) || has({ role: 'org:billing_manager' })">
    <template #fallback>
      <p>Only an Admin or Billing Manager can access this content.</p>
    </template>
    <p>Visible content.</p>
  </Protect>
</template>

----------------------------------------

TITLE: Implementing Custom Sign-In Flow
DESCRIPTION: Creating a custom sign-in page using Clerk's useSignIn hook for email and password authentication.

LANGUAGE: tsx
CODE:
import { useSignIn } from '@clerk/clerk-expo'
import { Link, useRouter } from 'expo-router'
import { Text, TextInput, TouchableOpacity, View } from 'react-native'
import React from 'react'

export default function Page() {
  const { signIn, setActive, isLoaded } = useSignIn()
  const router = useRouter()

  const [emailAddress, setEmailAddress] = React.useState('')
  const [password, setPassword] = React.useState('')

  // Handle the submission of the sign-in form
  const onSignInPress = async () => {
    if (!isLoaded) return

    // Start the sign-in process using the email and password provided
    try {
      const signInAttempt = await signIn.create({
        identifier: emailAddress,
        password,
      })

      // If sign-in process is complete, set the created session as active
      // and redirect the user
      if (signInAttempt.status === 'complete') {
        await setActive({ session: signInAttempt.createdSessionId })
        router.replace('/')
      } else {
        // If the status isn't complete, check why. User might need to
        // complete further steps.
        console.error(JSON.stringify(signInAttempt, null, 2))
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }

  return (
    <View>
      <Text>Sign in</Text>
      <TextInput
        autoCapitalize="none"
        value={emailAddress}
        placeholder="Enter email"
        onChangeText={(emailAddress) => setEmailAddress(emailAddress)}
      />
      <TextInput
        value={password}
        placeholder="Enter password"
        secureTextEntry={true}
        onChangeText={(password) => setPassword(password)}
      />
      <TouchableOpacity onPress={onSignInPress}>
        <Text>Continue</Text>
      </TouchableOpacity>
      <View style={{ display: 'flex', flexDirection: 'row', gap: 3 }}>
        <Text>Don't have an account?</Text>
        <Link href="/sign-up">
          <Text>Sign up</Text>
        </Link>
      </View>
    </View>
  )
}

----------------------------------------

TITLE: Implementing CreateOrganization in React
DESCRIPTION: Example of using the CreateOrganization component in a React application. The component is imported from '@clerk/clerk-react' and rendered in a functional component.

LANGUAGE: jsx
CODE:
import { CreateOrganization } from '@clerk/clerk-react'

export default function CreateOrganizationPage() {
  return <CreateOrganization />
}

----------------------------------------

TITLE: Detecting Impersonated Sessions in Express
DESCRIPTION: This Express.js example uses Clerk's middleware to attach the Auth object to the request, allowing detection of impersonated sessions.

LANGUAGE: js
CODE:
import express from 'express'
import { clerkMiddleware } from '@clerk/express'

const app = express()
// Apply the Express SDK middleware
app.use(clerkMiddleware())

app.get('/protected-endpoint', (req, res) => {
  // Clerk's authentication context can be accessed from the request object
  const { userId, actor } = req.auth

  res.json({ userId, actor })
})

app.listen(3000, () => {
  console.log('Booted.')
})

----------------------------------------

TITLE: Inline Styling of Clerk Elements in React
DESCRIPTION: Shows how to apply inline styles to Clerk Elements components. This approach is useful for applying dynamic styles or when avoiding external CSS files is preferred.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'

export default function SignInPage() {
  return (
    <SignIn.Root>
      <SignIn.Step
        name="start"
        style={{
          backgroundColor: 'white',
          padding: '1rem',
          border: '1px solid #dddddd',
          borderRadius: '4px',
        }}
      >
        <Clerk.Field name="identifier">
          <Clerk.Label
            style={{
              color: '#dddddd',
              fontSize: '0.875rem',
            }}
          >
            Email
          </Clerk.Label>
          <Clerk.Input
            style={{
              border: '1px solid #dddddd',
              borderRadius: '4px',
              padding: '1rem',
            }}
          />
        </Clerk.Field>
        <SignIn.Action
          submit
          style={{
            backgroundColor: '#111111',
            color: 'white',
            padding: '1rem',
            borderRadius: '4px',
          }}
        >
          Continue
        </SignIn.Action>
      </SignIn.Step>
    </SignIn.Root>
  )
}

----------------------------------------

TITLE: Destroying Organization - TypeScript and JavaScript
DESCRIPTION: Function definition and example for deleting an organization.

LANGUAGE: typescript
CODE:
function destroy(): Promise<void>

LANGUAGE: javascript
CODE:
await clerk.organization.destroy()

----------------------------------------

TITLE: Retrieving SAML Connection Example
DESCRIPTION: Example demonstrating how to use the clerkClient to retrieve a SAML connection using its ID. The response contains the SAML connection details.

LANGUAGE: tsx
CODE:
const samlConnectionId = 'samlc_123'

const response = await clerkClient.samlConnections.getSamlConnection(samlConnectionId)

----------------------------------------

TITLE: Importing Clerk Hooks in Expo
DESCRIPTION: Example of importing and using Clerk hooks in an Expo application. The useSSO() and useLocalCredentials() hooks are specific to the Expo SDK.

LANGUAGE: javascript
CODE:
import { useSSO, useLocalCredentials } from '@clerk/clerk-expo';

----------------------------------------

TITLE: Rendering SignIn Component in Expo Web App
DESCRIPTION: This snippet shows how to create a sign-in-or-up page using Clerk's SignIn component in an Expo web app. It imports the SignIn component from @clerk/clerk-expo/web and renders it in a functional component.

LANGUAGE: TypeScript
CODE:
import { SignIn } from '@clerk/clerk-expo/web'

export default function Page() {
  return <SignIn />
}

----------------------------------------

TITLE: Firebase to Clerk Migration Script
DESCRIPTION: Node.js script that migrates users from Firebase to Clerk, handling both password-based and OAuth users while preserving user IDs and passwords.

LANGUAGE: javascript
CODE:
const fetch = require('node-fetch')
const firebaseUsers = require('./firebase-users.json')

async function migrateToClerk() {
  // You can find these values on your Firebase project's authentication settings
  const signerKey = ''
  const saltSeparator = ''
  const rounds = ''
  const memoryCost = ''

  // You can find this value on your Clerk application's dashboard
  const clerkBackendApiKey = ''

  for (let user of firebaseUsers.users) {
    const { email, localId, passwordHash, salt } = user

    const body = passwordHash
      ? {
          email_address: [email],
          external_id: localId,
          password_hasher: 'scrypt_firebase',
          password_digest: `${passwordHash}$${salt}$${signerKey}$${saltSeparator}$${rounds}$${memoryCost}`,
        }
      : {
          email_address: [email],
          external_id: localId,
          skip_password_requirement: true,
        }

    try {
      const result = await fetch('https://api.clerk.com/v1/users', {
        method: 'POST',
        headers: {
          Authorization: `Bearer ${clerkBackendApiKey}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(body),
      })

      if (!result.ok) {
        throw Error(result.statusText)
      } else {
        console.log(`${email} added successfully`)
      }
    } catch (error) {
      console.error(`Error migrating ${email}: ${error}`)
    }
  }
}

migrateToClerk()

----------------------------------------

TITLE: Retrieving Private Metadata with Clerk
DESCRIPTION: Examples showing how to retrieve private metadata from a user object using various Clerk SDKs and APIs.

LANGUAGE: typescript
CODE:
export async function GET(req) {
  const { userId } = await req.json()

  const user = await clerkClient.users.getUser(userId)

  return Response.json(user.privateMetadata)
}

----------------------------------------

TITLE: Defining SignInInitialValues Type Interface in TypeScript
DESCRIPTION: TypeScript interface definition for sign-in form initial values. Includes optional properties for email address, username, and phone number in E.164 format.

LANGUAGE: typescript
CODE:
interface SignInInitialValues {
  emailAddress?: string;
  username?: string;
  phoneNumber?: string; // E.164 format
}

----------------------------------------

TITLE: Defining updateOrganizationLogo Function Signature in TypeScript
DESCRIPTION: Function signature for updating an organization's logo using Clerk's Backend SDK. It takes an organization ID and update parameters, returning a Promise that resolves to an Organization object.

LANGUAGE: typescript
CODE:
function updateOrganizationLogo(
  organizationId: string,
  params: UpdateLogoParams,
): Promise<Organization>

----------------------------------------

TITLE: Prefill Field Example URL
DESCRIPTION: Example URL showing how to prefill a username field in the sign-in form using query parameters.

LANGUAGE: url
CODE:
https://accounts.example.com/sign-in?username=nick

----------------------------------------

TITLE: Defining EmailLinkError Class in TypeScript
DESCRIPTION: This code snippet defines the EmailLinkError class, which extends the base Error class. It includes a code property that can be either 'Expired' or 'Failed' to indicate the specific type of email link error.

LANGUAGE: TypeScript
CODE:
class EmailLinkError extends Error {
  code: EmailLinkErrorCode;

  constructor(code: EmailLinkErrorCode) {
    super();
    this.code = code;
  }
}

enum EmailLinkErrorCode {
  Expired = 'Expired',
  Failed = 'Failed'
}

----------------------------------------

TITLE: Installing Backend SDK via Package Managers
DESCRIPTION: Commands to install the @clerk/backend package using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/backend

yarn add @clerk/backend

pnpm add @clerk/backend

bun add @clerk/backend

----------------------------------------

TITLE: Deleting an Organization using Clerk Backend SDK in TypeScript
DESCRIPTION: Function signature for deleting an organization. It takes an organization ID as a string parameter and returns a Promise that resolves to a DeletedObject.

LANGUAGE: typescript
CODE:
function deleteOrganization(organizationId: string): Promise<DeletedObject>

----------------------------------------

TITLE: Defining TOTP Verification Function in TypeScript
DESCRIPTION: Function signature for verifying TOTP or backup codes. Returns a promise with verification status and code type.

LANGUAGE: typescript
CODE:
function verifyTOTP(params: VerifyTOTPParams): Promise<{ verified: true; code_type: 'totp' }>

----------------------------------------

TITLE: Implementing GoogleOneTap in React
DESCRIPTION: Example of using the GoogleOneTap component in a React application. The component is rendered on a sign-in page as a functional component.

LANGUAGE: jsx
CODE:
import { GoogleOneTap } from '@clerk/clerk-react'

const SignInPage = () => <GoogleOneTap />

export default SignInPage

----------------------------------------

TITLE: Protecting Routes in Ruby on Rails Controller
DESCRIPTION: This example shows how to protect specific controllers or actions in a Rails application using a before_action callback with the require_clerk_session! method to check for an authenticated Clerk session.

LANGUAGE: ruby
CODE:
class AdminController < ApplicationController
  # Protect routes with the `require_clerk_session!` method
  before_action :require_clerk_session!

  def index
    # ...
  end
end

----------------------------------------

TITLE: Organization Update JavaScript Implementation
DESCRIPTION: Vanilla JavaScript implementation for organization updates using Clerk's JavaScript SDK. Handles organization updates, user authentication state, and organization switching functionality.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!pubKey) {
  throw new Error('Add your VITE_CLERK_PUBLISHABLE_KEY to .env file')
}

const clerk = new Clerk('{{pub_key}}')
await clerk.load()

if (clerk.user) {
  // Check for an active organization
  if (clerk.organization) {
    const form = document.getElementById('update-organization')

    form.addEventListener('submit', function (e) {
      e.preventDefault()

      const inputEl = document.getElementById('name')

      if (!inputEl) {
        // ... handle empty input
        return
      }

      clerk.organization
        .update({ name: inputEl.value })
        .then((res) => console.log(`Updated org:`, res))
        .catch((error) => console.log('An error occurred:', error))
    })
  } else {
    // If there is no active organization,
    // mount Clerk's <OrganizationSwitcher />
    // to allow the user to set an organization as active
    document.getElementById('app').innerHTML = `
      <h2>Select an organization to set it as active</h2>
      <div id="org-switcher"></div>
    `

    const orgSwitcherDiv = document.getElementById('org-switcher')

    clerk.mountOrganizationSwitcher(orgSwitcherDiv)
  }
} else {
  // If there is no active user, mount Clerk's <SignIn />
  document.getElementById('app').innerHTML = `
    <div id="sign-in"></div>
  `

  const signInDiv = document.getElementById('sign-in')

  clerk.mountSignIn(signInDiv)
}

----------------------------------------

TITLE: Creating an Email Link Flow in Clerk
DESCRIPTION: This method sets up a sign-up with email link flow. It returns two functions: one to start the email link flow and another to cancel it.

LANGUAGE: typescript
CODE:
function createEmailLinkFlow(): {
  startEmailLinkFlow: (params: StartEmailLinkFlowParams) => Promise<SignUp>
  cancelEmailLinkFlow: () => void
}

----------------------------------------

TITLE: Installing @clerk/expo-passkeys Package
DESCRIPTION: This snippet shows the command to install the @clerk/expo-passkeys package using various package managers.

LANGUAGE: bash
CODE:
npm install @clerk/expo-passkeys

LANGUAGE: bash
CODE:
yarn add @clerk/expo-passkeys

LANGUAGE: bash
CODE:
pnpm add @clerk/expo-passkeys

LANGUAGE: bash
CODE:
bun add @clerk/expo-passkeys

----------------------------------------

TITLE: Configuring Next.js App Router with Clerk MultisessionAppSupport
DESCRIPTION: This example demonstrates how to add multi-session support to a Next.js App Router application. It shows the configuration of the root layout component, wrapping the entire application with ClerkProvider and MultisessionAppSupport.

LANGUAGE: tsx
CODE:
import React from 'react'
import { ClerkProvider } from '@clerk/nextjs'
import { MultisessionAppSupport } from './components/MultisessionAppSupport'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <ClerkProvider afterMultiSessionSingleSignOutUrl="/">
        <MultisessionAppSupport>
          <body>{children}</body>
        </MultisessionAppSupport>
      </ClerkProvider>
    </html>
  )
}

----------------------------------------

TITLE: Installing Dependencies
DESCRIPTION: Command to install required node-fetch package version 2.

LANGUAGE: bash
CODE:
npm i node-fetch@2

----------------------------------------

TITLE: Styling Clerk Elements with CSS Modules in React
DESCRIPTION: Demonstrates how to use CSS Modules to style Clerk Elements components. This approach allows for scoped styling and helps prevent class name conflicts.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'
import styles from './sign-in.module.css'

export default function SignInPage() {
  return (
    <SignIn.Root>
      <SignIn.Step name="start" className={styles.startStep}>
        <Clerk.Connection name="google" className={styles.provider}>
          Sign in with Google
        </Clerk.Connection>
        <Clerk.Field name="identifier">
          <Clerk.Label className={styles.label}>Email</Clerk.Label>
          <Clerk.Input className={styles.input} />
          <Clerk.FieldError className={styles.error} />
        </Clerk.Field>
        <SignIn.Action submit className={styles.submit}>
          Continue
        </SignIn.Action>
      </SignIn.Step>
      <SignIn.Step name="verifications" className={styles.verificationsStep}>
        <SignIn.Strategy name="email_code">
          <Clerk.Field name="code">
            <Clerk.Label className={styles.label}>Code</Clerk.Label>
            <Clerk.Input className={styles.input} />
            <Clerk.FieldError className={styles.error} />
          </Clerk.Field>
          <SignIn.Action submit className={styles.submit}>
            Verify
          </SignIn.Action>
        </SignIn.Strategy>
      </SignIn.Step>
    </SignIn.Root>
  )
}

----------------------------------------

TITLE: JSON Error Structure for Missing Claims in Clerk
DESCRIPTION: Defines the JSON structure for a 'MissingClaims' error, which occurs when a token is missing required claims. It includes a short message, a long message detailing the missing claims, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "<invalidCookieMessage>",
  "longMessage": "The token is missing the following claims: <claims>",
  "code": "cookie_invalid_code"
}

----------------------------------------

TITLE: SignUpRedirectOptions Interface Definition in TypeScript
DESCRIPTION: Interface defining optional string properties for controlling redirect behavior after sign-up and sign-in events. Includes force redirect URLs and fallback redirect URLs for both sign-up and sign-in flows.

LANGUAGE: typescript
CODE:
interface SignUpRedirectOptions {
  signInForceRedirectUrl?: string;
  signUpForceRedirectUrl?: string;
  signInFallbackRedirectUrl?: string;
  signUpFallbackRedirectUrl?: string;
}

----------------------------------------

TITLE: Defining updateUserProfileImage Function in TypeScript
DESCRIPTION: Function signature for updating a user's profile image using Clerk's Backend SDK. It takes a user ID and a file parameter, and returns a Promise resolving to a User object.

LANGUAGE: typescript
CODE:
function updateUserProfileImage(userId: string, params: { file: Blob | File }): Promise<User>

----------------------------------------

TITLE: Setting Active Session and Organization
DESCRIPTION: A method used to set the active session and/or organization. Accepts a SetActiveParams object.

LANGUAGE: TypeScript
CODE:
function setActive(params: SetActiveParams): Promise<void>

----------------------------------------

TITLE: Creating EmailAddress in TypeScript
DESCRIPTION: Creates a new email address for the current user.

LANGUAGE: typescript
CODE:
function create(): Promise<EmailAddress>

----------------------------------------

TITLE: Defining SignInRedirectOptions Interface in TypeScript
DESCRIPTION: This code snippet defines the SignInRedirectOptions interface with four optional string properties: signInForceRedirectUrl, signUpForceRedirectUrl, signInFallbackRedirectUrl, and signUpFallbackRedirectUrl. These properties control the redirect behavior after sign-in and sign-up actions.

LANGUAGE: typescript
CODE:
interface SignInRedirectOptions {
  signInForceRedirectUrl?: string;
  signUpForceRedirectUrl?: string;
  signInFallbackRedirectUrl?: string;
  signUpFallbackRedirectUrl?: string;
}

----------------------------------------

TITLE: Configuring Environment Variables for Clerk Ruby SDK
DESCRIPTION: This snippet shows the available environment variables for configuring the Clerk Ruby SDK. It includes the required secret key and optional overrides for API base URL and various sign-in related URLs.

LANGUAGE: markdown
CODE:
| Variable name | Usage |
| - | - |
| `CLERK_SECRET_KEY` | The Secret Key of your instance **(required)** |
| `CLERK_API_BASE` | Overrides the default API base URL: `https://api.clerk.com/v1/` |
| `CLERK_SIGN_IN_URL` | Rails view helper: `clerk_sign_in_url` |
| `CLERK_SIGN_IN_UP` | Rails view helper: `clerk_sign_up_url` |
| `CLERK_USER_PROFILE_URL` | Rails view helper: `clerk_user_profile_url` |

----------------------------------------

TITLE: Defining Organization Metadata Interfaces in TypeScript
DESCRIPTION: Defines TypeScript interfaces for organization-related metadata, including public and private metadata for organizations, invitations, and memberships.

LANGUAGE: typescript
CODE:
interface OrganizationPublicMetadata {
  [k: string]: unknown
}

LANGUAGE: typescript
CODE:
interface OrganizationPrivateMetadata {
  [k: string]: unknown
}

LANGUAGE: typescript
CODE:
interface OrganizationInvitationPublicMetadata {
  [k: string]: unknown
}

LANGUAGE: typescript
CODE:
interface OrganizationInvitationPrivateMetadata {
  [k: string]: unknown
}

LANGUAGE: typescript
CODE:
interface OrganizationMembershipPublicMetadata {
  [k: string]: unknown
}

LANGUAGE: typescript
CODE:
interface OrganizationMembershipPrivateMetadata {
  [k: string]: unknown
}

----------------------------------------

TITLE: Creating Sign-In Token Function Definition - TypeScript
DESCRIPTION: TypeScript function signature for creating a sign-in token. The function accepts CreateSignInTokensParams and returns a Promise containing the SignInToken.

LANGUAGE: typescript
CODE:
function createSignInToken(params: CreateSignInTokensParams): Promise<SignInToken>

----------------------------------------

TITLE: Implementing GoogleOneTap in Vue
DESCRIPTION: Example of using the GoogleOneTap component in a Vue application. The component is imported from @clerk/vue and rendered in the template section.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { GoogleOneTap } from '@clerk/vue'
</script>

<template>
  <GoogleOneTap />
</template>

----------------------------------------

TITLE: Configuring ClerkProvider with Offline Support in Expo
DESCRIPTION: Set up the ClerkProvider component with tokenCache and __experimental_resourceCache properties to enable offline support in an Expo app.

LANGUAGE: typescript
CODE:
import { ClerkProvider } from '@clerk/clerk-expo'
import { Slot } from 'expo-router'
import { tokenCache } from '@clerk/clerk-expo/token-cache'
import { resourceCache } from '@clerk/clerk-expo/resource-cache'

export default function RootLayout() {
  return (
    <ClerkProvider tokenCache={tokenCache} __experimental_resourceCache={resourceCache}>
      <Slot />
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Adding Clerk Plugin to Vue App
DESCRIPTION: Demonstration of how to add the Clerk plugin to a Vue application, providing session and user context for Clerk components.

LANGUAGE: typescript
CODE:
import { createApp } from 'vue'
import './style.css'
import App from './App.vue'
import { clerkPlugin } from '@clerk/vue'

const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Add your Clerk Publishable Key to the .env file')
}

const app = createApp(App)
app.use(clerkPlugin, { publishableKey: PUBLISHABLE_KEY })
app.mount('#app')

----------------------------------------

TITLE: Using Clerk Components in Astro Pages
DESCRIPTION: Example of using Clerk components like SignedIn, SignedOut, UserButton, and SignInButton in an Astro layout file.

LANGUAGE: astro
CODE:
---
import { SignedIn, SignedOut, UserButton, SignInButton } from '@clerk/astro/react'
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
  </head>
  <body>
    <header>
      <nav>
        <SignedOut client:load>
          <SignInButton client:load mode="modal" />
        </SignedOut>
        <SignedIn client:load>
          <UserButton client:load />
        </SignedIn>
      </nav>
    </header>
    <article>
      <slot />
    </article>
  </body>
</html>

----------------------------------------

TITLE: Updating app.json for Android Passkey Configuration in Expo
DESCRIPTION: This snippet demonstrates how to update the app.json file in an Expo application to configure passkeys for Android. It includes adding the intentFilters property for app links.

LANGUAGE: json
CODE:
{
  "expo": {
    "plugins": [["expo-build-properties"]],
    "android": {
      //...existing properties
      "intentFilters": [
        {
          "action": "VIEW",
          "autoVerify": true,
          "data": [
            {
              "scheme": "https",
              "host": "<YOUR_FRONTEND_API_URL>"
            }
          ],
          "category": ["BROWSABLE", "DEFAULT"]
        }
      ]
    }
  }
}

----------------------------------------

TITLE: Configuring Global Clerk Variables in Next.js
DESCRIPTION: Example showing how to apply global variable customizations to all Clerk components using ClerkProvider in Next.js App Router.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/nextjs'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider
      appearance={{
        variables: {
          colorPrimary: 'blue',
          colorText: 'black',
        },
      }}
    >
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Implementing OrganizationSwitcher in Remix
DESCRIPTION: Demonstration of how to use the OrganizationSwitcher component in a Remix application. This snippet shows the basic implementation within a route component.

LANGUAGE: jsx
CODE:
import { OrganizationSwitcher } from '@clerk/remix'

export default function OrganizationSwitcherPage() {
  return <OrganizationSwitcher />
}

----------------------------------------

TITLE: Limited Organization Membership List Retrieval
DESCRIPTION: Example showing how to limit the number of organization memberships returned in the response.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const { data, totalCount } = await clerkClient.users.getOrganizationMembershipList({
  userId,
  // returns the first 10 memberships
  limit: 10,
})

----------------------------------------

TITLE: Authorization-based Route Protection
DESCRIPTION: Implementation of route protection based on user roles and permissions, checking specific admin privileges.

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/astro/server'

const isProtectedRoute = createRouteMatcher(['/admin(.*)'])

export const onRequest = clerkMiddleware((auth, context) => {
  const { has, redirectToSignIn } = auth()

  // Restrict admin routes to users with specific permissions
  if (
    (isProtectedRoute(context.request) && !has({ permission: 'org:admin:example1' })) ||
    !has({ permission: 'org:admin:example2' })
  ) {
    // Add logic to run if the user does not have the required permissions; for example, redirecting to the sign-in page
    return redirectToSignIn()
  }
})

----------------------------------------

TITLE: Setting Public Metadata with Clerk
DESCRIPTION: Examples demonstrating how to set public metadata (like user roles) that can be accessed from both frontend and backend.

LANGUAGE: typescript
CODE:
export async function POST(req) {
  const { role, userId } = await req.json()

  await clerkClient.users.updateUserMetadata(userId, {
    publicMetadata: {
      role,
    },
  })

  return Response.json({ success: true })
}

----------------------------------------

TITLE: Defining ActorTokenSubjectNotFound Error in JSON
DESCRIPTION: This snippet defines the error response for an actor token associated with a non-existent user. It includes a short message, long message, and error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "user not found",
  "longMessage": "The user of the actor token no longer exists. Please request a new one.",
  "code": "actor_token_subject_not_found_code"
}

----------------------------------------

TITLE: Implementing Waitlist Component in Next.js
DESCRIPTION: Basic implementation of the Waitlist component in a Next.js application using the @clerk/nextjs package.

LANGUAGE: tsx
CODE:
import { Waitlist } from '@clerk/nextjs'

export default function WaitlistPage() {
  return <Waitlist />
}

----------------------------------------

TITLE: Implementing Geo Blocking with Vercel Geolocation
DESCRIPTION: Implementation of geo blocking middleware using Vercel's geolocation function. Checks client's country and redirects to a block route if the country is not in the allowed list. Also handles protected route authentication.

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'
import { geolocation } from '@vercel/functions'
import { NextResponse } from 'next/server'

// Define your protected and blocked routes
const isProtectedRoute = createRouteMatcher(['/dashboard(.*)'])
const isBlockRoute = createRouteMatcher(['/block(.*)'])

// Define the countries you want to allow
const allowedCountries = ['US']

export default clerkMiddleware(async (auth, req) => {
  if (isBlockRoute(req)) {
    return
  }

  // Use Vercel's `geolocation()` function to get the client's country
  const { country } = geolocation(req)

  // Redirect if the client's country is not allowed
  if (country && !allowedCountries.includes(country)) {
    return NextResponse.redirect(new URL('/block', req.url))
  }

  // Protect routes based on authentication status
  if (isProtectedRoute(req)) await auth.protect()
})

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Defining TOTPResource Interface in TypeScript
DESCRIPTION: This code snippet defines the TOTPResource interface, which represents a TOTP secret. It includes properties for the secret's ID, the secret itself, a URI for configuration, verification status, backup codes, and creation/update timestamps.

LANGUAGE: typescript
CODE:
interface TOTPResource {
  id: string;
  secret?: string;
  uri?: string;
  verified: boolean;
  backupCodes?: string[];
  createdAt: Date;
  updatedAt: Date;
}

----------------------------------------

TITLE: Updating OrganizationMembership in TypeScript
DESCRIPTION: This method updates the member's role in the organization. It takes an UpdateOrganizationMembershipParams object as an argument and returns a Promise that resolves to an OrganizationMembership object.

LANGUAGE: typescript
CODE:
function update(updateParams: UpdateOrganizationMembershipParams): Promise<OrganizationMembership>

----------------------------------------

TITLE: Component-Specific Variables in Next.js SignIn
DESCRIPTION: Demonstrates how to apply custom variables to a specific SignIn component instance in Next.js.

LANGUAGE: tsx
CODE:
import { SignIn } from '@clerk/nextjs'

export default function Page() {
  return (
    <SignIn
      appearance={{
        variables: {
          colorPrimary: 'blue',
          colorText: 'black',
        },
      }}
    />
  )
}

----------------------------------------

TITLE: Revoking OrganizationInvitation in TypeScript
DESCRIPTION: This snippet defines the revoke() method for the OrganizationInvitation object. It returns a Promise that resolves to an OrganizationInvitation object.

LANGUAGE: typescript
CODE:
function revoke(): Promise<OrganizationInvitation>

----------------------------------------

TITLE: Defining RoleResource Interface in TypeScript
DESCRIPTION: This snippet defines the RoleResource interface, which represents a role in an organization. It includes properties for id, key, name, description, permissions, and timestamps for creation and updates.

LANGUAGE: typescript
CODE:
interface RoleResource {
  id: string;
  key: string;
  name: string;
  description: string;
  permissions: PermissionResource[];
  createdAt: Date;
  updatedAt: Date;
}

----------------------------------------

TITLE: Revoking a Session with TypeScript
DESCRIPTION: Method signature for revoking a session. This method marks the session as revoked, but will fail if attempted on the currently active session. Can only be used by users on their own sessions.

LANGUAGE: typescript
CODE:
function revoke(): Promise<SessionWithActivities>

----------------------------------------

TITLE: Tutorial Hero Component in React/JSX
DESCRIPTION: A component that displays prerequisites and tutorial overview for the Clerk-Loops integration guide.

LANGUAGE: jsx
CODE:
<TutorialHero
  beforeYouStart={[
    {
      title: "Set up a Clerk application",
      link: "/docs/quickstarts/setup-clerk",
      icon: "clerk",
    },
    {
      title: "Set up a Loops account",
      link: "https://app.loops.so",
      icon: "cog-6-teeth",
    }
  ]}
>
  - Sync Clerk users to your Loops audience and send automated emails.
</TutorialHero>

----------------------------------------

TITLE: Implementing SignedOut Component in Next.js
DESCRIPTION: This snippet demonstrates how to use the SignedOut component in a Next.js application. It wraps the component around content that should only be visible to unauthenticated users.

LANGUAGE: tsx
CODE:
import '@/styles/globals.css'
import { ClerkProvider, RedirectToSignIn, SignedOut } from '@clerk/nextjs'
import { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider {...pageProps}>
      <SignedOut>
        <p>You are signed out.</p>
      </SignedOut>
      <p>This content is always visible.</p>
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Implementing OAuth Sign-In with Google using useOAuth() in React Native
DESCRIPTION: This example demonstrates how to create a custom OAuth sign-in flow for Google accounts using the useOAuth() hook in a React Native application. It includes error handling and session management.

LANGUAGE: tsx
CODE:
import React from 'react'
import * as WebBrowser from 'expo-web-browser'
import { Text, View, Button } from 'react-native'
import { Link } from 'expo-router'
import { useOAuth } from '@clerk/clerk-expo'
import * as Linking from 'expo-linking'

export const useWarmUpBrowser = () => {
  React.useEffect(() => {
    // Warm up the android browser to improve UX
    // https://docs.expo.dev/guides/authentication/#improving-user-experience
    void WebBrowser.warmUpAsync()
    return () => {
      void WebBrowser.coolDownAsync()
    }
  }, [])
}

WebBrowser.maybeCompleteAuthSession()

export default function Page() {
  useWarmUpBrowser()

  const { startOAuthFlow } = useOAuth({ strategy: 'oauth_google' })

  const onPress = React.useCallback(async () => {
    try {
      const { createdSessionId, signIn, signUp, setActive } = await startOAuthFlow({
        redirectUrl: Linking.createURL('/dashboard', { scheme: 'myapp' }),
      })

      // If sign in was successful, set the active session
      if (createdSessionId) {
        setActive!({ session: createdSessionId })
      } else {
        // Use signIn or signUp returned from startOAuthFlow
        // for next steps, such as MFA
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }, [])

  return (
    <View>
      <Link href="/">
        <Text>Home</Text>
      </Link>
      <Button title="Sign in with Google" onPress={onPress} />
    </View>
  )
}

----------------------------------------

TITLE: Role-based Authorization in Client Components with Clerk
DESCRIPTION: Demonstrates how to perform role-based authorization checks in a Next.js client component using Clerk's has() function.

LANGUAGE: tsx
CODE:
'use client'
import { useAuth } from '@clerk/nextjs'

export function SettingsForm() {
  const { has } = useAuth()

  const canAccessSettings = has({ role: 'org:admin' }) || has({ role: 'org:billing_manager' })

  if (!canAccessSettings) return null

  return <form>{/* Add UI for team settings */}</form>
}

----------------------------------------

TITLE: Paginated Organization Membership List Retrieval
DESCRIPTION: Example demonstrating how to skip results for pagination using the offset parameter.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const { data, totalCount } = await clerkClient.users.getOrganizationMembershipList({
  userId,
  // skips the first 10 memberships
  offset: 10,
})

----------------------------------------

TITLE: Rendering OrganizationProfile in Remix
DESCRIPTION: Example of using the <OrganizationProfile /> component in a Remix application.

LANGUAGE: jsx
CODE:
import { OrganizationProfile } from '@clerk/remix'

export default function OrganizationProfilePage() {
  return <OrganizationProfile />
}

----------------------------------------

TITLE: Implementing Auth Store in React
DESCRIPTION: Demonstrates how to use the $authStore with React components to handle authentication states using nanostores. Shows loading, signed out, and authenticated states handling.

LANGUAGE: typescript
CODE:
import { useStore } from '@nanostores/react'
import { $authStore } from '@clerk/astro/client'

export default function ExternalData() {
  const { userId } = useStore($authStore)

  if (userId === undefined) {
    // Handle loading state however you like
    return <div>Loading...</div>
  }

  if (userId === null) {
    // Handle signed out state however you like
    return <div>Sign in to view this page</div>
  }

  return <div>...</div>
}

----------------------------------------

TITLE: Basic Usage of buildClerkProps in Next.js getServerSideProps
DESCRIPTION: This snippet shows how to use buildClerkProps in a Next.js getServerSideProps function to handle authentication. It checks for a userId and returns the Clerk props for client-side use.

LANGUAGE: tsx
CODE:
import { getAuth, buildClerkProps } from '@clerk/nextjs/server'
import { GetServerSideProps } from 'next'

export const getServerSideProps: GetServerSideProps = async (ctx) => {
  const { userId } = getAuth(ctx.req)

  if (!userId) {
    // handle user is not signed in.
  }

  // Load any data your application needs for the page using the userId
  return { props: { ...buildClerkProps(ctx.req) } }
}

----------------------------------------

TITLE: Password Reset Implementation in iOS using SwiftUI
DESCRIPTION: A SwiftUI implementation of password reset flow using Clerk's iOS SDK. Handles email verification, code verification, and password updates.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct ForgotPasswordView: View {
  @Environment(Clerk.self) private var clerk
  @State private var email = ""
  @State private var code = ""
  @State private var newPassword = ""
  @State private var isVerifying = false

  var body: some View {
    switch clerk.client?.signIn?.status {
    case .needsFirstFactor:
      TextField("Enter your code", text: $code)
      Button("Verify") {
        Task { await verify(code: code) }
      }

    case .needsSecondFactor:
      Text("2FA is required, but this UI does not handle that")

    case .needsNewPassword:
      SecureField("New password", text: $newPassword)
      Button("Set new password") {
        Task { await setNewPassword(password: newPassword) }
      }

    default:
      if let session = clerk.session {
        Text("Active Session: \(session.id)")
      } else {
        TextField("Email", text: $email)
        Button("Forgot password?") {
          Task { await createSignIn(email: email) }
        }
      }
    }
  }
}

extension ForgotPasswordView {

  func createSignIn(email: String) async {
    do {
      try await SignIn.create(strategy: .identifier(email, strategy: "reset_password_email_code"))
    } catch {
      dump(error)
    }
  }

  func verify(code: String) async {
    do {
      guard let inProgressSignIn = clerk.client?.signIn else { return }
      try await inProgressSignIn.attemptFirstFactor(for: .resetPasswordEmailCode(code: code))
    } catch {
      dump(error)
    }
  }

  func setNewPassword(password: String) async {
    do {
      guard let inProgressSignIn = clerk.client?.signIn else { return }
      try await inProgressSignIn.resetPassword(.init(password: password, signOutOfOtherSessions: true))
    } catch {
      dump(error)
    }
  }
}

----------------------------------------

TITLE: Attempting PhoneNumber Verification in TypeScript
DESCRIPTION: Attempts to verify the phone number using the one-time code sent via SMS.

LANGUAGE: typescript
CODE:
function attemptVerification(params: AttemptPhoneNumberVerificationParams): Promise<PhoneNumber>

----------------------------------------

TITLE: TypeScript SAML Account Interface Properties
DESCRIPTION: Interface definition specifying the properties of a SAML account including activation status, user details, provider information, and verification status. Used for typing SAML account objects in TypeScript applications.

LANGUAGE: typescript
CODE:
interface SamlAccount {
  active: boolean;
  email_address: string;
  first_name: string;
  last_name: string;
  saml_connection: SamlAccountConnection | null;
  provider: 'saml_okta' | 'saml_google' | 'saml_microsoft' | 'saml_custom';
  provider_user_id: string | null;
  verification: Verification | null;
}

----------------------------------------

TITLE: Converting Web3Wallet to String in TypeScript
DESCRIPTION: Method to convert Web3Wallet to its hexadecimal string representation.

LANGUAGE: typescript
CODE:
function toString(): string

----------------------------------------

TITLE: Using verifyPassword Function with Clerk Backend SDK in TypeScript
DESCRIPTION: Example of how to use the verifyPassword function from the Clerk Backend SDK. It demonstrates verifying a user's password by providing a userId and password.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const password = 'testpassword123'

const response = await clerkClient.users.verifyPassword({
  userId,
  password,
})

----------------------------------------

TITLE: Defining UpdateUser Function Signature in TypeScript
DESCRIPTION: TypeScript function signature for the updateUser method that takes a userId and UpdateUserParams to modify a user's properties.

LANGUAGE: typescript
CODE:
function updateUser(userId: string, params: UpdateUserParams): Promise<User>

----------------------------------------

TITLE: InvalidCSRFToken Error JSON Response
DESCRIPTION: JSON response structure for an invalid or missing CSRF token error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid or missing CSRF token",
  "longMessage": "To protect against CSRF attacks, the given request must include a valid CSRF token.",
  "code": "invalid_csrf_token_code"
}

----------------------------------------

TITLE: Defining SignInFirstFactor Union Type in TypeScript
DESCRIPTION: This snippet defines the SignInFirstFactor type as a union of various factor types used in the sign-in process. It encompasses different strategies like email code, phone code, password, and OAuth.

LANGUAGE: typescript
CODE:
type SignInFirstFactor =
  | EmailCodeFactor
  | EmailLinkFactor
  | PhoneCodeFactor
  | PasswordFactor
  | ResetPasswordPhoneCodeFactor
  | ResetPasswordEmailCodeFactor
  | Web3SignatureFactor
  | OauthFactor
  | SamlFactor

----------------------------------------

TITLE: Implementing Clerk Frontend API Proxy in Cloudflare Workers
DESCRIPTION: This TypeScript code sets up a Cloudflare Worker to proxy requests to the Clerk Frontend API. It includes the necessary headers and environment variable configurations.

LANGUAGE: typescript
CODE:
export default {
  async fetch(req: Request, env: Env, _ctx: ExecutionContext): Promise<Response> {
    const url = req.url.replace(env.CLERK_PROXY_URL, env.CLERK_FAPI)
    const proxyReq = new Request(req, {
      redirect: 'manual',
    })

    proxyReq.headers.set('Clerk-Proxy-Url', env.CLERK_PROXY_URL)
    proxyReq.headers.set('Clerk-Secret-Key', env.CLERK_SECRET_KEY)
    proxyReq.headers.set('X-Forwarded-For', req.headers.get('CF-Connecting-IP') || '')

    return fetch(url, proxyReq)
  },
}

LANGUAGE: toml
CODE:
name = "cloudflare-proxy"
main = "src/index.ts"
compatibility_date = "2023-10-02"

[vars]
CLERK_FAPI="https://frontend-api.clerk.dev"

LANGUAGE: env
CODE:
# Do not commit this file to source control
CLERK_PROXY_URL="https://app.dev/__clerk"
CLERK_SECRET_KEY="sk_live_xxxxx"

LANGUAGE: typescript
CODE:
interface Env {
  CLERK_FAPI: string
  CLERK_PROXY_URL: string
  CLERK_SECRET_KEY: string
}

----------------------------------------

TITLE: Implementing Waitlist Component in Astro
DESCRIPTION: Basic implementation of the Waitlist component in an Astro application using the @clerk/astro package.

LANGUAGE: astro
CODE:
---
import { Waitlist as WaitlistAstro } from '@clerk/astro/components'
---

<WaitlistAstro />

----------------------------------------

TITLE: Using SignedOut Component in React
DESCRIPTION: This example shows how to implement the SignedOut component in a React application. It includes setup with ClerkProvider and demonstrates usage with and without React Router.

LANGUAGE: tsx
CODE:
import { SignedOut, ClerkProvider } from '@clerk/clerk-react'

// Import your Publishable Key
const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Add your Clerk Publishable Key to the .env file')
}

function Page() {
  return (
    <ClerkProvider publishableKey={PUBLISHABLE_KEY}>
      <SignedOut>
        <p>You are signed out.</p>
      </SignedOut>
      <p>This content is always visible.</p>
    </ClerkProvider>
  )
}

LANGUAGE: tsx
CODE:
import { Routes, Route } from 'react-router'
import { ClerkProvider, SignedOut } from '@clerk/clerk-react'

function App() {
  return (
    <ClerkProvider publishableKey={`{{pub_key}}`}>
      <Routes>
        <Route path="/" element={<p>This page is publicly accessible.</p>} />
        <Route
          path="/public"
          element={
            <SignedOut>
              <p>You are signed out.</p>
            </SignedOut>
          }
        />
      </Routes>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Implementing Custom Invitation Sign-up Flow in JavaScript
DESCRIPTION: This JavaScript code demonstrates how to create a custom sign-up flow for handling application invitations using the Clerk API. It includes HTML markup for the sign-up form and JavaScript code to handle the form submission and API interaction.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="signed-in"></div>

    <div id="sign-up">
      <h2>Sign up</h2>
      <form id="sign-up-form">
        <label for="firstName">Enter first name</label>
        <input name="firstName" id="firstName" />
        <label for="lastName">Enter last name</label>
        <input name="lastName" id="lastName" />
        <label for="password">Enter password</label>
        <input name="password" id="password" />
        <button type="submit">Continue</button>
      </form>
    </div>

    <script type="module" src="/src/main.js" async crossorigin="anonymous"></script>
  </body>
</html>

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(pubKey)
await clerk.load()

if (clerk.user) {
  // Mount user button component
  document.getElementById('signed-in').innerHTML = `
    <div id="user-button"></div>
  `

  const userbuttonDiv = document.getElementById('user-button')

  clerk.mountUserButton(userbuttonDiv)
} else {
  // Get the token from the query parameter
  const param = '__clerk_ticket'
  const token = new URL(window.location.href).searchParams.get(param)

  // Handle the sign-up form
  document.getElementById('sign-up-form').addEventListener('submit', async (e) => {
    e.preventDefault()

    const formData = new FormData(e.target)
    const firstName = formData.get('firstName')
    const lastName = formData.get('lastName')
    const password = formData.get('password')

    try {
      // Start the sign-up process using the ticket method
      const signUpAttempt = await clerk.client.signUp.create({
        strategy: 'ticket',
        ticket: token,
        firstName,
        lastName,
        password,
      })

      // If sign-up was successful, set the session to active
      if (signUpAttempt.status === 'complete') {
        await clerk.setActive({ session: signUpAttempt.createdSessionId })
      } else {
        // If the status is not complete, check why. User may need to
        // complete further steps.
        console.error(JSON.stringify(signUpAttempt, null, 2))
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  })
}

----------------------------------------

TITLE: Creating Organization Domain - TypeScript Definition
DESCRIPTION: TypeScript function definition for creating a new domain for an organization.

LANGUAGE: typescript
CODE:
function createDomain(domainName: string): Promise<OrganizationDomainResource>

----------------------------------------

TITLE: Implementing GoogleOneTap in Remix
DESCRIPTION: Example of using the GoogleOneTap component in a Remix application. The component is rendered on a sign-in page using the default export.

LANGUAGE: jsx
CODE:
import { GoogleOneTap } from '@clerk/remix'

export default function Page() {
  return <GoogleOneTap />
}

----------------------------------------

TITLE: Defining ActorTokenAlreadyUsed Error in JSON
DESCRIPTION: This snippet defines the error response for an actor token that has already been used. It includes a short message, long message, and error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "actor token has already been used",
  "longMessage": "This actor token has already been used. Each token can only be used once.",
  "code": "actor_token_already_used_code"
}

----------------------------------------

TITLE: Implementing User Session Management in Svelte
DESCRIPTION: Svelte component implementation using $sessionListStore to create a user button with session management functionality. Uses Svelte's reactive syntax with Clerk's authentication system.

LANGUAGE: svelte
CODE:
<script>
  // The $ prefix is reserved in Svelte for its own reactivity system.
  // Alias the imports to avoid conflicts.
  import { $sessionListStore as sessions, $clerkStore as clerk } from '@clerk/astro/client'
</script>

{#if $sessions === undefined}
  <div>Loading sessions...</div>
{:else}
  <div>
    <div>{$clerk.session.user.primaryEmailAddress}</div>
    <div role="menu">
      {#each $sessions as sess (sess.id)}
        <button role="menuitem" on:click={() => $clerk.setActive({ session: sess.id })}>
          {sess.user.primaryEmailAddress}
        </button>
      {/each}
      <button role="menuitem" on:click={() => $clerk.signOut()}> Sign out of all accounts </button>
    </div>
  </div>
{/if}

----------------------------------------

TITLE: Implementing CreateOrganization in Remix
DESCRIPTION: Example of using the CreateOrganization component in a Remix application. The component is imported from '@clerk/remix' and rendered in a route component.

LANGUAGE: jsx
CODE:
import { CreateOrganization } from '@clerk/remix'

export default function CreateOrganizationPage() {
  return <CreateOrganization />
}

----------------------------------------

TITLE: Using TOTP Verification with Clerk Client
DESCRIPTION: Example showing how to use the verifyTOTP function with ClerkClient to verify a user's TOTP code.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const code = '123456'

const response = await clerkClient.users.verifyTOTP({
  userId,
  code,
})

----------------------------------------

TITLE: Implementing SignedOut Component in Expo
DESCRIPTION: This example demonstrates how to use the SignedOut component in an Expo (React Native) application. It shows the component usage within a React Native screen component.

LANGUAGE: tsx
CODE:
import { SignedOut } from '@clerk/clerk-expo'
import { Text, View } from 'react-native'

export default function Screen() {
  return (
    <View>
      <SignedOut>
        <Text>You are signed out</Text>
      </SignedOut>
      <Text>This content is always visible.</Text>
    </View>
  )
}

----------------------------------------

TITLE: SignOutButton Usage in Vue
DESCRIPTION: Demonstrates how to use the SignOutButton component in a Vue.js application, including both basic usage and a custom button implementation.

LANGUAGE: vue
CODE:
<script setup>
import { SignOutButton } from '@clerk/vue'
</script>

<template>
  <SignOutButton />
</template>

LANGUAGE: vue
CODE:
<script setup>
import { SignOutButton } from '@clerk/vue'
</script>

<template>
  <SignOutButton>
    <button>Custom sign out button</button>
  </SignOutButton>
</template>

----------------------------------------

TITLE: Auth Object Example With Valid Factor Age
DESCRIPTION: This snippet shows the Auth object structure with a valid factor age. It includes the factorVerificationAge property set to [0,0], indicating recent verification of both factors.

LANGUAGE: javascript
CODE:
{
  sessionId: 'sess_123',
  userId: 'user_123',
  orgId: null,
  orgRole: null,
  orgSlug: null,
  orgPermissions: null,
  factorVerificationAge: [0,0],
  has: [Function (anonymous)],
  getToken: [AsyncFunction (anonymous)],
  claims: {
    azp: 'http://localhost:3000',
    exp: 1666622607,
    iat: 1666622547,
    iss: 'https://clerk.quiet.muskox-85.lcl.dev',
    nbf: 1666622537,
    sid: 'sess_123',
    sub: 'user_123',
  },
}

----------------------------------------

TITLE: Retrieving Current User in Astro Endpoints with Clerk
DESCRIPTION: This snippet demonstrates how to retrieve the current user in an Astro endpoint using the asynchronous currentUser() local provided by Clerk.

LANGUAGE: typescript
CODE:
export async function GET({ locals }) {
  const user = await locals.currentUser()

  if (!user) {
    return new Response('Unauthorized', { status: 401 })
  }

  return new Response(JSON.stringify({ user }))
}

----------------------------------------

TITLE: Configuring Nginx for Clerk Frontend API Proxy
DESCRIPTION: This Nginx configuration sets up a proxy for the Clerk Frontend API. It forwards requests to the specified path to the Clerk API and sets the required headers.

LANGUAGE: nginx
CODE:
http {
  # ...
  server {
    # ...
    location /__clerk/ {
      rewrite          ^/__clerk/(.*)$ /$1 break;
      proxy_pass       https://frontend-api.clerk.dev;
      proxy_set_header Clerk-Proxy-Url https://app.dev/__clerk;
      proxy_set_header Clerk-Secret-Key sk_live_***;
      proxy_set_header X-Forwarded-For $remote_addr;
      proxy_redirect   off;
    }
  }
}

----------------------------------------

TITLE: Implementing Reverification in Ruby on Rails Controller
DESCRIPTION: This snippet demonstrates how to use Clerk's :require_reverification! filter to prompt users to re-authenticate for actions requiring additional security. It shows how to protect all actions from unauthenticated users and require reverification for a specific action.

LANGUAGE: ruby
CODE:
class AdminController < ApplicationController
  # Protect routes with the `require_clerk_session!` method
  before_action :require_clerk_session!
  # Protect `destroy` with the `require_reverification!` method
  # Reverification preset is set to `LAX`
  before_action :require_reverification!, only: :destroy, preset: Clerk::StepUp::Preset::LAX


  def index
    # ...
  end

  def destroy
    # ...
  end
end

----------------------------------------

TITLE: Updating Passkey Name in TypeScript
DESCRIPTION: This method updates the name of the associated passkey for the signed-in user. It takes an object with a 'name' property and returns a Promise that resolves to a PasskeyResource.

LANGUAGE: typescript
CODE:
function update(params: { name: string }): Promise<PasskeyResource>

----------------------------------------

TITLE: Authorization Check Example - JavaScript
DESCRIPTION: Example demonstrating how to check user authorization for a specific role.

LANGUAGE: javascript
CODE:
await clerk.session.checkAuthorization({
  role: 'admin',
})

----------------------------------------

TITLE: InvalidClientStateForAction Error in JSON for Clerk Sign-in
DESCRIPTION: Indicates an invalid action for the current client state. The longMessage includes placeholders for specific action and reason details.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid action",
  "longMessage": "We were unable to complete %s for this Client. %s",
  "code": "client_state_invalid"
}

----------------------------------------

TITLE: LastIdentificationDeletionFailed Error Response
DESCRIPTION: JSON response when attempting to delete the last remaining identification for a user, which is not allowed as users must maintain at least one identification.

LANGUAGE: json
CODE:
{
  "shortMessage": "Deletion failed",
  "longMessage": "You cannot delete your last identification.",
  "code": "identification_deletion_failed_code"
}

----------------------------------------

TITLE: Creating Protected Route Patterns
DESCRIPTION: Example of using createRouteMatcher() to define protected route patterns for dashboard and forum sections.

LANGUAGE: typescript
CODE:
const isProtectedRoute = createRouteMatcher(['/dashboard(.*)', '/forum(.*)'])

----------------------------------------

TITLE: Billing Account Not Found Error Response
DESCRIPTION: Error response returned when a billing account cannot be found with the specified ID.

LANGUAGE: json
CODE:
{
  "shortMessage": "Billing account not found",
  "longMessage": "No billing account was found with ID <baID>",
  "code": "resource_not_found_code"
}

----------------------------------------

TITLE: Using SignedOut Component in Remix
DESCRIPTION: This snippet shows how to implement the SignedOut component in a Remix application. It demonstrates the component usage within a Remix route component.

LANGUAGE: tsx
CODE:
import { SignedOut } from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <SignedOut>
        <p>You are signed out.</p>
      </SignedOut>
      <p>This content is always visible.</p>
    </div>
  )
}

----------------------------------------

TITLE: Vanilla JavaScript Implementation of Clerk Organization Creation
DESCRIPTION: JavaScript implementation using Clerk's SDK to handle organization creation, including user authentication check and form submission handling.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!pubKey) {
  throw new Error('Add your VITE_CLERK_PUBLISHABLE_KEY to .env file')
}

const clerk = new Clerk(pubKey)
await clerk.load()

if (clerk.user) {
  const form = document.getElementById('create-organization')

  form.addEventListener('submit', function (e) {
    e.preventDefault()

    const inputEl = document.getElementById('name')

    if (!inputEl) {
      // ... handle empty input
      return
    }

    clerk
      .createOrganization({ name: inputEl.value })
      .then((res) => console.log(res))
      .catch((error) => console.log('An error occurred:', error))
  })
} else {
  // If there is no active user, mount Clerk's <SignIn />
  document.getElementById('app').innerHTML = `
    <div id="sign-in"></div>
  `

  const signInDiv = document.getElementById('sign-in')

  clerk.mountSignIn(signInDiv)
}

----------------------------------------

TITLE: JavaScript SignIn Component Mounting
DESCRIPTION: Example demonstrating how to mount the SignIn component using vanilla JavaScript with the Clerk SDK.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="sign-in"></div>
`

const signInDiv = document.getElementById('sign-in')

clerk.mountSignIn(signInDiv)

----------------------------------------

TITLE: Using unlockUser Method Example
DESCRIPTION: Example showing how to call the unlockUser method using the clerkClient.users interface, demonstrating the removal of a sign-in lock from a specific user.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const response = await clerkClient.users.unlockUser(userId)

----------------------------------------

TITLE: Setting Clerk API Key in Environment File
DESCRIPTION: Example of setting the Clerk Publishable Key in the .env file for use in the Vue application.

LANGUAGE: env
CODE:
VITE_CLERK_PUBLISHABLE_KEY={{pub_key}}

----------------------------------------

TITLE: CustomPage Interface Definition
DESCRIPTION: Interface definition for creating custom pages in Clerk components. Includes required label property and optional properties for URL handling, icon management, and content mounting/unmounting.

LANGUAGE: typescript
CODE:
interface CustomPage {
  label: string;
  url?: string;
  mountIcon?: (el: HTMLDivElement) => void;
  unmountIcon?: (el?: HTMLDivElement) => void;
  mount?: (el: HTMLDivElement) => void;
  unmount?: (el?: HTMLDivElement) => void;
}

----------------------------------------

TITLE: Accessing Clerk Object in Rack Application for Authentication in Ruby
DESCRIPTION: This example shows a simple Rack application that protects all routes using Clerk. It checks if the user is authenticated and returns the user's first name and ID if authenticated, or a 401 status if not.

LANGUAGE: ruby
CODE:
require "erb"
require "clerk"

class App
  def call(env)
    clerk = env["clerk"]

    # Check if the user is authenticated
    user = clerk.user
    user ?
      [200, {"Content-Type" => "text/plain"}, ["Authenticated User: #{user.first_name} (#{user.id})"]]
      [401, {"Content-Type" => "text/plain"}, ["Not Authenticated"]]
  end
end

----------------------------------------

TITLE: Implementing Waitlist Component in Vue
DESCRIPTION: Basic implementation of the Waitlist component in a Vue application using the @clerk/vue package.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { Waitlist } from '@clerk/vue'
</script>

<template>
  <Waitlist />
</template>

----------------------------------------

TITLE: Demonstrating JWT Structure in Plaintext
DESCRIPTION: This snippet shows the basic structure of a JWT, consisting of three base64-encoded parts separated by dots: header, payload, and signature.

LANGUAGE: plaintext
CODE:
<Header>.<Payload>.<Signature>

----------------------------------------

TITLE: Implementing Reverification in Application Logic with Clerk in Ruby
DESCRIPTION: This example shows how to handle reverification in the application logic using Clerk. It checks if the user needs to reverify their session and returns the appropriate response, requiring authentication and reverification for all routes.

LANGUAGE: ruby
CODE:
require "erb"
require "clerk"

STEP_UP_PRESET = Clerk::StepUp::Preset::LAX

class App
  def call(env)
    clerk = env["clerk"]

    # Check if the user needs to reverify their session
    if clerk.user_needs_reverification?(STEP_UP_PRESET)
      # Get the response
      return clerk.user_reverification_rack_response(STEP_UP_PRESET)
    end

    # Check if the user is authenticated
    user = clerk.user
    user ?
      [200, {"Content-Type" => "text/plain"}, ["Authenticated User: #{user.first_name} (#{user.id})"]]
      [401, {"Content-Type" => "text/plain"}, ["Not Authenticated"]]
  end
end

----------------------------------------

TITLE: Defining PermissionResource Interface in TypeScript
DESCRIPTION: This interface defines the structure of a permission resource in an organization. It includes properties for identification, naming, categorization, and tracking creation and update times.

LANGUAGE: typescript
CODE:
interface PermissionResource {
  id: string;
  key: string;
  name: string;
  type: 'system' | 'user';
  createdAt: Date;
  updatedAt: Date;
}

----------------------------------------

TITLE: Retrieving OAuth Access Token with Clerk Backend SDK in TypeScript
DESCRIPTION: This function retrieves the OAuth access token for a user who has previously authenticated with a particular OAuth provider. It takes the user ID and provider name as parameters and returns a Promise resolving to an array of OauthAccessToken objects.

LANGUAGE: typescript
CODE:
function getUserOauthAccessToken(
  userId: string,
  provider: `${OAuthProvider}`,
): Promise<OauthAccessToken[]>

----------------------------------------

TITLE: Basic Usage of getInvitationList in TypeScript
DESCRIPTION: Simple example of calling getInvitationList without any parameters to retrieve all non-revoked invitations.

LANGUAGE: tsx
CODE:
const response = await clerkClient.invitations.getInvitationList()

----------------------------------------

TITLE: InvalidHandshake Error JSON Response
DESCRIPTION: JSON response structure for an invalid handshake request error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "invalid handshake",
  "longMessage": "The handshake request is invalid: <REASON>",
  "code": "invalid_handshake_code"
}

----------------------------------------

TITLE: InvalidAuthorization Error JSON Response
DESCRIPTION: JSON response structure for an unauthorized request error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Unauthorized request",
  "longMessage": "You are not authorized to perform this request",
  "code": "authorization_invalid_code"
}

----------------------------------------

TITLE: Using getAllowlistIdentifierList() with Clerk Client in TypeScript
DESCRIPTION: Example usage of the `getAllowlistIdentifierList()` function with the Clerk client. This retrieves the list of all allowlist identifiers.

LANGUAGE: tsx
CODE:
const response = await clerkClient.allowlistIdentifiers.getAllowlistIdentifierList()

----------------------------------------

TITLE: Deleting User Passkeys with Clerk API in React
DESCRIPTION: This code snippet shows how to delete a user's passkey using the Clerk API. It uses the useUser hook to access the user's passkeys and calls the delete() method on a specific passkey object.

LANGUAGE: tsx
CODE:
export function DeletePasskeyUI() {
  const { user } = useUser()
  const { passkeys } = user

  const passkeyToDeleteId = useRef<HTMLInputElement>(null)
  const [success, setSuccess] = useState(false)

  const deletePasskey = async () => {
    const passkeyToDelete = passkeys?.find((pk: any) => pk.id === passkeyToDeleteId.current?.value)
    try {
      await passkeyToDelete?.delete()

      setSuccess(true)
    } catch (err) {
      console.error('Error:', JSON.stringify(err, null, 2))
      setSuccess(false)
    }
  }

  return (
    <>
      <p>Passkeys:</p>
      <ul>
        {passkeys?.map((pk: any) => {
          return (
            <li key={pk.id}>
              Name: {pk.name} | ID: {pk.id}
            </li>
          )
        })}
      </ul>
      <input ref={passkeyToDeleteId} type="text" placeholder="Enter the passkey ID" />
      <button onClick={deletePasskey}>Delete passkey</button>
      <p>Passkey deleted: {success ? 'Yes' : 'No'}</p>
    </>
  )
}

----------------------------------------

TITLE: Preparing Email Verification in TypeScript
DESCRIPTION: Initiates the email address verification process by sending a verification code or link.

LANGUAGE: typescript
CODE:
function prepareVerification(params: PrepareEmailAddressVerificationParams): Promise<EmailAddress>

----------------------------------------

TITLE: Rendering OrganizationProfile in Tanstack Start
DESCRIPTION: Example of using the <OrganizationProfile /> component in a Tanstack Start application.

LANGUAGE: tsx
CODE:
import { OrganizationProfile } from '@clerk/tanstack-start'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/organization-profile')({
  component: OrganizationProfile,
})

function OrganizationProfile() {
  return <OrganizationProfile />
}

----------------------------------------

TITLE: Implementing SignIn Component in Astro
DESCRIPTION: Basic implementation of the SignIn component in an Astro application.

LANGUAGE: astro
CODE:
---
import { SignIn } from '@clerk/astro/components'
---

<SignIn />

----------------------------------------

TITLE: Custom Usage of SignInWithMetamaskButton in Next.js
DESCRIPTION: Shows how to customize the SignInWithMetamaskButton in Next.js by wrapping a custom button inside it. The 'mode' prop is set to 'modal' for a modal sign-in experience.

LANGUAGE: jsx
CODE:
import { SignInWithMetamaskButton } from '@clerk/nextjs'

export default function Home() {
  return (
    <div>
      <SignInWithMetamaskButton mode="modal">
        <button>Custom sign in button</button>
      </SignInWithMetamaskButton>
    </div>
  )
}

----------------------------------------

TITLE: Updating Email Address TypeScript Function Definition
DESCRIPTION: TypeScript function signature for updating an email address, accepting an email address ID and update parameters, returning a Promise of EmailAddress type.

LANGUAGE: typescript
CODE:
function updateEmailAddress(
  emailAddressId: string,
  params: UpdateEmailAddressParams,
): Promise<EmailAddress>

----------------------------------------

TITLE: Accessing User Data in Remix Action Function
DESCRIPTION: Example of using getAuth() helper in a Remix action function to handle user authentication and data retrieval. Similar to the loader function, it checks authentication and uses the Clerk Backend SDK to access user data.

LANGUAGE: typescript
CODE:
import { ActionFunction, redirect } from '@remix-run/node'
import { getAuth } from '@clerk/remix/ssr.server'
import { createClerkClient } from '@clerk/remix/api.server'

export const action: ActionFunction = async (args) => {
  // Use `getAuth()` to retrieve the user's ID
  const { userId } = await getAuth(args)

  // If there is no userId, then redirect to sign-in route
  if (!userId) {
    return redirect('/sign-in?redirect_url=' + args.request.url)
  }

  // Initialize the Backend SDK and get the user's full `Backend User` object
  const updatedUser = await createClerkClient({
    secretKey: process.env.CLERK_SECRET_KEY,
  }).users.getUser(userId)

  // Return the retrieved user data
  return { serialisedUser: JSON.stringify(updatedUser) }
}

----------------------------------------

TITLE: Implementing SignIn Component in Next.js
DESCRIPTION: Basic implementation of Clerk's SignIn component in a Next.js page using optional catch-all routing.

LANGUAGE: typescript
CODE:
import { SignIn } from '@clerk/nextjs'

export default function Page() {
  return <SignIn />
}

----------------------------------------

TITLE: Basic Usage of getCount Function
DESCRIPTION: Example of how to use the getCount function to retrieve the total number of users without any filters.

LANGUAGE: tsx
CODE:
const response = await clerkClient.users.getCount()

----------------------------------------

TITLE: Rendering Content by Permissions in Next.js
DESCRIPTION: This snippet demonstrates how to use the <Protect> component to render content only for users with the 'org:invoices:create' permission in a Next.js application.

LANGUAGE: jsx
CODE:
import { Protect } from '@clerk/nextjs'

export default function ProtectPage() {
  return (
    <Protect
      permission="org:invoices:create"
      fallback={<p>You do not have the permissions to create an invoice.</p>}
    >
      {children}
    </Protect>
  )
}

----------------------------------------

TITLE: Filtering Organization Invitations by Status in TypeScript
DESCRIPTION: Example of using getOrganizationInvitationList to retrieve a filtered list of organization invitations based on their status. This example filters for pending invitations.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const { data, totalCount } = await clerkClient.organizations.getOrganizationInvitationList({
  organizationId,
  // returns a list of invitations that have not yet been accepted
  status: ['pending'],
})

----------------------------------------

TITLE: Implementing Sign-In-or-Up Page in TanStack Start with Clerk
DESCRIPTION: This code snippet shows how to create a sign-in-or-up page using Clerk's SignIn component and TanStack Router's catch-all route. It defines a route and renders the SignIn component.

LANGUAGE: typescript
CODE:
import { SignIn } from '@clerk/tanstack-start'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/sign-in/$')({
  component: Page,
})

function Page() {
  return <SignIn />
}

----------------------------------------

TITLE: Accessing Session Data with useAuth() in Expo
DESCRIPTION: This example shows how to use the useAuth() hook to access session information and protect routes based on the user's authentication status. It demonstrates checking if the user is signed in and displaying their userId and sessionId.

LANGUAGE: tsx
CODE:
import { useAuth } from '@clerk/clerk-expo'
import { Text } from 'react-native'

export default function UseAuthExample() {
  const { isLoaded, isSignedIn, userId, sessionId, getToken } = useAuth()

  if (!isLoaded) {
    return <Text>Loading...</Text>
  }

  if (!isSignedIn) {
    // You could also add a redirect to the sign-in page here
    return <Text>Sign in to view this page</Text>
  }

  return (
    <Text>
      Hello, {userId}! Your current active session is {sessionId}.
    </Text>
  )
}

----------------------------------------

TITLE: Configuring Astro with Clerk and React
DESCRIPTION: Update astro.config.mjs to include Clerk and React integrations, set output to server, and use the node adapter.

LANGUAGE: typescript
CODE:
import { defineConfig } from 'astro/config'
import node from '@astrojs/node'
import react from '@astrojs/react'
import clerk from '@clerk/astro'

export default defineConfig({
  integrations: [clerk(), react()],
  output: 'server',
  adapter: node({ mode: 'standalone' }),
})

----------------------------------------

TITLE: Implementing SignIn Component in Remix Route
DESCRIPTION: Creates a dedicated page for authentication using Clerk's SignIn component with Remix optional routing.

LANGUAGE: typescript
CODE:
import { SignIn } from '@clerk/remix'

export default function Page() {
  return <SignIn />
}

----------------------------------------

TITLE: Reserving PhoneNumber for Second Factor in TypeScript
DESCRIPTION: Marks the phone number as reserved (or not) for multi-factor authentication.

LANGUAGE: typescript
CODE:
function setReservedForSecondFactor(params: SetReservedForSecondFactorParams): Promise<PhoneNumber>

----------------------------------------

TITLE: Creating Web3Wallet Instance in TypeScript
DESCRIPTION: Method to create a new Web3Wallet instance.

LANGUAGE: typescript
CODE:
function create(): Promise<Web3Wallet>

----------------------------------------

TITLE: Handling Checkout Lock Status Error - JSON
DESCRIPTION: Error response when a checkout process is still in progress for a specific application ID

LANGUAGE: json
CODE:
{
  "shortMessage": "Checkout is still processing",
  "longMessage": "Checkout is still processing for application ID <appID>",
  "code": "checkout_locked_code"
}

----------------------------------------

TITLE: Implementing Identifier Exists Error in Clerk
DESCRIPTION: Error response when attempting to use an identifier that is already registered. Uses a dynamic message with an identifier type parameter.

LANGUAGE: json
CODE:
{
  "shortMessage": "That %s is taken. Please try another.",
  "code": "form_identifier_exists"
}

----------------------------------------

TITLE: Using ClerkPaginatedResponse in Promise Return Type
DESCRIPTION: This snippet demonstrates how ClerkPaginatedResponse is used in the return type of promises in Clerk's SDKs. It shows that the SDK methods return a Promise of ClerkPaginatedResponse with a generic type T.

LANGUAGE: typescript
CODE:
Promise<ClerkPaginatedResponse<T>>

----------------------------------------

TITLE: Updating auth.protect() syntax
DESCRIPTION: Example showing the new syntax for calling protect() directly on the auth object.

LANGUAGE: javascript
CODE:
import { auth } from '@clerk/nextjs/server'

- export default function Page() {
-   auth().protect()
+ export default async function Page() {
+   await auth.protect()
}

----------------------------------------

TITLE: Preparing Web3Wallet Verification in TypeScript
DESCRIPTION: Method to initiate the verification process for a Web3Wallet, requiring user signature via browser extension.

LANGUAGE: typescript
CODE:
function prepareVerification(params: PrepareWeb3WalletVerificationParams): Promise<Web3Wallet>

----------------------------------------

TITLE: Rendering UserProfile Component in React
DESCRIPTION: Example of how to use the <UserProfile /> component in a React application.

LANGUAGE: jsx
CODE:
import { UserProfile } from '@clerk/clerk-react'

const UserProfilePage = () => <UserProfile />

export default UserProfilePage

----------------------------------------

TITLE: Defining deleteUser Function in TypeScript
DESCRIPTION: Function signature for deleting a user given their ID. It returns a Promise that resolves to a User object.

LANGUAGE: typescript
CODE:
function deleteUser(userId: string): Promise<User>

----------------------------------------

TITLE: Adding Custom Links to OrganizationProfile in Next.js
DESCRIPTION: Demonstrates how to add a custom external link to the OrganizationProfile sidenav using Next.js. The example adds a link to the homepage.

LANGUAGE: tsx
CODE:
'use client'

import { OrganizationSwitcher } from '@clerk/nextjs'

const DotIcon = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" />
    </svg>
  )
}

const Header = () => (
  <header>
    <OrganizationSwitcher>
      <OrganizationSwitcher.OrganizationProfileLink
        label="Homepage"
        url="/"
        labelIcon={<DotIcon />}
      />
    </OrganizationSwitcher>
  </header>
)

export default Header

----------------------------------------

TITLE: Protecting a Form with Clerk Auth in Astro
DESCRIPTION: This example demonstrates how to protect a form submission using the auth() local in Astro. It checks if the user is signed in before processing the form data.

LANGUAGE: astro
CODE:
---
if (Astro.request.method === 'POST') {
  if (!Astro.locals.auth().userId) {
    throw new Error('You must be signed in to add an item to your cart')
  }

  const data = await Astro.request.formData()
  console.log('add item action', data)
}
---

<form method="POST">
  <input value="test" type="text" name="name" />
  <button type="submit">Add to Cart</button>
</form>

----------------------------------------

TITLE: Authenticating with Web3 in Clerk
DESCRIPTION: Example of initiating Web3 authentication using a wallet address in Clerk's SignIn object.

LANGUAGE: javascript
CODE:
const signIn = await clerk.signIn.authenticateWithWeb3({
  identifier: '0x1234567890123456789012345678901234567890',
})

----------------------------------------

TITLE: Implementing RedirectToUserProfile in Remix
DESCRIPTION: Example showing how to implement RedirectToUserProfile in a Remix application route with authentication state handling.

LANGUAGE: tsx
CODE:
import { SignedIn, SignedOut, RedirectToUserProfile } from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <SignedIn>
        <RedirectToUserProfile />
      </SignedIn>
      <SignedOut>
        <p>You need to sign in to view your user profile.</p>
      </SignedOut>
    </div>
  )
}

----------------------------------------

TITLE: Rendering UserProfile Component in Tanstack Start
DESCRIPTION: Example of how to use the <UserProfile /> component in a Tanstack Start application.

LANGUAGE: tsx
CODE:
import { UserProfile } from '@clerk/tanstack-start'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/user-profile')({
  component: UserProfile,
})

function UserProfile() {
  return <UserProfile />
}

----------------------------------------

TITLE: Detecting Impersonated Sessions in Next.js
DESCRIPTION: This Next.js example uses the auth() helper to access the Auth object and detect an impersonated session on the server side.

LANGUAGE: jsx
CODE:
import { auth } from '@clerk/nextjs/server'

export default async function Page() {
  // Use Clerk's `auth()` helper to access the `Auth` object
  const { userId, actor } = await auth()

  return (
    <div>
      {actor && (
        <span>
          user {actor.sub} has signed in as user {userId}
        </span>
      )}
    </div>
  )
}

----------------------------------------

TITLE: Defining OAuthProvider Type in TypeScript
DESCRIPTION: Defines the OAuthProvider type as a union of strings representing various OAuth providers supported by Clerk. It includes popular providers like Facebook, Google, GitHub, and many others.

LANGUAGE: typescript
CODE:
type OAuthProvider =
  | 'facebook'
  | 'google'
  | 'hubspot'
  | 'github'
  | 'tiktok'
  | 'gitlab'
  | 'discord'
  | 'twitter'
  | 'twitch'
  | 'linkedin'
  | 'linkedin_oidc'
  | 'dropbox'
  | 'atlassian'
  | 'bitbucket'
  | 'microsoft'
  | 'notion'
  | 'apple'
  | 'line'
  | 'instagram'
  | 'coinbase'
  | 'spotify'
  | 'xero'
  | 'box'
  | 'slack'
  | 'linear'
  | 'x'
  | 'huggingface'
  | `custom_${string}`

----------------------------------------

TITLE: Defining banUser Function Signature in TypeScript
DESCRIPTION: Function signature for the `banUser()` method, which takes a user ID as a string parameter and returns a Promise resolving to a User object.

LANGUAGE: typescript
CODE:
function banUser(userId: string): Promise<User>

----------------------------------------

TITLE: First Factor Verification Example - JavaScript
DESCRIPTION: Example showing how to attempt first factor verification using email code strategy.

LANGUAGE: javascript
CODE:
await clerk.session.attemptFirstFactorVerification({
  strategy: 'email_code',
  code: '123456',
})

----------------------------------------

TITLE: DomainNotFound Error Response in JSON
DESCRIPTION: Error response when a domain cannot be found with the provided ID.

LANGUAGE: json
CODE:
{
  "shortMessage": "Domain not found",
  "longMessage": "No domain was found with <id>",
  "code": "resource_not_found_code"
}

----------------------------------------

TITLE: ApplicationNotFound Error Response in JSON
DESCRIPTION: Error response when an application with the specified appID cannot be found in the system.

LANGUAGE: json
CODE:
{
  "shortMessage": "Application not found",
  "longMessage": "No application was found with id <appID>",
  "code": "resource_not_found_code"
}

----------------------------------------

TITLE: Limiting and Ordering User List Results
DESCRIPTION: Example of using getUserList with ordering and limiting options to retrieve a specific number of users sorted by creation date.

LANGUAGE: tsx
CODE:
const { data, totalCount } = await clerkClient.users.getUserList({
  orderBy: '-created_at',
  limit: 10,
})

----------------------------------------

TITLE: Using createClerkClient instead of setters
DESCRIPTION: Example of using createClerkClient with options instead of individual setter methods.

LANGUAGE: javascript
CODE:
const clerkClient = createClerkClient({
  secretKey: '...',
  apiVersion: '...',
  httpOptions: '...',
  serverApiUrl: '...'
})

await clerkClient.users.getUser(userId)

----------------------------------------

TITLE: EnterpriseAccountConnection Interface Definition in TypeScript
DESCRIPTION: TypeScript interface defining the structure of an enterprise account connection with properties for managing authentication settings, domain configuration, and connection metadata.

LANGUAGE: typescript
CODE:
interface EnterpriseAccountConnection {
  active: boolean;
  allow_idp_initiated: boolean;
  allow_subdomains: boolean;
  disable_additional_identifications: boolean;
  domain: string;
  id: string;
  logo_public_url: string | null;
  name: string;
  protocol: 'saml' | 'oauth';
  provider: 'saml_okta' | 'saml_google' | 'saml_microsoft' | 'saml_custom' | `oauth_${OAuthProvider}`;
  sync_user_attributes: boolean;
  created_at: number;
  updated_at: number;
}

----------------------------------------

TITLE: Implementing ClerkLoaded in Remix
DESCRIPTION: Demonstrates the usage of ClerkLoaded component in a Remix application route.

LANGUAGE: tsx
CODE:
import { ClerkLoaded } from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <ClerkLoaded>
        <div>Clerk is loaded</div>
        <p>{window.Clerk.version}</p>
      </ClerkLoaded>
    </div>
  )
}

----------------------------------------

TITLE: Implementing Password Validation with Clerk Input
DESCRIPTION: Demonstrates how to use the Input component with password validation and display validation feedback.

LANGUAGE: tsx
CODE:
<Clerk.Field name="password">
  <Clerk.Label>Password</Clerk.Label>
  <Clerk.Input type="password" validatePassword />
  <Clerk.FieldState>
    {({ state, codes, message }) => (
      <div>
        <pre>Field state: {state}</pre>
        <pre>Field msg: {message}</pre>
        <pre>Codes: {JSON.stringify(codes, null, 2)}</pre>
      </div>
    )}
  </Clerk.FieldState>
</Clerk.Field>

----------------------------------------

TITLE: Adding Custom Pages in JavaScript
DESCRIPTION: Example showing how to add custom pages to UserProfile component using the JavaScript SDK's mountUserProfile method with customPages property.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(pubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="user-profile"></div>
`

const userProfileDiv = document.getElementById('user-profile')

clerk.mountUserProfile(userProfileDiv, {
  customPages: [
    {
      url: 'custom-page',
      label: 'Custom Page',
      mountIcon: (el) => {
        el.innerHTML = '👋'
      },
      unmountIcon: (el) => {
        el.innerHTML = ''
      },
      mount: (el) => {
        el.innerHTML = `
          <h1><b>Custom Page</b></h1>
          <p>This is the content of the custom page.</p>
          `
      },
      unmount: (el) => {
        el.innerHTML = ''
      },
    }
  ],
})

----------------------------------------

TITLE: Installing Clerk Chrome Extension SDK
DESCRIPTION: Command to add the Clerk Chrome Extension SDK to the project using pnpm.

LANGUAGE: bash
CODE:
pnpm add @clerk/chrome-extension

----------------------------------------

TITLE: SSO Callback Handler for Next.js
DESCRIPTION: Next.js callback page that handles the SSO redirect flow using Clerk's AuthenticateWithRedirectCallback component.

LANGUAGE: jsx
CODE:
import { AuthenticateWithRedirectCallback } from '@clerk/nextjs'

export default function Page() {
  return <AuthenticateWithRedirectCallback />
}

----------------------------------------

TITLE: Initializing Clerk Client in Chrome Extension Background Service Worker
DESCRIPTION: This code creates a background service worker that listens for messages from content scripts. It uses createClerkClient() to initialize a Clerk instance and retrieve a fresh session token for the user.

LANGUAGE: typescript
CODE:
import { createClerkClient } from '@clerk/chrome-extension/background'

const publishableKey = process.env.PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY

if (!publishableKey) {
  throw new Error('Please add the PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY to the .env.development file')
}

async function getToken() {
  const clerk = await createClerkClient({
    publishableKey,
  })

  if (!clerk.session) {
    return null
  }

  return await clerk.session?.getToken()
}

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  getToken()
    .then((token) => sendResponse({ token }))
    .catch((error) => {
      console.error('[Background service worker] Error:', JSON.stringify(error))
      sendResponse({ token: null })
    })
  return true
})

----------------------------------------

TITLE: Deleting Phone Numbers with Clerk Backend SDK - TypeScript Definition
DESCRIPTION: TypeScript function signature for deleting a phone number. Takes a phoneNumberId string parameter and returns a Promise resolving to a PhoneNumber object.

LANGUAGE: typescript
CODE:
function deletePhoneNumber(phoneNumberId: string): Promise<PhoneNumber>

----------------------------------------

TITLE: Opening UserProfile Component with JavaScript
DESCRIPTION: Example of how to open the <UserProfile /> component as an overlay using the Clerk JavaScript SDK.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="user-profile"></div>
`

const userProfileDiv = document.getElementById('user-profile')

clerk.openUserProfile(userProfileDiv)

----------------------------------------

TITLE: Implementing ClerkLoading in Remix
DESCRIPTION: Example of using ClerkLoading component in a Remix route file to display loading state. Shows basic implementation within a route component.

LANGUAGE: tsx
CODE:
import { ClerkLoading } from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <ClerkLoading>
        <div>Clerk is loading</div>
      </ClerkLoading>
    </div>
  )
}

----------------------------------------

TITLE: Running the Astro Development Server
DESCRIPTION: Commands to start the Astro development server with the newly integrated Clerk authentication.

LANGUAGE: bash
CODE:
npm run dev

LANGUAGE: bash
CODE:
yarn dev

LANGUAGE: bash
CODE:
pnpm dev

LANGUAGE: bash
CODE:
bun dev

----------------------------------------

TITLE: Implementing Clerk Sign-in with Vue
DESCRIPTION: Example of using $clerkStore in a Vue component to implement a sign-in button. Uses @nanostores/vue for state management and @clerk/astro/client for Clerk functionality.

LANGUAGE: vue
CODE:
<script setup>
import { useStore } from '@nanostores/vue'
import { $clerkStore } from '@clerk/astro/client'

const clerk = useStore($clerkStore)

const openSignIn = () => clerk.value.openSignIn()
</script>

<template>
  <button @click="openSignIn">Sign in</button>
</template>

----------------------------------------

TITLE: Updating Path-based Routing Components
DESCRIPTION: Examples of updating components to use path-based routing, which is now the default.

LANGUAGE: jsx
CODE:
<SignIn path="/sign-in" />
<SignUp path="/sign-up" />
<UserProfile path="/user-profile" />
<CreateOrganization path="/create-org" />
<OrganizationProfile path="/org-profile" />

----------------------------------------

TITLE: Defining UpdateOrganization Function Signature in TypeScript
DESCRIPTION: TypeScript function signature for updating an organization, showing the expected parameters and return type.

LANGUAGE: typescript
CODE:
function updateOrganization(params: UpdateOrganizationParams): Promise<Organization>

----------------------------------------

TITLE: JSON Representation of FeatureRequiresPSU Error in Clerk
DESCRIPTION: This snippet defines the structure of a FeatureRequiresPSU error in Clerk. It includes a short message, a long message explaining that the feature requires Progressive Sign Up, and provides a link to documentation for upgrading.

LANGUAGE: json
CODE:
{
  "shortMessage": "not a Progressive Sign Up instance",
  "longMessage": "<feature> can only be used in instances that migrated to Progressive Sign Up (https://clerk.com/docs/upgrade-guides/progressive-sign-up)",
  "code": "feature_requires_psu_code"
}

----------------------------------------

TITLE: Basic Token Generation Example
DESCRIPTION: Simple example demonstrating how to use getToken with a session ID and template name.

LANGUAGE: javascript
CODE:
const sessionId = 'sess_123'

const template = 'test'

const response = await clerkClient.sessions.getToken(sessionId, template)

----------------------------------------

TITLE: MutationOnOlderSignInNotAllowed Error in JSON for Clerk Sign-in
DESCRIPTION: Represents an error when attempting to perform update operations on older sign-ins, which is not allowed.

LANGUAGE: json
CODE:
{
  "shortMessage": "Update operations are not allowed on older sign ins",
  "code": "resource_forbidden"
}

----------------------------------------

TITLE: Deleting a PhoneNumber in TypeScript
DESCRIPTION: Deletes the current phone number.

LANGUAGE: typescript
CODE:
function destroy(): Promise<void>

----------------------------------------

TITLE: Defining getRedirectUrlList Function Signature in TypeScript
DESCRIPTION: This snippet shows the TypeScript function signature for getRedirectUrlList(). It returns a Promise that resolves to a PaginatedResourceResponse containing an array of RedirectUrl objects.

LANGUAGE: typescript
CODE:
function getRedirectUrlList(): () => Promise<PaginatedResourceResponse<RedirectUrl[]>>

----------------------------------------

TITLE: DevBrowserUnauthenticated Error JSON Response
DESCRIPTION: JSON response structure for an unauthenticated dev browser error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Browser unauthenticated",
  "longMessage": "Unable to authenticate this browser for your development instance. Check your Clerk cookies and try again. If the issue persists reach out to support@clerk.com.",
  "code": "dev_browser_unauthenticated_code"
}

----------------------------------------

TITLE: Getting Provider Title in TypeScript
DESCRIPTION: Method signature for getting the formatted provider title with 'Account' appended.

LANGUAGE: typescript
CODE:
function providerTitle(): string

----------------------------------------

TITLE: Implementing GoogleOneTap in Next.js
DESCRIPTION: Example of using the GoogleOneTap component in a Next.js application. The component is rendered on a sign-in page and doesn't require additional checks for user authentication status.

LANGUAGE: tsx
CODE:
import { GoogleOneTap } from '@clerk/nextjs'

export default function Page() {
  return <GoogleOneTap />
}

----------------------------------------

TITLE: Deleting Organization Logo Function Signature in TypeScript
DESCRIPTION: This snippet shows the TypeScript function signature for the `deleteOrganizationLogo()` method. It takes an organization ID as a string parameter and returns a Promise that resolves to an Organization object.

LANGUAGE: typescript
CODE:
function deleteOrganizationLogo(organizationId: string): Promise<Organization>

----------------------------------------

TITLE: Filtering Sessions by Status in TypeScript
DESCRIPTION: Example of using getSessionList to retrieve expired sessions for a specific user. This demonstrates how to filter sessions by status.

LANGUAGE: typescript
CODE:
const userId = 'user_123'

const status = 'expired'

const response = await clerkClient.sessions.getSessionList({ userId, status })

----------------------------------------

TITLE: Paginated SAML Connection List with Limit
DESCRIPTION: Example showing how to limit the number of SAML connections returned in the response.

LANGUAGE: tsx
CODE:
const { data, totalCount } = await clerkClient.samlConnections.getSamlConnectionList({
  // returns the first 10 results
  limit: 10,
})

----------------------------------------

TITLE: RequestInvalidForInstance Error JSON Response
DESCRIPTION: JSON response structure for an invalid request for instance error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid request for instance",
  "longMessage": "This request is not valid for your instance. Modify your instance settings to use this request.",
  "code": "request_invalid_for_instance_code"
}

----------------------------------------

TITLE: Implementing SignUp Component in Next.js
DESCRIPTION: Example showing how to use the SignUp component on a public page in a Next.js application.

LANGUAGE: tsx
CODE:
import { SignUp, useUser } from '@clerk/nextjs'

export default function Home() {
  const { user } = useUser()

  if (!user) return <SignUp />

  return <div>Welcome!</div>
}

----------------------------------------

TITLE: Accessing Nested Metadata Fields in JWT Template Shortcodes
DESCRIPTION: This snippet shows how to access nested fields within user metadata using dot notation in shortcodes. It demonstrates accessing an array of interests and a specific address from the metadata.

LANGUAGE: json
CODE:
{
  "likes_to_do": "{{user.public_metadata.interests}}",
  "shipping_address": "{{user.public_metadata.addresses.Home}}"
}

----------------------------------------

TITLE: Rendering UserProfile Component in Vue
DESCRIPTION: Example of how to use the <UserProfile /> component in a Vue application.

LANGUAGE: vue
CODE:
<script setup>
import { UserProfile } from '@clerk/vue'
</script>

<template>
  <UserProfile />
</template>

----------------------------------------

TITLE: Defining getInvitationList Function in TypeScript
DESCRIPTION: Function signature for getInvitationList, which retrieves a list of non-revoked invitations. It returns a Promise resolving to a PaginatedResourceResponse containing an array of Invitation objects.

LANGUAGE: typescript
CODE:
function getInvitationList(
  params: GetInvitationListParams,
): Promise<PaginatedResourceResponse<Invitation[]>>

----------------------------------------

TITLE: Handling Invalid Subscription Plan Switch Error - JSON
DESCRIPTION: Error response when attempting to switch to a plan that doesn't support currently used features

LANGUAGE: json
CODE:
{
  "shortMessage": "Unsupported plan features",
  "longMessage": "Some application features are not supported in your new plan. Stay with your current plan to avoid breaking changes.",
  "code": "invalid_subscription_plan_switch_code"
}

----------------------------------------

TITLE: Creating Email Address Example Usage
DESCRIPTION: Example showing how to create a new email address for a user using the Clerk client, including setting primary and verification status.

LANGUAGE: tsx
CODE:
const response = await clerkClient.emailAddresses.createEmailAddress({
  userId: 'user_123',
  emailAddress: 'testclerk123@gmail.com',
  primary: true,
  verified: true,
})

----------------------------------------

TITLE: UpdateSecondFactorUnverified Error Response
DESCRIPTION: JSON response when attempting to update second factor attributes for an unverified identification, which must be verified first.

LANGUAGE: json
CODE:
{
  "shortMessage": "Update failed",
  "longMessage": "Cannot update second factor attributes for unverified identification",
  "code": "identification_update_second_factor_unverified"
}

----------------------------------------

TITLE: Setting Clerk API Key in Environment File
DESCRIPTION: Adding the Clerk Publishable Key to the .env file for use in the Expo app.

LANGUAGE: env
CODE:
EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}

----------------------------------------

TITLE: Typing useLocalCredentials Hook Return Values in TypeScript
DESCRIPTION: Defines the return type of the useLocalCredentials() hook, including various boolean flags, biometric type, and methods for managing credentials and authentication.

LANGUAGE: typescript
CODE:
interface UseLocalCredentialsReturn {
  hasCredentials: boolean;
  userOwnsCredentials: boolean;
  biometricType: 'face-recognition' | 'fingerprint' | null;
  setCredentials: (params: LocalCredentials) => Promise<void>;
  clearCredentials: () => Promise<void>;
  authenticate: () => Promise<SignInResource>;
}

----------------------------------------

TITLE: Protected Routes with Clerk Authentication
DESCRIPTION: Demonstrates how to protect routes using Clerk's auth filter. When applied, unauthenticated users will be redirected to the sign-in page by default.

LANGUAGE: ruby
CODE:
require "clerk/sinatra"
require "sinatra/base"

class App < Sinatra::Base
  register Sinatra::Clerk

  get "/" do
    erb :index, format: :html5
  end

  # Protect the "/admin" route with the `auth` filter
  # If the user is not authenticated, they will be redirected to the sign-in page
  get "/admin", auth: true do
    @user = clerk.user
    erb :admin, format: :html5
  end

  run! if app_file == $0
end

----------------------------------------

TITLE: Defining SignInSecondFactor Union Type in TypeScript
DESCRIPTION: Defines a union type for different second factor authentication strategies including phone code, TOTP, and backup codes.

LANGUAGE: typescript
CODE:
type SignInSecondFactor = PhoneCodeFactor | TOTPFactor | BackupCodeFactor

----------------------------------------

TITLE: Shell Command Installation Example
DESCRIPTION: Example of a shell command block showing package installation with environment variables.

LANGUAGE: bash
CODE:
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Defining ClerkPaginatedResponse Interface in TypeScript
DESCRIPTION: This snippet defines the ClerkPaginatedResponse interface, which includes an array of generic type T for the data and a number for the total count of remote data. It's used in Clerk's SDKs for methods returning paginated resources.

LANGUAGE: typescript
CODE:
interface ClerkPaginatedResponse<T> {
  data: T[];
  totalCount: number;
}

----------------------------------------

TITLE: Getting SAML Connection Type Definition
DESCRIPTION: TypeScript function signature for retrieving a SAML connection by ID. Returns a Promise that resolves to a SamlConnection object.

LANGUAGE: typescript
CODE:
function getSamlConnection(samlConnectionId: string): Promise<SamlConnection>

----------------------------------------

TITLE: Customizing Multiple Entries for SignUp Component
DESCRIPTION: Demonstrates how to customize multiple localization entries for the SignUp component.

LANGUAGE: typescript
CODE:
const localization = {
  signUp: {
    start: {
      subtitle: 'to access {{applicationName}}',
    },
    emailCode: {
      subtitle: 'to access {{applicationName}}',
    },
  },
}

----------------------------------------

TITLE: Defining LocalCredentials Interface in TypeScript
DESCRIPTION: Defines the structure for the LocalCredentials object used in the setCredentials() method. It includes optional identifier and required password properties.

LANGUAGE: typescript
CODE:
interface LocalCredentials {
  identifier?: string;
  password: string;
}

----------------------------------------

TITLE: Updating SignOutButton Component
DESCRIPTION: Example of updating the SignOutButton component to use the new redirectUrl prop instead of signOutCallback.

LANGUAGE: jsx
CODE:
<SignOutButton redirectUrl="/your-path">
  <button>Sign Out</button>
</SignOutButton>

----------------------------------------

TITLE: Retrieving Allowlist Identifiers with Clerk Backend SDK in TypeScript
DESCRIPTION: Function signature for `getAllowlistIdentifierList()`. It returns a Promise that resolves to a PaginatedResourceResponse containing an array of AllowlistIdentifier objects and a total count.

LANGUAGE: typescript
CODE:
function getAllowlistIdentifierList(): Promise<PaginatedResourceResponse<AllowlistIdentifier[]>>

----------------------------------------

TITLE: Implementing CreateOrganization in Astro
DESCRIPTION: Example of using the CreateOrganization component in an Astro application. The component is imported from '@clerk/astro/components' and used directly in the Astro template.

LANGUAGE: astro
CODE:
---
import { CreateOrganization } from '@clerk/astro/components'
---

<CreateOrganization />

----------------------------------------

TITLE: Defining CaptchaInvalid Error in JSON for Clerk
DESCRIPTION: This snippet defines the JSON structure for the CaptchaInvalid error in Clerk. It includes a short message indicating an invalid token and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid token",
  "code": "captcha_invalid"
}

----------------------------------------

TITLE: Implementing Client-Side Authentication UI
DESCRIPTION: Example of using Clerk's prebuilt components for client-side authentication UI

LANGUAGE: typescript
CODE:
import {
  SignInButton,
  SignOutButton,
  SignUpButton,
  SignedIn,
  SignedOut,
  UserButton,
} from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <h1>Index Route</h1>
      <SignedIn>
        <p>You are signed in!</p>
        <UserButton />
      </SignedIn>
      <SignedOut>
        <p>You are signed out</p>
        <SignInButton />
      </SignedOut>
    </div>
  )
}

----------------------------------------

TITLE: Updating Organization.create method
DESCRIPTION: Example of updating the Organization.create method to use an object parameter instead of a string.

LANGUAGE: javascript
CODE:
Organization.create('...')
Organization.create({ name: '...' })

----------------------------------------

TITLE: Using deleteUserProfileImage with Clerk Client
DESCRIPTION: Example usage of the deleteUserProfileImage method with the Clerk client. Demonstrates how to delete a user's profile image using the Backend SDK.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const response = await clerkClient.users.deleteUserProfileImage(userId)

----------------------------------------

TITLE: Handling Duplicate Blocklist Identifier Error in Clerk
DESCRIPTION: Error response structure when attempting to create a blocklist identifier that already exists in the system

LANGUAGE: json
CODE:
{
  "shortMessage": "duplicate blocklist identifier",
  "longMessage": "the identifier <identifier> already exists",
  "code": "duplicate_record_code"
}

----------------------------------------

TITLE: Defining ResetPasswordPhoneCodeFactor Type in TypeScript
DESCRIPTION: This snippet defines the ResetPasswordPhoneCodeFactor type, which represents the reset password via phone code strategy. It includes properties for strategy, phoneNumberId, safeIdentifier, and primary status.

LANGUAGE: typescript
CODE:
type ResetPasswordPhoneCodeFactor = {
  strategy: ResetPasswordPhoneCodeStrategy
  phoneNumberId: string
  safeIdentifier: string
  primary?: boolean
}

----------------------------------------

TITLE: Defining Session Verification Parameters Types - TypeScript
DESCRIPTION: Type definitions for session verification parameters including email code, phone code and password verification strategies.

LANGUAGE: typescript
CODE:
type SessionVerifyAttemptFirstFactorParams = EmailCodeAttempt | PhoneCodeAttempt | PasswordAttempt

type EmailCodeAttempt = {
  strategy: 'email_code'
  code: string
}

type PhoneCodeAttempt = {
  strategy: 'phone_code'
  code: string
}

type PasswordAttempt = {
  strategy: 'password'
  password: string
}

----------------------------------------

TITLE: Accessing Clerk with Fetch API in TypeScript
DESCRIPTION: Demonstrates how to use getClerkInstance() with the Fetch API to make authenticated requests. The function retrieves a session token and includes it as a Bearer token in the Authorization header.

LANGUAGE: typescript
CODE:
import { getClerkInstance } from '@clerk/clerk-expo'

export async function fetchFoo() {
  const clerkInstance = getClerkInstance()
  const token = await clerkInstance.session?.getToken()

  const response = await fetch('/api/foo', {
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json',
    },
  })

  if (!response.ok) {
    throw new Error(`API Error: ${response.status} ${response.statusText}`)
  }

  return response.json()
}

----------------------------------------

TITLE: Accessing Session List with useSessionList() in Vue
DESCRIPTION: This snippet demonstrates how to use the useSessionList() composable from Clerk in a Vue component. It retrieves the list of sessions and displays the number of times the user has visited the page.

LANGUAGE: vue
CODE:
<script setup>
import { useSessionList } from '@clerk/vue'

const { isLoaded, sessions } = useSessionList()
</script>

<template>
  <div v-if="!isLoaded">
    <!-- Handle loading state -->
  </div>

  <div v-else>
    <p>Welcome back. You've been here {{ sessions.length }} times before.</p>
  </div>
</template>

----------------------------------------

TITLE: Accepting Organization Membership Request in TypeScript
DESCRIPTION: Method to accept a pending request from a user to join an organization. Returns a Promise that resolves to the updated OrganizationMembershipRequest object.

LANGUAGE: typescript
CODE:
function accept(): Promise<OrganizationMembershipRequest>

----------------------------------------

TITLE: Configuring Clerk SDK with Secret Key and Logger in Ruby
DESCRIPTION: This code snippet shows how to configure the Clerk SDK by setting the secret key and configuring a logger. The secret key is required for API calls and can be retrieved from the Clerk Dashboard. The logger is optional and set to output to STDOUT in this example.

LANGUAGE: ruby
CODE:
Clerk.configure do |c|
  c.secret_key = `{{secret}}` # if omitted: ENV["CLERK_SECRET_KEY"] - API calls will fail if unset
  c.logger = Logger.new(STDOUT) # if omitted, no logging
end

----------------------------------------

TITLE: Organization Suggestion Interface TypeScript Definition
DESCRIPTION: Interface definition containing properties for organization suggestions including ID, public organization data, status, and timestamps. The interface includes details about the organization's image, name, slug, and tracking information.

LANGUAGE: typescript
CODE:
function accept(): Promise<OrganizationSuggestionResource>

----------------------------------------

TITLE: Implementing Auth Store in Svelte
DESCRIPTION: Demonstrates $authStore implementation in Svelte components, showing how to handle naming conflicts with Svelte's reactivity system and conditional rendering of authentication states.

LANGUAGE: svelte
CODE:
<script>
  // The $ prefix is reserved in Svelte for its own reactivity system.
  // Alias the imports to avoid conflicts.
  import { $authStore as auth } from '@clerk/astro/client'
</script>

{#if $auth.userId === undefined}
  <div>Loading...</div>
{:else if $auth.userId === null}
  <div>Sign in to view this page</div>
{:else}
  <div>...</div>
{/if}

----------------------------------------

TITLE: Handling Unsupported Subscription Plan Features Error - JSON
DESCRIPTION: Error response when attempting to access features not supported in the current subscription plan

LANGUAGE: json
CODE:
{
  "shortMessage": "Unsupported plan features",
  "longMessage": "Some features are not supported in your current plan. Upgrade your subscription to unlock them.",
  "code": "unsupported_subscription_plan_features_code"
}

----------------------------------------

TITLE: Converting EmailAddress to String in TypeScript
DESCRIPTION: Returns the value of the email address as a string.

LANGUAGE: typescript
CODE:
function toString(): string

----------------------------------------

TITLE: Implementing RedirectToUserProfile in Next.js
DESCRIPTION: Example of using the RedirectToUserProfile component within a Next.js application's _app.tsx file. Demonstrates integration with ClerkProvider and conditional rendering based on authentication state.

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, RedirectToUserProfile } from '@clerk/nextjs'
import { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider {...pageProps}>
      <SignedIn>
        <RedirectToUserProfile />
      </SignedIn>
      <SignedOut>
        <p>You need to sign in to view your user profile.</p>
      </SignedOut>
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Updating Organization Invitation Retrieval
DESCRIPTION: Example of changing the method to retrieve pending organization invitations.

LANGUAGE: javascript
CODE:
Organization.getInvitations({ status: 'pending' })

----------------------------------------

TITLE: IdentificationNotFound Error Response
DESCRIPTION: JSON response structure when a requested identification resource cannot be found in the system.

LANGUAGE: json
CODE:
{
  "shortMessage": "Resource not found",
  "longMessage": "No resource was found for ID <resourceID>",
  "code": "resource_not_found_code"
}

----------------------------------------

TITLE: Wrapping Remix App with ClerkApp
DESCRIPTION: Demonstrates how to wrap the main App component with ClerkApp to provide authentication state. This code should be placed in the app/root.tsx file of a Remix project.

LANGUAGE: tsx
CODE:
// The rest of your code

function App() {
  return (
    <html lang="en">
      <head>
        <Meta />
        <Links />
      </head>
      <body>
        <Outlet />
        <ScrollRestoration />
        <Scripts />
        <LiveReload />
      </body>
    </html>
  )
}

// Wrap your app with `ClerkApp`
export default ClerkApp(App)

----------------------------------------

TITLE: Defining SignUpOutdatedVerification Error in JSON for Clerk
DESCRIPTION: This snippet defines the JSON structure for the SignUpOutdatedVerification error in Clerk. It includes a short message, a long message explaining the outdated verification, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Outdated verification",
  "longMessage": "There is a more recent verification pending for this signup. Try attempting the verification again.",
  "code": "sign_up_outdated_verification"
}

----------------------------------------

TITLE: Implementing Conditional Content View
DESCRIPTION: Creates a ContentView that conditionally renders content based on user authentication status using the Clerk environment instance.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct ContentView: View {
  @Environment(Clerk.self) private var clerk

  var body: some View {
    VStack {
      if let user = clerk.user {
        Text("Hello, \(user.id)")
      } else {
        Text("You are signed out")
      }
    }
  }
}

----------------------------------------

TITLE: Preparing Second Factor Authentication in Clerk
DESCRIPTION: Example of preparing the second factor authentication using a phone code strategy in Clerk's SignIn object.

LANGUAGE: javascript
CODE:
const signIn = await clerk.signIn.prepareSecondFactor({
  strategy: 'phone_code',
  phoneNumberId: '123',
})

----------------------------------------

TITLE: External Account Integration Example
DESCRIPTION: Complete example showing how to integrate an external OAuth provider (Notion) with HTML structure and JavaScript implementation.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="app"></div>

    <p>
      Notion verification status:
      <span id="notion-status"></span>
    </p>
    <button id="add-notion">Add Notion as a social connection</button>

    <script type="module" src="/main.js"></script>
  </body>
</html>

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(pubKey)
await clerk.load()

if (clerk.user) {
  const externalAccount = clerk.user.externalAccounts.find((p) => p.provider === 'notion')
  document.getElementById('notion-status').innerHTML = externalAccount.verification.status

  document.getElementById('add-notion').addEventListener('click', async () => {
    clerk.user
      .createExternalAccount({ strategy: 'oauth_notion', redirect_url: '/' })
      .then((externalAccount) => {
        window.location.href = externalAccount.verification.externalVerificationRedirectURL
      })
      .catch((error) => {
        console.log('An error occurred:', error.errors)
      })
  })
} else {
  document.getElementById('app').innerHTML = `
    <div id="sign-in"></div>
  `

  const signInDiv = document.getElementById('sign-in')

  clerk.mountSignIn(signInDiv)
}

----------------------------------------

TITLE: Creating Organization Invitation with cURL in Clerk
DESCRIPTION: This snippet demonstrates how to create an organization invitation using a cURL command to interact with Clerk's Backend API. It includes parameters for the organization ID, inviter user ID, invitee email address, and role.

LANGUAGE: bash
CODE:
curl 'https://api.clerk.com/v1/organizations/{org_123}/invitations' \
-X POST \
-H 'Authorization: Bearer {{secret}}' \
-H 'Content-Type: application/json' \
-d '{ "inviter_user_id": "user_123", "email_address": "email@example.com", "role": "org:member" }'

----------------------------------------

TITLE: Defining revokeInvitation Function - TypeScript
DESCRIPTION: TypeScript function signature for revoking a Clerk invitation. Takes an invitation ID as input and returns a Promise resolving to an Invitation object.

LANGUAGE: typescript
CODE:
function revokeInvitation(invitationId: string): Promise<Invitation>

----------------------------------------

TITLE: Using Clerk Loading Component
DESCRIPTION: Shows how to use the Loading component to handle loading states in different scopes of a sign-in flow.

LANGUAGE: tsx
CODE:
<SignIn.Root>
  <Clerk.Loading>
    {(isGlobalLoading) => (isGlobalLoading ? 'Global Loading...' : 'Global')}
  </Clerk.Loading>
  <SignIn.Step name="start">
    <Clerk.Connection name="google">
      <Clerk.Loading scope="provider:google">
        {(isLoading) => (isLoading ? 'Loading...' : 'Continue with Google')}
      </Clerk.Loading>
    </Clerk.Connection>
    <SignIn.Action submit>
      <Clerk.Loading>{(isLoading) => (isLoading ? 'Loading...' : 'Submit')}</Clerk.Loading>
    </SignIn.Action>
  </SignIn.Step>
</SignIn.Root>

----------------------------------------

TITLE: Creating Backup Codes Example
DESCRIPTION: Demonstrates how to generate backup codes for a user's account using the createBackupCode() method.

LANGUAGE: javascript
CODE:
await clerk.user.createBackupCode()

----------------------------------------

TITLE: Implementing Clerk Logo Using SVG Path
DESCRIPTION: Defines the Clerk logo as an SVG with a 32x32 viewBox containing a complex path element filled with a reddish-brown color (#BF4722). The path data describes the geometric shapes that make up the Clerk logo using SVG path commands.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 32 32" fill="none">
  <path
    fill="#BF4722"
    d="m9.317 4.627 6.214 4.241c.14.094.304.144.472.148a.845.845 0 0 0 .472-.148l6.218-4.256a.85.85 0 0 0-.118-1.449L16.36.087a.853.853 0 0 0-.746 0L9.42 3.163a.848.848 0 0 0-.104 1.464Zm8.796 5.572a.86.86 0 0 0 .368.704l4.982 3.404a.837.837 0 0 0 1.034-.067l4.179-3.737a.849.849 0 0 0-.037-1.297l-3.99-3.191a.847.847 0 0 0-1.001-.039L18.483 9.51a.859.859 0 0 0-.37.689ZM5.725 14.831a.853.853 0 0 1 .148 1.092.834.834 0 0 1-.29.272L2.61 17.978a.84.84 0 0 1-.957-.066.853.853 0 0 1-.28-.924l1.1-3.461a.84.84 0 0 1 1.364-.375l1.89 1.679Zm16.134.361-5.378-3.68a.845.845 0 0 0-.944 0l-5.377 3.68a.861.861 0 0 0-.368.647.885.885 0 0 0 .283.695l5.373 4.806a.847.847 0 0 0 1.123 0l5.373-4.806a.861.861 0 0 0-.085-1.342Zm-14.344-.95L3.34 10.504a.864.864 0 0 1-.284-.67.835.835 0 0 1 .316-.642l3.99-3.209a.855.855 0 0 1 1.005-.039l5.16 3.534a.852.852 0 0 1 0 1.426l-4.976 3.404a.844.844 0 0 1-1.037-.066Zm21.43 5.368-4.25-2.544a.837.837 0 0 0-.991.094l-5.193 4.636a.858.858 0 0 0-.097 1.172c.09.113.208.2.342.255l7.205 2.92a.846.846 0 0 0 1.087-.443l2.233-5.002a.854.854 0 0 0-.336-1.088Zm.59-6.082 1.1 3.462h-.01a.847.847 0 0 1-1.236.989l-2.978-1.783a.831.831 0 0 1-.407-.646.842.842 0 0 1 .279-.718l1.888-1.682a.841.841 0 0 1 1.364.378Zm-15.76 9.048a.849.849 0 0 0-.27-.78L8.312 17.16a.836.836 0 0 0-.992-.094L3.07 19.61a.864.864 0 0 0-.34 1.084l2.238 5.002a.843.843 0 0 0 1.085.443l7.2-2.92a.849.849 0 0 0 .522-.643Zm2.549 1.427 5.779 2.34a.85.85 0 0 1 .509.695.847.847 0 0 1-.359.794L16.47 31.85A.833.833 0 0 1 16 32a.853.853 0 0 1-.472-.152l-5.779-4.017a.847.847 0 0 1 .165-1.49l5.779-2.34c.203-.08.43-.08.632.002Z"
  />
</svg>

----------------------------------------

TITLE: Defining CustomOAuthStrategy Type in TypeScript
DESCRIPTION: Defines the CustomOAuthStrategy type for custom OAuth providers. It uses a template literal type to create a string in the format 'oauth_custom_' followed by any string.

LANGUAGE: typescript
CODE:
type CustomOAuthStrategy = `oauth_custom_${string}`

----------------------------------------

TITLE: Defining ActorTokenCanBeUsedOnlyInSignIn Error in JSON
DESCRIPTION: This snippet defines the error response for an actor token used outside of the sign-in process. It includes a short message, long message, and error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "not in sign in",
  "longMessage": "Actor tokens can only be used during sign in.",
  "code": "actor_token_not_in_sign_in_code"
}

----------------------------------------

TITLE: Defining startSSOFlow Function Signature in TypeScript
DESCRIPTION: This snippet shows the TypeScript function signature for the startSSOFlow method returned by the useSSO() hook. It defines the parameters and return type for initiating an SSO flow.

LANGUAGE: typescript
CODE:
function startSSOFlow(startSSOFlowParams: StartSSOFlowParams): Promise<StartSSOFlowReturnType>

----------------------------------------

TITLE: Basic SignUpButton Implementation - Astro
DESCRIPTION: Implementation of the SignUpButton component in Astro framework.

LANGUAGE: astro
CODE:
---
import { SignUpButton } from '@clerk/astro/components'
---

<SignUpButton />

----------------------------------------

TITLE: Updating UserButton Component
DESCRIPTION: Example of removing the explicit afterSignOutUrl prop from the UserButton component.

LANGUAGE: jsx
CODE:
<UserButton />

----------------------------------------

TITLE: Creating Sign In View
DESCRIPTION: Implements a SignInView for user authentication using email and password credentials.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct SignInView: View {
  @State private var email = ""
  @State private var password = ""

  var body: some View {
    VStack {
      Text("Sign In")
      TextField("Email", text: $email)
      SecureField("Password", text: $password)
      Button("Continue") {
        Task { await submit(email: email, password: password) }
      }
    }
    .padding()
  }
}

extension SignInView {

  func submit(email: String, password: String) async {
    do {
      try await SignIn.create(
        strategy: .identifier(email, password: password)
      )
    } catch {
      dump(error)
    }
  }

}

----------------------------------------

TITLE: Defining ActorTokenRevoked Error in JSON
DESCRIPTION: This snippet defines the error response for a revoked actor token. It includes a short message, long message, and error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "actor token has been revoked",
  "longMessage": "This actor token has been revoked and cannot be used anymore.",
  "code": "actor_token_revoked_code"
}

----------------------------------------

TITLE: Fetching Long-lived JWT Token in Browser Console
DESCRIPTION: JavaScript command to retrieve a long-lived JWT token using the Clerk session object. This token can be used for API testing in Postman or Insomnia.

LANGUAGE: javascript
CODE:
await window.Clerk.session.getToken({ template: '<the template name you chose above>' })

----------------------------------------

TITLE: SignInButton Implementation in Astro
DESCRIPTION: Illustrates how to use the SignInButton component in an Astro application, including the necessary import statement and component usage.

LANGUAGE: astro
CODE:
---
import { SignInButton } from '@clerk/astro/components'
---

<SignInButton />

----------------------------------------

TITLE: Using SignedOut Component in Vue
DESCRIPTION: This snippet demonstrates how to implement the SignedOut component in a Vue application. It shows the component usage within a Vue template and script setup.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { SignedOut } from '@clerk/vue'
</script>

<template>
  <SignedOut>
    <div>You are signed out</div>
  </SignedOut>
  <p>This content is always visible.</p>
</template>

----------------------------------------

TITLE: Defining getPhoneNumber Function in TypeScript
DESCRIPTION: Function signature for retrieving a single PhoneNumber object by its ID. It takes a phoneNumberId as a string parameter and returns a Promise that resolves to a PhoneNumber object.

LANGUAGE: typescript
CODE:
function getPhoneNumber(phoneNumberId: string): Promise<PhoneNumber>

----------------------------------------

TITLE: IdentifierNotAllowedAccess Error JSON Response
DESCRIPTION: JSON response structure for an identifier not allowed access error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Access not allowed.",
  "longMessage": "You are not allowed to access this application.",
  "code": "identifier_not_allowed_access_code"
}

----------------------------------------

TITLE: Revoking Organization Invitation Example with Clerk Backend SDK
DESCRIPTION: Example usage of the revokeOrganizationInvitation function from Clerk's Backend SDK. It demonstrates how to revoke an organization invitation by providing the necessary parameters: organizationId, invitationId, and requestingUserId.

LANGUAGE: typescript
CODE:
const organizationId = 'org_123'

const invitationId = 'orginv_123'

const requestingUserId = 'user_123'

const response = await clerkClient.organizations.revokeOrganizationInvitation({
  organizationId,
  invitationId,
  requestingUserId,
})

----------------------------------------

TITLE: Using getToken() Method in Next.js App Router
DESCRIPTION: This example shows how to use the getToken() method in a Next.js App Router API route. It retrieves a custom JWT token using a specified template name.

LANGUAGE: typescript
CODE:
import { auth } from '@clerk/nextjs/server'

export async function GET() {
  const { getToken } = await auth()

  const template = 'supabase'

  const token = await getToken({ template })

  return Response.json({ token })
}

----------------------------------------

TITLE: Updating Store Imports
DESCRIPTION: Changes required for importing Clerk stores, replacing the old stores submodule with the new client submodule.

LANGUAGE: javascript
CODE:
import { $clerkStore } from '@clerk/astro/client'
import { $userStore } from '@clerk/astro/client'
import { $sessionStore } from '@clerk/astro/client'

----------------------------------------

TITLE: Accessing User Data in Remix Loader Function
DESCRIPTION: Example of using getAuth() helper in a Remix loader function to retrieve user data and protect routes. The code demonstrates checking authentication status and fetching full user details using the Clerk Backend SDK.

LANGUAGE: typescript
CODE:
import { LoaderFunction, redirect } from '@remix-run/node'
import { getAuth } from '@clerk/remix/ssr.server'
import { createClerkClient } from '@clerk/remix/api.server'

export const loader: LoaderFunction = async (args) => {
  // Use `getAuth()` to retrieve the user's ID
  const { userId } = await getAuth(args)

  // If there is no userId, then redirect to sign-in route
  if (!userId) {
    return redirect('/sign-in?redirect_url=' + args.request.url)
  }

  // Initialize the Backend SDK and get the user's full `Backend User` object
  const user = await createClerkClient({ secretKey: process.env.CLERK_SECRET_KEY }).users.getUser(
    userId,
  )

  // Return the retrieved user data
  return { serialisedUser: JSON.stringify(user) }
}

----------------------------------------

TITLE: Handling OAuth Redirect Callback in TypeScript
DESCRIPTION: Method to complete custom OAuth flow initiated by SignIn or SignUp authenticate with redirect calls. Takes parameters for redirect URLs and custom navigation handling.

LANGUAGE: typescript
CODE:
function handleRedirectCallback(
  params: HandleOAuthCallbackParams,
  customNavigate?: ((to: string) => Promise<unknown>) | undefined,
): Promise<unknown>

----------------------------------------

TITLE: Preparing Web3 Wallet Verification in Clerk
DESCRIPTION: This method initiates a verification process for a Web3 wallet by sending the wallet address to the server and retrieving a nonce that must be cryptographically signed by the wallet.

LANGUAGE: typescript
CODE:
function prepareWeb3WalletVerification(
  params?: PrepareWeb3WalletVerificationParams,
): Promise<SignUpResource>

----------------------------------------

TITLE: Responsive Bank Logo SVG with Theme Support
DESCRIPTION: SVG vector graphic that defines a stylized 'B' logo mark using path elements. Includes dynamic fill color that switches between dark and light themes using CSS variables. The viewBox is set to 32x32 units.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 32 32" style={{ fill: 'var(--light, #121212) var(--dark, white)' }}>
  <path
    fillRule="evenodd"
    d="M27.267 24.297c.26 3.4.26 4.994.26 6.734h-7.744c0-.379.007-.726.013-1.077.021-1.093.043-2.233-.131-4.534-.23-3.37-1.659-4.118-4.285-4.118H3.2v-6.13h12.55c3.317 0 4.976-1.026 4.976-3.74 0-2.387-1.66-3.833-4.976-3.833H3.199V1.6h13.932c7.51 0 11.242 3.603 11.242 9.36 0 4.305-2.626 7.113-6.174 7.58 2.995.609 4.746 2.34 5.068 5.757Z"
    clipRule="evenodd"
  />

  <path d="M3.2 31.031v-4.57h8.188c1.368 0 1.665 1.03 1.665 1.645v2.925H3.199Z" />
</svg>

----------------------------------------

TITLE: Attempting Verification in Clerk
DESCRIPTION: This method attempts to complete a pending verification process for the specified verification strategy. It must be called after initiating verification via SignUp.prepareVerification().

LANGUAGE: typescript
CODE:
function attemptVerification(params: AttemptVerificationParams): Promise<SignUp>

----------------------------------------

TITLE: Creating Combined Sign Up/Sign In View
DESCRIPTION: Implements a container view that allows users to toggle between sign up and sign in forms.

LANGUAGE: swift
CODE:
import SwiftUI

struct SignUpOrSignInView: View {
  @State private var isSignUp = true

  var body: some View {
    ScrollView {
      if isSignUp {
        SignUpView()
      } else {
        SignInView()
      }

      Button {
        isSignUp.toggle()
      } label: {
        if isSignUp {
          Text("Already have an account? Sign In")
        } else {
          Text("Don't have an account? Sign Up")
        }
      }
      .padding()
    }
  }
}

----------------------------------------

TITLE: NoSecondFactorsForStrategy Error in JSON for Clerk Sign-in
DESCRIPTION: Indicates that no second factors were found for the specified strategy. The longMessage includes a placeholder for the strategy name.

LANGUAGE: json
CODE:
{
  "shortMessage": "no second factors",
  "longMessage": "No second factors were found for strategy <strategy>.",
  "code": "no_second_factors"
}

----------------------------------------

TITLE: Installing Clerk Remix SDK
DESCRIPTION: Commands for installing the @clerk/remix package using different package managers

LANGUAGE: bash
CODE:
npm install @clerk/remix

LANGUAGE: bash
CODE:
yarn add @clerk/remix

LANGUAGE: bash
CODE:
pnpm add @clerk/remix

LANGUAGE: bash
CODE:
bun add @clerk/remix

----------------------------------------

TITLE: Updating JWT Import Paths
DESCRIPTION: Example of updating import paths for JWT-related functions to the new location.

LANGUAGE: javascript
CODE:
// Old
import { verifyJwt } from '@clerk/backend'

// New
import { verifyJwt } from '@clerk/backend/jwt'

----------------------------------------

TITLE: Updating SAML Connection Function Definition
DESCRIPTION: TypeScript function signature for updating a SAML connection with specified parameters

LANGUAGE: typescript
CODE:
function updateSamlConnection(
  samlConnectionId: string,
  params: UpdateSamlConnectionParams = {},
): Promise<Organization>

----------------------------------------

TITLE: Implementing Custom Invitation Sign-up Flow in Next.js
DESCRIPTION: This TypeScript code creates a custom sign-up page in Next.js that handles application invitations. It extracts the invitation token from the URL, collects user information, and uses the Clerk API to complete the sign-up process.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useSignUp, useUser } from '@clerk/nextjs'
import { useSearchParams, useRouter } from 'next/navigation'

export default function Page() {
  const { user } = useUser()
  const router = useRouter()
  const { isLoaded, signUp, setActive } = useSignUp()
  const [firstName, setFirstName] = React.useState('')
  const [lastName, setLastName] = React.useState('')
  const [password, setPassword] = React.useState('')

  // Handle signed-in users visiting this page
  // This will also redirect the user once they finish the sign-up process
  React.useEffect(() => {
    if (user?.id) {
      router.push('/')
    }
  }, [user])

  // Get the token from the query params
  const token = useSearchParams().get('__clerk_ticket')

  // If there is no invitation token, restrict access to this page
  if (!token) {
    return <p>No invitation token found.</p>
  }

  // Handle submission of the sign-up form
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!isLoaded) return

    try {
      if (!token) return null

      // Create a new sign-up with the supplied invitation token.
      // Make sure you're also passing the ticket strategy.
      // After the below call, the user's email address will be
      // automatically verified because of the invitation token.
      const signUpAttempt = await signUp.create({
        strategy: 'ticket',
        ticket: token,
        firstName,
        lastName,
        password,
      })

      // If the sign-up was completed, set the session to active
      if (signUpAttempt.status === 'complete') {
        await setActive({ session: signUpAttempt.createdSessionId })
      } else {
        // If the status is not complete, check why. User may need to
        // complete further steps.
        console.error(JSON.stringify(signUpAttempt, null, 2))
      }
    } catch (err) {
      console.error(JSON.stringify(err, null, 2))
    }
  }

  return (
    <>
      <h1>Sign up</h1>
      <form onSubmit={handleSubmit}>
        <div>
          <label htmlFor="firstName">Enter first name</label>
          <input
            id="firstName"
            type="text"
            name="firstName"
            value={firstName}
            onChange={(e) => setFirstName(e.target.value)}
          />
        </div>
        <div>
          <label htmlFor="lastName">Enter last name</label>
          <input
            id="lastName"
            type="text"
            name="lastName"
            value={lastName}
            onChange={(e) => setLastName(e.target.value)}
          />
        </div>
        <div>
          <label htmlFor="password">Enter password</label>
          <input
            id="password"
            type="password"
            name="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
          />
        </div>
        <div>
          <button type="submit">Next</button>
        </div>
      </form>
    </>
  )
}

----------------------------------------

TITLE: Implementing $sessionStore in React with TypeScript
DESCRIPTION: React component using $sessionStore to access and display the user's session last active time. Includes handling for loading and signed-out states.

LANGUAGE: tsx
CODE:
import { useStore } from '@nanostores/react'
import { $sessionStore } from '@clerk/astro/client'

export default function Session() {
  const session = useStore($sessionStore)

  if (session === undefined) {
    // Add logic to handle loading state
    return null
  }

  if (session === null) {
    // Add logic to handle not signed in state
    return null
  }

  return (
    <div>
      <p>This session has been active since {session.lastActiveAt.toLocaleString()}</p>
    </div>
  )
}

----------------------------------------

TITLE: Handling ClientNotFoundInRequest Error in Clerk
DESCRIPTION: Error response structure when a request requires a client but none is found in the incoming request context. Returns a client not found error with descriptive messages.

LANGUAGE: json
CODE:
{
  "shortMessage": "No client found",
  "longMessage": "This request is expecting a client and did not find one",
  "code": "client_not_found_code"
}

----------------------------------------

TITLE: Setting Clerk API Keys in Environment Variables
DESCRIPTION: Example of setting Clerk API keys in a .env file for a Nuxt application.

LANGUAGE: env
CODE:
NUXT_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
NUXT_CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Delete Email Address Function Signature
DESCRIPTION: TypeScript function signature for deleting an email address, which takes an emailAddressId string parameter and returns a Promise resolving to an EmailAddress object.

LANGUAGE: typescript
CODE:
function deleteEmailAddress(emailAddressId: string): Promise<EmailAddress>

----------------------------------------

TITLE: Auth Object Example With Active Organization
DESCRIPTION: This example demonstrates the structure of the Auth object when there is an active organization. It includes organization-specific properties like orgId, orgRole, and orgPermissions.

LANGUAGE: javascript
CODE:
{
  sessionId: 'sess_123',
  userId: 'user_123',
  orgId: 'org_123',
  orgRole: 'org:admin',
  orgSlug: undefined,
  orgPermissions: ['org:team_settings:manage'], // Custom permissions
  has: [Function (anonymous)],
  getToken: [AsyncFunction (anonymous)],
  claims: {
    azp: 'http://localhost:3000',
    exp: 1666622607,
    iat: 1666622547,
    iss: 'https://clerk.quiet.muskox-85.lcl.dev',
    nbf: 1666622537,
    sid: 'sess_123',
    sub: 'user_123',
  },
}

----------------------------------------

TITLE: Updating SignIn Component with Path Routing
DESCRIPTION: Example of updating the SignIn component to use the new default path routing strategy.

LANGUAGE: jsx
CODE:
<SignIn path="/sign-in" />

----------------------------------------

TITLE: Example Usage of updateOrganizationMetadata
DESCRIPTION: Practical example showing how to update an organization's public metadata using the Clerk Backend SDK. The example demonstrates setting a simple metadata field named 'example'.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const response = await clerkClient.organizations.updateOrganizationMetadata(organizationId, {
  publicMetadata: {
    example: 'metadata',
  },
})

----------------------------------------

TITLE: Mounting UserProfile Component with JavaScript
DESCRIPTION: Example of how to mount the <UserProfile /> component using the Clerk JavaScript SDK.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="user-profile"></div>
`

const userProfileDiv = document.getElementById('user-profile')

clerk.mountUserProfile(userProfileDiv)

----------------------------------------

TITLE: Checking User Authorization with has() Method in Next.js
DESCRIPTION: This snippet demonstrates how to use the has() method to check if a user has a specific permission in a Next.js App Router component. It checks for the 'org:team_settings:manage' permission and conditionally renders content based on the result.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'

export default async function Page() {
  const { has } = await auth()

  const canManage = has({ permission: 'org:team_settings:manage' })

  if (!canManage) return null

  return <h1>Team Settings</h1>
}

----------------------------------------

TITLE: Rendering Clerk Logo SVG with Theme Support
DESCRIPTION: SVG vector graphic implementation of the Clerk logo that dynamically adjusts fill color using CSS variables for light mode (#000020) and dark mode (white). The viewBox is set to 32x32 units.

LANGUAGE: jsx
CODE:
<svg viewBox="0 0 32 32" style={{ fill: 'var(--light, #000020) var(--dark, white)' }}>
  <path
    d="M0 26.778c.057.707.307 1.417.957 2.37.774 1.133 2.102 1.754 3.071.757.653-.674 7.725-13.035 11.133-17.72a1.016 1.016 0 0 1 1.664 0c3.408 4.685 10.48 17.046 11.134 17.72.969.997 2.297.376 3.07-.756.76-1.114.971-1.894.971-2.728 0-.568-11.013-21.064-12.123-22.77-1.066-1.64-1.392-1.998-3.196-2.057h-1.376c-1.804.059-2.129.415-3.197 2.056C11.023 5.32.44 25.01 0 26.36v.418Z"
  />
</svg>

----------------------------------------

TITLE: Retrieving Organization by ID Example
DESCRIPTION: Example showing how to retrieve an organization using its ID with the Clerk client.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const response = await clerkClient.organizations.getOrganization({ organizationId })

----------------------------------------

TITLE: InvalidStrategyForUser Error in JSON for Clerk Sign-in
DESCRIPTION: Represents an error when the chosen verification strategy is not valid for the user's account.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid verification strategy",
  "longMessage": "The verification strategy is not valid for this account",
  "code": "strategy_for_user_invalid"
}

----------------------------------------

TITLE: SignInNoIdentificationForUser Error in JSON for Clerk Sign-in
DESCRIPTION: Represents an error when the given token doesn't have an associated identification for the user who created it.

LANGUAGE: json
CODE:
{
  "shortMessage": "no identification for user",
  "longMessage": "The given token doesn't have an associated identification for the user who created it.",
  "code": "sign_in_no_identification_for_user"
}

----------------------------------------

TITLE: Vanilla JavaScript Organization Switcher Implementation
DESCRIPTION: JavaScript implementation of organization switching using Clerk's JavaScript SDK, including organization listing, switching, and creation functionality.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const clerk = new Clerk('{{pub_key}}')
await clerk.load()

if (clerk.user) {
  // Implementation logic
}

----------------------------------------

TITLE: Using getRedirectUrlList Function with Clerk Client in TypeScript
DESCRIPTION: This example demonstrates how to use the getRedirectUrlList() function with the Clerk client to retrieve the list of redirect URLs. It awaits the response from the API call.

LANGUAGE: typescript
CODE:
const response = await clerkClient.redirectUrls.getRedirectUrlList()

----------------------------------------

TITLE: Installing Clerk Expo SDK
DESCRIPTION: Commands to install the @clerk/clerk-expo package using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/clerk-expo

LANGUAGE: bash
CODE:
yarn add @clerk/clerk-expo

LANGUAGE: bash
CODE:
pnpm add @clerk/clerk-expo

LANGUAGE: bash
CODE:
bun add @clerk/clerk-expo

----------------------------------------

TITLE: Initializing Clerk Commands in Cypress
DESCRIPTION: Sets up Clerk custom commands in the Cypress E2E support file by importing and initializing the commands with Cypress and cy objects.

LANGUAGE: typescript
CODE:
/// <reference types="cypress" />
import { addClerkCommands } from '@clerk/testing/cypress'
addClerkCommands({ Cypress, cy })

export {}

----------------------------------------

TITLE: IdentificationExists Error JSON Response for Email Address
DESCRIPTION: JSON response structure for an existing email address error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "already exists",
  "longMessage": "This email address already exists.",
  "code": "email_address_exists_code"
}

----------------------------------------

TITLE: Implementing SignedOut Component in Tanstack Start
DESCRIPTION: This example illustrates how to use the SignedOut component in a Tanstack Start application. It shows the component usage within a route component created with createFileRoute.

LANGUAGE: tsx
CODE:
import { SignedOut } from '@clerk/tanstack-start'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/')({
  component: Home,
})

function Home() {
  return (
    <div>
      <SignedOut>
        <p>You are signed out.</p>
      </SignedOut>
      <p>This content is always visible.</p>
    </div>
  )
}

----------------------------------------

TITLE: Revoking an Actor Token with Clerk Backend API
DESCRIPTION: This example shows how to revoke an actor token using Clerk's Backend API, even if it's not expired yet.

LANGUAGE: bash
CODE:
curl -X POST https://api.clerk.com/v1/actor_tokens/act_2EL6mQKzeUtoRwGuLZsznyfkIsH/revoke

----------------------------------------

TITLE: Attempting Web3Wallet Verification in TypeScript
DESCRIPTION: Method to complete the verification process using the generated signature.

LANGUAGE: typescript
CODE:
function attemptVerification(params: AttemptWeb3WalletVerificationParams): Promise<Web3Wallet>

----------------------------------------

TITLE: Handling ClientNotFound Error in Clerk
DESCRIPTION: Error response structure when a client cannot be found using the provided clientID. Returns a resource not found error with descriptive messages.

LANGUAGE: json
CODE:
{
  "shortMessage": "Client not found",
  "longMessage": "No client was found with id <clientID>",
  "code": "resource_not_found_code"
}

----------------------------------------

TITLE: Auth Object Example Without MFA Method Registered
DESCRIPTION: This example illustrates the Auth object for a user without a registered MFA method. The factorVerificationAge property is set to [0, -1], indicating no second factor is available.

LANGUAGE: javascript
CODE:
{
  sessionId: 'sess_123',
  userId: 'user_123',
  orgId: null,
  orgRole: null,
  orgSlug: null,
  orgPermissions: null,
  factorVerificationAge: [0, -1],
  has: [Function (anonymous)],
  getToken: [AsyncFunction (anonymous)],
  claims: {
    azp: 'http://localhost:3000',
    exp: 1666622607,
    iat: 1666622547,
    iss: 'https://clerk.quiet.muskox-85.lcl.dev',
    nbf: 1666622537,
    sid: 'sess_123',
    sub: 'user_123',
  },
}

----------------------------------------

TITLE: Framework-specific Auth Object Access Methods
DESCRIPTION: Table showing how to access the Auth object across different frameworks. The Auth object is available on the request object in server contexts, with framework-specific helper methods provided for easier access.

LANGUAGE: markdown
CODE:
| Framework | How to access the `Auth` object |
| - | - |
| Next.js App Router | [`auth()`](/docs/references/nextjs/auth) |
| Next.js Pages Router | [`getAuth()`](/docs/references/nextjs/get-auth) |
| Astro | [`locals.auth()`](/docs/references/astro/locals#locals-auth) |
| Express | [`req.auth`](/docs/references/express/overview) |
| React Router | [`getAuth()`](/docs/references/react-router/get-auth) |
| Remix | [`getAuth()`](/docs/references/remix/read-session-data#get-auth) |
| Tanstack Start | [`getAuth()`](/docs/references/tanstack-start/get-auth) |
| Other | `request.auth` |

----------------------------------------

TITLE: Updating User Password Change Method
DESCRIPTION: Example of changing the method to update a user's password from User.update to User.updatePassword.

LANGUAGE: javascript
CODE:
user.updatePassword({
  currentPassword: 'bar',
  newPassword: 'foo',
  signOutOfOtherSessions: true,
})

----------------------------------------

TITLE: Revoking Sign-In Token Example using Clerk Client
DESCRIPTION: Example usage of the revokeSignInToken method to revoke a specific sign-in token using the Clerk client.

LANGUAGE: tsx
CODE:
const signInTokenId = 'sit_123'

const response = await clerkClient.signInTokens.revokeSignInToken(signInTokenId)

----------------------------------------

TITLE: Creating Settings Route Component with Clerk UserProfile
DESCRIPTION: Implements a Settings component using Clerk's UserProfile component for the settings route.

LANGUAGE: tsx
CODE:
import { UserProfile } from '@clerk/chrome-extension'

export const Settings = () => {
  return (
    <>
      <h1>Settings</h1>
      <UserProfile routing="virtual" />
    </>
  )
}

----------------------------------------

TITLE: Function Definition - Clerk lockUser TypeScript Declaration
DESCRIPTION: TypeScript function signature for the lockUser method that takes a user ID and returns a Promise resolving to a User object.

LANGUAGE: typescript
CODE:
function lockUser(userId: string): Promise<User>

----------------------------------------

TITLE: Configuring Global Setup for Clerk Authentication in Playwright
DESCRIPTION: This TypeScript code sets up global authentication for Playwright tests using Clerk. It signs in a test user and saves the authentication state to a file.

LANGUAGE: typescript
CODE:
import { clerk, clerkSetup } from '@clerk/testing/playwright'
import { test as setup } from '@playwright/test'
import path from 'path'

// Configure Playwright with Clerk
setup('global setup', async ({}) => {
  await clerkSetup()
})

// Define the path to the storage file, which is `user.json`
const authFile = path.join(__dirname, '../playwright/.clerk/user.json')

setup('authenticate and save state to storage', async ({ page }) => {
  // Perform authentication steps.
  // This example uses a Clerk helper to authenticate
  await page.goto('/')
  await clerk.signIn({
    page,
    signInParams: {
      strategy: 'password',
      identifier: process.env.E2E_CLERK_USER_USERNAME!,
      password: process.env.E2E_CLERK_USER_PASSWORD!,
    },
  })
  await page.goto('/protected')
  // Ensure the user has successfully accessed the protected page
  // by checking an element on the page that only the authenticated user can access
  await page.waitForSelector("h1:has-text('This is a PROTECTED page')")

  await page.context().storageState({ path: authFile })
})

----------------------------------------

TITLE: InvalidAuthentication Error JSON Response
DESCRIPTION: JSON response structure for an invalid authentication error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid authentication",
  "longMessage": "Unable to authenticate the request, you need to supply an active session",
  "code": "authentication_invalid_code"
}

----------------------------------------

TITLE: Handling Checkout Session Mismatch Error - JSON
DESCRIPTION: Error response when there is a mismatch between the provided checkout session ID and the application ID

LANGUAGE: json
CODE:
{
  "shortMessage": "Checkout session ID mismatch",
  "longMessage": "Application ID <APPID> has no matching checkout session ID <SESSID>",
  "code": "checkout_session_mismatch_code"
}

----------------------------------------

TITLE: NotAuthorizedToDeleteSystemApplication Error Response in JSON
DESCRIPTION: Error response when a user attempts to delete a system application without proper authorization.

LANGUAGE: json
CODE:
{
  "shortMessage": "Unauthorized request",
  "longMessage": "You are not authorized to delete system application <applicationID>",
  "code": "authorization_invalid_code"
}

----------------------------------------

TITLE: Implementing $sessionStore in Vue
DESCRIPTION: Vue component using $sessionStore to access and display the user's session last active time. Uses v-if directives for conditional rendering of different states.

LANGUAGE: vue
CODE:
<script setup>
import { useStore } from '@nanostores/vue'
import { $sessionStore } from '@clerk/astro/client'

const session = useStore($sessionStore)
</script>

<template>
  <div v-if="session === undefined">
    <!-- Add logic to handle loading state -->
  </div>
  <div v-else-if="session === null">
    <!-- Add logic to handle not signed in state -->
  </div>
  <div v-else>
    <p>This session has been active since {{ session.lastActiveAt.toLocaleString() }}</p>
  </div>
</template>

----------------------------------------

TITLE: JavaScript Implementation for Managing Organization Membership Requests
DESCRIPTION: This JavaScript code demonstrates how to use the Clerk API to retrieve and manage organization membership requests in a vanilla JavaScript application. It includes functionality to display requests, and handle accepting or rejecting them.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!pubKey) {
  throw new Error('Add your VITE_CLERK_PUBLISHABLE_KEY to .env file')
}

const clerk = new Clerk('{{pub_key}}')
await clerk.load()

if (clerk.user) {
  // Check for an active organization
  if (clerk.organization) {
    const requestsTable = document.getElementById('requests-table-body')
    const { data } = await clerk.organization
      .getMembershipRequests()
      .then((res) => console.log(`Membership requests:`, data).catch((err) => console.error(err)))
    const requests = data

    requests.map((request) => {
      const row = requestsTable.insertRow()
      row.insertCell().textContent = request.publicUserData.identifier
      row.insertCell().textContent = request.createdAt.toLocaleDateString()

      // Accept request
      const acceptBtn = document.createElement('button')
      acceptBtn.textContent = 'Accept'
      acceptBtn.addEventListener('click', async function (e) {
        e.preventDefault()
        await request.accept()
      })
      row.insertCell().appendChild(acceptBtn)

      // Reject request
      const rejectBtn = document.createElement('button')
      rejectBtn.textContent = 'Reject'
      rejectBtn.addEventListener('click', async function (e) {
        e.preventDefault()
        await request.reject()
      })
      row.insertCell().appendChild(rejectBtn)
    })
  } else {
    // If there is no active organization,
    // mount Clerk's <OrganizationSwitcher />
    // to allow the user to set an organization as active
    document.getElementById('app').innerHTML = `
      <h2>Select an organization to set it as active</h2>
      <div id="org-switcher"></div>
    `

    const orgSwitcherDiv = document.getElementById('org-switcher')

    clerk.mountOrganizationSwitcher(orgSwitcherDiv)
  }
} else {
  // If there is no active user, mount Clerk's <SignIn />
  document.getElementById('app').innerHTML = `
    <div id="sign-in"></div>
  `

  const signInDiv = document.getElementById('sign-in')

  clerk.mountSignIn(signInDiv)
}

----------------------------------------

TITLE: Updating Organization Membership Function Signature in TypeScript
DESCRIPTION: Function signature for updating a user's OrganizationMembership. It takes UpdateOrganizationMembershipParams as input and returns a Promise resolving to OrganizationMembership.

LANGUAGE: typescript
CODE:
function updateOrganizationMembership(
  params: UpdateOrganizationMembershipParams,
): Promise<OrganizationMembership>

----------------------------------------

TITLE: IdentificationClaimed Error in JSON for Clerk Sign-in
DESCRIPTION: Indicates that one or more identifiers used in a sign-up attempt have been connected to a different user, requiring a new sign-up process.

LANGUAGE: json
CODE:
{
  "shortMessage": "Identification claimed by another user",
  "longMessage": "One or more identifiers on this sign up have since been connected to a different User. Please sign up again.",
  "code": "identification_claimed"
}

----------------------------------------

TITLE: Deleting a Redirect URL using Clerk Backend SDK in TypeScript
DESCRIPTION: This function deletes a RedirectUrl using its ID. It returns a Promise that resolves to the deleted RedirectUrl object.

LANGUAGE: typescript
CODE:
function deleteRedirectUrl(redirectUrlId: string): Promise<RedirectUrl>

----------------------------------------

TITLE: Updating setSession to setActive
DESCRIPTION: Examples of updating setSession calls to use the new setActive method with its updated parameter structure.

LANGUAGE: javascript
CODE:
await setActive({ session: 'sessionID', beforeEmit: () => void })

LANGUAGE: javascript
CODE:
await setActive({ session: sessionObj })

LANGUAGE: javascript
CODE:
await setActive({ session: sessionObj, beforeEmit: () => void })

LANGUAGE: javascript
CODE:
await setActive({
  session: 'sessionID',
  organization: 'orgID',
  beforeEmit: () => void,
})

LANGUAGE: javascript
CODE:
await setActive({
  session: sessionObj,
  organization: orgObj,
  beforeEmit: () => void,
})

----------------------------------------

TITLE: Billing Account Not Accessible Error Response
DESCRIPTION: Error response returned when a user attempts to access a billing account they don't have permission to access.

LANGUAGE: json
CODE:
{
  "shortMessage": "Billing account not accessible",
  "longMessage": "Billing account <baID> is not accessible by user <userID>",
  "code": "billing_account_not_accessible_code"
}

----------------------------------------

TITLE: Implementing Server-Side Route Protection
DESCRIPTION: Server-side authentication check implementation using Clerk's getAuth method to protect routes and handle user authentication state.

LANGUAGE: tsx
CODE:
import { createFileRoute, redirect } from '@tanstack/react-router'
import { createServerFn } from '@tanstack/start'
import { getAuth } from '@clerk/tanstack-start/server'
import { getWebRequest } from 'vinxi/http'

const authStateFn = createServerFn({ method: 'GET' }).handler(async () => {
  const { userId } = await getAuth(getWebRequest())

  if (!userId) {
    throw redirect({
      to: '/sign-in/$',
    })
  }

  return { userId }
})

export const Route = createFileRoute('/')({ 
  component: Home,
  beforeLoad: async () => await authStateFn(),
  loader: async ({ context }) => {
    return { userId: context.userId }
  },
})

function Home() {
  const state = Route.useLoaderData()
  return <h1>Welcome! Your ID is {state.userId}!</h1>
}

----------------------------------------

TITLE: Disabling Telemetry via Environment Variable
DESCRIPTION: Shows how to disable telemetry collection using environment variables in a .env file.

LANGUAGE: env
CODE:
CLERK_TELEMETRY_DISABLED=1

----------------------------------------

TITLE: Attempting Email Verification in TypeScript
DESCRIPTION: Attempts to verify an email address using a one-time code previously sent to the email.

LANGUAGE: typescript
CODE:
function attemptVerification(params: AttemptEmailAddressVerificationParams): Promise<EmailAddress>

----------------------------------------

TITLE: Defining EmailCodeFactor Type in TypeScript
DESCRIPTION: This snippet defines the EmailCodeFactor type, which represents the email code strategy for first factor verification. It includes properties for strategy, emailAddressId, safeIdentifier, and primary status.

LANGUAGE: typescript
CODE:
type EmailCodeFactor = {
  strategy: EmailCodeStrategy
  emailAddressId: string
  safeIdentifier: string
  primary?: boolean
}

----------------------------------------

TITLE: Implementing RedirectToSignUp in Next.js Pages Router
DESCRIPTION: This example shows how to implement the RedirectToSignUp component in a Next.js application using the Pages Router. It demonstrates wrapping the entire application with ClerkProvider and using conditional rendering for authenticated and unauthenticated users.

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, RedirectToSignUp } from '@clerk/nextjs'
import { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider>
      <SignedIn>
        <Component {...pageProps} />
      </SignedIn>
      <SignedOut>
        <RedirectToSignUp />
      </SignedOut>
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Defining unbanUser Function in TypeScript
DESCRIPTION: Function signature for unbanUser, which takes a userId as a string parameter and returns a Promise resolving to a User object.

LANGUAGE: typescript
CODE:
function unbanUser(userId: string): Promise<User>

----------------------------------------

TITLE: Basic Account Portal Redirect Test Structure in TypeScript
DESCRIPTION: Demonstrates the basic structure for testing Account Portal redirects using Cypress's cy.origin() function. Shows how to handle cross-origin navigation between your app and the Account Portal.

LANGUAGE: typescript
CODE:
it('sign in with Account Portal redirects', () => {
  setupClerkTestingToken()

  // Set the origin to the Account Portal domain
  cy.origin('https://verb-noun-00.accounts.dev', () => {
    // Visit a protected page that redirects to the Account Portal when not signed in
    cy.visit('http://localhost:3000/protected')
    // Fill the form to sign in
    // Add any other actions to test
  })

  // The user should be redirected back to the protected page
  cy.url().should('include', '/protected')
})

----------------------------------------

TITLE: InvalidPlanForResource Error Response in JSON
DESCRIPTION: Error response when an invalid plan is selected for a specific resource.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid plan",
  "longMessage": "Plan <planID> can't be selected for <resourceType> <resourceID>",
  "code": "invalid_plan"
}

----------------------------------------

TITLE: Next.js Edge Middleware Authentication
DESCRIPTION: Implementation of authentication in Next.js edge middleware using the new withEdgeMiddlewareAuth wrapper.

LANGUAGE: jsx
CODE:
import { withEdgeMiddlewareAuth } from '@clerk/nextjs/edge-middleware'

export const middleware = withEdgeMiddlewareAuth((req, ev) => {
  const { userId, sessionId, getToken } = req.auth
  // Your middleware
})

----------------------------------------

TITLE: HTML Structure for Organization Membership Request Management
DESCRIPTION: This HTML snippet provides the structure for displaying organization membership requests in a vanilla JavaScript application. It includes a table for listing the requests and placeholders for the JavaScript functionality.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="app"></div>

    <h1>Membership Requests</h1>
    <table>
      <thead>
        <tr>
          <th>User</th>
          <th>Date requested</th>
          <th>Accept</th>
          <th>Reject</th>
        </tr>
      </thead>
      <tbody id="requests-table-body"></tbody>
    </table>

    <script type="module" src="/src/main.js" async crossorigin="anonymous"></script>
  </body>
</html>

----------------------------------------

TITLE: Offsetting Results in getOrganizationMembershipList Query
DESCRIPTION: Example of using the getOrganizationMembershipList function with the offset parameter to skip a certain number of results.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const { data, totalCount } = await clerkClient.organizations.getOrganizationMembershipList({
  organizationId,
  // skips the first 10 memberships
  offset: 10,
})

----------------------------------------

TITLE: Implementing Password Length Too Short Error in Clerk
DESCRIPTION: Error response when a user's password is shorter than the minimum required length. Uses a dynamic message with a length parameter.

LANGUAGE: json
CODE:
{
  "shortMessage": "Passwords must be %d characters or more.",
  "code": "form_password_length_too_short"
}

----------------------------------------

TITLE: Rendering a Social Connection Button with Clerk
DESCRIPTION: Demonstrates how to use the Connection component to render a social connection button for Google sign-in.

LANGUAGE: tsx
CODE:
<SignIn.Root>
  <SignIn.Step name="start">
    <Clerk.Connection name="google">Sign in with Google</Clerk.Connection>
  </SignIn.Step>
</SignIn.Root>

----------------------------------------

TITLE: Removed Localization Keys in Clerk Core 2
DESCRIPTION: This code snippet lists the localization keys that have been removed in Clerk Core 2. These keys should be removed from your localization object as they are no longer used in the new component designs.

LANGUAGE: javascript
CODE:
const deletedKeys = [
  'formFieldLabel__emailAddress_phoneNumber',
  'formFieldLabel__phoneNumber_username',
  'formFieldLabel__emailAddress_phoneNumber_username',
  'formFieldInputPlaceholder__emailAddress_phoneNumber',
  'formFieldInputPlaceholder__phoneNumber_username',
  'formFieldInputPlaceholder__emailAddress_phoneNumber_username',
  'signIn.forgotPassword.title_email',
  'signIn.forgotPassword.title_phone',
  'signIn.forgotPassword.formSubtitle_email',
  'signIn.forgotPassword.formSubtitle_phone',
  'signIn.emailCode.formSubtitle',
  'signIn.phoneCode.formSubtitle',
  'signIn.phoneCodeMfa.formSubtitle',
  'signIn.totpMfa.formSubtitle',
  'signIn.backupCodeMfa.formTitle',
  'signIn.backupCodeMfa.formSubtitle',
  'userProfile.start.headerSubtitle__account',
  'userProfile.start.headerSubtitle__security',
  'userProfile.start.emailAddressesSection.detailsTitle__primary',
  'userProfile.start.emailAddressesSection.detailsSubtitle__primary',
  'userProfile.start.emailAddressesSection.detailsTitle__nonPrimary',
  'userProfile.start.emailAddressesSection.detailsSubtitle__nonPrimary',
  'userProfile.start.emailAddressesSection.detailsTitle__unverified',
  'userProfile.start.emailAddressesSection.detailsSubtitle__unverified',
  'userProfile.start.emailAddressesSection.destructiveActionTitle',
  'userProfile.start.emailAddressesSection.destructiveActionSubtitle',
  'userProfile.start.phoneNumbersSection.detailsTitle__primary',
  'userProfile.start.phoneNumbersSection.detailsSubtitle__primary',
  'userProfile.start.phoneNumbersSection.detailsTitle__nonPrimary',
  'userProfile.start.phoneNumbersSection.detailsSubtitle__nonPrimary',
  'userProfile.start.phoneNumbersSection.detailsTitle__unverified',
  'userProfile.start.phoneNumbersSection.detailsSubtitle__unverified',
  'userProfile.start.phoneNumbersSection.destructiveActionTitle',
  'userProfile.start.phoneNumbersSection.destructiveActionSubtitle',
  'userProfile.start.connectedAccountsSection.title__connectionFailed',
  'userProfile.start.connectedAccountsSection.title__connectionFailed',
  'userProfile.start.connectedAccountsSection.title__reauthorize',
  'userProfile.start.connectedAccountsSection.actionLabel__connectionFailed',
  'userProfile.start.connectedAccountsSection.destructiveActionSubtitle',
  'userProfile.start.connectedAccountsSection.destructiveActionAccordionSubtitle',
  'userProfile.start.mfaSection.phoneCode.destructiveActionTitle',
  'userProfile.start.mfaSection.phoneCode.destructiveActionSubtitle',
  'userProfile.start.mfaSection.phoneCode.title__default',
  'userProfile.start.mfaSection.phoneCode.title__setDefault',
  'userProfile.start.mfaSection.phoneCode.subtitle__default',
  'userProfile.start.mfaSection.phoneCode.subtitle__setDefault',
  'userProfile.start.mfaSection.totp.title',
  'userProfile.start.mfaSection.totp.subtitle',
  'userProfile.start.mfaSection.totp.destructiveActionSubtitle',
  'userProfile.start.mfaSection.totp.destructiveActionLabel',
  'userProfile.start.activeDevicesSection.primaryButton',
  'userProfile.start.activeDevicesSection.detailsTitle',
  'userProfile.start.activeDevicesSection.detailsSubtitle',
  'userProfile.start.activeDevicesSection.destructiveActionTitle',
  'userProfile.start.activeDevicesSection.destructiveActionSubtitle',
  'userProfile.start.web3WalletsSection.destructiveActionTitle',
  'userProfile.start.web3WalletsSection.destructiveActionSubtitle',
  'userProfile.start.dangerSection.deleteAccountTitle',
  'userProfile.start.dangerSection.deleteAccountDescription',
  'userProfile.profilePage.fileDropAreaTitle',
  'userProfile.profilePage.fileDropAreaAction',
  'userProfile.phoneNumberPage.infoText__secondary',
  'userProfile.mfaPhoneCodePage.successMessage',
  'organizationProfile.start.headerTitle__settings',
  'organizationProfile.start.headerSubtitle__members',
  'organizationProfile.start.headerSubtitle__settings',
  'organizationProfile.profilePage.subtitle',
  'organizationProfile.profilePage.domainSection.unverifiedDomain_menuAction__verify',
  'organizationProfile.profilePage.domainSection.unverifiedDomain_menuAction__remove',
  'organizationProfile.membersPage.start.headerTitle__active',
  'organizationProfile.membersPage.start.headerTitle__invited',
  'organizationProfile.membersPage.invitationsTab.manualInvitations.headerTitle',
  'organizationProfile.membersPage.invitationsTab.manualInvitations.headerSubtitle',
  'organizationProfile.membersPage.requestsTab.requests.headerTitle',
  'organizationProfile.membersPage.requestsTab.requests.headerSubtitle',
  'createOrganization.subtitle',
]

----------------------------------------

TITLE: Retrieving External Data with Clerk JWT in Astro Endpoints
DESCRIPTION: This example shows how to retrieve a token from a JWT template and use it to fetch data from an external source (Supabase in this case) in an Astro endpoint.

LANGUAGE: typescript
CODE:
export async function GET({ locals }) {
  const { userId, getToken } = locals.auth()

  if (!userId) {
    return new Response('Unauthorized', { status: 401 })
  }

  const token = await getToken({ template: 'supabase' })

  // Fetch data from Supabase and return it.
  const data = { supabaseData: 'Hello World' }

  return new Response(JSON.stringify(data))
}

----------------------------------------

TITLE: Performing Clerk Backend API Operations with Go SDK
DESCRIPTION: This code snippet showcases how to use the Clerk Go SDK to create and update an organization, list organization memberships, and retrieve user details. It requires the Clerk Secret Key and demonstrates error handling for API operations.

LANGUAGE: go
CODE:
import (
    "github.com/clerk/clerk-sdk-go/v2"
    "github.com/clerk/clerk-sdk-go/v2/organization"
    "github.com/clerk/clerk-sdk-go/v2/organizationmembership"
    "github.com/clerk/clerk-sdk-go/v2/user"
)

func main() {
  // Each API operation requires a context.Context as the first argument.
  ctx := context.Background()

  // Set the API key
  clerk.SetKey("{{secret}}")

  // Create an organization
  org, err := organization.Create(ctx, &organization.CreateParams{
      Name: clerk.String("Clerk Inc"),
  })
  if err != nil {
    // You can get additional information on the error, if it can
    // be type-cast to clerk.APIErrorResponse.
    if apiErr, ok := err.(*clerk.APIErrorResponse); ok {
      apiErr.TraceID
      apiErr.Error()
      apiErr.Response.RawJSON
    }
    // handle the error
    panic(err)
  }

  // Update the organization
  org, err = organization.Update(ctx, org.ID, &organization.UpdateParams{
      Slug: clerk.String("clerk"),
  })
  if err != nil {
    // handle the error
    panic(err)
  }

  // List organization memberships
  listParams := organizationmembership.ListParams{}
  listParams.Limit = clerk.Int64(10)
  memberships, err := organizationmembership.List(ctx, params)
  if err != nil {
    // handle the error
    panic(err)
  }
  if memberships.TotalCount < 0 {
      return
  }
  membership := memberships[0]

  // Get a user
  usr, err := user.Get(ctx, membership.UserID)
  if err != nil {
    // handle the error
    panic(err)
  }
}

----------------------------------------

TITLE: Configuring CAPTCHA Appearance in Remix
DESCRIPTION: This snippet demonstrates how to configure the CAPTCHA appearance in a Remix application using the ClerkApp wrapper function.

LANGUAGE: tsx
CODE:
// Import ClerkApp
import { ClerkApp } from '@clerk/remix'
import type { MetaFunction, LoaderFunction } from '@remix-run/node'

import { Links, LiveReload, Meta, Outlet, Scripts, ScrollRestoration } from '@remix-run/react'

import { rootAuthLoader } from '@clerk/remix/ssr.server'

export const meta: MetaFunction = () => ({
  charset: 'utf-8',
  title: 'New Remix App',
  viewport: 'width=device-width,initial-scale=1',
})

export const loader: LoaderFunction = (args) => rootAuthLoader(args)

function App() {
  return (
    <html lang="en">
      <head>
        <Meta />
        <Links />
      </head>
      <body>
        <Outlet />
        <ScrollRestoration />
        <Scripts />
        <LiveReload />
      </body>
    </html>
  )
}

export default ClerkApp(App, {
  appearance: {
    captcha: {
      theme: 'dark',
      size: 'flexible',
      language: 'es-ES',
    },
  },
})

----------------------------------------

TITLE: Using Clerk with Other SDKs in TypeScript
DESCRIPTION: Example of using authenticateRequest() with other Clerk SDKs, such as Next.js. It shows how to use the clerkClient when the publishableKey is inferred from environment variables.

LANGUAGE: tsx
CODE:
import { clerkClient } from '@clerk/nextjs/server'

const client = await clerkClient()

export async function GET(req: Request) {
  const { isSignedIn } = await client.authenticateRequest(req, {
    authorizedParties: ['https://example.com'],
  })

  if (!isSignedIn) {
    return Response.json({ status: 401 })
  }

  // Perform protected actions
  // Add logic to perform protected actions

  return Response.json({ message: 'This is a reply' })
}

----------------------------------------

TITLE: Updating Organization.create Method
DESCRIPTION: Example of updating the Organization.create method to use an object parameter instead of a string.

LANGUAGE: javascript
CODE:
Organization.create({ name: '...' })

----------------------------------------

TITLE: Server-side Organization Detection in Next.js
DESCRIPTION: Server-side implementation to detect active organization using Clerk's auth() helper function.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'

export default async function Layout() {
  const { orgId } = await auth()

  const hasActiveOrg = !!orgId
  // ...
}

----------------------------------------

TITLE: Example Organization Invitation Creation
DESCRIPTION: Example usage of the createOrganizationInvitation method using Clerk's Backend SDK client. Shows how to create an invitation with organization ID, inviter user ID, email address, and role parameters.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const inviterUserId = 'user_123'

const emailAddress = 'testclerk123@clerk.dev'

const role = 'org:member'

const response = await clerkClient.organizations.createOrganizationInvitation({
  organizationId,
  inviterUserId,
  emailAddress,
  role,
})

----------------------------------------

TITLE: Destroying Web3Wallet Instance in TypeScript
DESCRIPTION: Method to delete an existing Web3Wallet instance.

LANGUAGE: typescript
CODE:
function destroy(): Promise<void>

----------------------------------------

TITLE: Protecting Content with Clerk's Protect Component in Next.js
DESCRIPTION: Example of using the <Protect> component to conditionally render content based on user permissions in a Next.js client component.

LANGUAGE: tsx
CODE:
'use client'
import { Protect } from '@clerk/nextjs'

export default function SettingsForm() {
  return (
    <Protect
      permission="org:team_settings:manage"
      fallback={<p>You are not allowed to see this section.</p>}
    >
      <form>{/* Add UI for managing team settings */}</form>
    </Protect>
  )
}

----------------------------------------

TITLE: Installing Clerk Themes Package
DESCRIPTION: Command line instructions for installing the @clerk/themes package using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/themes

LANGUAGE: bash
CODE:
yarn add @clerk/themes

LANGUAGE: bash
CODE:
pnpm add @clerk/themes

LANGUAGE: bash
CODE:
bun add @clerk/themes

----------------------------------------

TITLE: Using createPhoneNumber Function with Clerk Backend SDK
DESCRIPTION: Example of how to use the createPhoneNumber function to create a phone number for a user. It demonstrates setting various parameters like userId, phoneNumber, primary status, and verification status.

LANGUAGE: tsx
CODE:
const response = await clerkClient.phoneNumbers.createPhoneNumber({
  userId: 'user_123',
  phoneNumber: '15551234567',
  primary: true,
  verified: true,
})

----------------------------------------

TITLE: Checking Clerk Load Status in Cypress
DESCRIPTION: Example demonstrating how to verify that Clerk has been properly loaded using the clerkLoaded command.

LANGUAGE: typescript
CODE:
it('check Clerk loaded', () => {
  cy.visit(`/`)
  cy.clerkLoaded()
  // Clerk has been loaded from here on
})

----------------------------------------

TITLE: OperationNotAllowedOnPrimaryDomain Error Response in JSON
DESCRIPTION: Error response when an invalid operation is attempted on a primary domain.

LANGUAGE: json
CODE:
{
  "shortMessage": "operation not allowed",
  "longMessage": "This operation is not allowed on a primary domain. Try again with a satellite domain of the instance.",
  "code": "operation_not_allowed_on_primary_domain_code"
}

----------------------------------------

TITLE: Implementing Password Length Too Long Error in Clerk
DESCRIPTION: Error response when a user's password exceeds the maximum allowed length. Uses a dynamic message with a length parameter.

LANGUAGE: json
CODE:
{
  "shortMessage": "Passwords must be less than %d characters.",
  "code": "form_password_length_too_long"
}

----------------------------------------

TITLE: Updating pagination arguments
DESCRIPTION: Example of updating pagination arguments for Organization methods.

LANGUAGE: javascript
CODE:
const { data } = await organization.getRoles({
  pageSize: 10,
  initialPage: 2
})

----------------------------------------

TITLE: Getting Account Identifier in TypeScript
DESCRIPTION: Method signature for retrieving the account identifier, returning username, email address, or label based on availability.

LANGUAGE: typescript
CODE:
function accountIdentifier(): string

----------------------------------------

TITLE: Defining createAllowlistIdentifier Function Signature in TypeScript
DESCRIPTION: This snippet shows the function signature for createAllowlistIdentifier. It takes AllowlistIdentifierCreateParams as input and returns a Promise resolving to an AllowlistIdentifier object.

LANGUAGE: typescript
CODE:
function createAllowlistIdentifier(
  params: AllowlistIdentifierCreateParams,
): Promise<AllowlistIdentifier>

----------------------------------------

TITLE: Delaying Script Loading with Clerk in React
DESCRIPTION: This code snippet demonstrates how to delay the loading of another script (in this case, Monaco Editor) until after Clerk has finished loading. It uses the useClerk() hook to check if Clerk has loaded before rendering the Editor component.

LANGUAGE: jsx
CODE:
import { Editor } from '@monaco-editor/react'
import { useClerk } from '@clerk/nextjs'

export default function Home() {
  const clerk = useClerk()

  return <main>{clerk.loaded && <Editor />}</main>
}

----------------------------------------

TITLE: Updating UserButton Component
DESCRIPTION: Example of updating the UserButton component to use the new userProfileProps prop instead of userProfile.

LANGUAGE: jsx
CODE:
<UserButton userProfileProps={} />

----------------------------------------

TITLE: Defining getOrganizationInvitationList Function in TypeScript
DESCRIPTION: Function signature for getOrganizationInvitationList, which retrieves a list of organization invitations. It returns a Promise resolving to a PaginatedResourceResponse containing an array of OrganizationInvitation objects.

LANGUAGE: typescript
CODE:
function getOrganizationInvitationList(
  params: GetOrganizationInvitationListParams,
): Promise<PaginatedResourceResponse<OrganizationInvitation[]>>

----------------------------------------

TITLE: Updating Organization.getPendingInvitations Method
DESCRIPTION: Example of updating the Organization.getPendingInvitations method to use the new getInvitations method with a status filter.

LANGUAGE: javascript
CODE:
Organization.getInvitations({ status: 'pending' })

----------------------------------------

TITLE: Defining SignUpNotFound Error in JSON for Clerk
DESCRIPTION: This snippet defines the JSON structure for the SignUpNotFound error in Clerk. It includes a short message, a long message with a placeholder for the sign-up ID, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Sign up not found",
  "longMessage": "No sign up was found with id %s",
  "code": "resource_not_found"
}

----------------------------------------

TITLE: Creating Home Page UI Component
DESCRIPTION: React component implementation for the home page with message management functionality and Clerk integration.

LANGUAGE: tsx
CODE:
import { createUserMessage, deleteUserMessage } from './actions'
import { db } from './db'
import { auth } from '@clerk/nextjs/server'

export default async function Home() {
  const { userId } = await auth()
  if (!userId) throw new Error('User not found')
  const existingMessage = await db.query.UserMessages.findFirst({
    where: (messages, { eq }) => eq(messages.user_id, userId),
  })

  return (
    <main>
      <h1>Neon + Clerk Example</h1>
      {existingMessage ? (
        <div>
          <p>{existingMessage.message}</p>
          <form action={deleteUserMessage}>
            <button>Delete Message</button>
          </form>
        </div>
      ) : (
        <form action={createUserMessage}>
          <input type="text" name="message" placeholder="Enter a message" />
          <button>Save Message</button>
        </form>
      )}
    </main>
  )
}

----------------------------------------

TITLE: Filtering Organizations by Query in TypeScript
DESCRIPTION: Example of using the getOrganizationList function with a query parameter to filter organizations based on a search term.

LANGUAGE: tsx
CODE:
// returns organizations that have 'test' in their name
const { data, totalCount } = await clerkClient.organizations.getOrganizationList({ query: 'test' })

----------------------------------------

TITLE: Configuring Fauna Access Provider FSL Schema
DESCRIPTION: FSL schema configuration for Fauna access provider to include user-defined roles for Clerk JWTs.

LANGUAGE: fsl
CODE:
access provider Clerk {
  // Don't change the values of the issuer or jwks_uri fields.
  issuer "..."
  jwks_uri "..."

  // Adds a user-defined role to Clerk JWTs.
  role <YOUR_ROLE>
}

----------------------------------------

TITLE: Installing @clerk/remix Package
DESCRIPTION: Commands for installing the Clerk Remix SDK using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/remix

LANGUAGE: bash
CODE:
yarn add @clerk/remix

LANGUAGE: bash
CODE:
pnpm add @clerk/remix

LANGUAGE: bash
CODE:
bun add @clerk/remix

----------------------------------------

TITLE: MissingRequestHeaders Error JSON Response for Standard Browsers
DESCRIPTION: JSON response structure for missing request headers error in standard browsers. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid request headers",
  "longMessage": "Your Clerk Frontend API is accessible from browsers and native applications. To protect against standard web attacks, the HTTP Origin header is required in browser requests. If you see this error, you probably accessed Clerk Frontend API directly from the address bar or a browser extension is intercepting your browser requests, removing the HTTP Origin header. For more information refer to https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin.",
  "code": "request_header_missing_code"
}

----------------------------------------

TITLE: Defining deleteSamlConnection Function in TypeScript
DESCRIPTION: Function signature for deleteSamlConnection. It takes a samlConnectionId as a string parameter and returns a Promise that resolves to a DeletedObject.

LANGUAGE: typescript
CODE:
function deleteSamlConnection(samlConnectionId: string): Promise<DeletedObject>

----------------------------------------

TITLE: Signing In with Clerk in Playwright Tests
DESCRIPTION: Demonstrates how to use the clerk.signIn() function to authenticate a user in a Playwright test. It includes navigating to an unprotected page, signing in with a phone code strategy, and then accessing a protected page.

LANGUAGE: typescript
CODE:
import { clerk } from '@clerk/testing/playwright'

test('sign in', async ({ page }) => {
  // Navigate to an unprotected page that loads Clerk
  await page.goto('/')

  await clerk.signIn({
    page,
    signInParams: { strategy: 'phone_code', identifier: '+15555550100' },
  })

  // Navigate to a protected page
  await page.goto('/protected')
})

----------------------------------------

TITLE: Defining ActorTokenCannotBeRevoked Error in JSON
DESCRIPTION: This snippet defines the error response for an actor token that cannot be revoked due to its status. It includes a short message, long message, and error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "cannot revoke",
  "longMessage": "Actor token cannot be revoked because its status is <status>. Only pending tokens can be revoked.",
  "code": "actor_token_cannot_be_revoked_code"
}

----------------------------------------

TITLE: Customizing CAPTCHA Widget Appearance with HTML Attributes
DESCRIPTION: This HTML snippet demonstrates how to customize the appearance of the Clerk CAPTCHA widget by adding data attributes to the div element. It sets the theme to dark, size to flexible, and language to Spanish (Spain).

LANGUAGE: html
CODE:
<div id="clerk-captcha" data-cl-theme="dark" data-cl-size="flexible" data-cl-language="es-ES" />

----------------------------------------

TITLE: Installing shadcn/ui Components
DESCRIPTION: Command to install required shadcn/ui components for the examples.

LANGUAGE: shell
CODE:
npx shadcn@latest add button card input label

----------------------------------------

TITLE: Preparing Verification in Clerk
DESCRIPTION: This method initiates the verification process for a field that requires validation during sign-up. It prepares the necessary verification flow based on the specified strategy.

LANGUAGE: typescript
CODE:
function prepareVerification(params: PrepareVerificationParams): Promise<SignUpResource>

----------------------------------------

TITLE: AlreadySignedIn Error in JSON for Clerk Sign-in
DESCRIPTION: Indicates that a user is attempting to sign in when they are already signed in. Includes a session ID in the meta data.

LANGUAGE: json
CODE:
{
  "shortMessage": "You're already signed in",
  "code": "identifier_already_signed_in",
  "meta": {
    "SessionID": "<session ID>"
  }
}

----------------------------------------

TITLE: Defining Backup Code Factor Type in TypeScript
DESCRIPTION: Defines the structure for backup code factor authentication strategy.

LANGUAGE: typescript
CODE:
type BackupCodeFactor = {
  strategy: BackupCodeStrategy
}

----------------------------------------

TITLE: Managing SMS MFA Settings in Next.js App Router
DESCRIPTION: React component for managing SMS multi-factor authentication settings, including phone number management and backup code generation. Uses Clerk's useUser hook and PhoneNumberResource for handling MFA operations.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useUser } from '@clerk/nextjs'
import { BackupCodeResource, PhoneNumberResource } from '@clerk/types'
import Link from 'next/link'

// Display phone numbers reserved for MFA
const ManageMfaPhoneNumbers = () => {
  const { user } = useUser()

  if (!user) return null

  // Check if any phone numbers are reserved for MFA
  const mfaPhones = user.phoneNumbers
    .filter((ph) => ph.verification.status === 'verified')
    .filter((ph) => ph.reservedForSecondFactor)
    .sort((ph: PhoneNumberResource) => (ph.defaultSecondFactor ? -1 : 1))

  if (mfaPhones.length === 0) {
    return <p>There are currently no phone numbers reserved for MFA.</p>
  }

  return (
    <>
      <h2>Phone numbers reserved for MFA</h2>
      <ul>
        {mfaPhones.map((phone) => {
          return (
            <li key={phone.id} style={{ display: 'flex', gap: '10px' }}>
              <p>
                {phone.phoneNumber} {phone.defaultSecondFactor && '(Default)'}
              </p>
              <div>
                <button onClick={() => phone.setReservedForSecondFactor({ reserved: false })}>
                  Disable for MFA
                </button>
              </div>

              {!phone.defaultSecondFactor && (
                <div>
                  <button onClick={() => phone.makeDefaultSecondFactor()}>Make default</button>
                </div>
              )}

              <div>
                <button onClick={() => phone.destroy()}>Remove from account</button>
              </div>
            </li>
          )
        })}
      </ul>
    </>
  )
}

----------------------------------------

TITLE: Rendering Nuxt Logo SVG Path
DESCRIPTION: Defines an SVG viewBox of 300x300 with a path element that draws the Nuxt.js logo using path commands. The logo uses the signature Nuxt green color (#00DC82) and consists of a complex shape defined through absolute coordinates.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 300 300">
  <path
    fill="#00DC82"
    d="M168 250h111c3.542 0 6.932-1.244 10-3 3.068-1.756 6.23-3.959 8-7 1.77-3.041 3.002-6.49 3-10.001-.002-3.511-1.227-6.959-3-9.998L222 91c-1.77-3.04-3.933-5.245-7-7s-7.458-3-11-3-6.933 1.245-10 3-5.23 3.96-7 7l-19 33-38-64.002c-1.772-3.04-3.932-6.243-7-7.998s-6.458-2-10-2-6.932.245-10 2c-3.068 1.755-6.228 4.958-8 7.998L2 220c-1.773 3.039-1.998 6.487-2 9.998-.002 3.511.23 6.96 2 10.001 1.77 3.04 4.932 5.244 8 7 3.068 1.756 6.458 3 10 3h70c27.737 0 47.925-12.442 62-36l34-59 18-31 55 94h-73l-18 32Zm-79-32H40l73-126 37 63-24.509 42.725C116.144 213.01 105.488 218 89 218Z"
  />
</svg>

----------------------------------------

TITLE: Defining OrganizationCustomPermissionKey Type in TypeScript
DESCRIPTION: Declares the OrganizationCustomPermissionKey type, which represents a user's permission in an organization. It is typically a string, but can be customized using ClerkAuthorization.

LANGUAGE: typescript
CODE:
type OrganizationCustomPermissionKey = string | CustomPermissionType;

----------------------------------------

TITLE: Defining SamlFactor Type in TypeScript
DESCRIPTION: This snippet defines the SamlFactor type, which represents the SAML strategy for first factor verification. It only includes the strategy property.

LANGUAGE: typescript
CODE:
type SamlFactor = {
  strategy: SamlStrategy
}

----------------------------------------

TITLE: Rendering Clerk Logo SVG with Dynamic Styling
DESCRIPTION: This SVG code defines the Clerk logo with two paths. It uses inline CSS variables to support different colors for light and dark modes. The logo consists of two overlapping shapes that form a stylized 'C'.

LANGUAGE: SVG
CODE:
<svg viewBox="0 0 32 32">
  <path
    style={{ fill: 'var(--light, #6C47FF) var(--dark, #9785FF)' }}
    d="M16 21a5 5 0 1 0 0-10 5 5 0 0 0 0 10ZM25.01 27.838c.425.426.382 1.13-.118 1.465A15.925 15.925 0 0 1 16 32c-3.29 0-6.35-.994-8.893-2.697-.5-.335-.542-1.04-.117-1.465l3.654-3.654c.33-.33.843-.382 1.258-.17A8.96 8.96 0 0 0 16 25a8.961 8.961 0 0 0 4.098-.985c.416-.213.928-.161 1.258.17l3.654 3.653Z"
  />

  <path
    style={{ fill: 'var(--light, #BAB1FF) var(--dark, rgb(151 133 255 / 0.6))' }}
    d="M24.893 2.697c.5.335.542 1.04.117 1.464l-3.654 3.654c-.33.33-.843.383-1.258.17A9 9 0 0 0 7.985 20.098c.213.416.16.928-.17 1.258L4.161 25.01c-.425.425-1.13.383-1.464-.117A15.926 15.926 0 0 1 0 16C0 7.163 7.163 0 16 0c3.29 0 6.35.994 8.893 2.697Z"
  />
</svg>

----------------------------------------

TITLE: Updating SignUp Component with Path Routing
DESCRIPTION: Example of updating the SignUp component to use the new default path routing strategy.

LANGUAGE: jsx
CODE:
<SignUp path="/sign-up" />

----------------------------------------

TITLE: Using Fetch API with Clerk Authentication
DESCRIPTION: Example of using the Fetch API with SWR hook to make authenticated GraphQL requests using Clerk tokens

LANGUAGE: jsx
CODE:
import { useAuth } from '@clerk/nextjs'
import useSWR from 'swr'

export default function Home() {
  const { getToken } = useAuth()
  const subdomain = process.env.NEXT_PUBLIC_NHOST_SUBDOMAIN
  const endpoint = `https://${subdomain}.nhost.run/v1/graphql`
  const query = `query { __schema { types { name } } }`
  const fetcher = async (...args) =>
    fetch(...args, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
        Authorization: `Bearer ${await getToken({ template: 'nhost' })}`,
      },
      body: JSON.stringify({ query }),
    }).then((res) => res.json())

  const { data } = useSWR(endpoint, fetcher)

  return <p>GraphQL schema has {data?.data?.__schema.types.length} types</p>
}

----------------------------------------

TITLE: Example Usage of updateUserMetadata in TypeScript React
DESCRIPTION: This example demonstrates how to use the updateUserMetadata function from the Clerk Backend SDK. It updates the public metadata for a user with a specific ID.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const response = await clerkClient.users.updateUserMetadata(userId, {
  publicMetadata: {
    example: 'metadata',
  },
})

----------------------------------------

TITLE: Rendering OrganizationProfile in React
DESCRIPTION: Example of using the <OrganizationProfile /> component in a React application.

LANGUAGE: jsx
CODE:
import { OrganizationProfile } from '@clerk/clerk-react'

export default function OrganizationProfilePage() {
  return <OrganizationProfile />
}

----------------------------------------

TITLE: Implementing Authentication Header Components
DESCRIPTION: Creation of a header component with Clerk's authentication components for handling user sign-in and profile display.

LANGUAGE: typescript
CODE:
import { SignedIn, SignedOut, SignInButton, UserButton } from '@clerk/clerk-react'

export default function App() {
  return (
    <header>
      <SignedOut>
        <SignInButton />
      </SignedOut>
      <SignedIn>
        <UserButton />
      </SignedIn>
    </header>
  )
}

----------------------------------------

TITLE: Installing Fauna Library
DESCRIPTION: Commands for installing the Fauna library using different package managers.

LANGUAGE: bash
CODE:
npm i fauna

LANGUAGE: bash
CODE:
yarn add fauna

LANGUAGE: bash
CODE:
pnpm add fauna

LANGUAGE: bash
CODE:
bun add fauna

----------------------------------------

TITLE: Creating Invitation with Clerk Backend SDK in TypeScript
DESCRIPTION: Function signature for creating a new invitation using Clerk's Backend SDK. It takes CreateParams as input and returns a Promise resolving to an Invitation object.

LANGUAGE: typescript
CODE:
function createInvitation(params: CreateParams): Promise<Invitation>

----------------------------------------

TITLE: Installing Clerk TanStack Start SDK
DESCRIPTION: Commands for installing the @clerk/tanstack-start package using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/tanstack-start

----------------------------------------

TITLE: IdentificationExists Error JSON Response for SAML Account
DESCRIPTION: JSON response structure for an existing SAML account error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "already exists",
  "longMessage": "This SAML account already exists.",
  "code": "external_account_exists_code"
}

----------------------------------------

TITLE: InvalidAuthorizationHeaderFormat Error JSON Response
DESCRIPTION: JSON response structure for an invalid Authorization header format error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid Authorization header format",
  "longMessage": "Invalid Authorization header format. Must be 'Bearer <YOUR_API_KEY>'",
  "code": "authorization_header_format_invalid_code"
}

----------------------------------------

TITLE: Implementing OAuth Sign-In/Sign-Up with iOS (Swift)
DESCRIPTION: This snippet shows how to create a custom OAuth sign-in and sign-up flow using Clerk in an iOS application. It uses SwiftUI and the Clerk SDK to handle OAuth authentication and manage the sign-in/sign-up process.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct OAuthView: View {
  var body: some View {
    // Render a button for each supported OAuth provider
    // you want to add to your app. This example uses only Google.
    Button("Sign In with Google") {
      Task { await signInWithOAuth(provider: .google) }
    }
  }
}

extension OAuthView {

  func signInWithOAuth(provider: OAuthProvider) async {
    do {
      // Start the sign-in process using the selected OAuth provider.
      let result = try await SignIn.authenticateWithRedirect(strategy: .oauth(provider: provider))

      // It is common for users who are authenticating with OAuth to use
      // a sign-in button when they mean to sign-up, and vice versa.
      // Clerk will handle this transfer for you if possible.
      // Therefore, a TransferFlowResult can be either a SignIn or SignUp.

      switch result {
      case .signIn(let signIn):
        switch signIn.status {
        case .complete:
          // If sign-in process is complete, navigate the user as needed.
          dump(Clerk.shared.session)
        default:
          // If the status is not complete, check why. User may need to
          // complete further steps.
          dump(signIn.status)
        }
      case .signUp(let signUp):
        switch signUp.status {
        case .complete:
          // If sign-up process is complete, navigate the user as needed.
          dump(Clerk.shared.session)
        default:
          // If the status is not complete, check why. User may need to
          // complete further steps.
          dump(signUp.status)
        }
      }

    } catch {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling.
      dump(error)
    }
  }
}

----------------------------------------

TITLE: Configuring Header Forwarding in Nginx
DESCRIPTION: Basic nginx configuration to forward the X-Forwarded-Host and X-Forwarded-Proto headers to the Clerk application. This configuration is essential for proper functioning of Clerk behind a proxy.

LANGUAGE: nginx
CODE:
proxy_set_header X-Forwarded-Host $host;
proxy_set_header X-Forwarded-Proto https;

----------------------------------------

TITLE: Handling Organization Activation in Next.js Page
DESCRIPTION: This snippet shows how to handle organization activation in a Next.js page, including error handling for invalid organizations and rendering organization-specific content.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'
import { OrganizationList } from '@clerk/nextjs'

export default async function Home({ params }: { params: { slug: string } }) {
  const { orgSlug } = await auth()

  // Check if the organization slug from the URL params doesn't match
  // the active organization slug from the user's session.
  // If they don't match, show an error message and the list of valid organizations.
  if (params.slug != orgSlug) {
    return (
      <>
        <p>Sorry, organization {params.slug} is not valid.</p>
        <OrganizationList
          hideSlug={false}
          hidePersonal={false}
          afterCreateOrganizationUrl="/orgs/:slug"
          afterSelectOrganizationUrl="/orgs/:slug"
          afterSelectPersonalUrl="/me"
        />
      </>
    )
  }

  return <div>Welcome to organization {orgSlug}</div>
}

----------------------------------------

TITLE: Preparing Domain Affiliation Verification - TypeScript
DESCRIPTION: Method to initiate the verification process for an organization domain, which is required to complete domain registration.

LANGUAGE: typescript
CODE:
function prepareAffiliationVerification(
  params: PrepareAffiliationVerificationParams,
): Promise<OrganizationDomain>

----------------------------------------

TITLE: Adding Custom Claims to Session Token in Clerk Dashboard
DESCRIPTION: JSON configuration to add custom claims to the session token in the Clerk Dashboard. This adds a 'metadata' field containing the user's public metadata.

LANGUAGE: json
CODE:
{
  "metadata": "{{user.public_metadata}}"
}

----------------------------------------

TITLE: Server-Side Supabase Client Creation with Clerk in Next.js
DESCRIPTION: Function to create a Supabase client with Clerk authentication for server-side rendering in Next.js.

LANGUAGE: ts
CODE:
import { auth } from '@clerk/nextjs/server'
import { createClient } from '@supabase/supabase-js'

export async function createClerkSupabaseClientSsr() {
  const { getToken } = await auth()

  return createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_KEY!,
    {
      global: {
        fetch: async (url, options = {}) => {
          const clerkToken = await getToken({
            template: 'supabase',
          })

          const headers = new Headers(options?.headers)
          headers.set('Authorization', `Bearer ${clerkToken}`)

          return fetch(url, {
            ...options,
            headers,
          })
        },
      },
    },
  )
}

----------------------------------------

TITLE: Updating ClerkProvider Component
DESCRIPTION: Example of updating the ClerkProvider component to use the new routerPush and routerReplace props instead of navigate.

LANGUAGE: jsx
CODE:
<ClerkProvider routerPush={(x) => x} routerReplace={(x) => x} />

----------------------------------------

TITLE: SignedOut Error JSON Response
DESCRIPTION: JSON response structure for a signed out user error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Signed out",
  "longMessage": "You are signed out",
  "code": "signed_out_code"
}

----------------------------------------

TITLE: Client-side Next.js Reverification Implementation
DESCRIPTION: Demonstrates client-side reverification handling using the useReverification hook in Next.js. Shows how to handle the reverification process and retry failed requests automatically.

LANGUAGE: typescript
CODE:
'use client'

import { useReverification } from '@clerk/nextjs'
import { myAction } from '../actions'

export default function Page() {
  const [performAction] = useReverification(myAction)

  const handleClick = async () => {
    const myData = await performAction()
    // If `myData` is null, the user cancelled the reverification process
    // You can choose how your app responds. This example returns null.
    if (!myData) return
  }

  return <button onClick={handleClick}>Perform action</button>
}

----------------------------------------

TITLE: Defining unlockUser Function Signature
DESCRIPTION: TypeScript function signature for unlocking a user, specifying that it takes a userId string parameter and returns a Promise resolving to a User object.

LANGUAGE: typescript
CODE:
function unlockUser(userId: string): Promise<User>

----------------------------------------

TITLE: Checking Client Creation Status in TypeScript
DESCRIPTION: Method to check if the client has been saved in the Frontend API.

LANGUAGE: typescript
CODE:
function isNew(): boolean

----------------------------------------

TITLE: SignOutButton with asChild Prop in Astro
DESCRIPTION: Shows how to use the SignOutButton component in Astro with the asChild prop, which is required when passing children to the component in Astro.

LANGUAGE: astro
CODE:
---
import { SignOutButton } from '@clerk/astro/components'
---

<SignOutButton asChild>
  <button>Custom sign out button</button>
</SignOutButton>

----------------------------------------

TITLE: Configuring ClerkApp Wrapper
DESCRIPTION: Implementation of ClerkApp wrapper to provide authentication state throughout the React component tree

LANGUAGE: typescript
CODE:
import { ClerkApp } from '@clerk/remix'

function App() {
  return <Outlet />
}

// Wrap your app with `ClerkApp`
export default ClerkApp(App)

----------------------------------------

TITLE: Running the Cognito to Clerk migration script
DESCRIPTION: Shell command to execute the TypeScript migration script using npx and tsx.

LANGUAGE: shell
CODE:
npx tsx --env-file=.env main.ts

----------------------------------------

TITLE: Filtering Invitations by Status in TypeScript
DESCRIPTION: Example of using getInvitationList to retrieve only revoked invitations by specifying the 'status' parameter.

LANGUAGE: tsx
CODE:
// get all revoked invitations
const response = await clerkClient.invitations.getInvitationList({ status: 'revoked' })

----------------------------------------

TITLE: Creating a Vue App with Vite
DESCRIPTION: Commands to create a new Vue app using Vite with TypeScript template and start the development server.

LANGUAGE: bash
CODE:
npm create vite@latest clerk-vue -- --template vue-ts
cd clerk-vue
npm install
npm run dev

----------------------------------------

TITLE: DuplicateAllowlistIdentifier Error Response in JSON
DESCRIPTION: Error response structure when attempting to create an allowlist identifier that already exists. Returns a duplicate record error code with short and detailed messages.

LANGUAGE: json
CODE:
{
  "shortMessage": "duplicate allowlist identifier",
  "longMessage": "the identifier <identifier> already exists",
  "code": "duplicate_record_code"
}

----------------------------------------

TITLE: Organization Update HTML Structure
DESCRIPTION: HTML template for implementing organization update functionality in vanilla JavaScript. Sets up the basic structure with a form for updating organization details.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="app"></div>

    <h1>Update the current organization</h1>
    <form id="update-organization">
      <label for="name">Name</label>
      <input id="name" name="name" />
      <button>Update</button>
    </form>

    <script type="module" src="/src/main.js" async crossorigin="anonymous"></script>
  </body>
</html>

----------------------------------------

TITLE: SignOutButton with asChild Prop in Astro
DESCRIPTION: Shows how to use the SignOutButton component in Astro with the asChild prop, which is required when passing children to the component in Astro.

LANGUAGE: astro
CODE:
---
import { SignOutButton } from '@clerk/astro/components'
---

<SignOutButton asChild>
  <button>Custom sign out button</button>
</SignOutButton>

----------------------------------------

TITLE: Using getPhoneNumber Function in TypeScript React
DESCRIPTION: Example usage of the getPhoneNumber function from the Clerk Backend SDK. It demonstrates how to retrieve a phone number using its ID and store the response.

LANGUAGE: tsx
CODE:
const phoneNumberId = 'idn_123'

const response = await clerkClient.phoneNumbers.getPhoneNumber(phoneNumberId)

----------------------------------------

TITLE: Deleting Organization Domain - TypeScript
DESCRIPTION: Method to delete an organization domain and remove it from the organization.

LANGUAGE: typescript
CODE:
function delete(): Promise<void>

----------------------------------------

TITLE: InvalidUserSettings Error JSON Response
DESCRIPTION: JSON response structure for invalid auth configuration error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "invalid auth configuration",
  "longMessage": "The authentication settings are invalid.",
  "code": "invalid_user_settings_code"
}

----------------------------------------

TITLE: Rendering Ruby Logo in SVG
DESCRIPTION: Vector graphic implementation of the Ruby logo using SVG path elements. The icon uses the official Ruby red color (#CC342D) and creates the distinctive gem shape through path commands.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 32 32" fill="none">
  <path
    fill="#CC342D"
    d="M25.164 2.611c3.407.59 4.374 2.92 4.302 5.36l.017-.035-1.534 20.098L8.012 29.4h.018c-1.655-.07-5.344-.221-5.512-5.378l1.848-3.371 3.167 7.4.565 1.317 3.152-10.274-.034.008.018-.034 10.399 3.321-1.569-6.102-1.112-4.382 9.91-.639-.692-.573-7.114-5.8L25.167 2.6l-.003.011ZM8.28 8.218c4.001-3.97 9.165-6.316 11.148-4.315 1.98 1.997-.118 6.86-4.127 10.827-4.003 3.968-9.104 6.442-11.082 4.446-1.984-1.997.05-6.985 4.058-10.955l.003-.003Z"
  />
</svg>

----------------------------------------

TITLE: Setting Redirect URL Props in Clerk Components (JSX)
DESCRIPTION: Example of how to set redirect URL props on various Clerk components. These props allow customization of where users are redirected after sign-in or sign-up actions.

LANGUAGE: jsx
CODE:
<RedirectToSignIn />
<RedirectToSignUp />
<ClerkProvider>
<SignInButton>
<SignUpButton>
<SignIn>
<SignUp>

----------------------------------------

TITLE: Updating User Password Change Method
DESCRIPTION: Example of updating the method for changing a user's password from update to updatePassword.

LANGUAGE: javascript
CODE:
user.update({ password: 'foo' })

user.updatePassword({
  currentPassword: 'bar',
  newPassword: 'foo',
  signOutOfOtherSessions: true,
})

----------------------------------------

TITLE: Adding Custom Types for Clerk Roles and Permissions
DESCRIPTION: Shows how to define custom types for Clerk roles and permissions to enhance type safety in TypeScript projects.

LANGUAGE: typescript
CODE:
export {}

declare global {
  interface ClerkAuthorization {
    permission: 'org:quiz:create' | 'org:quiz:grade' | 'org:quiz:read' | 'org:quiz:fill'
    role: 'org:super_admin' | 'org:teacher' | 'org:student'
  }
}

----------------------------------------

TITLE: Destroying External Account in TypeScript
DESCRIPTION: Method signature for deleting an external account instance.

LANGUAGE: typescript
CODE:
function destroy(): Promise<void>

----------------------------------------

TITLE: Accessing SignUp State in Vue
DESCRIPTION: Example showing how to use the $signUpStore with Vue to check the current sign-up status. Uses @nanostores/vue for state management and includes conditional rendering.

LANGUAGE: vue
CODE:
<script setup>
import { useStore } from '@nanostores/vue'
import { $signUpStore } from '@clerk/astro/client'

const signUp = useStore($signUpStore)
</script>

<template>
  <div v-if="signUp === undefined">
    <!-- Add logic to handle loading state -->
  </div>
  <div v-else>
    <div>The current sign-up attempt status is {{ signUp.status }}.</div>
  </div>
</template>

----------------------------------------

TITLE: Updating User password change method
DESCRIPTION: Example of updating a user's password using the new User.updatePassword method.

LANGUAGE: javascript
CODE:
user.updatePassword({
  currentPassword: 'bar',
  newPassword: 'foo',
  signOutOfOtherSessions: true
})

----------------------------------------

TITLE: AccountTransferInvalid Error in JSON for Clerk Sign-in
DESCRIPTION: Represents an error when attempting an invalid account transfer, specifically when there is no account to transfer.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid account transfer",
  "longMessage": "There is no account to transfer",
  "code": "account_transfer_invalid"
}

----------------------------------------

TITLE: Defining MFA Disable Function Signature in TypeScript
DESCRIPTION: Function signature for disabling all MFA methods for a user, returning a Promise that resolves to a User object.

LANGUAGE: typescript
CODE:
function disableUserMFA(userId: string): Promise<User>

----------------------------------------

TITLE: Configuring Development Environment Variables for Clerk Sync
DESCRIPTION: Development environment configuration file setting up Clerk publishable key and sync host for local development.

LANGUAGE: env
CODE:
PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_FRONTEND_API=https://{{fapi_url}}
PLASMO_PUBLIC_CLERK_SYNC_HOST=http://localhost

----------------------------------------

TITLE: Installing Clerk Express SDK and Dependencies
DESCRIPTION: Commands for installing @clerk/express and dotenv packages using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/express
npm install dotenv

----------------------------------------

TITLE: Next.js Query Implementation with SWR
DESCRIPTION: Implementation of GraphQL queries in Next.js using SWR for data fetching and Clerk authentication.

LANGUAGE: typescript
CODE:
import { useAuth } from '@clerk/nextjs'
import useSWR from 'swr'

export const useQuery = (query, variables) => {
  if (!query) {
    throw Error('No query provided to `useQuery`')
  }

  const { getToken } = useAuth()

  const fetcher = async () => {
    const token = await getToken({ template: 'grafbase' })
    const results = await fetch('YOUR_GRAFBASE_API', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        authorization: `Bearer ${token}`,
      },
      body: JSON.stringify({ query, variables }),
    }).then((res) => res.json())
    return results
  }
  return useSWR(query, fetcher)
}

const YOUR_GRAPHQL_QUERY = `
	query {
		__schema {
			types {
				name
			}
		}
	}
`

const SchemaPage = () => {
  const { data, error } = useQuery(YOUR_GRAPHQL_QUERY)
  if (error) {
    return <div>error</div>
  }
  return <pre>{JSON.stringify({ data }, 2, null)}</pre>
}

export default SchemaPage

----------------------------------------

TITLE: Registering Clerk Plugin for Specific Routes in Fastify
DESCRIPTION: Shows how to implement route-specific authentication by registering the Clerk plugin only for protected routes while maintaining public routes separately. Includes user authentication checks and error handling.

LANGUAGE: typescript
CODE:
import 'dotenv/config'
import Fastify, { FastifyPluginCallback } from 'fastify'
import { clerkClient, clerkPlugin, getAuth } from '@clerk/fastify'

const fastify = Fastify({ logger: true })

const protectedRoutes: FastifyPluginCallback = (instance, options, done) => {
  instance.register(clerkPlugin)

  instance.get('/protected', async (req, reply) => {
    const { userId } = getAuth(req)

    // Protect the route from unauthenticated users
    if (!userId) {
      return reply.code(403).send({ message: 'Access denied. Authentication required.' })
    }

    const user = await clerkClient.users.getUser(userId)

    // Only authenticated users will see the following message
    reply.send({ message: 'This is a protected route.', user })
  })

  done()
}

const publicRoutes: FastifyPluginCallback = (instance, options, done) => {
  instance.get('/', async (req, reply) => {
    reply.send({ message: 'This is a public route.' })
  })

  done()
}

fastify.register(protectedRoutes)
fastify.register(publicRoutes)

const start = async () => {
  try {
    await fastify.listen({ port: 8080 })
  } catch (error) {
    fastify.log.error(error)
    process.exit(1)
  }
}

start()

----------------------------------------

TITLE: Setting Clerk API Keys in Environment Variables
DESCRIPTION: Configuration of Clerk API keys in the .env file for authentication setup.

LANGUAGE: env
CODE:
PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Handling Blocklist Identifier Not Found Error in Clerk
DESCRIPTION: Error response structure when attempting to access a blocklist identifier that does not exist in the system

LANGUAGE: json
CODE:
{
  "shortMessage": "Identifier not found",
  "longMessage": "No identifier was found with id <identifierID>",
  "code": "resource_not_found_code"
}

----------------------------------------

TITLE: Deleting Users with Clerk REST API via cURL
DESCRIPTION: Demonstrates how to delete a user by making a direct HTTP DELETE request to Clerk's REST API using cURL. Requires an authorization token and the user ID to be specified in the URL.

LANGUAGE: bash
CODE:
curl 'https://api.clerk.com/v1/users/{user_id}' -X DELETE -H 'Authorization:Bearer {{secret}}' -H 'Content-Type:application/json'

----------------------------------------

TITLE: Using Redirect Components in React with Clerk
DESCRIPTION: Examples of Clerk's redirect components used to navigate users to different Account Portal pages. These components handle authentication flows and user management interfaces.

LANGUAGE: jsx
CODE:
<RedirectToSignIn />
<RedirectToSignUp />
<RedirectToUserProfile />
<RedirectToCreateOrganization />
<RedirectToOrganizationProfile />

----------------------------------------

TITLE: Checking CAA DNS Records
DESCRIPTION: Shell command to check Certificate Authority Authorization DNS records for a domain

LANGUAGE: sh
CODE:
dig example.com +short CAA

----------------------------------------

TITLE: Changed Localization Values in Clerk Core 2
DESCRIPTION: This code snippet shows the localization keys whose default values have changed in Clerk Core 2. Review these changes and update your localization object accordingly if you have overridden any of these values.

LANGUAGE: javascript
CODE:
const changedValues = {
  formFieldLabel__organizationName: 'Name',
  formFieldLabel__organizationSlug: 'Slug',
  formFieldInputPlaceholder__emailAddresses: 'example@email.com, example2@email.com',
  formFieldInputPlaceholder__organizationSlug: 'my-org',
  signUp: {
    start: {
      subtitle: 'Welcome! Please fill in the details to get started.',
      actionText: 'Already have an account?',
    },
    emailCode: {
      subtitle: 'Enter the verification code sent to your email',
    },
    phoneCode: {
      subtitle: 'Enter the verification code sent to your phone',
    },
    continue: {
      subtitle: 'Please fill in the remaining details to continue.',
      actionText: 'Already have an account?',
    },
  },
  signIn: {
    start: {
      title: 'Sign in to {{applicationName}}',
      subtitle: 'Welcome back! Please sign in to continue',
      actionText: 'Don't have an account?',
    },
    password: {
      subtitle: 'Enter the password associated with your account',
    },
    forgotPasswordAlternativeMethods: {
      label__alternativeMethods: 'Or, sign in with another method',
    },
    resetPassword: {
      title: 'Set new password',
    },
    phoneCodeMfa: {
      subtitle: 'To continue, please enter the verification code sent to your phone',
    },
    totpMfa: {
      subtitle:
        'To continue, please enter the verification code generated by your authenticator app',
    },
    backupCodeMfa: {
      subtitle: 'Your backup code is the one you got when setting up two-step authentication.',
    },
  },
  userProfile: {
    start: {
      headerTitle__account: 'Profile details',
      emailAddressesSection: {
        primaryButton: 'Add email address',
        detailsAction__unverified: 'Verify',
        destructiveAction: 'Remove email',
      },
      phoneNumbersSection: {
        primaryButton: 'Add phone number',
      },
      mfaSection: {
        phoneCode: {
          destructiveActionLabel: 'Remove',
        },
        backupCodes: {
          actionLabel__regenerate: 'Regenerate',
        },
      },
      dangerSection: {
        title: 'Delete account',
        deleteAccountButton: 'Delete account',
      },
    },
    profilePage: {
      imageFormSubtitle: 'Upload',
      imageFormDestructiveActionSubtitle: 'Remove',
      fileDropAreaHint: 'Recommended size 1:1, up to 10MB.',
    },
    phoneNumberPage: {
      infoText:
        'A text message containing a verification code will be sent to this phone number. Message and data rates may apply.',
    },
    connectedAccountPage: {
      socialButtonsBlockButton: '{{provider|titleize}}',
    },
    mfaPhoneCodePage: {
      primaryButton__addPhoneNumber: 'Add phone number',
      subtitle__availablePhoneNumbers:
        'Select an existing phone number to register for SMS code two-step verification or add a new one.',
      subtitle__unavailablePhoneNumbers:
        'There are no available phone numbers to register for SMS code two-step verification, please add a new one.',
    },
    deletePage: {
      actionDescription: "Type 'Delete account' below to continue.",
    },
  },
  organizationSwitcher: {
    action__createOrganization: 'Create organization',
    action__manageOrganization: 'Manage',
  },
  organizationProfile: {
    profilePage: {
      title: 'Update Profile',
      dangerSection: {
        leaveOrganization: {
          actionDescription: "Type '{{organizationName}}' below to continue.",
        },
        deleteOrganization: {
          actionDescription: "Type '{{organizationName}}' below to continue.",
        },
      },
    },
    invitePage: {
      title: 'Invite new members',
      subtitle: 'Enter or paste one or more email addresses, separated by spaces or commas.',
    },
  },
  createOrganization: {
    title: 'Create organization',
  },
  organizationList: {
    title: 'Choose an account',
    titleWithoutPersonal: 'Choose an organization',
  },
}

----------------------------------------

TITLE: Adding Member to Organization - TypeScript Definition
DESCRIPTION: TypeScript function definition for adding a member to an organization with role specification.

LANGUAGE: typescript
CODE:
function addMember(params: AddMemberParams): Promise<OrganizationMembership>

----------------------------------------

TITLE: Updating ClerkMiddleware for async auth
DESCRIPTION: Example of updating custom middleware handlers to support asynchronous auth() calls.

LANGUAGE: javascript
CODE:
import { clerkClient, clerkMiddleware } from '@clerk/nextjs/server';
import { NextResponse } from 'next/server';

- export default clerkMiddleware((auth, request) => {
-  const resolvedAuth = auth();
+ export default clerkMiddleware(async (auth, request) => {
+  const resolvedAuth = await auth();

  const count = await resolvedAuth.users.getCount();

  if (count) {
    return NextResponse.redirect(new URL('/new-url', request.url));
  }
});

export const config = {
  matcher: [...],
};

----------------------------------------

TITLE: Creating Steps Component in Markdown
DESCRIPTION: This snippet demonstrates how to use the Steps component in Markdown to structure the tutorial into sequential steps.

LANGUAGE: markdown
CODE:
<Steps>
  ## Enable Microsoft Entra ID as a SAML connection in Clerk

  1. In the Clerk Dashboard, navigate to the [**SSO connections**](https://dashboard.clerk.com/last-active?path=user-authentication/sso-connections) page.
  1. Select **Add connection** and select **For specific domains or organizations**.
  1. Under **SAML**, select **Microsoft Entra ID (Formerly AD)**.
  1. Enter the **Domain**. This is the email domain of the users you want to allow to sign in to your application. Optionally, select an **Organization**.
  1. Enter the **Name**. This will be displayed on the sign-in form.
  1. Select **Add connection**. You'll be redirected to the connection's configuration page.
  1. In the **Service Provider Configuration** section, save the **Reply URL (Assertion Consumer Service URL)** and **Identifier (Entity ID)** values somewhere secure. Keep this page open.

  ## Create a new enterprise app in Microsoft

  1. In a separate page, navigate to the [Microsoft Azure portal](https://azure.microsoft.com/en-us/get-started/azure-portal) and sign in.
  1. Under the **Azure Services** section, find and select **Enterprise applications**. You may have to go to the [**All services**](https://portal.azure.com/#allservices) page and then scroll down to the **Identity** section to find it.
  1. Select **New application**. You'll be redirected to the **Browse Microsoft Entra Gallery** page.
  1. Select **Create your own application**.
  1. In the modal that opens:

  - Enter the **Name** of your app.
  - Select **Integrate any other application you don't find in the gallery (Non-gallery)**.
  - Select **Create**.

  ## Assign selected user or group in Microsoft

  Now that you have created the enterprise app, you need to assign users or groups to the app. For example, if you were part of the Clerk organization, you would have access to users and groups within the Clerk organization. In this case, you could assign individual users or entire groups to the enterprise app you just created.

  1. In the **Getting Started** section, select the **Assign users and groups** link.
  1. Select **Add user/group**. You'll be redirected to the **Add Assignment** page.
  1. Select the **None Selected** link.
  1. To assign a user to the enterprise app, you can either use the search field to find a user or select the checkbox next to the user in the table.
  1. Select **Select** at the bottom of the page. You'll be redirected to the **Add Assignment** page.
  1. Select **Assign** at the bottom of the page.

  ## Configure Clerk as your Service Provider

  After assigning the user or group to the enterprise app, you need to configure the SSO settings in Microsoft to enable SAML SSO.

  1. In the navigation sidenav, open the **Manage** dropdown and select **Single sign-on**.
  1. In the **Select a single sign-on method** section, select **SAML**. You'll be redirected to the **Set up Single Sign-On with SAML** page.
  1. Find the **Basic SAML Configuration** section.
  1. Select **Edit**. The **Basic SAML Configuration** panel will open.
  1. Paste the **Identifier (Entity ID)** and **Reply URL (Assertion Consumer Service URL)** values you saved from the Clerk Dashboard into their respective fields. These values will be saved automatically.
  1. Select **Save** at the top of the panel. Close the panel.

  ## Configure Microsoft as your Identity Provider

  1. On the **Set up Single Sign-On with SAML** page, find the **SAML Certificates** section.
  1. Copy the **App Federation Metadata Url**.
  1. Navigate back to the **Clerk Dashboard**. In the **Identity Provider Configuration** section, under **App Federation Metadata Url**, paste the **App Federation Metadata URL**.
  1. Select **Fetch & save**.

  ## Map Microsoft claims to Clerk attributes

  Mapping the claims in your IdP to the attributes in Clerk ensures that the data from your IdP is correctly mapped to the data in Clerk.

  | Clerk attribute | Microsoft claim |
  | - | - |
  | `mail` | `user.userprincipalname` |
  | `firstName` | `user.givenname` |
  | `lastName` | `user.surname` |

  The only Microsoft claim that is necessary to map is the email address claim. This is the email address that your users will use to authenticate into your app.

  1. On the **Set up Single Sign-On with SAML** page, find the **Attributes & Claims** section.
  1. Select **Edit**.
  1. To edit the email claim, select the claim with the claim name ending with `/claims/emailaddress`. You'll be redirected to the **Manage claim** page.
  1. Next to **Source attribute**, search for and select `user.userprincipalname` in the dropdown.
  1. Select **Save** at the top of the page.

  ## Enable the connection in Clerk

  <Include src="_partials/authentication/saml/enable-connection" />
</Steps>

----------------------------------------

TITLE: Configuring Clerk Environment Variables
DESCRIPTION: Setting up the required Clerk API keys in the environment configuration file.

LANGUAGE: env
CODE:
CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Revoking Invitation with cURL in Clerk
DESCRIPTION: This example shows how to revoke an invitation using cURL. It sends a POST request to the Clerk API with the invitation ID to be revoked and the necessary authorization headers.

LANGUAGE: bash
CODE:
curl https://api.clerk.com/v1/invitations/<invitation_id>/revoke -X POST -H "Authorization:Bearer {{secret}}" -H 'Content-Type:application/json'

----------------------------------------

TITLE: Defining VerificationCodeTooManyRequestsCode Error in JSON for Clerk
DESCRIPTION: This snippet defines the JSON structure for a 'VerificationCodeTooManyRequestsCode' error in Clerk. It includes short and long messages, with specific instructions about the 30-second wait period, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Too many verification code requests",
  "longMessage": "Too many verification code requests. Please wait at least 30 seconds to receive your code before trying again.",
  "code": "verification_code_too_many_requests"
}

----------------------------------------

TITLE: Revoking Organization Invitation Function Signature in TypeScript
DESCRIPTION: Function signature for revokeOrganizationInvitation, which revokes an OrganizationInvitation from a user for the specified organization. It takes RevokeOrganizationInvitationParams as input and returns a Promise resolving to OrganizationInvitation.

LANGUAGE: typescript
CODE:
function revokeOrganizationInvitation(
  params: RevokeOrganizationInvitationParams,
): Promise<OrganizationInvitation>

----------------------------------------

TITLE: Rendering React Logo SVG with Dynamic Styling
DESCRIPTION: This SVG component creates the React logo with paths for the atom symbol. It uses inline styles to set colors dynamically, allowing for light and dark theme variations.

LANGUAGE: SVG
CODE:
<svg viewBox="0 0 22 20" fill="none">
  <path style={{ fill: 'var(--light, #087EA4) var(--dark, #58C4DC)' }} d="M11 11.91a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />

  <g style={{ stroke: 'var(--light, #087EA4) var(--dark, #58C4DC)' }}>
    <path d="M11 14.41c5.523 0 10-2.014 10-4.5 0-2.485-4.477-4.5-10-4.5S1 7.425 1 9.91c0 2.486 4.477 4.5 10 4.5Z" />

    <path
      d="M7.102 12.16c2.762 4.783 6.745 7.653 8.897 6.41 2.153-1.242 1.659-6.127-1.103-10.91C12.136 2.877 8.152.007 6 1.25 3.847 2.493 4.341 7.377 7.102 12.16Z"
    />

    <path
      d="M7.102 7.66C4.341 12.443 3.847 17.328 6 18.57c2.153 1.243 6.136-1.627 8.898-6.41 2.76-4.783 3.255-9.667 1.102-10.91C13.847.007 9.864 2.877 7.102 7.66Z"
    />
  </g>
</svg>

----------------------------------------

TITLE: Implementing Sign Out Functionality
DESCRIPTION: Updates ContentView to include a sign out button and integrate the authentication flow components.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct ContentView: View {
  @Environment(Clerk.self) private var clerk

  var body: some View {
    VStack {
      if let user = clerk.user {
        Text("Hello, \(user.id)")
        Button("Sign Out") {
          Task { try? await clerk.signOut() }
        }
      } else {
        SignUpOrSignInView()
      }
    }
  }
}

----------------------------------------

TITLE: Running Clerk Upgrade CLI Tool
DESCRIPTION: Commands for running the @clerk/upgrade CLI tool to assist with migration across different package managers.

LANGUAGE: bash
CODE:
npx @clerk/upgrade --from=core-1

LANGUAGE: bash
CODE:
yarn dlx @clerk/upgrade --from=core-1

LANGUAGE: bash
CODE:
pnpm dlx @clerk/upgrade --from=core-1

LANGUAGE: bash
CODE:
bun dlx @clerk/upgrade --from=core-1

----------------------------------------

TITLE: Configuring Clerk Plugin Hook Name in Fastify
DESCRIPTION: Shows how to configure the Clerk plugin's hook timing by specifying the hookName option. This determines at which point in the request lifecycle the authentication check occurs.

LANGUAGE: typescript
CODE:
fastify.register(clerkPlugin, {
  hookName: 'preHandler',
})

----------------------------------------

TITLE: Installing Clerk Next.js SDK
DESCRIPTION: Commands for installing the @clerk/nextjs package using various package managers.

LANGUAGE: bash
CODE:
npm install @clerk/nextjs

LANGUAGE: bash
CODE:
yarn add @clerk/nextjs

LANGUAGE: bash
CODE:
pnpm add @clerk/nextjs

LANGUAGE: bash
CODE:
bun add @clerk/nextjs

----------------------------------------

TITLE: NotAuthorizedToMoveApplicationToOrganization Error Response in JSON
DESCRIPTION: Error response when attempting to move an application to an organization without being a member.

LANGUAGE: json
CODE:
{
  "shortMessage": "unauthorized request",
  "longMessage": "You need to be a member of organization <OrgID>, in order to move application <AppID>.",
  "code": "authorization_invalid_code"
}

----------------------------------------

TITLE: Prebuilt Organization Components Overview
DESCRIPTION: List of available prebuilt Clerk components for managing organizations, including CreateOrganization, OrganizationProfile, OrganizationList, and OrganizationSwitcher.

LANGUAGE: markdown
CODE:
- [`<CreateOrganization />`] - A form for a user to create a new organization.
- [`<OrganizationProfile />`] - A profile page for the user's currently active organization.
- [`<OrganizationList />`] - A list of organizations that a user is a member of.
- [`<OrganizationSwitcher />`] - A dropdown menu that handles all organization flows.

----------------------------------------

TITLE: Creating a Header with Clerk Authentication Components
DESCRIPTION: Example of creating a header component using Clerk's prebuilt control components for authentication.

LANGUAGE: tsx
CODE:
import { SignInButton, SignedIn, SignedOut, UserButton } from '@clerk/react-router'

export default function App() {
  return (
    <header>
      <SignedOut>
        <SignInButton />
      </SignedOut>
      <SignedIn>
        <UserButton />
      </SignedIn>
    </header>
  )
}

----------------------------------------

TITLE: Implementing Infinite Organization Switcher in Next.js
DESCRIPTION: React component that implements an infinite scrolling list of organizations with switching functionality using Clerk's useOrganizationList hook with infinite loading enabled.

LANGUAGE: jsx
CODE:
'use client'

import { useAuth, useOrganizationList } from '@clerk/nextjs'
import CreateOrganization from '../components/create-organization'

export default function JoinedOrganizations() {
  const { isLoaded, setActive, userMemberships } = useOrganizationList({
    userMemberships: {
      infinite: true,
    },
  })
  const { orgId } = useAuth()

  if (!isLoaded) {
    return <p>Loading...</p>
  }

  return (
    // ... component JSX
  )
}

----------------------------------------

TITLE: Handling Unauthenticated Requests in TypeScript
DESCRIPTION: Method to handle 401 responses from Frontend API by refreshing client and session objects. Takes optional broadcast parameter.

LANGUAGE: typescript
CODE:
function handleUnauthenticated(opts?: { broadcast: boolean }): Promise<unknown>

----------------------------------------

TITLE: Custom Link Redirection with Clerk Auth
DESCRIPTION: Example demonstrating how to create a custom HTML anchor that uses Clerk's redirectWithAuth helper for authenticated navigation.

LANGUAGE: jsx
CODE:
<a onClick={() => clerk.redirectWithAuth('your_destination_url')}>My link</a>

----------------------------------------

TITLE: Updating a Sign-Up in Clerk
DESCRIPTION: This method updates the current SignUp object with new information.

LANGUAGE: typescript
CODE:
function update(params: SignUpUpdateParams): Promise<SignUpResource>

----------------------------------------

TITLE: Updating Clerk.configure in Ruby SDK v4
DESCRIPTION: This snippet demonstrates the change in Clerk.configure from using 'api_key' to 'secret_key'. It shows how to properly configure the Clerk Ruby SDK with the new parameter.

LANGUAGE: ruby
CODE:
require 'clerk'

Clerk.configure do |c|
  c.api_key = `{{secret}}`
  c.secret_key = `{{secret}}`
end

----------------------------------------

TITLE: Implementing GoogleOneTap in Tanstack Start
DESCRIPTION: Example of using the GoogleOneTap component in a Tanstack Start application. The component is rendered on a sign-in page and uses the createFileRoute function to define the route.

LANGUAGE: tsx
CODE:
import { GoogleOneTap } from '@clerk/tanstack-start'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/sign-in')({
  component: SignIn,
})

function SignIn() {
  return <GoogleOneTap />
}

----------------------------------------

TITLE: Implementing Waitlist Component
DESCRIPTION: Basic implementation of the Clerk Waitlist component on the home page route.

LANGUAGE: jsx
CODE:
import { Waitlist } from '@clerk/nextjs'

export default function Page() {
  return <Waitlist />
}

----------------------------------------

TITLE: Preparing Phone Number Verification in Clerk
DESCRIPTION: This method initiates a phone number verification process by sending a one-time verification code (OTP) via SMS to the phone number associated with the current sign-up attempt.

LANGUAGE: typescript
CODE:
function preparePhoneNumberVerification(
  params?: PreparePhoneNumberVerificationParams,
): Promise<SignUpResource>

----------------------------------------

TITLE: Implementing MFA Enforcement Middleware in Astro
DESCRIPTION: Update clerkMiddleware() for Astro to check if the user has MFA enabled and redirect to the MFA setup page if necessary. This middleware also handles sign-in page redirection for authenticated users.

LANGUAGE: tsx
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/astro/server'

const isMFARoute = createRouteMatcher(['/account/manage-mfa/add(.*)'])
const isSignInRoute = createRouteMatcher(['/sign-in(.*)'])

export const onRequest = clerkMiddleware((auth, context) => {
  const { userId, sessionClaims } = auth()

  // Redirect to homepage if the user is signed in and on the sign-in page
  if (userId !== null && isSignInRoute(context.request)) {
    return Response.redirect(new URL('/', context.request.url))
  }

  // Redirect to MFA setup page if MFA is not enabled
  if (userId !== null && !isMFARoute(context.request)) {
    if (sessionClaims.isMfa === undefined) {
      console.error('You need to add the `isMfa` claim to your session token.')
    }
    if (sessionClaims.isMfa === false) {
      return Response.redirect(new URL('/account/manage-mfa/add', context.request.url))
    }
  }
})

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Installing Clerk Fastify SDK
DESCRIPTION: Commands for installing the @clerk/fastify package using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/fastify

LANGUAGE: bash
CODE:
yarn add @clerk/fastify

LANGUAGE: bash
CODE:
pnpm add @clerk/fastify

LANGUAGE: bash
CODE:
bun add @clerk/fastify

----------------------------------------

TITLE: Implementing Identifier Not Found Error in Clerk
DESCRIPTION: Error response when a required identifier (email, phone, username) cannot be found in the system.

LANGUAGE: json
CODE:
{
  "shortMessage": "Couldn't find your account.",
  "code": "form_identifier_not_found"
}

----------------------------------------

TITLE: Implementing Clerk Sign-in with React
DESCRIPTION: Example of using $clerkStore in a React component to implement a sign-in button. Uses @nanostores/react for state management and @clerk/astro/client for Clerk functionality.

LANGUAGE: tsx
CODE:
import { useStore } from '@nanostores/react'
import { $clerkStore } from '@clerk/astro/client'

export default function SignIn() {
  const clerk = useStore($clerkStore)

  return <button onClick={() => clerk.openSignIn()}>Sign in</button>
}

----------------------------------------

TITLE: Defining Clerk SVG Icon with Dynamic Theming
DESCRIPTION: SVG viewBox definition with a complex path element that uses CSS variables for dynamic light/dark theme coloring. The icon includes detailed path coordinates for the Clerk logo shape.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 32 32">
  <path
    style={{ fill: 'var(--light, black) var(--dark, white)' }}
    d="M30.056 8.841 31 6.298l-.04-.157L21.617 8.7c.994-1.498.653-2.7.653-2.7s-2.983 1.98-5.24 1.929c-2.256-.052-2.982-.678-6.442.469s-4.438 4.667-5.44 5.421C4.146 14.575 1 17.04 1 17.04l.007.044 2.836-.94s-.777.763-2.43 3.079l-.077-.074.002.016s1.329 2.111 2.633 1.72c.152-.049.3-.113.441-.19.525.303 1.21.602 1.967.685a12.63 12.63 0 0 1-.94-1.323l.354-.24-.055.042 1.08.412-.12-1.057.01-.007 1.06.404-.132-.96c.135-.073.27-.142.403-.207l1.109-4.35 4.575-3.245-.364.951c-.928 2.373-2.67 2.931-2.67 2.931l-.727.287c-.54.665-.768.828-.954 3.059.436-.114.852-.14 1.23-.037 1.955.548 2.632 2.998 2.106 3.675-.132.17-.446.46-.842.8h-.793l-.01.668-.082.066H9.81l-.01.652c-.071.057-.142.112-.213.166-.759.017-1.719-.67-1.719-.67 0 .624.501 1.589.501 1.589l.09-.045-.077.058s2.03 1.408 3.309.886c1.138-.461 4.08-2.872 6.621-4.014L26 19.764l1.014-2.73-5.859 1.604v-2.453l6.873-1.883 1.014-2.732-7.887 2.161v-2.452l8.9-2.438ZM16.103 14.04l1.824-.5.024.096-.57 1.533-1.89.518.612-1.647Zm.63 3.281-1.891.519.61-1.647 1.824-.5.024.096-.567 1.532Zm2.463-.55-1.89.518.61-1.647 1.825-.5.024.095-.569 1.533Z"
  />
</svg>

----------------------------------------

TITLE: Installing Clerk Nuxt SDK
DESCRIPTION: Commands to install the @clerk/nuxt package using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/nuxt

LANGUAGE: bash
CODE:
yarn add @clerk/nuxt

LANGUAGE: bash
CODE:
pnpm add @clerk/nuxt

LANGUAGE: bash
CODE:
bun add @clerk/nuxt

----------------------------------------

TITLE: Reordering Default Items in UserButton for Next.js
DESCRIPTION: This snippet shows how to reorder default items and add a custom link in the UserButton component for a Next.js application.

LANGUAGE: tsx
CODE:
'use client'

import { UserButton } from '@clerk/nextjs'

const DotIcon = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" />
    </svg>
  )
}

export default function Home() {
  return (
    <header>
      <UserButton>
        <UserButton.MenuItems>
          <UserButton.Action label="signOut" />
          <UserButton.Link
            label="Create organization"
            labelIcon={<DotIcon />}
            href="/create-organization"
          />
          <UserButton.Action label="manageAccount" />
        </UserButton.MenuItems>
      </UserButton>
    </header>
  )
}

----------------------------------------

TITLE: Implementing clerkMiddleware in Nuxt Server Middleware
DESCRIPTION: This code creates a server middleware file that imports and exports the clerkMiddleware for manual configuration.

LANGUAGE: typescript
CODE:
import { clerkMiddleware } from '@clerk/nuxt/server'
export default clerkMiddleware()

----------------------------------------

TITLE: Configuring DMARC TXT Record for Email Authentication
DESCRIPTION: Example TXT record configuration for setting up DMARC email authentication policy. The record specifies a reject policy for failed authentications and includes reporting email addresses.

LANGUAGE: txt
CODE:
TXT Record

name:
_dmarc<.example.com>

content:
v=DMARC1; p=reject; pct=100; rua=mailto:you@example.com; ruf=mailto:you@example.com;

----------------------------------------

TITLE: JSON Representation of NotImplemented Error in Clerk
DESCRIPTION: This snippet outlines the structure of a NotImplemented error in Clerk. It includes a short message, a long message indicating that a specific feature is not available yet, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "not implemented",
  "longMessage": "Feature `<feature>` is not available yet",
  "code": "feature_not_implemented_code"
}

----------------------------------------

TITLE: Next.js API Route Authentication
DESCRIPTION: Example of implementing authentication in Next.js API routes using the new withAuth middleware.

LANGUAGE: jsx
CODE:
import { withAuth } from '@clerk/nextjs/api'

export default withAuth(async (req, res) => {
  const { userId, sessionId, getToken } = req.auth
  const hasuraToken = await getToken({ template: 'hasura' })
  // Your handler
})

----------------------------------------

TITLE: Handling throwOnCancel in React
DESCRIPTION: Demonstrates error handling with throwOnCancel option in React, including catching and handling ClerkRuntimeError when users cancel reverification.

LANGUAGE: tsx
CODE:
import { useReverification } from '@clerk/clerk-react'
import { isClerkRuntimeError } from '@clerk/clerk-react/errors'

export function MyButton() {
  const [enhancedFetcher] = useReverification(myFetcher, { throwOnCancel: true })

  const handleClick = async () => {
    try {
      const myData = await enhancedFetcher()
    } catch (e) {
      // Handle if user cancels the reverification process
      if (isClerkRuntimeError(e) && e.code === 'reverification_cancelled') {
        console.error('User cancelled reverification', e.code)
      }
    }
  }

  return <button onClick={handleClick}>Update user</button>
}

----------------------------------------

TITLE: Running the Clerk Upgrade CLI Tool
DESCRIPTION: Commands to run the @clerk/upgrade CLI tool for assistance in upgrading to Core 2.

LANGUAGE: bash
CODE:
npx @clerk/upgrade --from=core-1

LANGUAGE: bash
CODE:
yarn dlx @clerk/upgrade --from=core-1

LANGUAGE: bash
CODE:
pnpm dlx @clerk/upgrade --from=core-1

LANGUAGE: bash
CODE:
bun dlx @clerk/upgrade --from=core-1

----------------------------------------

TITLE: Accessing Organization Information on Client-Side in Next.js
DESCRIPTION: This snippet illustrates how to access organization information on the client-side in a Next.js application using Clerk's useOrganization hook.

LANGUAGE: tsx
CODE:
'use client'

import { OrganizationList, useOrganization } from '@clerk/nextjs'

export default function Home({ params }: { params: { slug: string } }) {
  const { organization } = useOrganization()

  if (!organization || organization.slug != params.slug) {
    return (
      <>
        <p>Sorry, organization {params.slug} is not valid.</p>
        <OrganizationList
          hidePersonal={false}
          hideSlug={false}
          afterCreateOrganizationUrl="/orgs/:slug"
          afterSelectOrganizationUrl="/orgs/:slug"
          afterSelectPersonalUrl="/me"
        />
      </>
    )
  }

  // Access the organization name from the organization object
  return <div>{organization && `Welcome to organization ${organization.name}`}</div>
}

----------------------------------------

TITLE: Attempting Phone Number Verification in Clerk
DESCRIPTION: This method attempts to verify a phone number by validating a one-time verification code provided by the user against the code sent during the prepare verification step.

LANGUAGE: typescript
CODE:
function attemptPhoneNumberVerification(
  params: AttemptPhoneNumberVerificationParams,
): Promise<SignUpResource>

----------------------------------------

TITLE: TypeScript Interface Properties
DESCRIPTION: Interface properties defining the structure of SessionVerification, including status states, verification levels, and authentication factors.

LANGUAGE: typescript
CODE:
interface SessionVerification {
  status: 'needs_first_factor' | 'needs_second_factor' | 'complete';
  level: 'first_factor' | 'second_factor' | 'multi_factor';
  session: Session;
  firstFactorVerification: Verification;
  secondFactorVerification: Verification;
  supportedFirstFactors: (EmailCodeFactor | PhoneCodeFactor | PasswordFactor)[];
  supportedSecondFactors: (TOTPFactor | PhoneCodeFactor | BackupCodeFactor)[];
}

----------------------------------------

TITLE: Setting Clerk API Key in Environment File
DESCRIPTION: Example of setting the Clerk Publishable Key in a .env file for a Vite project.

LANGUAGE: env
CODE:
VITE_CLERK_PUBLISHABLE_KEY={{pub_key}}

----------------------------------------

TITLE: Updating UserProfile Component with Path Routing
DESCRIPTION: Example of updating the UserProfile component to use the new default path routing strategy.

LANGUAGE: jsx
CODE:
<UserProfile path="/user-profile" />

----------------------------------------

TITLE: Implementing Incorrect Password Error in Clerk
DESCRIPTION: Error response when a user provides an incorrect password during authentication.

LANGUAGE: json
CODE:
{
  "shortMessage": "Password is incorrect. Try again, or use another method.",
  "code": "form_password_incorrect"
}

----------------------------------------

TITLE: Updating clerkClient Usage
DESCRIPTION: Changes in clerkClient implementation, showing the new function-based approach that accepts Astro context.

LANGUAGE: typescript
CODE:
import type { APIRoute } from 'astro'
import { clerkClient } from '@clerk/astro/server'

export const GET: APIRoute = async (context) => {
  clerkClient(context).users.getUser(/* ... */)
  // ...
}

----------------------------------------

TITLE: Defining EnterpriseSSOStrategy Type in TypeScript
DESCRIPTION: Defines the EnterpriseSSOStrategy type as a literal string 'enterprise_sso'. This type is used for Enterprise SSO authentication flows in Clerk.

LANGUAGE: typescript
CODE:
type EnterpriseSSOStrategy = `enterprise_sso`

----------------------------------------

TITLE: Configuring Astro with Clerk Integration
DESCRIPTION: Updates to astro.config.mjs to include Clerk integration, SSR adapter, and server output configuration.

LANGUAGE: typescript
CODE:
import { defineConfig } from 'astro/config'
import node from '@astrojs/node'
import clerk from '@clerk/astro'

export default defineConfig({
  integrations: [clerk()],
  adapter: node({ mode: 'standalone' }),
  output: 'server',
})

----------------------------------------

TITLE: Implementing Custom Sign-Out in iOS with Clerk
DESCRIPTION: This Swift code snippet shows how to create a custom sign-out view in iOS using Clerk. It displays the active session ID and provides a sign-out button that calls Clerk's signOut() method when tapped.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct SignOutView: View {
  @Environment(Clerk.self) private var clerk

  var body: some View {
    if let session = clerk.session {
      Text("Active Session: \(session.id)")
      Button("Sign out") {
        Task { await signOut() }
      }
    } else {
      Text("You are signed out")
    }
  }
}

extension SignOutView {

  func signOut() async {
    do {
      try await clerk.signOut()
    } catch {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling.
      dump(error)
    }
  }
}

----------------------------------------

TITLE: Implementing Authorization-based Protection with Default Roles
DESCRIPTION: This snippet demonstrates how to use clerkMiddleware to protect routes based on default roles, checking if a user has the admin role for accessing admin routes.

LANGUAGE: typescript
CODE:
import { clerkMiddleware } from '@clerk/nuxt/server'

export default clerkMiddleware((event) => {
  const { has } = event.context.auth
  const isAdminRoute = event.path.startsWith('/api/admin')
  const isAdmin = has({
    role: 'org:admin',
  })

  if (isAdminRoute) {
    if (!isAdmin) {
      throw createError({
        statusCode: 403,
        statusMessage: 'Unauthorized: Admin access required',
      })
    }
  }
})

----------------------------------------

TITLE: LastIdentificationSetFor2FAFailed Error Response
DESCRIPTION: JSON response when attempting to set the only identification as a second factor, which requires at least two identifications to be present.

LANGUAGE: json
CODE:
{
  "shortMessage": "Update failed",
  "longMessage": "You cannot set your last identification as second factor.",
  "code": "identification_set_for2_f_a_failed_code"
}

----------------------------------------

TITLE: Defining SignInTokenCannotBeRevoked Error in JSON
DESCRIPTION: Defines the error message and code for a sign-in token that cannot be revoked in Clerk. The status placeholder in the long message should be replaced with the actual token status.

LANGUAGE: json
CODE:
{
  "shortMessage": "cannot revoke",
  "longMessage": "Sign in token cannot be revoked because its status is <status>. Only pending tokens can be revoked.",
  "code": "sign_in_token_cannot_be_revoked_code"
}

----------------------------------------

TITLE: Making a POST Request with Testing Token in Shell
DESCRIPTION: This snippet demonstrates how to include a Testing Token in a Frontend API request for sign-up. The token is added as a query parameter named '__clerk_testing_token' to bypass bot detection mechanisms.

LANGUAGE: shell
CODE:
POST https://happy-hippo-1.clerk.accounts.dev/v1/client/sign_ups?__clerk_testing_token=1713877200-c_2J2MvPu9PnXcuhbPZNao0LOXqK9A7YrnBn0HmIWxy

----------------------------------------

TITLE: Implementing RedirectToUserProfile in React
DESCRIPTION: Implementation example for React applications showing how to use RedirectToUserProfile with ClerkProvider and environment variable configuration.

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, RedirectToUserProfile } from '@clerk/clerk-react'

// Import your Publishable Key
const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Add your Clerk Publishable Key to the .env file')
}

function PrivatePage() {
  return (
    <ClerkProvider publishableKey={PUBLISHABLE_KEY}>
      <SignedIn>
        <RedirectToUserProfile />
      </SignedIn>
      <SignedOut>
        <p>You need to sign in to view your user profile.</p>
      </SignedOut>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Configuring Clerk Handler in TanStack Start
DESCRIPTION: Demonstrates the basic setup of Clerk authentication handler in a TanStack Start application. The code shows how to integrate Clerk with TanStack routes by combining createClerkHandler with createStartHandler and defaultStreamHandler.

LANGUAGE: tsx
CODE:
import { createStartHandler, defaultStreamHandler } from '@tanstack/start/server'
import { getRouterManifest } from '@tanstack/start/router-manifest'
import { createRouter } from './router'
import { createClerkHandler } from '@clerk/tanstack-start/server'

export default createClerkHandler(
  createStartHandler({
    createRouter,
    getRouterManifest,
  }),
)(defaultStreamHandler)

----------------------------------------

TITLE: Accessing SignUp State in React
DESCRIPTION: Example showing how to use the $signUpStore with React to check the current sign-up status. Uses @nanostores/react for state management and handles undefined state.

LANGUAGE: tsx
CODE:
import { useStore } from '@nanostores/react'
import { $signUpStore } from '@clerk/astro/client'

export default function SignUpStep() {
  const signUp = useStore($signUpStore)

  if (signUp === undefined) {
    // Add logic to handle loading state
    return null
  }

  return <div>The current sign-up attempt status is {signUp.status}.</div>
}

----------------------------------------

TITLE: Updating UserButton Component
DESCRIPTION: Example of removing the unnecessary afterSignOutUrl prop from the UserButton component.

LANGUAGE: jsx
CODE:
<UserButton afterSignOutUrl="/" />
<UserButton />

----------------------------------------

TITLE: Configuring Environment Variables for Primary Domain
DESCRIPTION: Environment variable configuration for the primary domain in Next.js and Remix applications

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up

----------------------------------------

TITLE: Creating Invitation with cURL in Clerk
DESCRIPTION: This snippet demonstrates how to create an invitation using cURL. It sends a POST request to the Clerk API with the email address of the invitee and the necessary authorization headers.

LANGUAGE: bash
CODE:
curl https://api.clerk.com/v1/invitations -X POST -d '{"email_address": "email@example.com"}' -H "Authorization:Bearer {{secret}}" -H 'Content-Type:application/json'

----------------------------------------

TITLE: Installing @clerk/backend Core 2
DESCRIPTION: Commands for installing the latest version of @clerk/backend using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/backend

LANGUAGE: bash
CODE:
yarn add @clerk/backend

LANGUAGE: bash
CODE:
pnpm add @clerk/backend

LANGUAGE: bash
CODE:
bun add @clerk/backend

----------------------------------------

TITLE: Updating Phone Number with Clerk Backend SDK in TypeScript
DESCRIPTION: Function signature for updatePhoneNumber() method in Clerk's Backend SDK. It takes a phoneNumberId and UpdatePhoneNumberParams to update a PhoneNumber object.

LANGUAGE: typescript
CODE:
function updatePhoneNumber(
  phoneNumberId: string,
  params: UpdatePhoneNumberParams,
): Promise<PhoneNumber>

----------------------------------------

TITLE: Implementing User Session Management in React
DESCRIPTION: React component implementation using $sessionListStore to create a user button that displays the current session email and provides session switching functionality. Uses TypeScript with React and Clerk's authentication system.

LANGUAGE: typescript
CODE:
import { $sessionListStore, $clerkStore } from '@clerk/astro/client'

export default function UserButton() {
  const sessions = useStore($sessionListStore)
  const { session, setActive, signOut } = useStore($clerkStore)

  if (sessions === undefined) {
    // Handle loading state
    return <div>Loading sessions...</div>
  }

  return (
    <div>
      <div>{session.user.primaryEmailAddress}</div>
      <div role="menu">
        {sessions.map((sess) => (
          <button role="menuitem" onClick={() => setActive({ session: sess.id })} key={sess.id}>
            {sess.user.primaryEmailAddress}
          </button>
        ))}
        <button role="menuitem" onClick={() => signOut()}>
          Sign out of all accounts
        </button>
      </div>
    </div>
  )

----------------------------------------

TITLE: Basic SAML Connection List Retrieval
DESCRIPTION: Simple example of retrieving all SAML connections using the default parameters.

LANGUAGE: tsx
CODE:
const response = await clerkClient.samlConnections.getSamlConnectionList()

----------------------------------------

TITLE: Initializing Clerk in JavaScript
DESCRIPTION: Code snippet showing how to initialize Clerk with the Publishable Key and load it in a JavaScript file.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const publishableKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(publishableKey)
await clerk.load({
  // Set load options here
})

----------------------------------------

TITLE: InvalidProxyConfiguration Error Response in JSON
DESCRIPTION: Error response when proxy URL configuration is incorrect for accessing Clerk Frontend API.

LANGUAGE: json
CODE:
{
  "longMessage": "Clerk Frontend API cannot be accessed through the proxy URL. Make sure your proxy is configured correctly.",
  "code": "invalid_proxy_configuration_code"
}

----------------------------------------

TITLE: Protecting a Page with Clerk Auth in Astro
DESCRIPTION: This snippet shows how to protect a page using the auth() local in Astro. It checks if a user is signed in and redirects to sign-in if not.

LANGUAGE: astro
CODE:
---
const { userId, redirectToSignIn } = Astro.locals.auth()

if (!userId) {
  return redirectToSignIn()
}
---

<div>Protected page</div>

----------------------------------------

TITLE: Defining SignInTokenCanBeUsedOnlyInSignIn Error in JSON
DESCRIPTION: Specifies the error message and code for a sign-in token used outside of the sign-in process in Clerk.

LANGUAGE: json
CODE:
{
  "shortMessage": "not in sign in",
  "longMessage": "Sign in tokens can only be used during sign in.",
  "code": "sign_in_token_not_in_sign_in_code"
}

----------------------------------------

TITLE: Creating a Plasmo Chrome Extension Project
DESCRIPTION: Command to create a new Chrome Extension project using the Plasmo framework with Tailwind CSS and a src directory.

LANGUAGE: bash
CODE:
pnpm create plasmo --with-tailwindcss --with-src clerk-chrome-extension
cd clerk-chrome-extension

----------------------------------------

TITLE: Implementing Authentication State with useAuth() in React/TypeScript
DESCRIPTION: Example React component showcasing the usage of Clerk's useAuth() hook. The hook provides authentication state variables like isLoaded, isSignedIn, userId, and sessionId. It demonstrates proper handling of loading states and conditional rendering based on authentication status.

LANGUAGE: tsx
CODE:
export default function Example() {
  const { isLoaded, isSignedIn, userId, sessionId, getToken } = useAuth()

  if (!isLoaded) {
    return <div>Loading...</div>
  }

  if (!isSignedIn) {
    // You could also add a redirect to the sign-in page here
    return <div>Sign in to view this page</div>
  }

  return (
    <div>
      Hello, {userId}! Your current active session is {sessionId}.
    </div>
  )
}

----------------------------------------

TITLE: Accessing Clerk Object in Ruby on Rails Controller
DESCRIPTION: This snippet demonstrates how to include the Clerk::Authenticatable concern in a Rails application controller to access the clerk object. It also shows how to implement a method to require a Clerk session for authentication.

LANGUAGE: ruby
CODE:
class ApplicationController < ActionController::Base
  include Clerk::Authenticatable

  private

  # If the user is not authenticated, redirect to the sign-in page
  def require_clerk_session!
    # The `CLERK_SIGN_IN_URL` env var must be set or the `sign_in_url` method will fail
    redirect_to clerk.sign_in_url unless clerk.session
  end
end

----------------------------------------

TITLE: Defining SignInTokenAlreadyUsed Error in JSON
DESCRIPTION: Specifies the error message and code for an already used sign-in token in Clerk.

LANGUAGE: json
CODE:
{
  "shortMessage": "sign in token has already been used",
  "longMessage": "This sign in token has already been used. Each token can only be used once.",
  "code": "sign_in_token_already_used_code"
}

----------------------------------------

TITLE: Markdown Documentation Structure
DESCRIPTION: Structured markdown document outlining Clerk integration guides for different platforms and frameworks. Includes sections for full-stack frameworks (Next.js, Astro, Nuxt, etc.), frontend libraries (React, Vue, Expo, etc.), and backend frameworks (Express, Fastify).

LANGUAGE: markdown
CODE:
---
title: Quickstarts
description: See the getting started guides and tutorials.
---

## Full Stack

<Cards>
  - [Next.js](/docs/quickstarts/nextjs)
  - Easily add secure, beautiful, and fast authentication to your Next.js application with Clerk.
  - {<Include src="_partials/icons/nextjs" />}

  ---

  - [Astro](/docs/quickstarts/astro)
  - Easily add secure and SSR-friendly authentication to your Astro application with Clerk.
  - {<Include src="_partials/icons/astro" />}

  [... additional content truncated for brevity ...]


----------------------------------------

TITLE: Installing Latest Clerk Fastify SDK
DESCRIPTION: Commands to install the latest version of @clerk/fastify using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/fastify

LANGUAGE: bash
CODE:
yarn add @clerk/fastify

LANGUAGE: bash
CODE:
pnpm add @clerk/fastify

LANGUAGE: bash
CODE:
bun add @clerk/fastify

----------------------------------------

TITLE: Paginating Results with getInvitationList in TypeScript
DESCRIPTION: Shows how to implement pagination by using the 'offset' parameter in getInvitationList. This example skips the first 10 revoked invitations.

LANGUAGE: tsx
CODE:
const { data, totalCount } = await clerkClient.invitations.getInvitationList({
  status: 'revoked',
  // skips the first 10 results
  offset: 10,
})

----------------------------------------

TITLE: Implementing Clerk Components in JavaScript
DESCRIPTION: Example of how to add Clerk's SignIn and UserButton components to a JavaScript app based on the user's authentication state.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

if (clerk.user) {
  document.getElementById('app').innerHTML = `
    <div id="user-button"></div>
  `

  const userButtonDiv = document.getElementById('user-button')

  clerk.mountUserButton(userButtonDiv)
} else {
  document.getElementById('app').innerHTML = `
    <div id="sign-in"></div>
  `

  const signInDiv = document.getElementById('sign-in')

  clerk.mountSignIn(signInDiv)
}

----------------------------------------

TITLE: Detecting Impersonated Sessions in React
DESCRIPTION: This React snippet uses the useAuth() hook to access the authentication context and detect if the current session is impersonated.

LANGUAGE: jsx
CODE:
const { userId, actor } = useAuth()

return (
  <div>
    Server-side info:
    <p>
      {actor && (
        <span>
          User {actor.sub} has signed in as user {userId}
        </span>
      )}
    </p>
  </div>
)

----------------------------------------

TITLE: Creating Email Address Function Signature
DESCRIPTION: TypeScript function signature for creating an email address, showing the expected parameters and return type.

LANGUAGE: typescript
CODE:
function createEmailAddress(params: CreateEmailAddressParams): Promise<EmailAddress>

----------------------------------------

TITLE: Configuring Nuxt for Clerk Integration
DESCRIPTION: Adding the @clerk/nuxt module to the Nuxt configuration file.

LANGUAGE: typescript
CODE:
export default defineNuxtConfig({
  modules: ['@clerk/nuxt'],
})

----------------------------------------

TITLE: Example Telemetry Event Structure in JavaScript
DESCRIPTION: Shows the structure of a typical telemetry event object that Clerk collects, including event type, versions, and payload information.

LANGUAGE: javascript
CODE:
{
  event: 'COMPONENT_MOUNTED',
  cv: '4.62.1',
  sdk: '@clerk/nextjs',
  sdkv: '4.25.6',
  pk: 'pk_test_YmFsYW5jZWQtY293YmlyZC0xNi5jbGVyay5hY2NvdW50cy5kDXyk',
  payload: { component: 'SignIn', appearanceProp: false },
}

----------------------------------------

TITLE: DomainUpdateForbidden Error Response in JSON
DESCRIPTION: Error response when attempting to update a domain on a non-production instance.

LANGUAGE: json
CODE:
{
  "shortMessage": "Domain update was forbidden",
  "longMessage": "Domain can be only updated for production instances",
  "code": "domain_update_forbidden_code"
}

----------------------------------------

TITLE: Pre-rendering with Static Control Components in Astro
DESCRIPTION: Example of pre-rendering a page using Clerk's SignedIn component with isStatic={true} in server output mode.

LANGUAGE: astro
CODE:
---
export const prerender = true
---

<SignedIn isStatic={true}> You are signed in! </SignedIn>

----------------------------------------

TITLE: Defining SignUpForbiddenAccess Error in JSON for Clerk
DESCRIPTION: This snippet defines the JSON structure for the SignUpForbiddenAccess error in Clerk. It includes a short message, a long message explaining the forbidden access, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Sign up forbidden",
  "longMessage": "Access to this sign up is forbidden",
  "code": "resource_forbidden"
}

----------------------------------------

TITLE: Next.js Component with Appearance Props
DESCRIPTION: Example of implementing Clerk component styling in a Next.js application using the appearance prop.

LANGUAGE: typescript
CODE:
import { ClerkProvider, SignIn } from '@clerk/nextjs'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body>
          <SignIn
            appearance={{
              elements: {
                formButtonPrimary: 'your-org-button org-red-button',
              },
            }}
          />
        </body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Limiting Results in getOrganizationInvitationList in TypeScript
DESCRIPTION: Demonstrates how to limit the number of results returned by getOrganizationInvitationList. This example limits the results to 10 invitations.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const { data, totalCount } = await clerkClient.organizations.getOrganizationInvitationList({
  organizationId,
  // returns the first 10 results
  limit: 10,
})

----------------------------------------

TITLE: Importing Clerk SDK in Go
DESCRIPTION: Shows how to import the Clerk SDK package in a Go application using Go Modules.

LANGUAGE: go
CODE:
import (
  "github.com/clerk/clerk-sdk-go/v2"
)

----------------------------------------

TITLE: JSON Representation of FeatureNotEnabled Error in Clerk
DESCRIPTION: This snippet defines the structure of a FeatureNotEnabled error in Clerk. It includes a short message, a long message explaining that the feature is not enabled on the instance, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "not enabled",
  "longMessage": "This feature is not enabled on this instance",
  "code": "feature_not_enabled_code"
}

----------------------------------------

TITLE: Configuring Clerk Environment Variables
DESCRIPTION: Setting up required Clerk API keys in the environment configuration file.

LANGUAGE: sh
CODE:
CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Using revokeSession Function in TypeScript React
DESCRIPTION: Example of how to use the revokeSession function from the Clerk Backend SDK. It demonstrates revoking a session with a specific ID using the clerkClient.

LANGUAGE: tsx
CODE:
const sessionId = 'sess_123'

const response = await clerkClient.sessions.revokeSession(sessionId)

----------------------------------------

TITLE: Retrieving a RedirectUrl with Clerk Backend SDK in TypeScript
DESCRIPTION: This function retrieves a single RedirectUrl object using its ID. It takes a string parameter 'redirectUrlId' and returns a Promise that resolves to a RedirectUrl object.

LANGUAGE: typescript
CODE:
function getRedirectUrl(redirectUrlId: string): Promise<RedirectUrl>

----------------------------------------

TITLE: Handling Email Link Verification for Sign-in in Next.js
DESCRIPTION: This code snippet shows how to handle email link verification for the sign-in process in a Next.js application. It uses Clerk's useClerk hook and handles various verification statuses for sign-in.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useClerk } from '@clerk/nextjs'
import { EmailLinkErrorCodeStatus, isEmailLinkError } from '@clerk/nextjs/errors'
import Link from 'next/link'

export default function VerifyEmailLink() {
  const [verificationStatus, setVerificationStatus] = React.useState('loading')

  const { handleEmailLinkVerification, loaded } = useClerk()

  async function verify() {
    try {
      // Dynamically set the host domain for dev and prod
      // You could instead use an environment variable or other source for the host domain
      const protocol = window.location.protocol
      const host = window.location.host

      await handleEmailLinkVerification({
        // URL to navigate to if sign-in flow needs more requirements, such as MFA
        redirectUrl: `${protocol}//${host}/sign-in`,
      })

      // If not redirected at this point,
      // the flow has completed
      setVerificationStatus('verified')
    } catch (err: any) {
      let status = 'failed'

      if (isEmailLinkError(err)) {
        // If link expired, set status to expired
        if (err.code === EmailLinkErrorCodeStatus.Expired) {
          status = 'expired'
        } else if (err.code === EmailLinkErrorCodeStatus.ClientMismatch) {
          // OPTIONAL: This check is only required if you have
          // the 'Require the same device and browser' setting
          // enabled in the Clerk Dashboard
          status = 'client_mismatch'
        }
      }

      setVerificationStatus(status)
      return
    }
  }

  React.useEffect(() => {
    if (!loaded) return

    verify()
  }, [handleEmailLinkVerification, loaded])

  if (verificationStatus === 'loading') {
    return <div>Loading...</div>
  }

  if (verificationStatus === 'failed') {
    return (
      <div>
        <h1>Verify your email</h1>
        <p>The email link verification failed.</p>
        <Link href="/sign-in">Sign in</Link>
      </div>
    )
  }

  if (verificationStatus === 'expired') {
    return (
      <div>
        <h1>Verify your email</h1>
        <p>The email link has expired.</p>
        <Link href="/sign-in">Sign in</Link>
      </div>
    )
  }

  // OPTIONAL: This check is only required if you have
  // the 'Require the same device and browser' setting
  // enabled in the Clerk Dashboard
  if (verificationStatus === 'client_mismatch') {
    return (
      <div>
        <h1>Verify your email</h1>
        <p>
          You must complete the email link sign-in on the same device and browser as you started it
          on.
        </p>
        <Link href="/sign-in">Sign in</Link>
      </div>
    )
  }

  return (
    <div>
      <h1>Verify your email</h1>
      <p>Successfully signed in. Return to the original tab to continue.</p>
    </div>
  )
}

----------------------------------------

TITLE: Installing @clerk/testing Package
DESCRIPTION: Commands for installing the Clerk testing package using different package managers (npm, yarn, pnpm).

LANGUAGE: bash
CODE:
npm i @clerk/testing --save-dev

LANGUAGE: bash
CODE:
yarn add -D @clerk/testing

LANGUAGE: bash
CODE:
pnpm add @clerk/testing -D

----------------------------------------

TITLE: Skipping Results in getOrganizationInvitationList in TypeScript
DESCRIPTION: Shows how to use the offset parameter in getOrganizationInvitationList to skip a certain number of results. This example skips the first 10 results.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const { data, totalCount } = await clerkClient.organizations.getOrganizationInvitationList({
  organizationId,
  // skips the first 10 results
  offset: 10,
})

----------------------------------------

TITLE: Creating Redirect URL Implementation Example
DESCRIPTION: Example usage of the createRedirectUrl method using clerkClient to create a new redirect URL. Shows how to create a redirect URL pointing to example.com.

LANGUAGE: tsx
CODE:
const response = await clerkClient.redirectUrls.createRedirectUrl({
  url: 'https://example.com',
})

----------------------------------------

TITLE: Converting PhoneNumber to String in TypeScript
DESCRIPTION: Returns the phone number in E.164 format, including the country code and the phone number.

LANGUAGE: typescript
CODE:
function toString(): string

----------------------------------------

TITLE: Implementing SMS OTP Sign-In Flow in Next.js
DESCRIPTION: This code snippet shows how to implement a custom SMS OTP sign-in flow using Clerk in a Next.js application. It handles collecting the phone number, sending the OTP, verifying the code, and setting the active session for sign-in.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useSignIn } from '@clerk/nextjs'
import { PhoneCodeFactor, SignInFirstFactor } from '@clerk/types'
import { useRouter } from 'next/navigation'

export default function Page() {
  const { isLoaded, signIn, setActive } = useSignIn()
  const [verifying, setVerifying] = React.useState(false)
  const [phone, setPhone] = React.useState('')
  const [code, setCode] = React.useState('')
  const router = useRouter()

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault()

    if (!isLoaded && !signIn) return null

    try {
      // Start the sign-in process using the phone number method
      const { supportedFirstFactors } = await signIn.create({
        identifier: phone,
      })

      // Filter the returned array to find the 'phone_code' entry
      const isPhoneCodeFactor = (factor: SignInFirstFactor): factor is PhoneCodeFactor => {
        return factor.strategy === 'phone_code'
      }
      const phoneCodeFactor = supportedFirstFactors?.find(isPhoneCodeFactor)

      if (phoneCodeFactor) {
        // Grab the phoneNumberId
        const { phoneNumberId } = phoneCodeFactor

        // Send the OTP code to the user
        await signIn.prepareFirstFactor({
          strategy: 'phone_code',
          phoneNumberId,
        })

        // Set verifying to true to display second form
        // and capture the OTP code
        setVerifying(true)
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error('Error:', JSON.stringify(err, null, 2))
    }
  }

  async function handleVerification(e: React.FormEvent) {
    e.preventDefault()

    if (!isLoaded && !signIn) return null

    try {
      // Use the code provided by the user and attempt verification
      const signInAttempt = await signIn.attemptFirstFactor({
        strategy: 'phone_code',
        code,
      })

      // If verification was completed, set the session to active
      // and redirect the user
      if (signInAttempt.status === 'complete') {
        await setActive({ session: signInAttempt.createdSessionId })

        router.push('/')
      } else {
        // If the status is not complete, check why. User may need to
        // complete further steps.
        console.error(signInAttempt)
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error('Error:', JSON.stringify(err, null, 2))
    }
  }

  if (verifying) {
    return (
      <>
        <h1>Verify your phone number</h1>
        <form onSubmit={handleVerification}>
          <label htmlFor="code">Enter your verification code</label>
          <input value={code} id="code" name="code" onChange={(e) => setCode(e.target.value)} />
          <button type="submit">Verify</button>
        </form>
      </>
    )
  }

  return (
    <>
      <h1>Sign in</h1>
      <form onSubmit={handleSubmit}>
        <label htmlFor="phone">Enter phone number</label>
        <input
          value={phone}
          id="phone"
          name="phone"
          type="tel"
          onChange={(e) => setPhone(e.target.value)}
        />
        <button type="submit">Continue</button>
      </form>
    </>
  )
}

----------------------------------------

TITLE: Implementing SMS OTP Sign-In Flow in Next.js
DESCRIPTION: This code snippet shows how to implement a custom SMS OTP sign-in flow using Clerk in a Next.js application. It handles collecting the phone number, sending the OTP, verifying the code, and setting the active session for sign-in.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useSignIn } from '@clerk/nextjs'
import { PhoneCodeFactor, SignInFirstFactor } from '@clerk/types'
import { useRouter } from 'next/navigation'

export default function Page() {
  const { isLoaded, signIn, setActive } = useSignIn()
  const [verifying, setVerifying] = React.useState(false)
  const [phone, setPhone] = React.useState('')
  const [code, setCode] = React.useState('')
  const router = useRouter()

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault()

    if (!isLoaded && !signIn) return null

    try {
      // Start the sign-in process using the phone number method
      const { supportedFirstFactors } = await signIn.create({
        identifier: phone,
      })

      // Filter the returned array to find the 'phone_code' entry
      const isPhoneCodeFactor = (factor: SignInFirstFactor): factor is PhoneCodeFactor => {
        return factor.strategy === 'phone_code'
      }
      const phoneCodeFactor = supportedFirstFactors?.find(isPhoneCodeFactor)

      if (phoneCodeFactor) {
        // Grab the phoneNumberId
        const { phoneNumberId } = phoneCodeFactor

        // Send the OTP code to the user
        await signIn.prepareFirstFactor({
          strategy: 'phone_code',
          phoneNumberId,
        })

        // Set verifying to true to display second form
        // and capture the OTP code
        setVerifying(true)
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error('Error:', JSON.stringify(err, null, 2))
    }
  }

  async function handleVerification(e: React.FormEvent) {
    e.preventDefault()

    if (!isLoaded && !signIn) return null

    try {
      // Use the code provided by the user and attempt verification
      const signInAttempt = await signIn.attemptFirstFactor({
        strategy: 'phone_code',
        code,
      })

      // If verification was completed, set the session to active
      // and redirect the user
      if (signInAttempt.status === 'complete') {
        await setActive({ session: signInAttempt.createdSessionId })

        router.push('/')
      } else {
        // If the status is not complete, check why. User may need to
        // complete further steps.
        console.error(signInAttempt)
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error('Error:', JSON.stringify(err, null, 2))
    }
  }

  if (verifying) {
    return (
      <>
        <h1>Verify your phone number</h1>
        <form onSubmit={handleVerification}>
          <label htmlFor="code">Enter your verification code</label>
          <input value={code} id="code" name="code" onChange={(e) => setCode(e.target.value)} />
          <button type="submit">Verify</button>
        </form>
      </>
    )
  }

  return (
    <>
      <h1>Sign in</h1>
      <form onSubmit={handleSubmit}>
        <label htmlFor="phone">Enter phone number</label>
        <input
          value={phone}
          id="phone"
          name="phone"
          type="tel"
          onChange={(e) => setPhone(e.target.value)}
        />
        <button type="submit">Continue</button>
      </form>
    </>
  )
}

----------------------------------------

TITLE: Managing User Invitations with Vanilla JavaScript
DESCRIPTION: This JavaScript file demonstrates how to use the Clerk API to fetch and display user organization invitations. It dynamically populates the HTML table with invitation data and provides functionality to accept invitations.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!pubKey) {
  throw new Error('Add your VITE_CLERK_PUBLISHABLE_KEY to .env file')
}

const clerk = new Clerk('{{pub_key}}')
await clerk.load()

if (clerk.user) {
  const { data } = await clerk.user.getOrganizationInvitations()
  const invitations = data

  invitations.map((invitation) => {
    const tableBody = document.getElementById('invitations-table-body')
    const row = tableBody.insertRow()
    row.insertCell().textContent = invitation.emailAddress
    row.insertCell().textContent = invitation.publicOrganizationData.name
    row.insertCell().textContent = invitation.role
    row.insertCell().textContent = invitation.status

    // Show accept button for pending invitations
    if (invitation.status === 'pending') {
      const acceptBtn = document.createElement('button')
      acceptBtn.textContent = 'Accept'
      acceptBtn.addEventListener('click', async function (e) {
        e.preventDefault()
        await invitation.accept()
      })
      row.insertCell().appendChild(acceptBtn)
    }
  })
} else {
  // If there is no active user, mount Clerk's <SignIn />
  document.getElementById('app').innerHTML = `
    <div id="sign-in"></div>
  `

  const signInDiv = document.getElementById('sign-in')

  clerk.mountSignIn(signInDiv)
}

----------------------------------------

TITLE: Installing @clerk/clerk-expo v2 using pnpm
DESCRIPTION: Command to install the latest version of @clerk/clerk-expo using pnpm package manager.

LANGUAGE: bash
CODE:
pnpm add @clerk/clerk-expo@latest

----------------------------------------

TITLE: Creating Sign-Out Button Component
DESCRIPTION: Implementing a sign-out button component using Clerk's useClerk hook.

LANGUAGE: tsx
CODE:
import { useClerk } from '@clerk/clerk-expo'
import { useRouter } from 'expo-router'
import { Text, TouchableOpacity } from 'react-native'

export function SignOutButton() {
  const { signOut } = useClerk()
  const router = useRouter()

  const handleSignOut = async () => {
    await signOut()
    router.replace('/(auth)/sign-in')
  }

  return (
    <TouchableOpacity onPress={handleSignOut}>
      <Text>Sign out</Text>
    </TouchableOpacity>
  )
}

----------------------------------------

TITLE: JSON Error Structure for Invalid Rotating Token in Clerk
DESCRIPTION: Defines the JSON structure for an 'InvalidRotatingToken' error, which occurs when the rotating token doesn't match the client's token. It includes a short message, a long message with the mismatched token, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "<invalidCookieMessage>",
  "longMessage": "The client's rotating key does not match the given one <token>",
  "code": "cookie_invalid_code"
}

----------------------------------------

TITLE: Implementing Reverification in Rack Middleware with Clerk in Ruby
DESCRIPTION: This snippet demonstrates how to handle reverification in Rack middleware using Clerk::Rack::Reverification. It sets a LAX preset and applies reverification to all routes matching the '/*' pattern.

LANGUAGE: ruby
CODE:
require "rack"
require "clerk/rack"

require_relative "app"

use Clerk::Rack::Middleware
# Reverification preset is set to `LAX`
use Clerk::Rack::Reverification,
  preset: Clerk::StepUp::Preset::LAX,
  routes: ["/*"]

run App.new

----------------------------------------

TITLE: Creating HTML Template for Chrome Extension Content Script
DESCRIPTION: This HTML file serves as a template for the React component that will be used as a content script in the Chrome Extension.

LANGUAGE: html
CODE:
<!doctype html>
<html>
  <head>
    <title>Clerk Background Worker Demo</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>

  <body></body>
</html>

----------------------------------------

TITLE: Global CSS Styling Example
DESCRIPTION: Example of styling Clerk components using global CSS classes to customize the primary button appearance.

LANGUAGE: css
CODE:
.cl-formButtonPrimary {
  font-size: 14px;
  text-transform: none;
  background-color: #611bbd;
}

.cl-formButtonPrimary:hover,
.cl-formButtonPrimary:focus,
.cl-formButtonPrimary:active {
  background-color: #49247a;
}

----------------------------------------

TITLE: Basic Usage of getOrganizationMembershipList in TypeScript
DESCRIPTION: Example of how to use the getOrganizationMembershipList function with a basic configuration, providing only the organizationId parameter.

LANGUAGE: tsx
CODE:
const organizationId = 'org_2ZUtbk2yvnFGItdeze1ivCh3uqh'

const response = await clerkClient.organizations.getOrganizationMembershipList({ organizationId })

----------------------------------------

TITLE: Retrieving Token Function Definition in Swift
DESCRIPTION: Function signature for getToken() method that retrieves user session tokens or custom JWT templates. Takes optional GetTokenOptions parameter and returns a TokenResource.

LANGUAGE: swift
CODE:
func getToken(
  _ options: GetTokenOptions = .init()
) async throws -> TokenResource?

----------------------------------------

TITLE: SyncNonceAlreadyConsumed Error Response in JSON
DESCRIPTION: Error response when attempting to reuse an already consumed sync nonce.

LANGUAGE: json
CODE:
{
  "shortMessage": "sync nonce already consumed",
  "longMessage": "The given sync nonce has already been consumed and cannot be re-used.",
  "code": "sync_nonce_already_consumed_code"
}

----------------------------------------

TITLE: Configuring Clerk Environment Variables
DESCRIPTION: Setting up required Clerk API keys in the .env file

LANGUAGE: env
CODE:
CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Configuring ClerkProvider with Nonce for Strict-Dynamic CSP
DESCRIPTION: This code shows how to set up the ClerkProvider component with a nonce value for strict-dynamic Content Security Policy in a Next.js application. It demonstrates accessing the nonce from headers and passing it to the ClerkProvider.

LANGUAGE: typescript
CODE:
import { ClerkProvider } from '@clerk/nextjs'
import { headers } from 'next/headers'

export default function Layout({ children }) {
  return (
    // Note: since this is server-rendered, you don't _need_ to pass the nonce, see note below
    <ClerkProvider nonce={headers().get('x-nonce')} dynamic>
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Remix Token Generation Implementation
DESCRIPTION: Example showing token generation in a Remix application using action functions and server-side authentication.

LANGUAGE: typescript
CODE:
import { createClerkClient } from '@clerk/remix/api.server'
import { getAuth } from '@clerk/remix/ssr.server'
import { ActionFunction, json } from '@remix-run/node'

export const action: ActionFunction = async (req) => {
  const { sessionId } = await getAuth(req)

  const template = 'test'

  const token = await createClerkClient({
    secretKey: process.env.CLERK_SECRET_KEY,
  }).sessions.getToken(sessionId, template)

  return json({ token })
}

----------------------------------------

TITLE: Remix Token Generation Implementation
DESCRIPTION: Example showing token generation in a Remix application using action functions and server-side authentication.

LANGUAGE: typescript
CODE:
import { createClerkClient } from '@clerk/remix/api.server'
import { getAuth } from '@clerk/remix/ssr.server'
import { ActionFunction, json } from '@remix-run/node'

export const action: ActionFunction = async (req) => {
  const { sessionId } = await getAuth(req)

  const template = 'test'

  const token = await createClerkClient({
    secretKey: process.env.CLERK_SECRET_KEY,
  }).sessions.getToken(sessionId, template)

  return json({ token })
}

----------------------------------------

TITLE: Limiting Results in getOrganizationMembershipList Query
DESCRIPTION: Example of using the getOrganizationMembershipList function with the limit parameter to restrict the number of results returned.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const { data, totalCount } = await clerkClient.organizations.getOrganizationMembershipList({
  organizationId,
  // returns the first 10 memberships
  limit: 10,
})

----------------------------------------

TITLE: Custom Signing Key Configuration for Hasura
DESCRIPTION: YAML configuration showing how to set up Hasura with a custom HS256 signing key instead of JWKS

LANGUAGE: yaml
CODE:
HASURA_GRAPHQL_JWT_SECRET: '{"type": "HS256", "key": "<YOUR_SIGNING_KEY>" }'

----------------------------------------

TITLE: Displaying and Managing User Invitations in Next.js
DESCRIPTION: This React component uses the useOrganizationList hook to fetch and display user invitations. It renders a table of invitations with an 'Accept' button for each, allowing users to accept invitations directly from the UI.

LANGUAGE: jsx
CODE:
'use client'

import { useOrganizationList } from '@clerk/clerk-react'
import React from 'react'

export default function UserInvitationsList() {
  const { isLoaded, userInvitations } = useOrganizationList({
    userInvitations: {
      infinite: true,
      keepPreviousData: true,
    },
  })

  if (!isLoaded || userInvitations.isLoading) {
    return <>Loading</>
  }

  return (
    <>
      <h1>Organization invitations</h1>
      <table>
        <thead>
          <tr>
            <th>Email</th>
            <th>Organization name</th>
            <th>Role</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          {userInvitations.data?.map((invitation) => (
            <tr key={invitation.id}>
              <td>{invitation.emailAddress}</td>
              <td>{invitation.publicOrganizationData.name}</td>
              <td>{invitation.role}</td>
              <td>
                <button onClick={() => invitation.accept()}>Accept</button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      <button disabled={!userInvitations.hasNextPage} onClick={userInvitations.fetchNext}>
        Load more
      </button>
    </>
  )
}

----------------------------------------

TITLE: Accessing User Metadata in SMS Templates
DESCRIPTION: Shows how to interpolate specific metadata keys from user information in SMS templates using dot notation within Handlebars syntax.

LANGUAGE: handlebars
CODE:
{{user.metadata.foo.bar}}

----------------------------------------

TITLE: Implementing Server Actions for User Messages
DESCRIPTION: Server actions for creating and deleting user messages with Clerk authentication integration.

LANGUAGE: typescript
CODE:
'use server'

import { auth } from '@clerk/nextjs/server'
import { UserMessages } from './db/schema'
import { db } from './db'
import { eq } from 'drizzle-orm'

export async function createUserMessage(formData: FormData) {
  const { userId } = await auth()
  if (!userId) throw new Error('User not found')

  const message = formData.get('message') as string
  await db.insert(UserMessages).values({
    user_id: userId,
    message,
  })
}

export async function deleteUserMessage() {
  const { userId } = await auth()
  if (!userId) throw new Error('User not found')

  await db.delete(UserMessages).where(eq(UserMessages.user_id, userId))
}

----------------------------------------

TITLE: InvalidOriginHeader Error JSON Response
DESCRIPTION: JSON response structure for an invalid origin header error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid HTTP Origin header",
  "longMessage": "The Request HTTP Origin header must be equal to or a subdomain of the requesting URL.",
  "code": "origin_invalid_code"
}

----------------------------------------

TITLE: Running TanStack Start Development Server
DESCRIPTION: These commands show how to start the development server for a TanStack Start project using different package managers.

LANGUAGE: bash
CODE:
npm run dev

LANGUAGE: bash
CODE:
yarn dev

LANGUAGE: bash
CODE:
pnpm dev

LANGUAGE: bash
CODE:
bun dev

----------------------------------------

TITLE: Initializing Clerk Plugin in Fastify
DESCRIPTION: Setting up the Fastify server with Clerk plugin integration for authentication handling across all routes.

LANGUAGE: typescript
CODE:
import 'dotenv/config'
import Fastify from 'fastify'
import { clerkPlugin } from '@clerk/fastify'

const fastify = Fastify({ logger: true })

fastify.register(clerkPlugin)

const start = async () => {
  try {
    await fastify.listen({ port: 8080 })
  } catch (error) {
    fastify.log.error(error)
    process.exit(1)
  }
}

start()

----------------------------------------

TITLE: Clerk Variables Configuration in Vue
DESCRIPTION: Shows how to configure Clerk variables globally in a Vue application using the clerk plugin.

LANGUAGE: ts
CODE:
import { createApp } from 'vue'
import App from './App.vue'
import { clerkPlugin } from '@clerk/vue'

const app = createApp(App)
app.use(clerkPlugin, {
  appearance: {
    variables: {
      colorPrimary: 'blue',
      colorText: 'black',
    },
  },
})
app.mount('#app')

----------------------------------------

TITLE: Using Function as Children for State-Based Styling in React
DESCRIPTION: Shows how to use the function as children pattern to access component state for complex styling logic. This approach is useful for conditional rendering based on field state.

LANGUAGE: tsx
CODE:
<Clerk.Field name="email">
  <Clerk.FieldState>{(state) => state === 'invalid' && <ErrorIcon />}</Clerk.FieldState>
  <Clerk.Label>Email</Clerk.Label>
  <Clerk.Input />
  <Clerk.FieldError />
</Clerk.Field>

----------------------------------------

TITLE: IdentificationExists Error JSON Response for External Account
DESCRIPTION: JSON response structure for an existing external account error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "already exists",
  "longMessage": "This external account already exists.",
  "code": "external_account_exists_code"
}

----------------------------------------

TITLE: Defining SignInTokenRevoked Error in JSON
DESCRIPTION: Defines the error message and code for a revoked sign-in token in Clerk.

LANGUAGE: json
CODE:
{
  "shortMessage": "sign in token has been revoked",
  "longMessage": "This sign in token has been revoked and cannot be used anymore.",
  "code": "sign_in_token_revoked_code"
}

----------------------------------------

TITLE: Implementing Conditional Content Rendering
DESCRIPTION: Using Clerk's control components to conditionally render content based on user authentication status.

LANGUAGE: tsx
CODE:
import { SignedIn, SignedOut, useUser } from '@clerk/clerk-expo'
import { Link } from 'expo-router'
import { Text, View } from 'react-native'
import { SignOutButton } from '@/app/components/SignOutButton'

export default function Page() {
  const { user } = useUser()

  return (
    <View>
      <SignedIn>
        <Text>Hello {user?.emailAddresses[0].emailAddress}</Text>
        <SignOutButton />
      </SignedIn>
      <SignedOut>
        <Link href="/(auth)/sign-in">
          <Text>Sign in</Text>
        </Link>
        <Link href="/(auth)/sign-up">
          <Text>Sign up</Text>
        </Link>
      </SignedOut>
    </View>
  )
}

----------------------------------------

TITLE: Adding TypeScript Global Types for Clerk
DESCRIPTION: TypeScript type declaration for enabling Clerk type support in Express request handlers.

LANGUAGE: typescript
CODE:
/// <reference types="@clerk/express/env" />

----------------------------------------

TITLE: JavaScript Waitlist Component Mounting Example
DESCRIPTION: Example showing how to mount the Waitlist component using vanilla JavaScript and the @clerk/clerk-js package.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerk = new Clerk('{{pub_key}}')
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="waitlist"></div>
`

const waitlistDiv = document.getElementById('waitlist')

clerk.mountWaitlist(waitlistDiv)

----------------------------------------

TITLE: Implementing ClerkProvider in Chrome Extension
DESCRIPTION: Example of adding ClerkProvider to a Chrome Extension popup component, including error handling for missing API key.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/chrome-extension'

import { CountButton } from '~features/count-button'

import '~style.css'

const PUBLISHABLE_KEY = process.env.PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Please add the PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY to the .env.development file')
}

function IndexPopup() {
  return (
    <ClerkProvider publishableKey={PUBLISHABLE_KEY}>
      <div className="plasmo-flex plasmo-items-center plasmo-justify-center plasmo-h-16 plasmo-w-40">
        <CountButton />
      </div>
    </ClerkProvider>
  )
}

export default IndexPopup

----------------------------------------

TITLE: Implementing TOTP MFA Addition in Expo
DESCRIPTION: This code snippet shows how to create a page for adding TOTP-based MFA in an Expo application. It includes steps for generating a QR code, verifying the TOTP, and generating backup codes.

LANGUAGE: tsx
CODE:
import React from 'react'
import { useUser } from '@clerk/clerk-expo'
import { Link } from 'expo-router'
import { QrCodeSvg } from 'react-native-qr-svg'
import { FlatList, Button, Text, TextInput, View } from 'react-native'

import { BackupCodeResource, TOTPResource } from '@clerk/types'

type AddTotpSteps = 'add' | 'verify' | 'backupcodes' | 'success'
type DisplayFormat = 'qr' | 'uri'

function AddTOTPMfa({ setStep }: { setStep: React.Dispatch<React.SetStateAction<AddTotpSteps>> }) {
  const [totp, setTotp] = React.useState<TOTPResource | undefined>(undefined)
  const [displayFormat, setDisplayFormat] = React.useState<DisplayFormat>('qr')
  const { user } = useUser()

  React.useEffect(() => {
    void user
      ?.createTOTP()
      .then((totp: TOTPResource) => setTotp(totp))
      .catch((err) => console.error(JSON.stringify(err, null, 2)))
  }, [])

  return (
    <View>
      <Text>Add TOTP MFA</Text>

      {totp && displayFormat === 'qr' && (
        <>
          <View>
            <QrCodeSvg value={totp?.uri || ''} frameSize={200} />
          </View>
          <Button title="Use URI" onPress={() => setDisplayFormat('uri')} />
        </>
      )}

      {totp && displayFormat === 'uri' && (
        <>
          <View>
            <Text>{totp.uri}</Text>
          </View>
          <Button title="Use QR Code" onPress={() => setDisplayFormat('qr')} />
        </>
      )}

      <Button title="Verify" onPress={() => setStep('verify')} />
      <Button title="Reset" onPress={() => setStep('add')} />
    </View>
  )
}

function VerifyMFA({ setStep }: { setStep: React.Dispatch<React.SetStateAction<AddTotpSteps>> }) {
  const [code, setCode] = React.useState('')

  const { user } = useUser()

  const verifyTotp = async (e: any) => {
    await user
      ?.verifyTOTP({ code })
      .then(() => setStep('backupcodes'))
      .catch((err) => console.error(JSON.stringify(err, null, 2)))
  }

  return (
    <>
      <Text>Verify MFA</Text>
      <TextInput
        value={code}
        placeholder="Enter code"
        placeholderTextColor="#666666"
        onChangeText={(c) => setCode(c)}
      />
      <Button onPress={verifyTotp} title="Verify Code" />
      <Button onPress={() => setStep('add')} title="Reset" />
    </>
  )
}

function BackupCodes({ setStep }: { setStep: React.Dispatch<React.SetStateAction<AddTotpSteps>> }) {
  const { user } = useUser()
  const [backupCode, setBackupCode] = React.useState<BackupCodeResource | undefined>(undefined)

  React.useEffect(() => {
    if (backupCode) {
      return
    }

    void user
      ?.createBackupCode()
      .then((backupCode: BackupCodeResource) => setBackupCode(backupCode))
      .catch((err) => console.error(JSON.stringify(err, null, 2)))
  }, [])

  return (
    <>
      <Text>Verification was a success!</Text>
      {backupCode && (
        <View>
          <Text>
            Save this list of backup codes somewhere safe in case you need to access your account in
            an emergency
          </Text>

          <FlatList
            data={backupCode.codes.map((code) => ({
              key: code,
            }))}
            renderItem={({ item }) => <Text>{item.key}</Text>}
          />

          <Button title="Finish" onPress={() => setStep('success')} />
        </View>
      )}
    </>
  )
}

function Success() {
  return (
    <>
      <Text>Success</Text>
      <Text>You successfully added TOTP MFA via an authentication application</Text>
    </>
  )
}

export default function AddMfaScreen() {
  const [step, setStep] = React.useState<AddTotpSteps>('add')

  return (
    <>
      {step === 'add' && <AddTOTPMfa setStep={setStep} />}
      {step === 'verify' && <VerifyMFA setStep={setStep} />}
      {step === 'backupcodes' && <BackupCodes setStep={setStep} />}
      {step === 'success' && <Success />}

      <Link href="/account">
        <Text>Manage MFA</Text>
      </Link>
    </>
  )
}

----------------------------------------

TITLE: Installing Clerk Types Package
DESCRIPTION: Commands to install the @clerk/types package using different package managers (npm, yarn, pnpm, and bun). This package provides type definitions for adding type-safety to applications using Clerk.

LANGUAGE: bash
CODE:
npm install @clerk/types

LANGUAGE: bash
CODE:
yarn add @clerk/types

LANGUAGE: bash
CODE:
pnpm add @clerk/types

LANGUAGE: bash
CODE:
bun add @clerk/types

----------------------------------------

TITLE: Configuring Clerk Environment Variables
DESCRIPTION: Environment variable configuration for Clerk API keys required for authentication setup.

LANGUAGE: env
CODE:
VITE_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Demonstrating CSRF Attack Vector in HTML
DESCRIPTION: This HTML snippet shows how a malicious website could potentially trigger an unauthorized action on another site using an image tag with a query string. It illustrates the concept of a CSRF attack.

LANGUAGE: html
CODE:
<img src="https://www.example.com/?action=delete&id=123" />

----------------------------------------

TITLE: Handling Network Errors in Clerk Custom Flows for Expo
DESCRIPTION: Implement error handling for network issues in a Clerk sign-in flow within an Expo app, using isClerkRuntimeError to identify Clerk-specific errors.

LANGUAGE: typescript
CODE:
import { useSignIn, isClerkRuntimeError } from '@clerk/clerk-expo'
import { Link, useRouter } from 'expo-router'
import { Text, TextInput, Button, View } from 'react-native'
import React from 'react'

export default function SignInPage() {
  const { signIn, setActive, isLoaded } = useSignIn()
  const router = useRouter()

  const [emailAddress, setEmailAddress] = React.useState('')
  const [password, setPassword] = React.useState('')

  const onSignInPress = React.useCallback(async () => {
    if (!isLoaded) return
    try {
      const signInAttempt = await signIn.create({
        identifier: emailAddress,
        password,
      })

      // The rest of your custom flow logic
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      if (isClerkRuntimeError(err) && err.code === 'network_error') {
        console.error('Network error occurred!')
      }

      console.error(JSON.stringify(err, null, 2))
    }
  }, [isLoaded, emailAddress, password])

  return (
    <View>
      <Button title="Sign in" onPress={onSignInPress} />
    </View>
  )
}

----------------------------------------

TITLE: Generating Sign-In Token with Clerk API using cURL
DESCRIPTION: This snippet shows how to create a sign-in token using a cURL request to the Clerk API. It requires a secret key for authentication and returns a URL that can be used as an email link for automatic sign-in.

LANGUAGE: bash
CODE:
curl 'https://api.clerk.com/v1/sign_in_tokens' \
  -X POST \
  -H 'Authorization: Bearer {{secret}}' \
  -H 'Content-Type: application/json' \
  -d '{ "user_id": "user_123" }'

----------------------------------------

TITLE: SignInIdentificationOrUserDeleted Error in JSON for Clerk Sign-in
DESCRIPTION: Indicates that either the user or the selected identification has been deleted, requiring the sign-in process to be restarted.

LANGUAGE: json
CODE:
{
  "shortMessage": "identification or user deleted",
  "longMessage": "Either the user or the selected identification were deleted. Please start over.",
  "code": "sign_in_identification_or_user_deleted"
}

----------------------------------------

TITLE: Configuring Clerk Middleware Protection
DESCRIPTION: Implementation of Clerk middleware to protect application routes and require authentication.

LANGUAGE: typescript
CODE:
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware(async (auth) => {
  await auth.protect()
})

export const config = {
  matcher: [
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: ApplicationAlreadyBelongsToUser Error Response in JSON
DESCRIPTION: Error response when attempting to assign an application to a user who already owns it.

LANGUAGE: json
CODE:
{
  "shortMessage": "already belongs to user",
  "longMessage": "Application already belongs to the given user.",
  "code": "application_already_belongs_to_user_code"
}

----------------------------------------

TITLE: Configuring Environment Variables for Chrome Extension
DESCRIPTION: Creates an environment file to store the public key required for consistent CRX ID configuration.

LANGUAGE: env
CODE:
CRX_PUBLIC_KEY="<PUBLIC KEY>"

----------------------------------------

TITLE: Configuring Host Permissions for Clerk Chrome Extension in Production
DESCRIPTION: This JSON snippet demonstrates how to update the package.json file to include the necessary host permissions for a Chrome Extension using Clerk in production.

LANGUAGE: json
CODE:
{
  "manifest": {
    "key": "$CRX_PUBLIC_KEY",
    "permissions": ["cookies", "storage"],
    "host_permissions": ["https://<yourdomain>/*", "$CLERK_FRONTEND_API/*"]
  }
}

----------------------------------------

TITLE: Basic Sign-In Flow with Clerk Elements in React
DESCRIPTION: Demonstrates a basic sign-in flow using Clerk Elements components. This snippet serves as a starting point for further styling examples.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'

export default function SignInPage() {
  return (
    <SignIn.Root>
      <SignIn.Step name="start">
        <Clerk.Connection name="google">Sign in with Google</Clerk.Connection>
        <Clerk.Field name="identifier">
          <Clerk.Label>Email</Clerk.Label>
          <Clerk.Input />
          <Clerk.FieldError />
        </Clerk.Field>
        <SignIn.Action submit>Continue</SignIn.Action>
      </SignIn.Step>
      <SignIn.Step name="verifications">
        <SignIn.Strategy name="email_code">
          <Clerk.Field name="code">
            <Clerk.Label>Code</Clerk.Label>
            <Clerk.Input />
            <Clerk.FieldError />
          </Clerk.Field>
          <SignIn.Action submit>Verify</SignIn.Action>
        </SignIn.Strategy>
      </SignIn.Step>
    </SignIn.Root>
  )
}

----------------------------------------

TITLE: Creating a Clerk Instance in TypeScript
DESCRIPTION: This snippet demonstrates how to create a singleton Clerk instance using TypeScript. It includes importing necessary modules and setting up the basic structure for the createClerkInstance function.

LANGUAGE: typescript
CODE:
import { runOnce } from './utils'
// States accessible to other parts of your SDK and/or its users
import { $clerk, $state } from './stores'

export const createClerkInstance = runOnce(createClerkInstanceInternal)

async function createClerkInstanceInternal(options) {
  let clerkJSInstance = window.Clerk
}

----------------------------------------

TITLE: ApplicationAlreadyBelongsToOrganization Error Response in JSON
DESCRIPTION: Error response when attempting to move an application to an organization it already belongs to.

LANGUAGE: json
CODE:
{
  "shortMessage": "already belongs to organization",
  "longMessage": "Application already belongs to the selected organization.",
  "code": "application_already_belongs_to_organization_code"
}

----------------------------------------

TITLE: AllowlistIdentifierNotFound Error Response in JSON
DESCRIPTION: Error response structure when an allowlist identifier cannot be found in the system. Returns a not found error code with short and detailed messages.

LANGUAGE: json
CODE:
{
  "shortMessage": "Identifier not found",
  "longMessage": "No identifier was found with id <identifierID>",
  "code": "resource_not_found_code"
}

----------------------------------------

TITLE: Setting Clerk Environment Variables
DESCRIPTION: Configuration of Clerk Publishable Key in the environment file.

LANGUAGE: env
CODE:
VITE_CLERK_PUBLISHABLE_KEY={{pub_key}}

----------------------------------------

TITLE: Updating ClerkApp Options for Sign-in and Sign-up Redirects
DESCRIPTION: Configuration of ClerkApp options to set fallback redirect URLs for sign-in and sign-up processes.

LANGUAGE: typescript
CODE:
export default ClerkApp(App, {
  publishableKey: PUBLISHABLE_KEY,
  signInFallbackRedirectUrl: '/',
  signUpFallbackRedirectUrl: '/',
})

----------------------------------------

TITLE: Running Expo Web Project
DESCRIPTION: These commands demonstrate how to run an Expo web project using different package managers. They use the 'web' script to start the development server for the web platform.

LANGUAGE: Bash
CODE:
npm run web

LANGUAGE: Bash
CODE:
yarn web

LANGUAGE: Bash
CODE:
pnpm web

LANGUAGE: Bash
CODE:
bun web

----------------------------------------

TITLE: Ruby on Rails Reverification Controller Implementation
DESCRIPTION: Shows how to implement reverification in a Ruby on Rails controller using clerk_user_needs_reverification helper. Uses the 'moderate' preset to check for verification within 1 hour.

LANGUAGE: ruby
CODE:
class HomeController < ApplicationController
  before_action :require_reverification, only: :foo

  def foo
    render json: { success: "true" }
  end

  private

  # will halt the request and respond with a JSON that Clerk.js
  # will read and kickstart a reverification flow
  def require_reverification
    clerk_render_reverification(Clerk::StepUp::PRESETS[:moderate]) if clerk_user_needs_reverification?(Clerk::StepUp::PRESETS[:moderate])
  end
end

----------------------------------------

TITLE: Updating UserButton component
DESCRIPTION: Example of updating the UserButton component to remove the explicit afterSignOutUrl prop.

LANGUAGE: jsx
CODE:
<UserButton afterSignOutUrl="/" />
<UserButton />

----------------------------------------

TITLE: Verification State Properties
DESCRIPTION: Object properties that track the verification state of fields like email and phone number during sign-up.

LANGUAGE: typescript
CODE:
{
  unverifiedFields: string[],      // List of User attributes pending verification
  verifications: {               // Current verification state
    email_address: VerificationStatus,
    phone_number: VerificationStatus,
    external_account: VerificationStatus
  }
}

----------------------------------------

TITLE: Configuring CAPTCHA Appearance in React
DESCRIPTION: This snippet illustrates how to set the CAPTCHA appearance properties in a React application using the ClerkProvider component.

LANGUAGE: tsx
CODE:
import React from 'react'
import './App.css'
import { ClerkProvider } from '@clerk/clerk-react'

if (!process.env.REACT_APP_CLERK_PUBLISHABLE_KEY) {
  throw new Error('Missing Publishable Key')
}
const clerkPubKey = process.env.REACT_APP_CLERK_PUBLISHABLE_KEY

function App() {
  return (
    <ClerkProvider
      appearance={{
        captcha: {
          theme: 'dark',
          size: 'flexible',
          language: 'es-ES',
        },
      }}
      publishableKey={clerkPubKey}
    >
      {/* ... */}
    </ClerkProvider>
  )
}

export default App

----------------------------------------

TITLE: Authenticating Fauna Queries in Next.js
DESCRIPTION: React component demonstrating how to authenticate Fauna queries using Clerk JWT tokens in a Next.js application.

LANGUAGE: jsx
CODE:
'use client'

import React from 'react'
import { useAuth } from '@clerk/nextjs'
import { Client, fql } from 'fauna'

export default function Page() {
  const [message, setMessage] = React.useState('')
  // The `useAuth()` hook is used to get the `getToken()` method.
  const { getToken } = useAuth()

  // Create a function to make a query to Fauna.
  const makeQuery = async () => {
    let client

    try {
      // Get the custom Fauna token from Clerk.
      const clerkToken = await getToken({ template: 'fauna' })

      if (!clerkToken) {
        setMessage('No token found')
        return
      }

      // Initialize a new Fauna client with the Clerk token.
      client = new Client({ secret: clerkToken })

      // Make a query to Fauna.
      const response = await client.query(fql`'Hello World!'`)
      setMessage(JSON.stringify(response))
    } catch (error) {
      console.error(error)
      setMessage('Error occurred')
    } finally {
      if (client) client.close()
    }
  }

  return (
    <>
      <button onClick={makeQuery}>Make authenticated query</button>
      <p>Message: {message}</p>
    </>
  )
}

----------------------------------------

TITLE: Integrating InstantDB with Clerk in Next.js
DESCRIPTION: React component demonstrating the integration of InstantDB with Clerk in a Next.js application. It includes initialization, authentication, and sign-out functionality.

LANGUAGE: tsx
CODE:
'use client'

import { useAuth } from '@clerk/nextjs'
import { init } from '@instantdb/react'
import { useEffect } from 'react'

// Insert your app ID from https://instantdb.com/dash
const APP_ID = '<YOUR_APP_ID>'
// Use the Clerk client name that you set in the "Auth" tab of the InstantDB dashboard
const CLERK_CLIENT_NAME = 'clerk'

// Initialize InstantDB
const db = init({ appId: APP_ID })

export default function Page() {
  // Use `useAuth()` to get the `getToken()` and `signOut()` methods
  const { getToken, signOut } = useAuth()

  // Create a function to sign in to InstantDB with the Clerk token
  const signInToInstantWithClerkToken = async () => {
    // Get the JWT (token) from Clerk for your signed-in user
    const token = await getToken()

    if (!token) {
      return
    }

    // Create a long-lived session with InstantDB for your Clerk user
    // It will look up the user by email or create a new user with
    // the email provided in the session token
    db.auth.signInWithIdToken({
      clientName: CLERK_CLIENT_NAME,
      idToken: token,
    })
  }

  useEffect(() => {
    signInToInstantWithClerkToken()
  }, [])

  const { isLoading, user, error } = db.useAuth()

  if (isLoading) {
    return <div>Loading...</div>
  }

  if (error) {
    return <div>Error signing in to InstantDB! {error.message}</div>
  }

  if (user) {
    return (
      <div>
        <p>Signed in with InstantDB through Clerk!</p>{' '}
        <button
          onClick={() => {
            // First sign out of InstantDB to clear the InstantDB session
            db.auth.signOut().then(() => {
              // Then, sign out of Clerk to clear the Clerk session
              signOut()
            })
          }}
        >
          Sign out
        </button>
      </div>
    )
  }
  return (
    <div>
      <button onClick={signInToInstantWithClerkToken}>Sign in to InstantDB</button>
    </div>
  )
}

----------------------------------------

TITLE: Retrieving Authentication State with getAuth() in Remix
DESCRIPTION: The getAuth() function is a server-side helper that retrieves authentication state from the request object. It returns an Auth object and accepts optional configuration parameters.

LANGUAGE: javascript
CODE:
getAuth({
  args,
  opts: {
    secretKey: "your_secret_key_here"
  }
})

----------------------------------------

TITLE: Firebase CLI Login
DESCRIPTION: Command to authenticate with Firebase using the CLI.

LANGUAGE: bash
CODE:
firebase login

----------------------------------------

TITLE: Implementing React Component for Chrome Extension Content Script
DESCRIPTION: This React component creates a button that triggers the background service worker to retrieve a token. It demonstrates how to communicate between a content script and the background service worker in a Chrome Extension.

LANGUAGE: typescript
CODE:
import * as React from 'react'

export default function NewTab() {
  const [token, setToken] = React.useState<string | null>(null)

  const getToken = async (e: React.MouseEvent<HTMLButtonElement>) => {
    e.preventDefault()

    chrome.runtime.sendMessage({ greeting: 'get-token' }, (response) => {
      setToken(response.token)
    })
  }

  return (
    <div>
      <p>Clerk Background Worker Demo</p>
      <div className="App">
        <p>
          This new tab simulates a content page where you might want to access user information, or
          make a request to your backend server and include a user token in the request.
        </p>
        <p>Make sure that you are signed into the extension. You can have the popup closed.</p>
        <button type="button" onClick={getToken} className="button invert">
          Get token from service worker
        </button>
        {token && <p>Token: {token}</p>}
      </div>
    </div>
  )
}

----------------------------------------

TITLE: Creating Organization Domain - JavaScript Example
DESCRIPTION: Example of creating a new domain for an organization.

LANGUAGE: javascript
CODE:
await clerk.organization.createDomain('test-domain.com')

----------------------------------------

TITLE: Using Existing Components with Clerk Elements in React
DESCRIPTION: Demonstrates how to use the asChild prop to integrate existing UI components with Clerk Elements. This approach is useful when working with existing design systems or component libraries.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'

import { Button } from '@components/button'
import { Input } from '@components/input'

export default function SignInPage() {
  return (
    <SignIn.Root>
      <SignIn.Step name="start">
        <Clerk.Connection name="google" asChild>
          <Button>Sign in with Google</Button>
        </Clerk.Connection>
        <Clerk.Field name="identifier">
          <Clerk.Label>Email</Clerk.Label>
          <Clerk.Input asChild>
            <Input />
          </Clerk.Input>
          <Clerk.FieldError />
        </Clerk.Field>
        <SignIn.Action submit asChild>
          <Button>Continue</Button>
        </SignIn.Action>
      </SignIn.Step>
      <SignIn.Step name="verifications">
        <SignIn.Strategy name="email_code">
          <Clerk.Field name="code">
            <Clerk.Label>Code</Clerk.Label>
            <Clerk.Input asChild>
              <Input />
            </Clerk.Input>
            <Clerk.FieldError />
          </Clerk.Field>
          <SignIn.Action submit asChild>
            <Button>Continue</Button>
          </SignIn.Action>
        </SignIn.Strategy>
      </SignIn.Step>
    </SignIn.Root>
  )
}

----------------------------------------

TITLE: Syncing New User to Database with Inngest Function
DESCRIPTION: This snippet demonstrates how to create an Inngest function that listens for the 'clerk/user.created' event and inserts the new user into a database. It extracts relevant user information from the event payload and performs a database insert operation.

LANGUAGE: typescript
CODE:
const syncUser = inngest.createFunction(
  { id: 'sync-user-from-clerk' }, // ←The 'id' is an arbitrary string used to identify the function in the dashboard
  { event: 'clerk/user.created' }, // ← This is the function's triggering event
  async ({ event }) => {
    const user = event.data // The event payload's data will be the Clerk User json object
    const { id, first_name, last_name } = user
    const email = user.email_addresses.find(
      (e) => e.id === user.primary_email_address_id,
    ).email_address
    await database.users.insert({ id, email, first_name, last_name })
  },
)

----------------------------------------

TITLE: CannotTransferToAccountWithoutPaymentMethod Error Response in JSON
DESCRIPTION: Error response when attempting to transfer an application to an account without a payment method.

LANGUAGE: json
CODE:
{
  "shortMessage": "cannot transfer paid application, missing payment method",
  "longMessage": "The selected account doesn't have any payment methods associated with it.",
  "code": "transfer_paid_app_to_account_with_no_payment_method_code"
}

----------------------------------------

TITLE: Implementing Strict-Dynamic CSP with Next.js Middleware for Clerk
DESCRIPTION: This code snippet shows how to implement a strict-dynamic Content Security Policy using Next.js middleware. It generates a nonce per request, formats the CSP header, and sets the necessary headers for both the request and response.

LANGUAGE: typescript
CODE:
import { NextResponse } from 'next/server'
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware((auth, req) => {
  return applyCsp(req)
})

function applyCsp(req) {
  // create a randomly generated nonce value
  const nonce = Buffer.from(crypto.randomUUID()).toString('base64')

  // format the CSP header
  const cspHeader = `
    default-src 'self';
    script-src 'self' 'strict-dynamic' 'nonce-${nonce}' https: http: ${
      process.env.NODE_ENV === 'production' ? '' : `'unsafe-eval'`
    };
    connect-src 'self' https://{{fapi_url}};
    img-src 'self' https://img.clerk.com;
    worker-src 'self' blob:;
    style-src 'self';
    frame-src 'self' https://challenges.cloudflare.com;
    form-action 'self';
  `
  // Replace newline characters and spaces
  const contentSecurityPolicyHeaderValue = cspHeader.replace(/\s{2,}/g, ' ').trim()

  // set the nonce and csp values in the request headers
  const requestHeaders = new Headers(req.headers)
  requestHeaders.set('x-nonce', nonce)
  requestHeaders.set('Content-Security-Policy', contentSecurityPolicyHeaderValue)

  const response = NextResponse.next({
    request: {
      headers: requestHeaders,
    },
  })

  response.headers.set('Content-Security-Policy', contentSecurityPolicyHeaderValue)

  return response
}

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Setting Cookies via HTTP Response Header
DESCRIPTION: Demonstrates how a server sets a cookie using the Set-Cookie HTTP header. This example sets a session_id cookie with the value sess123.

LANGUAGE: http
CODE:
HTTP/2 200
Content-Type: text/html
Set-Cookie: session_id=sess123

<html>
  <body>
    <p>Hello, world!</p>
  </body>
</html>

----------------------------------------

TITLE: Setting Up Nhost and Clerk Providers in Next.js
DESCRIPTION: React component configuration showing how to properly wrap a Next.js application with both Nhost and Clerk providers for authentication context

LANGUAGE: jsx
CODE:
import { NhostNextProvider, NhostClient } from '@nhost/nextjs'
import { ClerkProvider, RedirectToSignIn, SignedIn, SignedOut } from '@clerk/nextjs'

const nhost = new NhostClient({
  subdomain: process.env.NEXT_PUBLIC_NHOST_SUBDOMAIN || '',
  region: process.env.NEXT_PUBLIC_NHOST_REGION || '',
})

function MyApp({ Component, pageProps }) {
  return (
    <NhostNextProvider nhost={nhost} initial={pageProps.nhostSession}>
      <ClerkProvider {...pageProps}>
        <SignedIn>
          <Component {...pageProps} />
        </SignedIn>
        <SignedOut>
          <RedirectToSignIn />
        </SignedOut>
      </ClerkProvider>
    </NhostNextProvider>
  )
}

----------------------------------------

TITLE: Configuring Clerk Middleware for Satellite Domain
DESCRIPTION: Middleware configuration for satellite domain authentication handling

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

const isPublicRoute = createRouteMatcher(['/'])

const options = {
  isSatellite: true,
  signInUrl: 'https://primary.dev/sign-in',
  signUpUrl: 'https://primary.dev/sign-up',
  domain: 'https://satellite.dev',
}

export default clerkMiddleware(async (auth, req) => {
  if (isPublicRoute(req)) return
  await auth.protect()
}, options)

----------------------------------------

TITLE: Running Next.js Development Server
DESCRIPTION: These commands show how to start the Next.js development server using different package managers. They allow developers to run and test the application locally.

LANGUAGE: bash
CODE:
npm run dev

LANGUAGE: bash
CODE:
yarn dev

LANGUAGE: bash
CODE:
pnpm dev

LANGUAGE: bash
CODE:
bun dev

----------------------------------------

TITLE: JavaScript SignUp Component Mounting
DESCRIPTION: Example demonstrating how to mount the SignUp component using vanilla JavaScript with Clerk.

LANGUAGE: typescript
CODE:
import { Clerk } from '@clerk/clerk-js'

const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="sign-up"></div>
`

const signUpDiv = document.getElementById('sign-up')

clerk.mountSignUp(signUpDiv)

----------------------------------------

TITLE: Implementing rootAuthLoader() without callback in React Router
DESCRIPTION: This snippet demonstrates how to use rootAuthLoader() in the loader() function of a root.tsx file without a callback, which simply returns the auth state.

LANGUAGE: tsx
CODE:
import { rootAuthLoader } from '@clerk/react-router/ssr.server'
import type { Route } from './+types/root'

export async function loader(args: Route.LoaderArgs) {
  return rootAuthLoader(args)
}

----------------------------------------

TITLE: Implementing TOTP MFA Management in Next.js
DESCRIPTION: This code snippet demonstrates how to create a page for managing TOTP-based MFA settings in a Next.js application. It includes components for enabling/disabling TOTP and generating backup codes.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useUser } from '@clerk/nextjs'
import Link from 'next/link'
import { BackupCodeResource } from '@clerk/types'

// If TOTP is enabled, provide the option to disable it
const TotpEnabled = () => {
  const { user } = useUser()

  const disableTOTP = async () => {
    await user?.disableTOTP()
  }

  return (
    <div>
      <p>
        TOTP via authentication app enabled - <button onClick={() => disableTOTP()}>Remove</button>
      </p>
    </div>
  )
}

// If TOTP is disabled, provide the option to enable it
const TotpDisabled = () => {
  return (
    <div>
      <p>
        Add TOTP via authentication app -{' '}
        <Link href="/account/manage-mfa/add">
          <button>Add</button>
        </Link>
      </p>
    </div>
  )
}

// Generate and display backup codes
export function GenerateBackupCodes() {
  const { user } = useUser()
  const [backupCodes, setBackupCodes] = React.useState<BackupCodeResource | undefined>(undefined)

  const [loading, setLoading] = React.useState(false)

  React.useEffect(() => {
    if (backupCodes) {
      return
    }

    setLoading(true)
    void user
      ?.createBackupCode()
      .then((backupCode: BackupCodeResource) => {
        setBackupCodes(backupCode)
        setLoading(false)
      })
      .catch((err) => {
        // See https://clerk.com/docs/custom-flows/error-handling
        // for more info on error handling
        console.error(JSON.stringify(err, null, 2))
        setLoading(false)
      })
  }, [])

  if (loading) {
    return <p>Loading...</p>
  }

  if (!backupCodes) {
    return <p>There was a problem generating backup codes</p>
  }

  return (
    <ol>
      {backupCodes.codes.map((code, index) => (
        <li key={index}>{code}</li>
      ))}
    </ol>
  )
}

export default function ManageMFA() {
  const { isLoaded, user } = useUser()
  const [showNewCodes, setShowNewCodes] = React.useState(false)

  if (!isLoaded) return null

  if (!user) {
    return <p>You must be logged in to access this page</p>
  }

  return (
    <>
      <h1>User MFA Settings</h1>

      {/* Manage TOTP MFA */}
      {user.totpEnabled ? <TotpEnabled /> : <TotpDisabled />}

      {/* Manage backup codes */}
      {user.backupCodeEnabled && user.twoFactorEnabled && (
        <div>
          <p>
            Generate new backup codes? -{' '}
            <button onClick={() => setShowNewCodes(true)}>Generate</button>
          </p>
        </div>
      )}
      {showNewCodes && (
        <>
          <GenerateBackupCodes />
          <button onClick={() => setShowNewCodes(false)}>Done</button>
        </>
      )}
    </>
  )
}

----------------------------------------

TITLE: Client-Side Supabase Integration with Clerk in Next.js
DESCRIPTION: React component demonstrating client-side rendering of tasks using Clerk for authentication and Supabase for data storage.

LANGUAGE: tsx
CODE:
'use client'
import { useEffect, useState } from 'react'
import { useSession, useUser } from '@clerk/nextjs'
import { createClient } from '@supabase/supabase-js'

export default function Home() {
  const [tasks, setTasks] = useState<any[]>([])
  const [loading, setLoading] = useState(true)
  const [name, setName] = useState('')
  const { user } = useUser()
  const { session } = useSession()

  function createClerkSupabaseClient() {
    return createClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.NEXT_PUBLIC_SUPABASE_KEY!,
      {
        global: {
          fetch: async (url, options = {}) => {
            const clerkToken = await session?.getToken({
              template: 'supabase',
            })

            const headers = new Headers(options?.headers)
            headers.set('Authorization', `Bearer ${clerkToken}`)

            return fetch(url, {
              ...options,
              headers,
            })
          },
        },
      },
    )
  }

  const client = createClerkSupabaseClient()

  useEffect(() => {
    if (!user) return

    async function loadTasks() {
      setLoading(true)
      const { data, error } = await client.from('tasks').select()
      if (!error) setTasks(data)
      setLoading(false)
    }

    loadTasks()
  }, [user])

  async function createTask(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault()
    await client.from('tasks').insert({
      name,
    })
    window.location.reload()
  }

  return (
    <div>
      <h1>Tasks</h1>

      {loading && <p>Loading...</p>}

      {!loading && tasks.length > 0 && tasks.map((task: any) => <p>{task.name}</p>)}

      {!loading && tasks.length === 0 && <p>No tasks found</p>}

      <form onSubmit={createTask}>
        <input
          autoFocus
          type="text"
          name="name"
          placeholder="Enter new task"
          onChange={(e) => setName(e.target.value)}
          value={name}
        />
        <button type="submit">Add</button>
      </form>
    </div>
  )
}

----------------------------------------

TITLE: Prebuilding Expo Project for Passkey Support
DESCRIPTION: This command prebuilds the Expo project to include the necessary native code for passkey support.

LANGUAGE: bash
CODE:
npx expo prebuild

----------------------------------------

TITLE: Configuring Additional OAuth Scopes with UserProfile Component
DESCRIPTION: Example showing how to add custom OAuth scopes to the UserProfile component for Google and GitHub providers.

LANGUAGE: tsx
CODE:
<UserProfile
  additionalOAuthScopes={{
    google: ['foo', 'bar'],
    github: ['qux'],
  }}
/>

----------------------------------------

TITLE: Accessing Nonce Value in Next.js Page for CSP
DESCRIPTION: This snippet demonstrates how to access the nonce value from request headers in a Next.js page. The nonce is used for Content Security Policy implementation with strict-dynamic directives.

LANGUAGE: typescript
CODE:
import { headers } from 'next/headers'

export default function Page() {
  const nonce = headers().get('x-nonce')

  return <p>{nonce}</p>
}

----------------------------------------

TITLE: Server-Side Rendered Page with Supabase and Clerk in Next.js
DESCRIPTION: Next.js page component demonstrating server-side rendering of tasks using Clerk for authentication and Supabase for data storage.

LANGUAGE: tsx
CODE:
import { createClerkSupabaseClientSsr } from './client'
import AddTaskForm from './AddTaskForm'

export default async function Home() {
  const client = createClerkSupabaseClientSsr()

  const { data, error } = await client.from('tasks').select()
  if (error) {
    throw error
  }
  const tasks = data

  return (
    <div>
      <h1>Tasks</h1>

      <div>{tasks?.map((task: any) => <p>{task.name}</p>)}</div>

      <AddTaskForm />
    </div>
  )
}

----------------------------------------

TITLE: Adding Chrome Extension ID to Clerk's Allowed Origins
DESCRIPTION: This bash command shows how to add the Chrome Extension's ID to the allowed origins for a Clerk instance using the Clerk API. This step is crucial for enabling authentication in production.

LANGUAGE: bash
CODE:
curl -X PATCH https://api.clerk.com/v1/instance \
  -H "Authorization: Bearer {{secret}}" \
  -H "Content-type: application/json" \
  -d '{"allowed_origins": ["chrome-extension://<CHROME_EXTENSION_KEY>"]}'

----------------------------------------

TITLE: Implementing Sign-In Route Component with Clerk
DESCRIPTION: Creates a SignInPage component using Clerk's SignIn component for the sign-in route.

LANGUAGE: tsx
CODE:
import { SignIn } from '@clerk/chrome-extension'

export const SignInPage = () => {
  return (
    <>
      <p>Sign In</p>
      <SignIn routing="virtual" />
    </>
  )
}

----------------------------------------

TITLE: Second Factor Verification Parameters - TypeScript
DESCRIPTION: Type definitions for second factor verification parameters including phone code, TOTP, and backup code strategies.

LANGUAGE: typescript
CODE:
type SessionVerifyAttemptSecondFactorParams = PhoneCodeAttempt | TOTPAttempt | BackupCodeAttempt

type PhoneCodeAttempt = {
  strategy: 'phone_code'
  code: string
}

type TOTPAttempt = {
  strategy: 'totp'
  code: string
}

type BackupCodeAttempt = {
  strategy: 'backup_code'
  code: string
}

----------------------------------------

TITLE: Implementing Localization in Vue
DESCRIPTION: Shows how to import and use a localization (French) with the clerkPlugin in a Vue application.

LANGUAGE: typescript
CODE:
import { createApp } from 'vue'
import App from './App.vue'
import { clerkPlugin } from '@clerk/vue'
// fr-FR locale is imported as frFR
import { frFR } from '@clerk/localizations'

const app = createApp(App)
app.use(clerkPlugin, {
  localization: frFR,
})
app.mount('#app')

----------------------------------------

TITLE: Configuring Custom Components for asChild in React
DESCRIPTION: Shows how to implement a custom input component that is compatible with the asChild prop in Clerk Elements. This approach uses forwardRef to ensure proper prop and ref forwarding.

LANGUAGE: tsx
CODE:
import { forwardRef } from 'react'

const CustomInput = forwardRef(function CustomInput(props, forwardedRef) {
  return <input ref={forwardedRef} {...props} className="custom-class" />
})

----------------------------------------

TITLE: PrimaryDomainAlreadyExists Error Response in JSON
DESCRIPTION: Error response when attempting to add a primary domain when one already exists.

LANGUAGE: json
CODE:
{
  "shortMessage": "primary domain already exists",
  "longMessage": "Currently, only a single primary domain is supported and the current instance already has one. All new domains need to be set a satellites.",
  "code": "primary_domain_already_exists_code"
}

----------------------------------------

TITLE: Apollo Client Setup with Clerk Authentication
DESCRIPTION: React component implementing Apollo Client with Clerk authentication for Hasura GraphQL requests

LANGUAGE: jsx
CODE:
import { ApolloProvider, ApolloClient, HttpLink, from, InMemoryCache } from '@apollo/client'
import { setContext } from '@apollo/client/link/context'
import { useAuth } from '@clerk/nextjs'

export const ApolloProviderWrapper = ({ children }) => {
  const { getToken } = useAuth()
  const apolloClient = useMemo(() => {
    const authMiddleware = setContext(async (req, { headers }) => {
      const token = await getToken({ template: 'template' })
      return {
        headers: {
          ...headers,
          authorization: `Bearer ${token}`,
        },
      }
    })

    const httpLink = new HttpLink({
      uri: process.env.GRAPHQL_URI,
    })

    return new ApolloClient({
      link: from([authMiddleware, httpLink]),
      cache: new InMemoryCache(),
    })
  }, [getToken])

  return <ApolloProvider client={apolloClient}>{children}</ApolloProvider>
}

----------------------------------------

TITLE: Decoding JWT Header in JSON
DESCRIPTION: This snippet shows the decoded content of a JWT header, specifying the algorithm used for signing (RS256) and the token type.

LANGUAGE: json
CODE:
{
  "alg": "RS256",
  "typ": "JWT"
}

----------------------------------------

TITLE: Configuring Public Routes in Clerk Middleware
DESCRIPTION: This code snippet demonstrates how to make the sign-up route public in a Next.js application using Clerk middleware. It's necessary when the middleware is configured to protect all routes by default.

LANGUAGE: tsx
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

// prettier-ignore
const isPublicRoute = createRouteMatcher([
  '/sign-in(.*)',
  '/sign-up(.*)'
])

export default clerkMiddleware(async (auth, req) => {
  if (!isPublicRoute(req)) {
    await auth.protect()
  }
})

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Configuring Clerk Session Token with Email Claim
DESCRIPTION: Add the email claim to the Clerk session token in the Clerk Dashboard. This is required for InstantDB authentication.

LANGUAGE: json
CODE:
{
  "email": "{{user.primary_email_address}}"
}

----------------------------------------

TITLE: Initializing and Using Clerk SDK in Ruby
DESCRIPTION: Demonstrates how to instantiate a Clerk::SDK instance and perform common user management operations like creating users, listing users, and managing user account locks. Shows the basic CRUD operations available through the SDK.

LANGUAGE: ruby
CODE:
sdk = Clerk::SDK.new

create_user_request = Clerk::SDK::CreateUserRequest.new(
  first_name: "John",
  last_name: "Doe",
  email_address: ["john.doe@example.com"],
  password: "password"
)

# Create a user
sdk.users.create(create_user_request)

# List all users and ensure the user was created
sdk.users.get_user_list

# Get the first user created in your instance
user = sdk.users.get_user_list(limit: 1).first

# Use the user's ID to lock the user
sdk.users.lock_user(user["id"])

# Then, unlock the user so they can sign in again
sdk.users.unlock_user(user["id"])

----------------------------------------

TITLE: Implementing Authentication Checks with useAuth() in Vue.js
DESCRIPTION: This snippet demonstrates how to use the useAuth() composable from Clerk to check the authentication status and display appropriate content. It uses the isLoaded property to check if Clerk has finished initializing and the userId property to determine if a user is signed in.

LANGUAGE: vue
CODE:
<script setup>
const { userId, isLoaded } = useAuth()
</script>

<template>
  <div v-if="!isLoaded">Loading...</div>
  <div v-else-if="!userId">Sign in to access this page</div>
  <div v-else>Hello, {{ userId }}!</div>
</template>

----------------------------------------

TITLE: Updating User Password Change
DESCRIPTION: Example of updating the user password change method to use the new updatePassword method instead of update.

LANGUAGE: javascript
CODE:
user.updatePassword({
  currentPassword: 'bar',
  newPassword: 'foo',
  signOutOfOtherSessions: true,
})

----------------------------------------

TITLE: Unmounting CreateOrganization with JavaScript
DESCRIPTION: Example of unmounting the CreateOrganization component using JavaScript. The Clerk instance's unmountCreateOrganization method is used to remove the component and perform cleanup.

LANGUAGE: js
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="create-organization"></div>
`

const createOrgDiv = document.getElementById('create-organization')

clerk.mountCreateOrganization(createOrgDiv)

// ...

clerk.unmountCreateOrganization(createOrgDiv)

----------------------------------------

TITLE: Setting up project directory for Cognito to Clerk migration script
DESCRIPTION: Shell commands to create a new directory, initialize a Node.js project, and install necessary dependencies for the migration script.

LANGUAGE: shell
CODE:
mkdir cognito_to_clerk
cd cognito_to_clerk

npm init -y
npm i -E @aws-sdk/client-cognito-identity-provider@3.614.0
npm i -E @clerk/backend@1.4.3

touch .env
touch main.ts

----------------------------------------

TITLE: Starting Next.js Development Server
DESCRIPTION: Commands for running the Next.js development server using different package managers.

LANGUAGE: bash
CODE:
npm run dev

LANGUAGE: bash
CODE:
yarn dev

LANGUAGE: bash
CODE:
pnpm dev

LANGUAGE: bash
CODE:
bun dev

----------------------------------------

TITLE: Testing Header Forwarding with Clerk Middleware
DESCRIPTION: TypeScript middleware implementation to verify proper header forwarding by logging the X-Forwarded-Host and X-Forwarded-Proto headers from incoming requests. This helps diagnose proxy configuration issues.

LANGUAGE: typescript
CODE:
export default clerkMiddleware(
  (auth, req) => {
    console.log('=========================')
    console.log('Request Headers')
    console.log('x-forwarded-host', req.headers.get('x-forwarded-host'))
    console.log('x-forwarded-proto', req.headers.get('x-forwarded-proto'))
    console.log('=========================')
  },
  { debug: debugStatus },
)

----------------------------------------

TITLE: Next.js Apollo Client Integration
DESCRIPTION: Setup for Apollo Client in Next.js with Clerk authentication middleware for GraphQL requests.

LANGUAGE: typescript
CODE:
import { useAuth } from '@clerk/nextjs'

export const ApolloProviderWrapper = ({ children }: PropsWithChildren) => {
  const { getToken } = useAuth()

  const client = useMemo(() => {
    const authMiddleware = setContext(async (operation, { headers }) => {
      const token = await getToken({ template: 'grafbase' })

      return {
        headers: {
          ...headers,
          authorization: `Bearer ${token}`,
        },
      }
    })

    return new ApolloClient({
      link: from([authMiddleware, httpLink]),
      cache: new InMemoryCache(),
    })
  }, [getToken])

  return <ApolloProvider client={client}>{children}</ApolloProvider>
}

----------------------------------------

TITLE: SAML Connection Creation Example
DESCRIPTION: Example of creating a SAML connection with Okta as the identity provider. Demonstrates setting up name, provider, domain, metadata URL, and attribute mapping.

LANGUAGE: tsx
CODE:
const response = await clerkClient.samlConnections.createSamlConnection({
  name: 'test-okta',
  provider: 'saml_okta',
  domain: 'clerk.dev',
  idpMetadataUrl: 'https://trial-000000.okta.com/app/exk...',
  attributeMapping: {
    emailAddress: 'user.email',
    firstName: 'user.firstName',
    lastName: 'user.lastName',
  },
})

----------------------------------------

TITLE: Implementing Custom Localization in Next.js
DESCRIPTION: Shows how to create and use a custom localization object with the ClerkProvider in a Next.js application.

LANGUAGE: typescript
CODE:
import { ClerkProvider } from '@clerk/nextjs'
import './globals.css'

const localization = {
  socialButtonsBlockButton: 'Sign In with {{provider|titleize}}',
}

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider localization={localization}>
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Rendering JavaScript Logo SVG
DESCRIPTION: SVG markup that creates the JavaScript logo with a yellow background and black 'JS' text. Uses masks for controlled rendering and includes precise path definitions for the logo shape.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 50 50" fill="none">
  <mask
    id="mask0_65_1635"
    width="50"
    height="50"
    x="0"
    y="0"
    maskUnits="userSpaceOnUse"
    style={{maskType:'luminance'}}
  >
    <path fill="#fff" d="M50 0H0v50h50V0Z" />
  </mask>

  <g mask="url(#mask0_65_1635)">
    <path fill="#F7DF1E" d="M50 0H0v50h50V0Z" />

    <path
      fill="#000"
      d="M33.586 39.063c1.008 1.644 2.318 2.853 4.635 2.853 1.947 0 3.19-.973 3.19-2.318 0-1.61-1.277-2.181-3.42-3.119l-1.175-.504c-3.39-1.444-5.642-3.254-5.642-7.079 0-3.524 2.684-6.206 6.88-6.206 2.988 0 5.136 1.04 6.683 3.762L41.078 28.8c-.805-1.445-1.674-2.014-3.023-2.014-1.377 0-2.249.873-2.249 2.014 0 1.41.873 1.98 2.889 2.853l1.175.503c3.992 1.712 6.246 3.457 6.246 7.381 0 4.23-3.323 6.548-7.786 6.548-4.363 0-7.183-2.08-8.562-4.805l3.818-2.218Zm-16.597.407c.738 1.31 1.41 2.416 3.023 2.416 1.544 0 2.518-.604 2.518-2.952V22.958h4.698v16.04c0 4.865-2.852 7.079-7.016 7.079-3.761 0-5.94-1.947-7.048-4.292l3.825-2.315Z"
    />
  </g>
</svg>

----------------------------------------

TITLE: SingleModeSessionExists Error in JSON for Clerk Sign-in
DESCRIPTION: Represents an error when a user attempts to sign in while already having an active session in single session mode.

LANGUAGE: json
CODE:
{
  "shortMessage": "Session already exists",
  "longMessage": "You're currently in single session mode. You can only be signed into one account at a time.",
  "code": "session_exists"
}

----------------------------------------

TITLE: Accessing User Identity in Convex Queries
DESCRIPTION: This snippet demonstrates how to access user identity information from the JWT in Convex queries. It uses ctx.auth.getUserIdentity() to retrieve the parsed JWT information or null if the client is not authenticated.

LANGUAGE: typescript
CODE:
import type { UserIdentity } from 'convex/server'
import { query } from './_generated/server'

export default query(async (ctx) => {
  const user = await ctx.auth.getUserIdentity()

  if (user === null) {
    return null
  }

  return user.tokenIdentifier
})

----------------------------------------

TITLE: Creating a Test Route Handler for Webhooks in Next.js
DESCRIPTION: This code snippet shows how to create a basic POST route handler in Next.js to test webhook functionality. It returns a simple JSON response to confirm the route is working.

LANGUAGE: typescript
CODE:
export async function POST() {
  return Response.json({ message: 'The route is working' })
}

----------------------------------------

TITLE: Authenticating with OKX Wallet in Clerk
DESCRIPTION: This method initiates an authentication flow using the OKX Wallet browser extension, allowing users to authenticate via their Web3 wallet address.

LANGUAGE: javascript
CODE:
const signUp = await clerk.signUp.authenticateWithOKXWallet()

----------------------------------------

TITLE: Updating OrganizationSwitcher Component
DESCRIPTION: Example of updating the OrganizationSwitcher component to use the new afterSelectOrganizationUrl prop instead of afterSwitchOrganizationUrl.

LANGUAGE: jsx
CODE:
<OrganizationSwitcher afterSelectOrganizationUrl="..." />

----------------------------------------

TITLE: Rendering CTA Cards with SVG Icons in React JSX
DESCRIPTION: A React component that displays two call-to-action cards using a Cards component with variant and level props. Each card contains a link, descriptive text, and an SVG icon for Discord and Support respectively.

LANGUAGE: jsx
CODE:
<Cards variant="cta" level={2}>
  - [Join our Discord](https://clerk.com/discord 'Join Discord')
  - Join our official Discord server to chat with us directly and become a part of the Clerk community.
  - {<svg viewBox="0 0 32 32" fill="none"><path fill="#5865F2" d="M27.09 5.826a26.387 26.387 0 0 0-6.514-2.02.099.099 0 0 0-.105.05c-.281.5-.593 1.153-.81 1.666a24.359 24.359 0 0 0-7.317 0 16.853 16.853 0 0 0-.823-1.666.103.103 0 0 0-.105-.05 26.315 26.315 0 0 0-6.513 2.02.093.093 0 0 0-.043.037C.71 12.061-.425 18.107.132 24.077a.11.11 0 0 0 .042.075 26.534 26.534 0 0 0 7.99 4.04.104.104 0 0 0 .113-.038 18.986 18.986 0 0 0 1.634-2.659.1.1 0 0 0-.055-.14c-.87-.33-1.7-.733-2.496-1.19a.104.104 0 0 1-.05-.083.102.102 0 0 1 .04-.088c.167-.125.335-.256.495-.388a.099.099 0 0 1 .104-.014c5.237 2.39 10.906 2.39 16.081 0a.098.098 0 0 1 .105.013c.16.131.328.264.497.39a.102.102 0 0 1-.009.17c-.797.465-1.632.863-2.497 1.188a.1.1 0 0 0-.059.06.102.102 0 0 0 .005.082c.48.931 1.03 1.817 1.633 2.658a.1.1 0 0 0 .113.038 26.453 26.453 0 0 0 8.002-4.04.104.104 0 0 0 .042-.073c.668-6.902-1.117-12.898-4.731-18.214a.08.08 0 0 0-.042-.038ZM10.692 20.442c-1.576 0-2.876-1.448-2.876-3.226 0-1.777 1.274-3.225 2.877-3.225 1.614 0 2.9 1.46 2.875 3.225 0 1.778-1.274 3.226-2.876 3.226Zm10.633 0c-1.576 0-2.875-1.448-2.875-3.226 0-1.777 1.273-3.225 2.875-3.225 1.615 0 2.901 1.46 2.876 3.225 0 1.778-1.261 3.226-2.876 3.226Z"/></svg>}

  ---

  - [Need help?](/support 'Get help')
  - Contact us through Discord, Twitter, or email to receive answers to your questions and learn more about Clerk.
  - {<svg viewBox="0 0 32 32" fill="none"><path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M22 30.603c-5.109 0-9.25-3.773-9.25-8.427 0-4.653 4.141-8.426 9.25-8.426s9.25 3.773 9.25 8.426c0 1.864-.664 3.587-1.789 4.982.28 1.476.996 3.488 1.789 4.092 0 0-2.735-.379-4.79-1.69A9.923 9.923 0 0 1 22 30.604Z"/><path fill="currentColor" fillOpacity=".15" fillRule="evenodd" d="M14.55 27.172c-1.131-1.398-1.8-3.125-1.8-4.996 0-4.653 4.141-8.426 9.25-8.426 3.67 0 6.84 1.947 8.335 4.768.592-1.412.915-2.937.915-4.527C31.25 6.678 24.422.75 16 .75S.75 6.678.75 13.99c0 2.93 1.095 5.636 2.95 7.829-.462 2.319-1.643 5.481-2.95 6.43 0 0 4.511-.595 7.9-2.654a16.853 16.853 0 0 0 5.9 1.577Z" clipRule="evenodd"/><path fill="currentColor" d="m14.55 27.172-.06.748a.75.75 0 0 0 .643-1.22l-.582.472Zm15.785-8.654-.663.351a.75.75 0 0 0 1.355-.06l-.692-.29ZM3.7 21.818l.736.147a.75.75 0 0 0-.163-.63l-.573.484ZM.75 28.25l-.44-.607a.75.75 0 0 0 .538 1.35L.75 28.25Zm7.9-2.655.323-.677a.75.75 0 0 0-.713.036l.39.64Zm6.483 1.106c-1.031-1.275-1.633-2.838-1.633-4.525H12c0 2.055.736 3.947 1.967 5.468l1.166-.943ZM13.5 22.176c0-4.175 3.738-7.676 8.5-7.676V13c-5.456 0-10 4.044-10 9.176h1.5ZM22 14.5c3.408 0 6.315 1.807 7.672 4.37l1.326-.703C29.366 15.087 25.93 13 22 13v1.5Zm9.027 4.308A12.42 12.42 0 0 0 32 13.991h-1.5a10.92 10.92 0 0 1-.857 4.237l1.384.58ZM32 13.991C32 6.168 24.734 0 16 0v1.5c8.111 0 14.5 5.688 14.5 12.49H32ZM16 0C7.266 0 0 6.168 0 13.99h1.5C1.5 7.189 7.889 1.5 16 1.5V0ZM0 13.99c0 3.123 1.169 5.998 3.127 8.313l1.145-.969c-1.75-2.07-2.772-4.608-2.772-7.343H0Zm2.964 7.682a18.779 18.779 0 0 1-1.111 3.58C1.34 26.438.785 27.296.309 27.641l.882 1.215c.831-.604 1.519-1.802 2.04-3.013.538-1.25.963-2.671 1.204-3.879l-1.471-.293ZM.75 28.25l.098.743h.006l.011-.002a21.578 21.578 0 0 0 .201-.03 27.929 27.929 0 0 0 2.553-.541c1.584-.415 3.637-1.101 5.42-2.185l-.78-1.281c-1.605.976-3.501 1.617-5.02 2.015a26.447 26.447 0 0 1-2.404.51 11.662 11.662 0 0 1-.174.026l-.008.001H.652l.098.744Zm7.576-1.979a17.604 17.604 0 0 0 6.163 1.649l.123-1.495a16.104 16.104 0 0 1-5.639-1.507l-.647 1.353Z"/></svg>}
</Cards>

----------------------------------------

TITLE: Configuring ClerkProvider with tRPC in Next.js Layout
DESCRIPTION: Shows how to wrap the tRPC provider with ClerkProvider in the root layout to enable authentication context access throughout the application.

LANGUAGE: tsx
CODE:
export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <ClerkProvider>
      <TRPCProvider>
        <html lang="en">
          <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
            <header className="flex justify-end items-center p-4 gap-4 h-16">
              <SignedOut>
                <SignInButton />
                <SignUpButton />
              </SignedOut>
              <SignedIn>
                <Link href="/">Home</Link>
                <UserButton />
              </SignedIn>
            </header>
            {children}
          </body>
        </html>
      </TRPCProvider>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Base64 WebP Image Tag Implementation in HTML
DESCRIPTION: An HTML img tag configuration with width and height of 32px, alt text for accessibility, and a base64 encoded WebP image source.

LANGUAGE: html
CODE:
<img
  width="32"
  height="32"
  alt="tanstack start logo"
  src="data:image/webp;base64,UklGRu4JAABXRUJQVlA4TOEJAAAvP8APEM8Hu9r2tM0n/1KSMjNze8UzdNWu0duOwMzMlfXTGnBt204b3SczDjPU0+Vr5j+nnZ6Zp2dm0vjJ0oUc2bZqZZ1z3rX/cXcdQphEQgoWB0TgMHOHa3JEASCA6mXbtl1bY02NHcC+gJtq6gS2j+Aa/Sf7/8nY7ADw+MR//od0UAdVqEIUojCFeOEKdZ2TC6d7an1+DTIlHUShDur0v2kPEIX1/ZF5rZCuYct/87xXJc3Jdcw4BHhRxdJqF9PdrdRpi51GGXWq0NbpSINW7nVWUXczcgDDExNiEfXqZnAy7g9PvOkcndL6ndA2FYTZ0e8waiGBcsekHQvyZJbM2C5dIKjFQE9hqRgZowLYZ5RSB00iBaNgKQx8DtQvIjlPAAWYEBECKCAEwEeBpigqfJvUv+k1pq4ajyduRLjbAe2/hCJ8eA5ejtzrLD3L+S1LJiwHtfy3qRsMF6O5Zs3w+OdGQFuYDmjCTUfIq2jCRruMVca0QtDGxEN73TM9m9mVTwTQlWqXKebbnReuFRAsKaMztr8sBDF4XQiCZf2gyhm+evx475T/bMXkJ/P/bH7sn4/fpvxg5xfdVOv/C1DP+5nOBtpF8V51yL7Hp19nN/1fWo2BdPkhPBQTrqPW+58ZI04aj9D8dcriIDYfPs2PeQKY0xtmlRvzW5u3wjVx+VkW8V3c9Bcz/d68ppcUT7NN5BwXMtrfxltpLS6TnfpxZ65i9Jva4/F09xKHDn33UUc9g2Lsa8dmfGDtesPbS7Q+O2PMJOiThnjBUOGBPkhPBomjsrRXRWakM5V5K+byF0kO8uIPPOcl/mupUf4X+Q+g+66zmdB050bbJVvZst3+2OJJd7s3ax939pabr/0Tagr9c9w69ufp30Cs+xcogWqHv6AEedBreClwp6kGmkJSOyjPr6vh72iOy4jMPEacH9WAtuOxwWx1qDE9nwH2MhCgNB9uLeTdml/ZZaWrxv9MWjrSMfjLmHJTb50zARERTEvbtrVt5K0IDGF0mDkb6FLaMDPYwxBmzuBRmSF84GFmxkj25WOBISv4v++T/j+i/w7ctnGk0FOwe8XvoKz9f2KnO/V25pQexx1WfZ5zGTjUXY7U3ff4yh32haU7VwF/vYjCtrJNMplMryD55Zckov8O3LaNpCiDFTqX926/4ElBrkDDz3//8+8P//OfGOfufyB+tjW6CgJR/PyL+yNLgruEZqMrucV//eF7w3cAQEAE1gbEyP01jijSv/3Gv2XfGFgyv//B+Lc/ijQvAtH9/esUfXtzaDDyx7d4/TCdCLz/w1dp+OP2PH69dgMO3k81AvHpl19A6swHADs3AFJ9KBAffJGW2wYhzAHYSyUC8eHn6fjs9tAg9t51jekAgv3kEYiP7qXpjutCcjsdZEvS88GTZJ65eeGBlzCh4vVteLLaQV2dln0v4SHw6bOkCqcHNJb3nCewMBRZPOfUsdtlc5ggAu8/fyEgscIBSVX080RFRLDMrHax02GZXk7X3090PT6yOS8qFHRE57rq55oeBsgWF0cWL4BOVstAdOz2EhmL6CDRsxOr82x9gLFozkV+LCDrpDkO9bNw0dEJceK8OjK4ekTLRmzsj+KnljkqGuhXfRy4CAOXomAhc43lW2qdRZaA86PTnS5r+qgnbj1LmU2BpgRcvw+0qOPoIKk+4LLkAyNmqyDnfHX59Mzp4sbNZP6gwHjxmQ0rDutS1HHIccghcjQ1gwdc7teLmdkKoHZwGRis7hoXU3fcI4zzLAgIAAiYP6MTWUIagaQ5ks8fyMi8RLMUQs3Q4hmUrYJY2d7t6OKduGUeJUGbsqwBDXSIEtGUI5MGROCE2LTUz4IW5Y1BxMh2EM+wfNVQVpLrwY0yu5wBVdZIlzSASUGcy6BwKbxWDmtQZhFEgc2D1cHyZUBERCE2PFgKAAIAxFpUVTQOQEAwNQ6aD7jE/f3ZZQazmtXgkhArfasClpkAKPVgBQBUAwDkxHySynVFBseY0dmYP+AzHvfPW2ox29QygKUIAOtbAQaVuFHFbEKXPsUvayoRl6bGJt7M7g9kuH7uDVfb1TCryFI5w8FFxljVxmaNzfqMP+CqUcUncZ80Ozbxek228GZkci7mMak6RKyNLFYj4uZWrRXOSYEM7/SM4pOBzbwxOgaNNfOhmHHxf4y1KWkk01Z9nRXNaZl+fT7k9cmBy9DCKIyL2jp3/mNNuZypS0d9A1q5c3IgOoezXp/qxt5EY94y2+DC3MchB9PQ0NZk1TgX1eewKeTN4P7pBecTGPvQVgiddGBba7PNnO40ue7HxsTecJo/HBv9xL0SrS127XNCCPeNy8zA9EJL82tjI6PXWq7E+RDc85Ny89mZ8+7F7Zvw5AzuBmcvhNCtT9+9YC2SuvUUbXQunj13yYVw7+oL55wl5f5TNIGLyLleFUL/83tKKXWx69ZNp+TFS5d7URMX/9lPrIbtNZadt10N2496ZeP/5f9OhJ9r6+E0YIUptxHjfhFP+7HCLS8ftUiBnY5Y8x/rdaihqEWi4hWkFfrbVKIdqZuPW6xHZ++wOiQbR8wLUL52tZjvZrQQdFcHtNyT3TH56+a9M9f8i8YYFKFxOyNQd8gYuc3SicSOphQbJmPPU+s1mTXwJD9+QuMaTeDITH7YrD+YwN/L68AKIP4g6YhNfD45gd8p5Qf9wD+MR+6Oj6rTmMGyLEhMddjkF9b5bLyW30bHAD5PJ1giFP8BuV96BmAwW8/zAo/5Vo+5uDP8tLC/NyshCWnFB3YePlPMmWtTZDr1RMUWvQUmJcbdGRZLTkm5sKS+hPLO9geHpGlotYoZWFybml1ZSubTslkvKGuprrKVZoK42Sd56PCnZXVpbnJAifm8HaMPkzNzrO4mYmC2mpOp5QkVotYA9V0oIIg633Pvd0qjE/McGJOsROH7cUFHg+zGZ1OeA2q3tUZRqqYw7WW3hsFD7gRF7cD85bpmUmKMXPzD7LGpMlNUEzq7BvVPD83E4g5HZw4uXKRUsLC/Zy16WQC4wJSSQV80oUSMjHLvGnf9gTLndw+myFXEJDqgEj/jdccCEnPgeAQUw/3AWQzaRVFKhynmTFOjxXHC4/2IykjInXGBD8CRlofHxbGi2OxMHTJHNhPOmdtNsMXjxXOhwgTfuJRKXTLA5Tv7GcaSAclEZR6nlTWJ/x7ZaGJ/7EDxvCFDoqJ9BN7BBceRw6pEEkLCzYJL3yOHhKWuPV5guJLNwfvD4eLFvgQNXLWbYKDB4OyT+yAhjd0NOK69UgkedvEzHQBosphjoR8DBuJQX531u3vjx0+yBcy0Nj0Ps/aLjQT7v3RI+RQt3+f2yuPHbHv6T4nsgEA"
/>

----------------------------------------

TITLE: Updating Astro Configuration Integration
DESCRIPTION: Changes required in the Astro configuration file to use the official Clerk SDK integration instead of the community SDK variants.

LANGUAGE: javascript
CODE:
import { defineConfig } from 'astro/config'
import node from '@astrojs/node'
import clerk from '@clerk/astro'

export default defineConfig({
  integrations: [clerk()],
  adapter: node({ mode: 'standalone' }),
  output: 'server',
})

----------------------------------------

TITLE: Implementing UserButton in JavaScript
DESCRIPTION: Example demonstrating how to mount and unmount the UserButton component using vanilla JavaScript with the Clerk SDK

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="user-button"></div>
`

const userButtonDiv = document.getElementById('user-button')

clerk.mountUserButton(userButtonDiv)

----------------------------------------

TITLE: Configuring General Clerk Authentication URLs
DESCRIPTION: Environment variables for configuring authentication URLs and redirect behavior in standard Clerk implementations. These variables control the paths for sign-in/sign-up pages and specify forced or fallback redirect destinations.

LANGUAGE: plaintext
CODE:
CLERK_SIGN_IN_URL=/sign-in
CLERK_SIGN_UP_URL=/sign-up
CLERK_SIGN_IN_FORCE_REDIRECT_URL=/dashboard
CLERK_SIGN_UP_FORCE_REDIRECT_URL=/dashboard
CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/dashboard
CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/dashboard

----------------------------------------

TITLE: Configuring Grafbase Schema with Group-Based Access
DESCRIPTION: GraphQL schema configuration for implementing group-based access control in Grafbase using specific group permissions.

LANGUAGE: graphql
CODE:
schema
  @auth(
    providers: [{ type: oidc, issuer: "{{ env.ISSUER_URL }}" }]
    rules: [{ allow: groups, groups: ["backend", "admin"] }]
  ) {
  query: Query
}

----------------------------------------

TITLE: Strategy Component Implementation
DESCRIPTION: Demonstrates usage of Strategy component for handling different authentication verification methods.

LANGUAGE: tsx
CODE:
<SignUp.Strategy name="email_code">
  <Clerk.Field name="code">
    <Clerk.Label>Code</Clerk.Label>
    <Clerk.Input />
    <Clerk.FieldError />
  </Clerk.Field>

  <SignUp.Action submit>Verify</SignUp.Action>
</SignUp.Strategy>

----------------------------------------

TITLE: Adding Custom Link to UserButton in Next.js
DESCRIPTION: This example demonstrates how to add a custom 'Create organization' link to the UserButton component in a Next.js application.

LANGUAGE: tsx
CODE:
'use client'

import { UserButton } from '@clerk/nextjs'

const DotIcon = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" />
    </svg>
  )
}

export default function Home() {
  return (
    <header>
      <UserButton>
        <UserButton.MenuItems>
          <UserButton.Link
            label="Create organization"
            labelIcon={<DotIcon />}
            href="/create-organization"
          />
        </UserButton.MenuItems>
      </UserButton>
    </header>
  )
}

----------------------------------------

TITLE: Fetch API Implementation with Clerk Authentication
DESCRIPTION: React component using Fetch API and SWR hook with Clerk authentication for Hasura GraphQL requests

LANGUAGE: jsx
CODE:
import { useAuth } from '@clerk/nextjs'
import useSWR from 'swr'

const Main = () => {
  const { getToken } = useAuth()
  const endpoint = process.env.NEXT_PUBLIC_HASURA_GRAPHQL_API
  const query = `query { __schema { types { name } } }`
  const fetcher = async (...args) =>
    fetch(...args, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
        Authorization: `Bearer ${await getToken({ template: 'hasura' })}`,
      },
      body: JSON.stringify({ query }),
    }).then((res) => res.json())

  const { data } = useSWR(endpoint, fetcher)

  return <p>GraphQL schema has {data?.data?.__schema.types.length} types</p>
}

export default Main

----------------------------------------

TITLE: Defining OauthFactor Type in TypeScript
DESCRIPTION: This snippet defines the OauthFactor type, representing the OAuth strategy for first factor verification. It only includes the strategy property.

LANGUAGE: typescript
CODE:
type OauthFactor = {
  strategy: OAuthStrategy
}

----------------------------------------

TITLE: Basic SignUpButton Implementation - React
DESCRIPTION: Basic implementation of the SignUpButton component in React.

LANGUAGE: jsx
CODE:
import { SignUpButton } from '@clerk/clerk-react'

const SignUpPage = () => <SignUpButton />

export default SignUpPage

----------------------------------------

TITLE: SignInNotFound Error in JSON for Clerk Sign-in
DESCRIPTION: Indicates that no sign-in was found with the given ID. The longMessage includes a placeholder for the specific sign-in ID.

LANGUAGE: json
CODE:
{
  "shortMessage": "not found",
  "longMessage": "No sign in was found with id <signInID>",
  "code": "resource_not_found"
}

----------------------------------------

TITLE: Installing @clerk/chrome-extension
DESCRIPTION: Commands to install the latest version of @clerk/chrome-extension using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/chrome-extension

LANGUAGE: bash
CODE:
yarn add @clerk/chrome-extension

LANGUAGE: bash
CODE:
pnpm add @clerk/chrome-extension

LANGUAGE: bash
CODE:
bun add @clerk/chrome-extension

----------------------------------------

TITLE: Adding Signing Secret to Environment Variables
DESCRIPTION: Add the Clerk webhook signing secret to the .env file for local development.

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}
SIGNING_SECRET=whsec_123

----------------------------------------

TITLE: RedirectOptions Interface Definition in TypeScript
DESCRIPTION: Interface defining optional properties for configuring authentication redirects. Includes forced and fallback URLs for both sign-in and sign-up flows, with recommendations to use environment variables instead of hard-coded values.

LANGUAGE: typescript
CODE:
interface RedirectOptions {
  signInForceRedirectUrl?: string;
  signUpForceRedirectUrl?: string;
  signInFallbackRedirectUrl?: string;
  signUpFallbackRedirectUrl?: string;
}

----------------------------------------

TITLE: Implementing Waitlist Component in React
DESCRIPTION: Basic implementation of the Waitlist component in a React application using the @clerk/clerk-react package.

LANGUAGE: tsx
CODE:
import { Waitlist } from '@clerk/clerk-react'

export default function WaitlistPage() {
  return <Waitlist />
}

----------------------------------------

TITLE: Custom SignUpButton Implementation - Next.js
DESCRIPTION: Custom implementation of SignUpButton in Next.js with a custom button child component.

LANGUAGE: jsx
CODE:
import { SignUpButton } from '@clerk/nextjs'

export default function Home() {
  return (
    <SignUpButton>
      <button>Custom sign up button</button>
    </SignUpButton>
  )
}

----------------------------------------

TITLE: Adding Email Address to User Account in Next.js with Clerk
DESCRIPTION: This component allows users to add a new email address to their account. It uses the useUser hook to access the user object, creates a new email address, and initiates the email verification process.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useUser } from '@clerk/nextjs'

export default function Page() {
  const { isLoaded, user } = useUser()
  const [email, setEmail] = React.useState('')
  const [verifying, setVerifying] = React.useState(false)
  const [error, setError] = React.useState('')

  if (!isLoaded) return null

  if (isLoaded && !user?.id) {
    return <p>You must be signed in to access this page</p>
  }

  // Handle addition of the email address
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    try {
      setVerifying(true)

      // Add an unverified email address to user
      const res = await user.createEmailAddress({ email })
      // Reload user to get updated User object
      await user.reload()

      // Find the email address that was just added
      const emailAddress = user.emailAddresses.find((a) => a.id === res.id)

      if (!emailAddress) {
        setError('Email address not found')
        return
      }

      const { startEmailLinkFlow } = emailAddress.createEmailLinkFlow()

      // Dynamically set the host domain for dev and prod
      // You could instead use an environment variable or other source for the host domain
      const protocol = window.location.protocol
      const host = window.location.host

      // Send the user an email with the verification link
      startEmailLinkFlow({ redirectUrl: `${protocol}//${host}/account/add-email/verify` })
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
      setError('An error occurred.')
    }
  }

  async function reset(e: React.FormEvent) {
    e.preventDefault()
    setVerifying(false)
  }

  if (error) {
    return (
      <div>
        <p>Error: {error}</p>
        <button onClick={() => setError('')}>Try again</button>
      </div>
    )
  }

  if (verifying) {
    return (
      <div>
        <p>Check your email and visit the link that was sent to you.</p>
        <form onSubmit={reset}>
          <button type="submit">Restart</button>
        </form>
      </div>
    )
  }

  // Display the initial form to capture the email address
  return (
    <>
      <h1>Add email</h1>
      <div>
        <form onSubmit={(e) => handleSubmit(e)}>
          <input
            placeholder="Enter email address"
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
          />
          <button type="submit">Continue</button>
        </form>
      </div>
    </>
  )
}

----------------------------------------

TITLE: IdentificationBelongsToDifferentUser Error in JSON for Clerk Sign-in
DESCRIPTION: Represents an error when the provided identification belongs to a different user, indicating a forbidden resource access.

LANGUAGE: json
CODE:
{
  "shortMessage": "belongs to different user",
  "longMessage": "The given identification belongs to a different user.",
  "code": "resource_forbidden"
}

----------------------------------------

TITLE: Clerk Sign-In Strategy Selection
DESCRIPTION: Shows how to implement the strategy selection step allowing users to choose different authentication methods.

LANGUAGE: tsx
CODE:
<SignIn.Step name="choose-strategy">
  <SignIn.SupportedStrategy name="phone_code">Send a code to your phone</SignIn.SupportedStrategy>
</SignIn.Step>

----------------------------------------

TITLE: Environment Configuration for Existing Chrome Extension
DESCRIPTION: Sets up the environment configuration file with the public key obtained from the Chrome Developer Dashboard.

LANGUAGE: env
CODE:
CRX_PUBLIC_KEY=<YOUR_PUBLIC_KEY>

----------------------------------------

TITLE: Component-Specific Theme in Vue
DESCRIPTION: Example of applying a theme to a specific SignIn component in Vue.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { SignIn } from '@clerk/vue'
import { dark } from '@clerk/themes'
</script>

<template>
  <SignIn :appearance="{ baseTheme: dark }" />
</template>

----------------------------------------

TITLE: Installing Project Dependencies with NPM
DESCRIPTION: Commands for creating a new Next.js project and installing required dependencies including Neon serverless and Drizzle ORM.

LANGUAGE: sh
CODE:
npx create-next-app clerk-neon-example --typescript --eslint --tailwind --use-npm --no-src-dir --app --import-alias "@/*"
cd clerk-neon-example
npm install @neondatabase/serverless
npm install drizzle-orm --legacy-peer-deps
npm install -D drizzle-kit

----------------------------------------

TITLE: Registering Clerk Plugin for All Routes in Fastify
DESCRIPTION: Demonstrates how to initialize Fastify with Clerk authentication plugin for all routes. Includes basic server setup with error handling and port configuration.

LANGUAGE: typescript
CODE:
// dotenv must be imported before @clerk/fastify
import 'dotenv/config'
import Fastify from 'fastify'
import { clerkPlugin } from '@clerk/fastify'

const fastify = Fastify({ logger: true })

fastify.register(clerkPlugin)

const start = async () => {
  try {
    await fastify.listen({ port: 8080 })
  } catch (error) {
    fastify.log.error(error)
    process.exit(1)
  }
}

start()

----------------------------------------

TITLE: Basic SignUpButton Implementation - Next.js
DESCRIPTION: Simple implementation of the SignUpButton component in Next.js showing the default usage.

LANGUAGE: jsx
CODE:
import { SignUpButton } from '@clerk/nextjs'

export default function Home() {
  return <SignUpButton />
}

----------------------------------------

TITLE: Defining SignUpCannotBeUpdated Error in JSON for Clerk
DESCRIPTION: This snippet defines the JSON structure for the SignUpCannotBeUpdated error in Clerk. It includes a short message, a long message explaining why the sign-up can't be updated, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Sign up cannot be updated",
  "longMessage": "This sign up has reached a terminal state and cannot be updated",
  "code": "sign_up_cannot_be_updated"
}

----------------------------------------

TITLE: Updating Clerk import
DESCRIPTION: Example of updating the Clerk import to use named export instead of default export.

LANGUAGE: javascript
CODE:
import Clerk from '@clerk/clerk-js'
import { Clerk } from '@clerk/clerk-js'

----------------------------------------

TITLE: Creating Invitation with Metadata in Clerk
DESCRIPTION: This snippet demonstrates how to create an invitation with additional metadata using cURL. The public_metadata parameter is included in the request body to add custom data to the invitation.

LANGUAGE: bash
CODE:
curl https://api.clerk.com/v1/invitations -X POST -d '{"email_address": "email@example.com", "public_metadata": {"age": "21"}}' -H "Authorization:Bearer {{secret}}" -H 'Content-Type:application/json'

----------------------------------------

TITLE: Basic Usage of SignInWithMetamaskButton in Remix
DESCRIPTION: Illustrates the implementation of SignInWithMetamaskButton in a Remix application. The component is imported from '@clerk/remix' and used in a Home component.

LANGUAGE: jsx
CODE:
import { SignInWithMetamaskButton } from '@clerk/remix'

export default function Home() {
  return (
    <div>
      <SignInWithMetamaskButton />
    </div>
  )
}

----------------------------------------

TITLE: Running Clerk Upgrade CLI Tool
DESCRIPTION: Commands to run the @clerk/upgrade CLI tool to assist with the upgrade process.

LANGUAGE: bash
CODE:
npx @clerk/upgrade --from=core-1

LANGUAGE: bash
CODE:
yarn dlx @clerk/upgrade --from=core-1

LANGUAGE: bash
CODE:
pnpm dlx @clerk/upgrade --from=core-1

LANGUAGE: bash
CODE:
bun dlx @clerk/upgrade --from=core-1

----------------------------------------

TITLE: Installing @clerk/clerk-expo v2 using npm
DESCRIPTION: Command to install the latest version of @clerk/clerk-expo using npm package manager.

LANGUAGE: bash
CODE:
npm i @clerk/clerk-expo@latest

----------------------------------------

TITLE: Updating Domain Using Clerk Backend API - Bash
DESCRIPTION: cURL command to update the production domain of a Clerk instance using the Backend API. Requires authentication with a Secret Key and accepts a new domain URL in the request body.

LANGUAGE: bash
CODE:
curl -XPOST -H 'Authorization: {{secret}}' -H "Content-type: application/json" -d '{
"home_url": "YOUR_PROD_URL"
}' 'https://api.clerk.com/v1/instance/change_domain'

----------------------------------------

TITLE: Implementing SMS OTP Sign-Up Flow in iOS (SwiftUI)
DESCRIPTION: This code snippet demonstrates how to implement a custom SMS OTP sign-up flow using Clerk in an iOS application with SwiftUI. It handles collecting the phone number, sending the OTP, verifying the code, and managing the sign-up process.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct SMSOTPSignUpView: View {
  @State private var phoneNumber = ""
  @State private var code = ""
  @State private var isVerifying = false

  var body: some View {
    if isVerifying {
      TextField("Enter your verification code", text: $code)
      Button("Verify") {
        Task { await verify(code: code) }
      }
    } else {
      TextField("Enter phone number", text: $phoneNumber)
      Button("Continue") {
        Task { await submit(phoneNumber: phoneNumber) }
      }
    }
  }
}

extension SMSOTPSignUpView {

  func submit(phoneNumber: String) async {
    do {
      // Start the sign-up process using the phone number method.
      let signUp = try await SignUp.create(strategy: .standard(phoneNumber: phoneNumber))

      // Start the verification - a SMS message will be sent to the
      // number with a one-time code.
      try await signUp.prepareVerification(strategy: .phoneCode)

      // Set isVerifying to true to display second form and capture the OTP code.
      isVerifying = true
    } catch {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      dump(error)
    }
  }

  func verify(code: String) async {
    do {
      // Access the in progress sign up stored on the client object.
      guard let inProgressSignUp = Clerk.shared.client?.signUp else { return }

      // Use the code provided by the user and attempt verification.
      let signUp = try await inProgressSignUp.attemptVerification(.phoneCode(code: code))

      switch signUp.status {
      case .complete:
        // If verification was completed, navigate the user as needed.
        dump(Clerk.shared.session)
      default:
        // If the status is not complete, check why. User may need to
        // complete further steps.
        dump(signUp.status)
      }
    } catch {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      dump(error)
    }
  }
}

----------------------------------------

TITLE: Updating OrganizationProfile Component with Path Routing
DESCRIPTION: Example of updating the OrganizationProfile component to use the new default path routing strategy.

LANGUAGE: jsx
CODE:
<OrganizationProfile path="/org-profile" />

----------------------------------------

TITLE: Implementing ClerkProvider in Next.js
DESCRIPTION: Integration of ClerkProvider component in both App Router and Pages Router configurations.

LANGUAGE: typescript
CODE:
import { ClerkProvider } from '@clerk/nextjs'
import './globals.css'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}

LANGUAGE: typescript
CODE:
import '@/styles/globals.css'
import { ClerkProvider } from '@clerk/nextjs'
import type { AppProps } from 'next/app'
function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider {...pageProps}>
      <Component {...pageProps} />
    </ClerkProvider>
  )
}
export default MyApp

----------------------------------------

TITLE: Using Clerk Field Component with Function Children
DESCRIPTION: Shows how to use the Field component with a function as children to access the field's state.

LANGUAGE: tsx
CODE:
<Clerk.Field name="unique-name">{(state) => <p>Field's state is: {state}</p>}</Clerk.Field>

----------------------------------------

TITLE: Styling Clerk Elements with Tailwind CSS in React
DESCRIPTION: Shows how to apply Tailwind CSS classes to Clerk Elements components for styling. This approach leverages existing Tailwind setup without additional configuration.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'

export default function SignInPage() {
  return (
    <SignIn.Root>
      <SignIn.Step
        name="start"
        className="bg-white w-96 rounded-2xl py-10 px-8 shadow-sm border space-y-6"
      >
        <div className="grid grid-cols-2 gap-x-4">
          <Clerk.Connection
            name="google"
            className="flex items-center gap-x-3 justify-center font-medium border shadow-sm py-1.5 px-2.5 rounded-md"
          >
            <Clerk.Icon className="size-4" />
            Google
          </Clerk.Connection>
          <Clerk.Connection
            name="github"
            className="flex items-center gap-x-3 justify-center font-medium border shadow-sm py-1.5 px-2.5 rounded-md"
          >
            <Clerk.Icon className="size-4" />
            GitHub
          </Clerk.Connection>
        </div>
        <Clerk.Field name="identifier" className="space-y-2">
          <Clerk.Label className="text-sm font-medium">Email</Clerk.Label>
          <Clerk.Input className="w-full border rounded-md py-1.5 px-2.5" />
          <Clerk.FieldError className="block text-red-500 text-sm" />
        </Clerk.Field>
        <SignIn.Action submit className="bg-black text-white rounded-md py-1.5 px-2.5">
          Continue
        </SignIn.Action>
      </SignIn.Step>
    </SignIn.Root>
  )
}

----------------------------------------

TITLE: Adding Firestore Security Rules in Firebase
DESCRIPTION: This snippet demonstrates how to add security rules to a Firestore database in Firebase, allowing read and write access only to authenticated users.

LANGUAGE: bash
CODE:
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}

----------------------------------------

TITLE: Authenticating with Metamask in Clerk
DESCRIPTION: This method initiates an authentication flow using the MetaMask browser extension, allowing users to authenticate via their Ethereum wallet address.

LANGUAGE: javascript
CODE:
const signUp = await clerk.signUp.authenticateWithMetamask()

----------------------------------------

TITLE: Implementing CreateOrganization in Vue
DESCRIPTION: Example of using the CreateOrganization component in a Vue application. The component is imported from '@clerk/vue' and used in a Vue template.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { CreateOrganization } from '@clerk/vue'
</script>

<template>
  <CreateOrganization />
</template>

----------------------------------------

TITLE: Defining ActorTokenCannotBeUsed Error in JSON
DESCRIPTION: This snippet defines the error response for an actor token that cannot be used. It includes a short message, long message, and error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "actor token cannot be used",
  "longMessage": "This actor token cannot be used anymore. Please request a new one.",
  "code": "actor_token_cannot_be_used_code"
}

----------------------------------------

TITLE: Installing @clerk/clerk-expo v2 using bun
DESCRIPTION: Command to install the latest version of @clerk/clerk-expo using bun package manager.

LANGUAGE: bash
CODE:
bun add @clerk/clerk-expo@latest

----------------------------------------

TITLE: Destroying Client Instance in TypeScript
DESCRIPTION: Asynchronous method to delete the client and reset all associated sessions.

LANGUAGE: typescript
CODE:
function destroy(): Promise<void>

----------------------------------------

TITLE: Setting Environment Variables
DESCRIPTION: Environment variable configuration for Neon database connection and Clerk authentication keys.

LANGUAGE: env
CODE:
DATABASE_URL=NEON_DB_CONNECTION_STRING
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Rendering OrganizationProfile in Vue
DESCRIPTION: Example of using the <OrganizationProfile /> component in a Vue application.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { OrganizationProfile } from '@clerk/vue'
</script>

<template>
  <OrganizationProfile />
</template>

----------------------------------------

TITLE: Installing expo-secure-store Dependency for Clerk Offline Support
DESCRIPTION: Install the required peer dependency expo-secure-store using npm, yarn, pnpm, or bun package managers.

LANGUAGE: bash
CODE:
npm install expo-secure-store

LANGUAGE: bash
CODE:
yarn add expo-secure-store

LANGUAGE: bash
CODE:
pnpm add expo-secure-store

LANGUAGE: bash
CODE:
bun add expo-secure-store

----------------------------------------

TITLE: Installing @clerk/clerk-react
DESCRIPTION: Commands to install the latest version of @clerk/clerk-react using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/clerk-react

LANGUAGE: bash
CODE:
yarn add @clerk/clerk-react

LANGUAGE: bash
CODE:
pnpm add @clerk/clerk-react

LANGUAGE: bash
CODE:
bun add @clerk/clerk-react

----------------------------------------

TITLE: Basic Usage of getUserList with Clerk Backend SDK
DESCRIPTION: Demonstrates the simplest way to call getUserList using the clerkClient.

LANGUAGE: tsx
CODE:
const response = await clerkClient.users.getUserList()

----------------------------------------

TITLE: Installing @clerk/localizations Package
DESCRIPTION: Shows how to install the @clerk/localizations package using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/localizations

LANGUAGE: bash
CODE:
yarn add @clerk/localizations

LANGUAGE: bash
CODE:
pnpm add @clerk/localizations

LANGUAGE: bash
CODE:
bun add @clerk/localizations

----------------------------------------

TITLE: Installing Firebase CLI
DESCRIPTION: Command to install the Firebase Command Line Interface tools globally using npm.

LANGUAGE: bash
CODE:
npm install -g firebase-tools

----------------------------------------

TITLE: Configuring CAPTCHA Appearance in Vue
DESCRIPTION: This snippet demonstrates how to configure the CAPTCHA appearance in a Vue application using the clerkPlugin in the main.ts file.

LANGUAGE: ts
CODE:
import { createApp } from 'vue'
import App from './App.vue'
import { clerkPlugin } from '@clerk/vue'

const app = createApp(App)
app.use(clerkPlugin, {
  appearance: {
    captcha: {
      theme: 'dark',
      size: 'flexible',
      language: 'es-ES',
    },
  },
})
app.mount('#app')

----------------------------------------

TITLE: Configuring Convex Authentication with Clerk Issuer
DESCRIPTION: This snippet shows how to configure Convex authentication using the Clerk issuer domain. It sets up the provider configuration in the Convex auth config file.

LANGUAGE: typescript
CODE:
export default {
  providers: [
    {
      domain: 'https://your-issuer-url.clerk.accounts.dev/',
      applicationID: 'convex',
    },
  ],
}

----------------------------------------

TITLE: Deleting EmailAddress in TypeScript
DESCRIPTION: Deletes the email address associated with the EmailAddress object.

LANGUAGE: typescript
CODE:
function destroy(): Promise<void>

----------------------------------------

TITLE: Closing CreateOrganization Overlay with JavaScript
DESCRIPTION: Example of closing the CreateOrganization component overlay using JavaScript. The Clerk instance's closeCreateOrganization method is used to hide the component.

LANGUAGE: js
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="create-organization"></div>
`

const createOrgDiv = document.getElementById('create-organization')

clerk.openCreateOrganization(createOrgDiv)

// ...

clerk.closeCreateOrganization(createOrgDiv)

----------------------------------------

TITLE: Installing Latest Clerk Next.js SDK
DESCRIPTION: Commands for installing the latest version of @clerk/nextjs across different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/nextjs

LANGUAGE: bash
CODE:
yarn add @clerk/nextjs

LANGUAGE: bash
CODE:
pnpm add @clerk/nextjs

LANGUAGE: bash
CODE:
bun add @clerk/nextjs

----------------------------------------

TITLE: Configuring Reverification Presets in Clerk Ruby SDK
DESCRIPTION: This snippet demonstrates the available presets for the reverification feature in the Clerk Ruby SDK. It shows different security levels with varying authentication time windows and factor requirements.

LANGUAGE: ruby
CODE:
Clerk::StepUp::Preset::LAX
Clerk::StepUp::Preset::MODERATE
Clerk::StepUp::Preset::STRICT
Clerk::StepUp::Preset::STRICT_MFA

----------------------------------------

TITLE: Implementing SignUp Component in Vue
DESCRIPTION: Example showing how to implement the SignUp component in a Vue application using script setup.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { SignUp } from '@clerk/vue'
</script>

<template>
  <SignUp />
</template>

----------------------------------------

TITLE: Multi-session SignOutButton in Next.js
DESCRIPTION: Demonstrates how to use SignOutButton for multi-session functionality in Next.js. It uses the useAuth hook to get the sessionId and conditionally renders SignInButton or SignOutButton based on the session state.

LANGUAGE: tsx
CODE:
'use client'

import { SignInButton, SignOutButton, useAuth } from '@clerk/nextjs'

export default function Home() {
  const { sessionId } = useAuth()

  if (!sessionId) {
    return <SignInButton />
  }

  return <SignOutButton signOutOptions={{ sessionId }} />
}

----------------------------------------

TITLE: Installing Latest React Dependencies
DESCRIPTION: Commands for updating React and React DOM to latest versions across different package managers.

LANGUAGE: bash
CODE:
npm install react@latest react-dom@latest

LANGUAGE: bash
CODE:
yarn add react@latest react-dom@latest

LANGUAGE: bash
CODE:
pnpm add react@latest react-dom@latest

LANGUAGE: bash
CODE:
bun add react@latest react-dom@latest

----------------------------------------

TITLE: Configuring environment variables for Cognito to Clerk migration
DESCRIPTION: Sample .env file content showing the required AWS and Clerk credentials for the migration script.

LANGUAGE: shell
CODE:
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=

COGNITO_USER_POOL_ID=
COGNITO_CLIENT_ID=

CLERK_SECRET_KEY=

----------------------------------------

TITLE: Paginating Organization Memberships in Svelte
DESCRIPTION: This snippet shows how to implement pagination for organization memberships using Svelte. It uses the $organizationStore to access the organization data and implements a fetchMemberships function to retrieve paginated data. The component includes previous and next buttons for navigation.

LANGUAGE: svelte
CODE:
<script>
  // The $ prefix is reserved in Svelte for its own reactivity system.
  // Alias the imports to avoid conflicts.
  import { $organizationStore as organization } from '@clerk/astro/client'

  let memberships = []
  let currentPage = 1

  async function fetchMemberships() {
    if (!$organization) {
      return
    }

    const { data } = await $organization.getMemberships({
      initialPage: currentPage,
      pageSize: 5,
    })
    memberships = data
  }

  $: fetchMemberships()

  const fetchPrevious = () => currentPage.value--
  const fetchNext = () => currentPage.value++
</script>

{#if organization === undefined}
  <!-- Handle loading state -->
{:else if organization === null}
  <!-- Handle no organization state -->
{:else}
  <div>
    <h2>Organization members</h2>
    <ul>
      {#each memberships as membership (membership.id)}
        <li>
          {membership.publicUserData.firstName}
          {membership.publicUserData.lastName} &lt;
          {membership.publicUserData.identifier}&gt; :: {membership.role}
        </li>
      {/each}
    </ul>
    <div>
      <button on:click={fetchPrevious} disabled={currentPage === 1}>Previous</button>
      <button on:click={fetchNext}>Next</button>
    </div>
  </div>
{/if}

----------------------------------------

TITLE: Implementing User Impersonation Dashboard in Expo
DESCRIPTION: This code creates the UI for the user impersonation dashboard in an Expo app. It displays a list of users, allows impersonation, and handles the impersonation process using Clerk's hooks and API calls.

LANGUAGE: tsx
CODE:
import React, { useState } from 'react'
import { Button, Text, View } from 'react-native'
import { useRouter } from 'expo-router'
import { useUser, useSignIn } from '@clerk/clerk-expo'
import useUsers from '../hooks/useUsers'

export default function Dashboard() {
  const [error, setError] = useState<string | null>(null)

  const { isLoaded, signIn, setActive } = useSignIn()
  const { user } = useUser()
  const router = useRouter()
  const { users, isLoading } = useUsers()

  if (!user?.id) return null

  async function createActorToken(actorId: string, userId: string) {
    setError(null)

    try {
      const res = await fetch('/generateActorToken', {
        method: 'POST',
        body: JSON.stringify({
          actorId,
          userId,
        }),
      })

      const data = await res.json()

      if (data.errors) {
        setError(data.errors[0].long_message)
        return null
      }

      return data.token
    } catch (err) {
      setError('Failed to generate actor token')
      return null
    }
  }

  async function impersonateUser(actorId: string, userId: string) {
    setError(null)
    if (!isLoaded) return

    const actorToken = await createActorToken(actorId, userId)

    if (actorToken) {
      try {
        const { createdSessionId } = await signIn.create({
          strategy: 'ticket',
          ticket: actorToken,
        })

        await setActive({ session: createdSessionId })

        router.push('/')
      } catch (err) {
        setError('Failed to impersonate user')
        console.error(JSON.stringify(err, null, 2))
      }
    }
  }

  return (
    <View>
      <Text style={{ fontSize: 24, fontWeight: 'bold', padding: 10 }}>
        Welcome to the dashboard, {user?.firstName}!
      </Text>
      <Text style={{ fontSize: 16, padding: 10 }}>Your user ID is {user?.id}</Text>

      {isLoading && <Text>Loading your users...</Text>}

      {!isLoading && users && (
        <View style={{ padding: 10 }}>
          <View style={{ flexDirection: 'row', padding: 5, borderBottomWidth: 1 }}>
            <Text style={{ flex: 1, fontWeight: 'bold' }}>User ID</Text>
            <Text style={{ flex: 1, fontWeight: 'bold' }}>Email ID</Text>
            <Text style={{ flex: 1, fontWeight: 'bold' }}>First Name</Text>
            <Text style={{ flex: 1, fontWeight: 'bold' }}>Actions</Text>
          </View>
          {users.map((userFromList) => {
            const primaryEmail = userFromList.email_addresses?.find(
              (email) => email.id === userFromList.primary_email_address_id,
            )
            return (
              <View key={userFromList.id} style={{ flexDirection: 'row', padding: 5 }}>
                <Text style={{ flex: 1 }}>{userFromList.id}</Text>
                <Text style={{ flex: 1 }}>{primaryEmail?.id || 'N/A'}</Text>
                <Text style={{ flex: 1 }}>{userFromList.first_name || 'N/A'}</Text>
                <View style={{ flex: 1 }}>
                  {userFromList.id !== user.id ? (
                    <Button
                      title="Impersonate"
                      onPress={async () => await impersonateUser(user.id, userFromList.id)}
                    />
                  ) : (
                    <Text>You cannot impersonate yourself</Text>
                  )}
                </View>
              </View>
            )
          })}
        </View>
      )}

      {error && (
        <View style={{ padding: 10, backgroundColor: '#ffebee' }}>
          <Text style={{ color: '#c62828' }}>{error}</Text>
        </View>
      )}
    </View>
  )
}

----------------------------------------

TITLE: Framework-Specific Telemetry Configuration
DESCRIPTION: Shows various ways to disable telemetry across different frameworks including Next.js, React, Remix, and others.

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_TELEMETRY_DISABLED=1

LANGUAGE: javascript
CODE:
const clerk = new Clerk(publishableKey)
c.load({ telemetry: false })

LANGUAGE: env
CODE:
PUBLIC_CLERK_TELEMETRY_DISABLED=1

LANGUAGE: env
CODE:
VITE_CLERK_TELEMETRY_DISABLED=1

----------------------------------------

TITLE: Creating Organization Membership with Clerk Backend SDK in TypeScript
DESCRIPTION: Example usage of createOrganizationMembership function to create an OrganizationMembership for a user with the role 'org:member'. It demonstrates how to use the organizationId, userId, and role parameters.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const userId = 'user_123'

const role = 'org:member'

const response = await clerkClient.organizations.createOrganizationMembership({
  organizationId,
  userId,
  role,
})

----------------------------------------

TITLE: Implementing Localization in Nuxt
DESCRIPTION: Demonstrates how to import and use a localization (French) in a Nuxt configuration file.

LANGUAGE: typescript
CODE:
// fr-FR locale is imported as frFR
import { frFR } from '@clerk/localizations'

export default defineNuxtConfig({
  modules: ['@clerk/nuxt'],
  clerk: {
    localization: frFR,
  },
})

----------------------------------------

TITLE: Configuring CAPTCHA Appearance in Astro
DESCRIPTION: This snippet shows how to configure the CAPTCHA appearance in an Astro application using the clerk integration in the astro.config.mjs file.

LANGUAGE: js
CODE:
import clerk from '@clerk/astro'

export default defineConfig({
  integrations: [
    clerk({
      appearance: {
        captcha: {
          theme: 'dark',
          size: 'flexible',
          language: 'es-ES',
        },
      },
    }),
  ],
})

----------------------------------------

TITLE: Creating Organization Invitation with Metadata in Clerk
DESCRIPTION: This snippet demonstrates how to add metadata to an organization invitation when creating it through Clerk's Backend API. The public_metadata parameter is included in the request body to associate additional information with the invitation.

LANGUAGE: bash
CODE:
curl 'https://api.clerk.com/v1/organizations/{org_123}/invitations' \
  -X POST \
  -H 'Authorization: Bearer {{secret}}' \
  -H 'Content-Type: application/json' \
  -d '{ "inviter_user_id": "user_123", "email_address": "email@example.com", "role": "org:member", "public_metadata": {"department": "marketing"} }'

----------------------------------------

TITLE: Delete Email Address Usage Example
DESCRIPTION: Example showing how to delete an email address using the Clerk client, demonstrating the practical usage of the deleteEmailAddress function with a sample email address ID.

LANGUAGE: tsx
CODE:
const emailAddressId = 'idn_123'

const response = await clerkClient.emailAddresses.deleteEmailAddress(emailAddressId)

----------------------------------------

TITLE: Basic Usage of SignInWithMetamaskButton in Vue
DESCRIPTION: Demonstrates how to use the SignInWithMetamaskButton component in a Vue application. It imports the component from '@clerk/vue' and uses it within a template.

LANGUAGE: vue
CODE:
<script setup>
import { SignInWithMetamaskButton } from '@clerk/vue'
</script>

<template>
  <div>
    <SignInWithMetamaskButton />
  </div>
</template>

----------------------------------------

TITLE: Installing Clerk SDK in JavaScript Project
DESCRIPTION: Commands to install the Clerk JavaScript SDK using various package managers.

LANGUAGE: bash
CODE:
npm install @clerk/clerk-js

LANGUAGE: bash
CODE:
yarn add @clerk/clerk-js

LANGUAGE: bash
CODE:
pnpm add @clerk/clerk-js

LANGUAGE: bash
CODE:
bun add @clerk/clerk-js

----------------------------------------

TITLE: Express Middleware Authentication
DESCRIPTION: Example of implementing authentication in Express using the new ClerkExpressRequireAuth middleware.

LANGUAGE: javascript
CODE:
import { ClerkExpressRequireAuth } from '@clerk/clerk-sdk-node'

app.use(ClerkExpressRequireAuth())
app.get('/', (req, res) => {
  const { userId, sessionId, getToken } = req.auth
  // Your handler...
})

----------------------------------------

TITLE: Initializing Clerk with window.Clerk.load() in TypeScript
DESCRIPTION: This snippet demonstrates how to call window.Clerk.load() to initialize the Clerk class and gain access to its functionality. It also sets the Clerk instance in the internal state.

LANGUAGE: typescript
CODE:
import { loadClerkJSScript } from '@clerk/shared/loadClerkJSScript'
import { runOnce } from './utils'
import { $clerk, $state } from './stores'

export const createClerkInstance = runOnce(createClerkInstanceInternal)

async function createClerkInstanceInternal(options) {
  let clerkJSInstance = window.Clerk

  if (!clerkJSInstance) {
    // loadClerkJSScript() codepath
  }

  if (!$clerk.get()) {
    $clerk.set(clerkJSInstance)
  }

  await clerkJSInstance.load(options)
}

----------------------------------------

TITLE: HTML Element Class Structure Example
DESCRIPTION: Example showing the class structure of a Clerk component element, demonstrating which classes are safe to target for styling.

LANGUAGE: html
CODE:
cl-formButtonPrimary cl-button 🔒️ cl-internal-1ta0xpz

----------------------------------------

TITLE: Implementing Clerk Sign-in with Svelte
DESCRIPTION: Example of using $clerkStore in a Svelte component to implement a sign-in button. Uses @clerk/astro/client for Clerk functionality with special handling for Svelte's reactivity system.

LANGUAGE: svelte
CODE:
<script>
  // The $ prefix is reserved in Svelte for its own reactivity system.
  // Alias the imports to avoid conflicts.
  import { $clerkStore as clerk } from '@clerk/astro/client'
</script>

<button on:click={() => $clerk.openSignIn()}>Sign in</button>

----------------------------------------

TITLE: Implementing Clerk Sign-Out in JavaScript
DESCRIPTION: This JavaScript snippet demonstrates how to initialize Clerk, check if a user is signed in, and attach a sign-out function to a button. It uses the Clerk object to handle the sign-out process.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(pubKey)
await clerk.load()

if (clerk.user) {
  // Attach signOut function to the sign-out button
  document.getElementById('sign-out').addEventListener('click', async () => {
    await clerk.signOut()
    // Optional: refresh page after sign-out
    window.location.reload()
  })
}

----------------------------------------

TITLE: User Role Helper Function Implementation
DESCRIPTION: Helper function for checking user roles using Clerk's auth helper.

LANGUAGE: typescript
CODE:
import { Roles } from '@/types/globals'
import { auth } from '@clerk/nextjs/server'

export const checkRole = async (role: Roles) => {
  const { sessionClaims } = await auth()
  return sessionClaims?.metadata.role === role
}

----------------------------------------

TITLE: Updating Clerk import
DESCRIPTION: Example of updating the Clerk import to use createClerkClient.

LANGUAGE: javascript
CODE:
import { createClerkClient } from '@clerk/clerk-sdk-node'

----------------------------------------

TITLE: Implementing Localization in JavaScript
DESCRIPTION: Demonstrates how to import and use a localization (French) with the Clerk.load() method in a JavaScript application.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'
// fr-FR locale is imported as frFR
import { frFR } from '@clerk/localizations'

const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load({
  localization: frFR,
})

if (clerk.user) {
  document.getElementById('app').innerHTML = `
    <div id="user-button"></div>
  `

  const userButtonDiv = document.getElementById('user-button')

  clerk.mountUserButton(userButtonDiv)
} else {
  document.getElementById('app').innerHTML = `
    <div id="sign-in"></div>
  `

  const signInDiv = document.getElementById('sign-in')

  clerk.mountSignIn(signInDiv)
}

----------------------------------------

TITLE: Implementing RedirectToCreateOrganization in Next.js
DESCRIPTION: Example showing how to implement the RedirectToCreateOrganization component within a Next.js application's _app.tsx file. The component is wrapped in ClerkProvider and SignedIn components to ensure proper authentication flow.

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, RedirectToCreateOrganization } from '@clerk/nextjs'
import { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider {...pageProps}>
      <SignedIn>
        <RedirectToCreateOrganization />
      </SignedIn>
      <SignedOut>You need to sign in to create an organization.</SignedOut>
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Mounting OrganizationProfile with JavaScript
DESCRIPTION: Example of mounting the <OrganizationProfile /> component using Clerk's JavaScript SDK.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="organization-profile"></div>
`

const orgProfileDiv = document.getElementById('organization-profile')

clerk.mountOrganizationProfile(orgProfileDiv)

----------------------------------------

TITLE: Revoking Organization Invitation with cURL in Clerk
DESCRIPTION: This example shows how to revoke an organization invitation using a cURL command to interact with Clerk's Backend API. It requires the organization ID, invitation ID, and the ID of the user revoking the invitation.

LANGUAGE: bash
CODE:
curl 'https://api.clerk.com/v1/organizations/{org_123}/invitations/{inv_123}/revoke' \
  -X POST \
  -H 'Authorization: Bearer {{secret}}' \
  -H 'Content-Type: application/json' \
  -d '{ "requesting_user_id": "user_123" }'

----------------------------------------

TITLE: Configuring Production Environment Variables for Clerk Sync
DESCRIPTION: Production environment configuration file setting up Clerk publishable key and sync host for production deployment.

LANGUAGE: env
CODE:
PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_live_123
CLERK_FRONTEND_API=https://yourdomain.com
PLASMO_PUBLIC_CLERK_SYNC_HOST=https://yourdomain.com

----------------------------------------

TITLE: Custom Usage of SignInWithMetamaskButton in Vue
DESCRIPTION: Illustrates how to customize the SignInWithMetamaskButton in Vue by wrapping a custom button inside it. The 'mode' attribute is set to 'modal' for a modal sign-in experience.

LANGUAGE: vue
CODE:
<script setup>
import { SignInWithMetamaskButton } from '@clerk/vue'
</script>

<template>
  <div>
    <SignInWithMetamaskButton mode="modal">
      <button>Custom sign in button</button>
    </SignInWithMetamaskButton>
  </div>
</template>

----------------------------------------

TITLE: Including Clerk SDK via CDN in HTML
DESCRIPTION: HTML snippet showing how to include the Clerk JavaScript SDK using a script tag and CDN, along with initialization code.

LANGUAGE: html
CODE:
<div id="app"></div>

<!-- Initialize Clerk with your
Clerk Publishable Key and Frontend API URL -->
<script
  async
  crossorigin="anonymous"
  data-clerk-publishable-key="{{pub_key}}"
  src="https://{{fapi_url}}/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
  type="text/javascript"
></script>

<script>
  window.addEventListener('load', async function () {
    await Clerk.load()

    if (Clerk.user) {
      document.getElementById('app').innerHTML = `
        <div id="user-button"></div>
      `

      const userButtonDiv = document.getElementById('user-button')

      Clerk.mountUserButton(userButtonDiv)
    } else {
      document.getElementById('app').innerHTML = `
        <div id="sign-in"></div>
      `

      const signInDiv = document.getElementById('sign-in')

      Clerk.mountSignIn(signInDiv)
    }
  })
</script>

----------------------------------------

TITLE: Defining PasswordFactor Type in TypeScript
DESCRIPTION: This snippet defines the PasswordFactor type, representing the password strategy for first factor verification. It only includes the strategy property.

LANGUAGE: typescript
CODE:
type PasswordFactor = {
  strategy: PasswordStrategy
}

----------------------------------------

TITLE: Paginated SAML Connection List with Offset
DESCRIPTION: Example demonstrating how to skip a specific number of results when retrieving SAML connections.

LANGUAGE: tsx
CODE:
const { data, totalCount } = await clerkClient.samlConnections.getSamlConnectionList({
  // skips the first 10 results
  offset: 10,
})

----------------------------------------

TITLE: Using Clerk Components in React Components
DESCRIPTION: Example of using Clerk components like SignInButton, SignedIn, SignedOut, and UserButton in a React component.

LANGUAGE: tsx
CODE:
import { SignInButton, SignedIn, SignedOut, UserButton } from '@clerk/astro/react'

export default function Header() {
  return (
    <>
      <p>My App</p>
      <SignedOut>
        <SignInButton />
      </SignedOut>
      <SignedIn>
        <UserButton />
      </SignedIn>
    </>
  )
}

----------------------------------------

TITLE: Implementing Geo Blocking with Render Headers
DESCRIPTION: Implementation of geo blocking middleware using Render's cf-ipcountry header. Checks client's country and redirects to a block route if the country is not in the allowed list. Also handles protected route authentication.

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'
import { NextResponse } from 'next/server'

const isProtectedRoute = createRouteMatcher(['/dashboard(.*)'])
const isBlockRoute = createRouteMatcher(['/block(.*)'])

const allowedCountries = ['US']

export default clerkMiddleware(async (auth, req) => {
  if (isBlockRoute(req)) {
    return
  }

  // Use Render's `cf-ipcountry` header to get the client's country
  const country = req.headers.get('cf-ipcountry')

  // Redirect if the client's country is not allowed
  if (country && !allowedCountries.includes(country)) {
    return NextResponse.redirect(new URL('/block', req.url))
  }

  // Protect routes based on authentication status
  if (isProtectedRoute(req)) await auth.protect()
})

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Configuring Session Token JSON in Clerk Dashboard
DESCRIPTION: JSON configuration to include publicMetadata in the session token for role-based access control.

LANGUAGE: json
CODE:
{
  "metadata": "{{user.public_metadata}}"
}

----------------------------------------

TITLE: Implementing RedirectToOrganizationProfile in React
DESCRIPTION: This snippet shows how to use the RedirectToOrganizationProfile component in a React application. It uses ClerkProvider with a publishable key and wraps the redirect component in a SignedIn component.

LANGUAGE: tsx
CODE:
import {
  ClerkProvider,
  SignedIn,
  SignedOut,
  RedirectToOrganizationProfile,
} from '@clerk/clerk-react'

function PrivatePage() {
  return (
    <ClerkProvider publishableKey={`{{pub_key}}`}>
      <SignedIn>
        <RedirectToOrganizationProfile />
      </SignedIn>
      <SignedOut>You need to sign in to view your organization profile.</SignedOut>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Using Clerk Stores in React Components
DESCRIPTION: Example of using a Clerk Astro store ($userStore) in a React component to access user data.

LANGUAGE: tsx
CODE:
import { $userStore } from '@clerk/astro/client'

export default function Username() {
  const user = useSyncExternalStore($userStore.listen, $userStore.get, $userStore.get)
  return <>{user?.firstName}</>
}

----------------------------------------

TITLE: Configuring ClerkProvider for Chrome Extension Navigation
DESCRIPTION: Example of updating ClerkProvider props to handle Chrome Extension-specific navigation, including afterSignOutUrl and fallback redirect URLs.

LANGUAGE: tsx
CODE:
import {
  ClerkProvider,
  SignInButton,
  SignedIn,
  SignedOut,
  UserButton,
} from '@clerk/chrome-extension'

import { CountButton } from '~features/count-button'

import '~style.css'

const PUBLISHABLE_KEY = process.env.PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY
const EXTENSION_URL = chrome.runtime.getURL('.')

if (!PUBLISHABLE_KEY) {
  throw new Error('Please add the PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY to the .env.development file')
}

function IndexPopup() {
  return (
    <ClerkProvider
      publishableKey={PUBLISHABLE_KEY}
      afterSignOutUrl={`${EXTENSION_URL}/popup.html`}
      signInFallbackRedirectUrl={`${EXTENSION_URL}/popup.html`}
      signUpFallbackRedirectUrl={`${EXTENSION_URL}/popup.html`}
    >
      <div className="plasmo-flex plasmo-items-center plasmo-justify-center plasmo-h-[600px] plasmo-w-[800px] plasmo-flex-col">
        <header className="plasmo-w-full">
          <SignedOut>
            <SignInButton mode="modal" />
          </SignedOut>
          <SignedIn>
            <UserButton />
          </SignedIn>
        </header>
        <main className="plasmo-grow">
          <CountButton />
        </main>
      </div>
    </ClerkProvider>
  )
}

export default IndexPopup

----------------------------------------

TITLE: Error Response for Unavailable Backup Codes in Clerk
DESCRIPTION: Defines the error response structure when a user attempts to use backup codes without having enabled any other multi-factor authentication method. The error includes a short message, detailed explanation, and an error code identifier.

LANGUAGE: json
CODE:
{
  "shortMessage": "Backup codes not available",
  "longMessage": "In order to use backup codes, you have to enable any other Multi-factor method",
  "code": "backup_codes_not_available_code"
}

----------------------------------------

TITLE: OperationNotAllowedOnSatelliteDomain Error Response in JSON
DESCRIPTION: Error response when an invalid operation is attempted on a satellite domain.

LANGUAGE: json
CODE:
{
  "shortMessage": "operation not allowed",
  "longMessage": "This operation is not allowed on a satellite domain. Try again using the primary domain of your instance.",
  "code": "operation_not_allowed_on_satellite_domain_code"
}

----------------------------------------

TITLE: Integrating OrganizationSwitcher in Astro
DESCRIPTION: Example of how to use the OrganizationSwitcher component in an Astro application. This code snippet shows the component usage within an Astro page.

LANGUAGE: astro
CODE:
---
import { OrganizationSwitcher } from '@clerk/astro/components'
---

<OrganizationSwitcher />

----------------------------------------

TITLE: Mounting OrganizationList with JavaScript
DESCRIPTION: Example of programmatically mounting the OrganizationList component using vanilla JavaScript with the Clerk SDK.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="organization-list"></div>
`

const orgListDiv = document.getElementById('organization-list')

clerk.mountOrganizationList(orgListDiv)

----------------------------------------

TITLE: Accessing Organization Information on Server-Side in Next.js
DESCRIPTION: This code demonstrates how to access organization information on the server-side in a Next.js application using Clerk's auth object and custom session claims.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'
import { OrganizationList } from '@clerk/nextjs'

export default async function Home({ params }: { params: { slug: string } }) {
  const { orgSlug } = await auth()

  if (params.slug != orgSlug) {
    return (
      <>
        <p>Sorry, organization {params.slug} is not valid.</p>
        <OrganizationList
          hideSlug={false}
          hidePersonal={false}
          afterCreateOrganizationUrl="/orgs/:slug"
          afterSelectOrganizationUrl="/orgs/:slug"
          afterSelectPersonalUrl="/me"
        />
      </>
    )
  }

  // Access the organization name from the session claims
  let orgName = authObject.sessionClaims['org_name'] as string
  return <div>{orgName && `Welcome to organization ${orgName}`}</div>
}

----------------------------------------

TITLE: Delete Organization Membership Usage Example
DESCRIPTION: Example showing how to use the deleteOrganizationMembership function with the Clerk client to remove a user from an organization.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const userId = 'user_123'

const response = await clerkClient.organizations.deleteOrganizationMembership({
  organizationId,
  userId,
})

----------------------------------------

TITLE: SignInButton Usage in Vue
DESCRIPTION: Demonstrates the implementation of the SignInButton component in a Vue.js application, including both the script setup and template sections.

LANGUAGE: vue
CODE:
<script setup>
import { SignInButton } from '@clerk/vue'
</script>

<template>
  <SignInButton />
</template>

----------------------------------------

TITLE: Implementing ClerkProvider in Root Layout
DESCRIPTION: Adding the ClerkProvider component to the root layout of an Expo app to enable Clerk authentication.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/clerk-expo'
import { Slot } from 'expo-router'

export default function RootLayout() {
  return (
    <ClerkProvider>
      <Slot />
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Defining ResetPasswordEmailCodeFactor Type in TypeScript
DESCRIPTION: This snippet defines the ResetPasswordEmailCodeFactor type, representing the reset password via email code strategy. It includes properties for strategy, emailAddressId, safeIdentifier, and primary status.

LANGUAGE: typescript
CODE:
type ResetPasswordEmailCodeFactor = {
  strategy: ResetPasswordEmailCodeStrategy
  emailAddressId: string
  safeIdentifier: string
  primary?: boolean
}

----------------------------------------

TITLE: Function Signature - getSamlConnectionList
DESCRIPTION: TypeScript function signature for retrieving SAML connections with optional pagination parameters.

LANGUAGE: typescript
CODE:
function getSamlConnectionList(params: SamlConnectionListParams = {}): Promise<SamlConnection[]>

----------------------------------------

TITLE: Frontend API Rate Limits
DESCRIPTION: Frontend API request rate limits are enforced per user based on IP address. Includes limits for sign-in and sign-up operations.

LANGUAGE: plaintext
CODE:
/v1/sign_ins - 5 requests per 10 seconds\n/v1/sign_ups - 5 requests per 10 seconds\n/v1/sign_ins/attempt_(first|second)_factor - 3 requests per 10 seconds\n/v1/sign_ups/attempt_verification - 3 requests per 10 seconds

----------------------------------------

TITLE: Updating app.json for iOS Passkey Configuration in Expo
DESCRIPTION: This snippet shows how to update the app.json file in an Expo application to configure passkeys for iOS. It includes adding the associatedDomains property and setting the iOS deployment target.

LANGUAGE: json
CODE:
{
  "expo": {
    //...existing properties
    "plugins": [
      [
        "expo-build-properties",
        {
          "ios": {
            "deploymentTarget": "16.0" //  iOS Support passkeys from version iOS 16+
          }
        }
      ]
    ],
    "ios": {
      //...existing properties
      "associatedDomains": [
        "applinks:<YOUR_FRONTEND_API_URL>",
        "webcredentials:<YOUR_FRONTEND_API_URL>"
      ]
    }
  }
}

----------------------------------------

TITLE: Configuring CAPTCHA Appearance in Next.js
DESCRIPTION: This snippet demonstrates how to set the CAPTCHA appearance properties in a Next.js application using the ClerkProvider component.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/nextjs';

<ClerkProvider
  appearance={{
    captcha: {
      theme: 'dark',
      size: 'flexible',
      language: 'es-ES',
    }
  }}
>
  {/* ... */}
</ClerkProvider>;

----------------------------------------

TITLE: Creating Email Link Flow in TypeScript
DESCRIPTION: Sets up an email verification flow using an email link, returning functions to start and cancel the flow.

LANGUAGE: typescript
CODE:
function createEmailLinkFlow(): {
  startEmailLinkFlow: (params: StartEmailLinkFlowParams) => Promise<EmailAddress>
  cancelEmailLinkFlow: () => void
}

----------------------------------------

TITLE: Implementing RedirectToCreateOrganization in Remix
DESCRIPTION: Example demonstrating the RedirectToCreateOrganization component implementation in a Remix application. Shows basic setup with SignedIn and SignedOut components for authentication flow control.

LANGUAGE: tsx
CODE:
import { SignedIn, SignedOut, RedirectToCreateOrganization } from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <SignedIn>
        <RedirectToCreateOrganization />
      </SignedIn>
      <SignedOut>
        <p>You need to sign in to create an organization.</p>
      </SignedOut>
    </div>
  )
}

----------------------------------------

TITLE: Accessing Custom Claims in Next.js Pages Router
DESCRIPTION: Example of accessing custom session token claims (fullName and primaryEmail) using the getAuth() helper in Next.js Pages API route.

LANGUAGE: typescript
CODE:
import { getAuth } from '@clerk/nextjs/server'
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const { sessionClaims } = getAuth(req)

  const fullName = sessionClaims.fullName

  const primaryEmail = sessionClaims.primaryEmail

  return res.status(200).json({ fullName, primaryEmail })
}

----------------------------------------

TITLE: Implementing RedirectToCreateOrganization in React
DESCRIPTION: Implementation example for the RedirectToCreateOrganization component in a React application. Shows usage with ClerkProvider and requires a publishable key for authentication setup.

LANGUAGE: tsx
CODE:
import {
  ClerkProvider,
  SignedIn,
  SignedOut,
  RedirectToCreateOrganization,
} from '@clerk/clerk-react'

function PrivatePage() {
  return (
    <ClerkProvider publishableKey={`{{pub_key}}`}>
      <SignedIn>
        <RedirectToCreateOrganization />
      </SignedIn>
      <SignedOut>You need to sign in to create an organization.</SignedOut>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Organization Synchronization Component
DESCRIPTION: Implementation of a component that synchronizes the active organization based on URL parameters.

LANGUAGE: tsx
CODE:
'use client'

import { useEffect } from 'react'
import { redirect, useParams } from 'next/navigation'
import { useAuth, useOrganizationList } from '@clerk/nextjs'

export function SyncActiveOrganization() {
  const { setActive, isLoaded } = useOrganizationList()
  const { orgId } = useAuth()
  const { orgId: urlOrgId } = useParams() as { orgId: string }

  useEffect(() => {
    if (!isLoaded) return

    if (!urlOrgId?.startsWith('org_')) {
      redirect('/')
      return
    }

    if (urlOrgId && urlOrgId !== orgId) {
      void setActive({ organization: urlOrgId })
    }
  }, [orgId, isLoaded, setActive, urlOrgId])

  return null
}

----------------------------------------

TITLE: Defining revokeSignInToken Method Signature in TypeScript
DESCRIPTION: TypeScript function signature for revoking a sign-in token. Returns a Promise that resolves to a SignInToken object.

LANGUAGE: typescript
CODE:
function revokeSignInToken(signInTokenId: string): Promise<SignInToken>

----------------------------------------

TITLE: Authenticating with GoogleOneTap using JavaScript
DESCRIPTION: Example of using the authenticateWithGoogleOneTap() and handleGoogleOneTapCallback() methods from the Clerk JavaScript SDK to authenticate a user and handle the callback with custom redirect URLs.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

// Optionally, you can set redirect URLs.
const customUrls = {
  signInUrl: '/sign-in',
  signUpUrl: '/sign-up',
}
// Initiate the authentication flow.
const signInOrUp = await clerk.authenticateWithGoogleOneTap({ token: 'xxxx' })
// Set the session as active, and handle any navigation or redirects
await clerk.handleGoogleOneTapCallback(signInOrUp, customUrls)

----------------------------------------

TITLE: Setting Clerk API Keys in Environment File
DESCRIPTION: Example of setting Clerk Publishable Key and Frontend API URL in the .env.development file for a Chrome Extension.

LANGUAGE: env
CODE:
PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_FRONTEND_API=https://{{fapi_url}}

----------------------------------------

TITLE: Defining EmailLinkFactor Type in TypeScript
DESCRIPTION: This snippet defines the EmailLinkFactor type, representing the email link strategy for first factor verification. It includes properties for strategy, emailAddressId, safeIdentifier, and primary status.

LANGUAGE: typescript
CODE:
type EmailLinkFactor = {
  strategy: EmailLinkStrategy
  emailAddressId: string
  safeIdentifier: string
  primary?: boolean
}

----------------------------------------

TITLE: Creating Tasks Table with RLS in Supabase
DESCRIPTION: SQL commands to create a 'tasks' table with a user_id column and enable Row Level Security.

LANGUAGE: sql
CODE:
create table tasks(
  id serial primary key,
  name text not null,
  user_id text not null default requesting_user_id()
);

alter table "tasks" enable row level security;

----------------------------------------

TITLE: Implementing Server Action to Update User Metadata in Clerk
DESCRIPTION: Server-side action to update user's public metadata in Clerk after completing the onboarding process. It uses the Clerk client to update the user's metadata.

LANGUAGE: typescript
CODE:
'use server'

import { auth, clerkClient } from '@clerk/nextjs/server'

export const completeOnboarding = async (formData: FormData) => {
  const { userId } = await auth()

  if (!userId) {
    return { message: 'No Logged In User' }
  }

  const client = await clerkClient()

  try {
    const res = await client.users.updateUser(userId, {
      publicMetadata: {
        onboardingComplete: true,
        applicationName: formData.get('applicationName'),
        applicationType: formData.get('applicationType'),
      },
    })
    return { message: res.publicMetadata }
  } catch (err) {
    return { error: 'There was an error updating the user metadata.' }
  }
}

----------------------------------------

TITLE: Implementing requireAuth Middleware in TypeScript
DESCRIPTION: This code defines a requireAuth middleware function that checks for user authentication. It returns a 401 status for unauthorized requests, ensuring protected routes are only accessible to authenticated users.

LANGUAGE: typescript
CODE:
export const requireAuth = (context, next) => {
  if (!hasAuthObject(context)) {
    throw new Error('Middleware required')
  }
  if (!getAuth(context).userId) {
    context.status = 401
    return
  }
  return next()
}

----------------------------------------

TITLE: Implementing RedirectToSignUp in Remix
DESCRIPTION: This example demonstrates how to use the RedirectToSignUp component in a Remix application. It shows the component usage within a route file, along with conditional rendering based on user authentication status.

LANGUAGE: tsx
CODE:
import { SignedIn, SignedOut, RedirectToSignUp, UserButton } from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <SignedIn>
        <UserButton />
      </SignedIn>
      <SignedOut>
        <RedirectToSignUp />
      </SignedOut>
    </div>
  )
}

----------------------------------------

TITLE: Configuring Additional OAuth Scopes with UserButton Component
DESCRIPTION: Example showing how to add custom OAuth scopes to the UserButton component for Google and GitHub providers.

LANGUAGE: tsx
CODE:
<UserButton
  userProfileProps={{
    additionalOAuthScopes: {
      google: ['foo', 'bar'],
      github: ['qux'],
    },
  }}
/>

----------------------------------------

TITLE: Importing GetAuth Function in Next.js Pages Router
DESCRIPTION: Shows how to import and use the getAuth() function in the Next.js Pages Router. This function returns an Auth object with user session details for Pages Router applications.

LANGUAGE: javascript
CODE:
import { getAuth } from "@clerk/nextjs";

----------------------------------------

TITLE: Testing Sign-In with Email Code in Clerk (TypeScript/React)
DESCRIPTION: This code snippet demonstrates how to test the sign-in process using an email code in Clerk. It uses a test email address and the predefined verification code '424242' to simulate the verification process.

LANGUAGE: tsx
CODE:
const testSignInWithEmailCode = async () => {
  const { signIn } = useSignIn()

  const emailAddress = 'john+clerk_test@example.com'
  const signInResp = await signIn.create({ identifier: emailAddress })
  const { emailAddressId } = signInResp.supportedFirstFactors.find(
    (ff) => ff.strategy === 'email_code' && ff.safeIdentifier === emailAddress,
  )! as EmailCodeFactor

  await signIn.prepareFirstFactor({
    strategy: 'email_code',
    emailAddressId: emailAddressId,
  })

  const attemptResponse = await signIn.attemptFirstFactor({
    strategy: 'email_code',
    code: '424242',
  })

  if (attemptResponse.status == 'complete') {
    console.log('success')
  } else {
    console.log('error')
  }
}

----------------------------------------

TITLE: Displaying Tutorial Hero Section in Markdown
DESCRIPTION: This snippet shows how to create a TutorialHero component in Markdown, listing prerequisites and main features of the tutorial.

LANGUAGE: markdown
CODE:
<TutorialHero
  beforeYouStart={[
    {
      title: "Add the Enhanced authentication add-on to your Pro plan",
      link: "/pricing",
      icon: "plus-circle",
    },
    {
      title: "Enable email address as an identifier for your app.",
      link: "/docs/authentication/configuration/sign-up-sign-in-options#identifiers",
      icon: "key",
    }
  ]}
>
  - Use Microsoft Azure Entra ID to enable SSO via SAML for your Clerk app
</TutorialHero>

----------------------------------------

TITLE: Installing Svix Package
DESCRIPTION: Install the svix package, which is used by Clerk to deliver webhooks.

LANGUAGE: bash
CODE:
npm install svix

LANGUAGE: bash
CODE:
yarn add svix

LANGUAGE: bash
CODE:
pnpm add svix

LANGUAGE: bash
CODE:
bun add svix

----------------------------------------

TITLE: Implementing RedirectToOrganizationProfile in Remix
DESCRIPTION: This snippet demonstrates the usage of RedirectToOrganizationProfile in a Remix application. It's used within a route component and wrapped in a SignedIn component to ensure authenticated access.

LANGUAGE: tsx
CODE:
import { SignedIn, SignedOut, RedirectToOrganizationProfile } from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <SignedIn>
        <RedirectToOrganizationProfile />
      </SignedIn>
      <SignedOut>
        <p>You need to sign in to view your organization profile.</p>
      </SignedOut>
    </div>
  )
}

----------------------------------------

TITLE: Opening GoogleOneTap with JavaScript
DESCRIPTION: Example of using the openGoogleOneTap() method from the Clerk JavaScript SDK to programmatically open the GoogleOneTap component with custom parameters.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

const params = {
  cancelOnTapOutside: false,
  itpSupport: false,
  fedCmSupport: false,
}
clerk.openGoogleOneTap(params)

----------------------------------------

TITLE: Sending Welcome Email with Inngest Function
DESCRIPTION: This snippet shows how to create an Inngest function that sends a welcome email when a new user is created. It listens for the 'clerk/user.created' event, extracts user information, and calls a function to send the welcome email.

LANGUAGE: typescript
CODE:
const sendWelcomeEmail = inngest.createFunction(
  { id: 'send-welcome-email' },
  { event: 'clerk/user.created' },
  async ({ event }) => {
    const user = event.data
    const { first_name } = user
    const email = user.email_addresses.find(
      (e) => e.id === user.primary_email_address_id,
    ).email_address
    // `emails` is a placeholder for the function in your codebase to send email
    await emails.sendWelcomeEmail({ email, first_name })
  },
)

----------------------------------------

TITLE: HTML Structure for Clerk JavaScript Integration
DESCRIPTION: Basic HTML structure for a JavaScript app using Clerk, including the necessary script tag for the app's main JavaScript file.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/main.js"></script>
  </body>
</html>

----------------------------------------

TITLE: MissingRequestHeaders Error JSON Response for Non-Standard Browsers
DESCRIPTION: JSON response structure for missing request headers error in non-standard browsers. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid request headers",
  "longMessage": "Your Clerk Frontend API is accessible from browsers and native applications. To protect against common web attacks, we require the HTTP Authorization header to be present in native application requests. Make sure the HTTP Authorization header is set a valid Clerk client JWT or set it to an empty string for your first Frontend API request that will return your Clerk client JWT.",
  "code": "request_header_missing_code"
}

----------------------------------------

TITLE: Starting Plasmo Development Server
DESCRIPTION: Command to start the Plasmo development server, which automatically builds and hot-reloads the Chrome Extension during development.

LANGUAGE: bash
CODE:
pnpm dev

----------------------------------------

TITLE: Defining verifiedFromTheSameClient Method in Typescript
DESCRIPTION: This method checks if the verification was completed from the same client as the parent sign-in or sign-up attempt. It returns a boolean value indicating whether the verification occurred on the same browser or client.

LANGUAGE: typescript
CODE:
function verifiedFromTheSameClient(): boolean

----------------------------------------

TITLE: Configuring Apollo Client with Clerk Authentication
DESCRIPTION: Implementation of Apollo Client setup with Clerk authentication token injection for GraphQL requests

LANGUAGE: jsx
CODE:
import { ApolloProvider, ApolloClient, HttpLink, from, InMemoryCache } from '@apollo/client'
import { setContext } from '@apollo/client/link/context'
import { useAuth } from '@clerk/nextjs'

export const ApolloProviderWrapper = ({ children }) => {
  const { getToken } = useAuth()
  const apolloClient = useMemo(() => {
    const authMiddleware = setContext(async (req, { headers }) => {
      const token = await user.getToken({ template: 'template' })
      return {
        headers: {
          ...headers,
          authorization: `Bearer ${token}`,
        },
      }
    })

    const httpLink = new HttpLink({
      uri: process.env.GRAPHQL_URI,
    })

    return new ApolloClient({
      link: from([authMiddleware, httpLink]),
      cache: new InMemoryCache(),
    })
  }, [getToken])

  return <ApolloProvider client={apolloClient}>{children}</ApolloProvider>
}

----------------------------------------

TITLE: Fetching OAuth Access Token and Using Notion API
DESCRIPTION: Server-side implementation showing how to retrieve a user's OAuth access token from Clerk and use it to access the Notion API.

LANGUAGE: tsx
CODE:
import { auth, clerkClient } from '@clerk/nextjs/server'
import { NextResponse } from 'next/server'

export async function GET() {
  const { userId } = await auth()

  if (!userId) {
    return NextResponse.json({ message: 'User not found' })
  }

  // Get the OAuth access token for the user
  const provider = 'notion'

  const client = await clerkClient()

  const clerkResponse = await client.users.getUserOauthAccessToken(userId, provider)

  const accessToken = clerkResponse[0].token || ''

  if (!accessToken) {
    return NextResponse.json({ message: 'Access token not found' }, { status: 401 })
  }

  // Fetch the user data from the Notion API
  // This endpoint fetches a list of users
  // https://developers.notion.com/reference/get-users
  const notionUrl = 'https://api.notion.com/v1/users'

  const notionResponse = await fetch(notionUrl, {
    headers: {
      Authorization: `Bearer ${accessToken}`,
      'Notion-Version': '2022-06-28',
    },
  })

  // Handle the response from the Notion API
  const notionData = await notionResponse.json()

  return NextResponse.json({ message: notionData })
}

----------------------------------------

TITLE: Accessing Custom Claims in Next.js App Router
DESCRIPTION: Example of accessing custom session token claims (fullName and primaryEmail) using the auth() helper in Next.js App Router route handler.

LANGUAGE: typescript
CODE:
import { auth } from '@clerk/nextjs/server'
import { NextResponse } from 'next/server'

export async function GET() {
  const { sessionClaims } = await auth()

  const fullName = sessionClaims?.fullName

  const primaryEmail = sessionClaims?.primaryEmail

  return NextResponse.json({ fullName, primaryEmail })
}

----------------------------------------

TITLE: Fetching Client List Using Clerk API (Deprecated)
DESCRIPTION: Demonstrates how to retrieve a list of clients using the deprecated getClientList() method from the Clerk client API. This method is no longer recommended for use and may be removed in future versions.

LANGUAGE: tsx
CODE:
const clients = await clerkClient.clients.getClientList()

----------------------------------------

TITLE: Testing a Webhook Route with cURL
DESCRIPTION: This bash command demonstrates how to test a webhook route using cURL. It sends a POST request to the test route on localhost with the appropriate content type header.

LANGUAGE: bash
CODE:
curl -H 'Content-Type: application/json' \
    -X POST http://localhost:3000/api/webhooks/test

----------------------------------------

TITLE: Skipping Results with getOrganizationList in TypeScript
DESCRIPTION: Demonstration of using the getOrganizationList function with an offset parameter to skip a specified number of results.

LANGUAGE: tsx
CODE:
const { data, totalCount } = await clerkClient.organizations.getOrganizationList({
  // skips the first 10 results
  offset: 10,
})

----------------------------------------

TITLE: Implementing ClerkLoading in Next.js Pages Router
DESCRIPTION: Example of using ClerkLoading component in Next.js Pages Router _app.tsx file to show loading state while Clerk initializes. Shows integration with AppProps and ClerkProvider setup.

LANGUAGE: tsx
CODE:
import '@/styles/globals.css'
import { ClerkLoaded, ClerkLoading, ClerkProvider } from '@clerk/nextjs'
import { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider {...pageProps}>
      <ClerkLoading>
        <div>Clerk is loading</div>
      </ClerkLoading>
      <ClerkLoaded>
        <Component {...pageProps} />
      </ClerkLoaded>
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Interpolating Variables in Handlebars Templates
DESCRIPTION: Demonstrates how to use Handlebars syntax to insert dynamic values into email and SMS templates. Variables are wrapped in double or triple curly braces, with triple braces used to unescape special characters.

LANGUAGE: handlebars
CODE:
{{app.name}}

LANGUAGE: handlebars
CODE:
{{{app.name}}}

----------------------------------------

TITLE: Comprehensive JWT Template Example with Static and Dynamic Claims
DESCRIPTION: This example showcases a complete JWT template utilizing static values, dynamic shortcodes, metadata access, and demonstrates how Clerk's default claims are included in the final token.

LANGUAGE: json
CODE:
{
  "aud": "https://my-site.com",
  "version": 1,
  "foo": { "bar": [1, 2, 3] },
  "user_id": "{{user.id}}",
  "avatar": "{{user.image_url}}",
  "full_name": "{{user.last_name}} {{user.first_name}} ",
  "email": "{{user.primary_email_address}}",
  "phone": "{{user.primary_phone_address}}",
  "registration_date": "{{user.created_at}}",
  "likes_to_do": "{{user.public_metadata.profile.interests}}",
  "unsafe_meta": "{{user.unsafe_metadata}}",
  "invalid_shortcode": "{{user.i_dont_exist}}"
}

----------------------------------------

TITLE: Setting Chrome Extension Public Key in Environment File
DESCRIPTION: Example of setting the Chrome Extension public key in the .env.chrome file to ensure a consistent CRX ID.

LANGUAGE: env
CODE:
CRX_PUBLIC_KEY=<YOUR_PUBLIC_KEY>

----------------------------------------

TITLE: Rendering OrganizationProfile in Astro
DESCRIPTION: Example of using the <OrganizationProfile /> component in an Astro application.

LANGUAGE: astro
CODE:
---
import { OrganizationProfile } from '@clerk/astro/components'
---

<OrganizationProfile />

----------------------------------------

TITLE: URLBasedSessionSyncingDisabled Error JSON Response
DESCRIPTION: JSON response structure for a disabled URL-based session syncing error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "URL-based session syncing is disabled for this instance",
  "longMessage": "This is a development instance operating with legacy, third-party cookies. To enable URL-based session syncing refer to https://clerk.com/docs/upgrade-guides/url-based-session-syncing.",
  "code": "url_based_session_syncing_disabled_code"
}

----------------------------------------

TITLE: Configuring Clerk Layout in Nuxt
DESCRIPTION: Configuration example for Clerk layout options in a Nuxt.js application's config file, demonstrating social button and terms page URL setup.

LANGUAGE: typescript
CODE:
export default defineNuxtConfig({
  modules: ['@clerk/nuxt'],
  clerk: {
    appearance: {
      layout: {
        socialButtonsPlacement: 'bottom',
        socialButtonsVariant: 'iconButton',
        termsPageUrl: 'https://clerk.com/terms',
      },
    },
  },
})

----------------------------------------

TITLE: Installing InstantDB React Library
DESCRIPTION: Command to install the InstantDB React library in your project using various package managers.

LANGUAGE: bash
CODE:
npm i @instantdb/react

LANGUAGE: bash
CODE:
yarn add @instantdb/react

LANGUAGE: bash
CODE:
pnpm add @instantdb/react

LANGUAGE: bash
CODE:
bun add @instantdb/react

----------------------------------------

TITLE: Installing Clerk React Router SDK
DESCRIPTION: Command to install the @clerk/react-router package using various package managers.

LANGUAGE: bash
CODE:
npm install @clerk/react-router

LANGUAGE: bash
CODE:
yarn add @clerk/react-router

LANGUAGE: bash
CODE:
pnpm add @clerk/react-router

LANGUAGE: bash
CODE:
bun add @clerk/react-router

----------------------------------------

TITLE: Setting up Clerk Frontend API Proxy in Next.js Middleware
DESCRIPTION: This Next.js middleware configuration sets up a proxy for the Clerk Frontend API. It intercepts requests to the specified path and forwards them to the Clerk API with the required headers.

LANGUAGE: typescript
CODE:
import { NextResponse } from 'next/server'
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware((auth, req) => {
  if (req.nextUrl.pathname.match('__clerk')) {
    const proxyHeaders = new Headers(req.headers)
    proxyHeaders.set('Clerk-Proxy-Url', process.env.NEXT_PUBLIC_CLERK_PROXY_URL || '')
    proxyHeaders.set('Clerk-Secret-Key', process.env.CLERK_SECRET_KEY || '')
    if (req.ip) {
      proxyHeaders.set('X-Forwarded-For', req.ip)
    } else {
      proxyHeaders.set('X-Forwarded-For', req.headers.get('X-Forwarded-For') || '')
    }

    const proxyUrl = new URL(req.url)
    proxyUrl.host = 'frontend-api.clerk.dev'
    proxyUrl.port = '443'
    proxyUrl.protocol = 'https'
    proxyUrl.pathname = proxyUrl.pathname.replace('/__clerk', '')

    return NextResponse.rewrite(proxyUrl, {
      request: {
        headers: proxyHeaders,
      },
    })
  }
})

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes AND anything passed through the proxy
    '/(api|trpc|__clerk)(.*)',
  ],
}

----------------------------------------

TITLE: Defining Navigation Types in TypeScript
DESCRIPTION: TypeScript type definitions for the documentation navigation system, including types for nav groups, items, and link properties.

LANGUAGE: typescript
CODE:
export type Nav = Array<NavGroup>

type NavGroup = Array<NavItem>

type NavItem = LinkItem | SubNavItem

type LinkItem = {
  title: string
  href: string
  tag?: string
  icon?: string
  wrap?: boolean
  target?: '_blank'
}

----------------------------------------

TITLE: Defining Pagination Properties in TypeScript
DESCRIPTION: This snippet defines the structure and types of pagination properties used in the Clerk project. It includes data handling, loading states, pagination controls, and utility functions.

LANGUAGE: typescript
CODE:
interface PaginationProperties<T> {
  data: T[];
  count: number;
  isLoading: boolean;
  isFetching: boolean;
  isError: boolean;
  page: number;
  pageCount: number;
  fetchPage: (page: number) => void;
  fetchPrevious: () => void;
  fetchNext: () => void;
  hasNextPage: boolean;
  hasPreviousPage: boolean;
  revalidate: () => void;
  setData: (data: any[]) => void;
}

----------------------------------------

TITLE: Adding ClerkProvider and Components to React Router App
DESCRIPTION: Integration of ClerkProvider and Clerk components (UserButton, SignInButton) into the React Router application for authentication UI.

LANGUAGE: typescript
CODE:
// Other imports

import { ClerkProvider, SignedIn, SignedOut, UserButton, SignInButton } from '@clerk/react-router'

export default function App({ loaderData }: Route.ComponentProps) {
  return (
    <ClerkProvider
      loaderData={loaderData}
      signUpFallbackRedirectUrl="/"
      signInFallbackRedirectUrl="/"
    >
      <header className="flex items-center justify-center py-8 px-4">
        <SignedOut>
          <SignInButton />
        </SignedOut>
        <SignedIn>
          <UserButton />
        </SignedIn>
      </header>
      <main>
        <Outlet />
      </main>
    </ClerkProvider>
  )
}

// Rest of the root.tsx code

----------------------------------------

TITLE: Implementing Google One Tap Page in Next.js
DESCRIPTION: A Next.js page component that implements the Custom Google One Tap authentication component. This component serves as an example of how to integrate the Google One Tap authentication flow into a page.

LANGUAGE: tsx
CODE:
import { CustomGoogleOneTap } from '@/app/components/CustomGoogleOneTap'

export default function CustomOneTapPage({ children }: { children: React.ReactNode }) {
  return (
    <CustomGoogleOneTap>
      <h1>Google One Tap Example</h1>
    </CustomGoogleOneTap>
  )
}

----------------------------------------

TITLE: Defining getSessionList Function in TypeScript
DESCRIPTION: Function signature for getSessionList, which retrieves a list of sessions. It returns a Promise resolving to a PaginatedResourceResponse containing an array of Session objects.

LANGUAGE: typescript
CODE:
function getSessionList(
  queryParams: SessionListParams,
): Promise<PaginatedResourceResponse<Session[]>>

----------------------------------------

TITLE: Implementing ClerkLoaded in Next.js App Router
DESCRIPTION: Shows how to wrap a Next.js application with ClerkLoaded component in the App Router pattern. Includes both the layout configuration and usage in a page component.

LANGUAGE: tsx
CODE:
import { ClerkProvider, ClerkLoaded, ClerkLoading } from '@clerk/nextjs'
import './globals.css'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body>
          <ClerkLoaded>{children}</ClerkLoaded>
        </body>
      </html>
    </ClerkProvider>
  )
}

LANGUAGE: tsx
CODE:
declare global {
  interface Window {
    Clerk: any
  }
}

export default function Home() {
  return <div>This page uses Clerk {window.Clerk.version}; </div>
}

----------------------------------------

TITLE: Configuring Markdown Tutorial Structure
DESCRIPTION: Markdown structure defining a tutorial page with hero section, prerequisites, and step-by-step instructions for setting up Atlassian OAuth integration with Clerk.

LANGUAGE: markdown
CODE:
---
title: Add Atlassian as a social connection
description: Learn how to allow users to sign up and sign in to your Clerk app with their Atlassian account using OAuth.
---

<TutorialHero
  beforeYouStart={[
    {
      title: "A Clerk app is required.",
      link: "/docs/quickstarts/setup-clerk",
      icon: "clerk",
    },
    {
      title: "An Atlassian account is required.",
      link: "https://developer.atlassian.com/",
      icon: "user-circle",
    }
  ]}
>
  - Use Atlassian to authenticate users with OAuth
</TutorialHero>

----------------------------------------

TITLE: Configuring package.json for Chrome Extension
DESCRIPTION: Example of updating the package.json file to include necessary permissions and host permissions for the Chrome Extension, and setting the public key for a consistent CRX ID.

LANGUAGE: json
CODE:
{
  "manifest": {
    "key": "$CRX_PUBLIC_KEY",
    "permissions": ["cookies", "storage"],
    "host_permissions": ["http://localhost/*", "$CLERK_FRONTEND_API/*"]
  }
}

----------------------------------------

TITLE: Closing GoogleOneTap with JavaScript
DESCRIPTION: Example of using the closeGoogleOneTap() method from the Clerk JavaScript SDK to programmatically close the GoogleOneTap component after opening it.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

const params = {
  cancelOnTapOutside: false,
  itpSupport: false,
  fedCmSupport: false,
}
clerk.openGoogleOneTap(params)

// Do something else

clerk.closeGoogleOneTap()

----------------------------------------

TITLE: IdentificationExists Error JSON Response for Username
DESCRIPTION: JSON response structure for an existing username error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "already exists",
  "longMessage": "This username already exists.",
  "code": "username_exists_code"
}

----------------------------------------

TITLE: Implementing Localization in Astro
DESCRIPTION: Shows how to import and use a localization (French) in an Astro configuration file.

LANGUAGE: javascript
CODE:
import clerk from '@clerk/astro'
// fr-FR locale is imported as frFR
import { frFR } from '@clerk/localizations'

export default defineConfig({
  integrations: [
    clerk({
      localization: frFR,
    }),
  ],
})

----------------------------------------

TITLE: Installing Clerk NextJS Package v4
DESCRIPTION: Commands to install version 4 of the @clerk/nextjs package using different package managers. Version 4 is specifically required for Next.js 12 and older versions.

LANGUAGE: bash
CODE:
npm install @clerk/nextjs@^4.0.0

LANGUAGE: bash
CODE:
yarn add @clerk/nextjs@^4.0.0

LANGUAGE: bash
CODE:
pnpm add @clerk/nextjs@^4.0.0

LANGUAGE: bash
CODE:
bun add @clerk/nextjs@^4.0.0

----------------------------------------

TITLE: Updating Clerk Domain with Proxy URL via Backend API
DESCRIPTION: This curl command demonstrates how to update a Clerk domain to use a proxy URL through the Backend API. It sends a PATCH request with the necessary headers and payload.

LANGUAGE: bash
CODE:
curl -X PATCH https://api.clerk.com/v1/domains/{{DOMAIN ID}} \
    -H "Authorization: Bearer {{SECRET KEY}}" \
    -H "Content-Type: application/json" \
    -d '{"proxy_url": "https://app.dev/__clerk"}'

----------------------------------------

TITLE: Including Partial Hook List in Markdown
DESCRIPTION: This snippet demonstrates how to include a partial file containing a list of hooks in the markdown documentation.

LANGUAGE: markdown
CODE:
<Include src="_partials/hooks/hook-list" />

----------------------------------------

TITLE: Initializing Basic Sign-up Route in Next.js
DESCRIPTION: Sets up the basic sign-up route using Clerk Elements in Next.js App Router. Creates an optional catch-all route to handle nested paths in the sign-up flow.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignUp from '@clerk/elements/sign-up'

export default function SignUpPage() {
  return <SignUp.Root>[Sign Up Root]</SignUp.Root>
}

----------------------------------------

TITLE: HTML Structure for Displaying User Invitations
DESCRIPTION: This HTML file provides the structure for displaying user organization invitations. It includes a table for showing invitation details and a placeholder for the JavaScript code that will populate the table.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="app"></div>

    <h1>Organization invitations</h1>
    <table>
      <thead>
        <tr>
          <th>Email</th>
          <th>Organization name</th>
          <th>Role</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody id="invitations-table-body"></tbody>
    </table>

    <script type="module" src="/src/main.js" async crossorigin="anonymous"></script>
  </body>
</html>

----------------------------------------

TITLE: Authentication Components in React with Clerk
DESCRIPTION: Core authentication components provided by Clerk for handling sign-in, sign-up, and profile management. These components are hosted on Clerk servers.

LANGUAGE: jsx
CODE:
<SignIn />
<SignUp />
<UserProfile />
<CreateOrganization />
<OrganizationProfile />
<Waitlist />

----------------------------------------

TITLE: Implementing SignOutButton Component with Clerk Authentication
DESCRIPTION: A React Native component that provides sign out functionality using Clerk's useClerk hook. It handles the sign out process, redirects users after successful logout, and includes error handling. The component renders a touchable button with 'Sign out' text.

LANGUAGE: tsx
CODE:
import { useClerk } from '@clerk/clerk-expo'
import * as Linking from 'expo-linking'
import { Text, TouchableOpacity } from 'react-native'

export const SignOutButton = () => {
  // Use `useClerk()` to access the `signOut()` function
  const { signOut } = useClerk()

  const handleSignOut = async () => {
    try {
      await signOut()
      // Redirect to your desired page
      Linking.openURL(Linking.createURL('/'))
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }

  return (
    <TouchableOpacity onPress={handleSignOut}>
      <Text>Sign out</Text>
    </TouchableOpacity>
  )
}

----------------------------------------

TITLE: Example Account Portal Sign-in URL
DESCRIPTION: Example of a complete Account Portal URL for sign-in with redirect. Demonstrates a practical implementation of the URL structure with actual domain values.

LANGUAGE: url
CODE:
https://accounts.myapp.com/sign-in?redirect_url=https://myapp.com/dashboard

----------------------------------------

TITLE: Implementing Client-Side Authentication Components
DESCRIPTION: Example of client-side authentication UI components showing different states for signed-in and signed-out users.

LANGUAGE: tsx
CODE:
import {
  SignedIn,
  UserButton,
  SignOutButton,
  SignedOut,
  SignInButton,
  SignUpButton,
} from '@clerk/tanstack-start'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/')({ component: Home })

function Home() {
  return (
    <div>
      <h1>Index Route</h1>
      <SignedIn>
        <p>You are signed in</p>
        <UserButton />
      </SignedIn>
      <SignedOut>
        <p>You are signed out</p>
        <SignInButton />
      </SignedOut>
    </div>
  )
}

----------------------------------------

TITLE: Implementing ClerkLoaded in React
DESCRIPTION: Shows how to use ClerkLoaded in a standard React application with a custom Page component that accesses the Clerk object.

LANGUAGE: tsx
CODE:
import { useEffect } from 'react'
import { ClerkLoaded, ClerkProvider } from '@clerk/clerk-react'

declare global {
  interface Window {
    Clerk: any
  }
}

function App() {
  return (
    <ClerkProvider publishableKey={`{{pub_key}}`}>
      <ClerkLoaded>
        <Page />
      </ClerkLoaded>
    </ClerkProvider>
  )
}

function Page() {
  useEffect(() => {
    // no need to check if window.Clerk exists
    document.title = 'This page uses Clerk ' + window.Clerk.version
  }, [])

  return <div>The content </div>
}

export default App

----------------------------------------

TITLE: InvalidRequestForEnvironment Error JSON Response
DESCRIPTION: JSON response structure for an invalid request for environment error. Includes short and long messages, and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Invalid request for environment",
  "longMessage": "Request only valid for <envTypesAsString> instances.",
  "code": "request_invalid_for_environment_code"
}

----------------------------------------

TITLE: Configuring Tailwind Animations
DESCRIPTION: JavaScript configuration for adding custom animations to Tailwind CSS.

LANGUAGE: javascript
CODE:
/** @type {import('tailwindcss').Config} */
module.exports = {
  theme: {
    extend: {
      keyframes: {
        'caret-blink': {
          '0%,70%,100%': { opacity: '1' },
          '20%,50%': { opacity: '0' },
        },
      },
      animation: {
        'caret-blink': 'caret-blink 1.25s ease-out infinite',
      },
    },
  },
}

----------------------------------------

TITLE: Creating Onboarding Layout in Next.js App Router
DESCRIPTION: Next.js App Router layout component for the onboarding route. It redirects users to the homepage if they have already completed onboarding.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'
import { redirect } from 'next/navigation'

export default async function RootLayout({ children }: { children: React.ReactNode }) {
  if ((await auth()).sessionClaims?.metadata.onboardingComplete === true) {
    redirect('/')
  }

  return <>{children}</>
}

----------------------------------------

TITLE: Clerk OAuth 2.0 User Information Response Structure
DESCRIPTION: JSON structure showing the user properties returned by Clerk's /oauth/userinfo endpoint after successful OAuth 2.0 authentication.

LANGUAGE: json
CODE:
{
  "user_id": "string",
  "sub": "string",
  "given_name": "string",
  "family_name": "string",
  "name": "string",
  "picture": "string",
  "preferred_username": "string",
  "email": "string",
  "email_verified": "boolean",
  "public_metadata": "object",
  "private_metadata": "object",
  "unsafe_metadata": "object"
}

----------------------------------------

TITLE: Implementing GoogleOneTap in Astro
DESCRIPTION: Example of using the GoogleOneTap component in an Astro application. The component is imported from @clerk/astro/components and rendered directly in the Astro template.

LANGUAGE: astro
CODE:
---
import { GoogleOneTap } from '@clerk/astro/components'
---

<GoogleOneTap />

----------------------------------------

TITLE: HTML Structure for JavaScript Organization Switcher
DESCRIPTION: HTML template that provides the structure for a vanilla JavaScript implementation of organization switching, including tables for organization list and creation form.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <!-- ... HTML content ... -->
  </body>
</html>

----------------------------------------

TITLE: Configuring Secure Token Cache
DESCRIPTION: Updating the root layout to use a secure token cache with expo-secure-store for storing session tokens.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/clerk-expo'
import { tokenCache } from '@clerk/clerk-expo/token-cache'
import { Slot } from 'expo-router'

export default function RootLayout() {
  return (
    <ClerkProvider tokenCache={tokenCache}>
      <Slot />
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Exporting Firebase Users
DESCRIPTION: Command to export Firebase users to a JSON file with specified project ID.

LANGUAGE: bash
CODE:
firebase auth:export firebase-users.json --format=json --project <YOUR_PROJECT_ID>

----------------------------------------

TITLE: Function Signature for getOrganizationMembershipList
DESCRIPTION: TypeScript function signature showing the parameters and return type for retrieving organization memberships.

LANGUAGE: typescript
CODE:
function getOrganizationMembershipList(
  params: GetOrganizationMembershipListParams,
): Promise<PaginatedResourceResponse<OrganizationMembership[]>>

----------------------------------------

TITLE: Starting Development Server with Package Managers (Bash)
DESCRIPTION: Commands to start the development server using npm, yarn, pnpm, or bun. These commands initiate the development environment for a Clerk-enabled project.

LANGUAGE: bash
CODE:
npm run dev

LANGUAGE: bash
CODE:
yarn dev

LANGUAGE: bash
CODE:
pnpm dev

LANGUAGE: bash
CODE:
bun dev

----------------------------------------

TITLE: URL Structure for Account Portal Links
DESCRIPTION: Template for creating direct links to Account Portal pages with redirect URLs. Shows how to structure the URL with the correct domain, page path, and redirect parameter.

LANGUAGE: url
CODE:
https://accounts.<your-domain.com>/<account-portal-page>?redirect_url=<your-redirect-url>

----------------------------------------

TITLE: Infinite Pagination with useOrganization in React
DESCRIPTION: Implementation of infinite pagination for organization memberships using the useOrganization hook in a React component.

LANGUAGE: jsx
CODE:
import { useOrganization } from '@clerk/clerk-react'

export default function MemberList() {
  const { memberships } = useOrganization({
    memberships: {
      infinite: true, // Append new data to the existing list
      keepPreviousData: true, // Persist the cached data until the new data has been fetched
    },
  })

  if (!memberships) {
    // Handle loading state
    return null
  }

  return (
    <div>
      <h2>Organization members</h2>
      <ul>
        {memberships.data?.map((membership) => (
          <li key={membership.id}>
            {membership.publicUserData.firstName} {membership.publicUserData.lastName} &lt;
            {membership.publicUserData.identifier}&gt; :: {membership.role}
          </li>
        ))}
      </ul>

      <button
        disabled={!memberships.hasNextPage} // Disable the button if there are no more available pages to be fetched
        onClick={memberships.fetchNext}
      >
        Load more
      </button>
    </div>
  )

----------------------------------------

TITLE: Implementing RedirectToSignIn in Remix
DESCRIPTION: This snippet shows how to use the RedirectToSignIn component in a Remix application. It demonstrates the component usage within a route file.

LANGUAGE: tsx
CODE:
import { SignedIn, SignedOut, RedirectToSignIn, UserButton } from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <SignedIn>
        <UserButton />
      </SignedIn>
      <SignedOut>
        <RedirectToSignIn />
      </SignedOut>
    </div>
  )
}

----------------------------------------

TITLE: CannotTransferPaidAppToAccountWithoutBillingInformation Error Response in JSON
DESCRIPTION: Error response when attempting to transfer a paid application to an account without billing information.

LANGUAGE: json
CODE:
{
  "shortMessage": "cannot transfer paid application, missing billing info",
  "longMessage": "Paid applications can only be transferred to personal workspaces or organizations with billing info. Add the necessary billing info and try again.",
  "code": "transfer_paid_app_to_free_account_code"
}

----------------------------------------

TITLE: Implementing Cognito to Clerk user migration script in TypeScript
DESCRIPTION: TypeScript code for a script that lists Cognito user pool users and creates corresponding Clerk users with the appropriate password hasher and digest.

LANGUAGE: typescript
CODE:
import { createClerkClient } from '@clerk/backend'
import * as IDP from '@aws-sdk/client-cognito-identity-provider'

// NOTE: The IAM user should have permissions roughly equivalent to AmazonCognitoReadOnly.
// https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AmazonCognitoReadOnly.html
const { AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION } = process.env
if (!AWS_ACCESS_KEY_ID || !AWS_SECRET_ACCESS_KEY || !AWS_REGION) {
  throw new Error(
    'AWS credentials are required. Double check that your `.env` file is set up correctly. Must have AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, and AWS_REGION.',
  )
}

const { COGNITO_USER_POOL_ID, COGNITO_CLIENT_ID } = process.env
if (!COGNITO_USER_POOL_ID || !COGNITO_CLIENT_ID) {
  throw new Error(
    'Cognito user pool and client IDs are required. Double check that your `.env` file is set up correctly. Must have COGNITO_USER_POOL_ID and COGNITO_CLIENT_ID.',
  )
}

const { CLERK_SECRET_KEY } = process.env
if (!CLERK_SECRET_KEY) {
  throw new Error(
    'Clerk Secret Key is required. Double check that your `.env` file is set up correctly. Must have CLERK_SECRET_KEY.',
  )
}

const idpClient = new IDP.CognitoIdentityProviderClient({
  region: AWS_REGION,
  credentials: {
    accessKeyId: AWS_ACCESS_KEY_ID,
    secretAccessKey: AWS_SECRET_ACCESS_KEY,
  },
})

const clerk = createClerkClient({
  secretKey: CLERK_SECRET_KEY,
})

async function main() {
  const usersResponse = await idpClient.send(
    new IDP.ListUsersCommand({ UserPoolId: COGNITO_USER_POOL_ID }),
  )
  if (!usersResponse.Users) {
    throw new Error('No users found')
  }

  usersLoop: for (const cognitoUser of usersResponse.Users) {
    // Skip unconfirmed users or EXTERNAL_PROVIDER users (like Facebook, Google, etc)
    if (cognitoUser.UserStatus !== 'CONFIRMED') {
      console.log(
        'Skipping user: User is not confirmed:',
        cognitoUser.Username,
        cognitoUser.UserStatus,
      )
      continue
    }

    // This identifier must match the one that use used for sign in on the Cognito user pool.
    // Note that in AWS, this option is only configurable at the time of user creation.
    let identifier: string
    // Comment/Uncomment the block(s) below to use the identifier from the Cognito user pool.
    {
      identifier = cognitoUser.Attributes?.find((a) => a.Name === 'sub')!.Value!
    }
    {
      identifier = cognitoUser.Attributes?.find((a) => a.Name === 'email')!.Value!
    }
    {
      identifier = cognitoUser.Username!
    }

    if (!identifier) {
      console.log('Skipping user: No identifier found:', cognitoUser)
      continue
    }

    const email = cognitoUser.Attributes?.find((a) => a.Name === 'email')!.Value!

    try {
      await clerk.users.createUser({
        emailAddress: [email],
        passwordDigest: `awscognito#${COGNITO_USER_POOL_ID}#${COGNITO_CLIENT_ID}#${identifier}`,
        // @ts-expect-error - awscognito works, but is not a valid TypeScript yet
        passwordHasher: 'awscognito',
      })
      console.log('Created clerk user for:', identifier)
      await new Promise((resolve) => setTimeout(resolve, 500))
    } catch (err) {
      console.error(err)
      break usersLoop
    }
  }
}

main()

----------------------------------------

TITLE: Next.js Pages Router Token Generation Implementation
DESCRIPTION: Example showing token generation in Next.js Pages Router with type safety and error handling.

LANGUAGE: typescript
CODE:
import { clerkClient, getAuth } from '@clerk/nextjs/server'
import type { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const { sessionId } = getAuth(req)

  if (!sessionId) {
    return res.status(401).json({ error: 'Unauthorized' })
  }

  const template = 'test'
  const client = await clerkClient()
  const token = await client.sessions.getToken(sessionId, template)

  return res.json({ token })
}

----------------------------------------

TITLE: Running Migration Script
DESCRIPTION: Command to execute the Node.js migration script.

LANGUAGE: bash
CODE:
node migrate-to-clerk.js

----------------------------------------

TITLE: Creating Auth Layout for Protected Routes
DESCRIPTION: Implementing a layout for authentication routes that redirects signed-in users to the home page.

LANGUAGE: tsx
CODE:
import { Redirect, Stack } from 'expo-router'
import { useAuth } from '@clerk/clerk-expo'

export default function AuthRoutesLayout() {
  const { isSignedIn } = useAuth()

  if (isSignedIn) {
    return <Redirect href={'/'} />
  }

  return <Stack />
}

----------------------------------------

TITLE: Configuring CAPTCHA Appearance in Nuxt
DESCRIPTION: This snippet shows how to set the CAPTCHA appearance properties in a Nuxt application using the nuxt.config.ts file.

LANGUAGE: ts
CODE:
export default defineNuxtConfig({
  modules: ['@clerk/nuxt'],
  clerk: {
    appearance: {
      captcha: {
        theme: 'dark',
        size: 'flexible',
        language: 'es-ES',
      },
    },
  },
})

----------------------------------------

TITLE: Attempting Domain Affiliation Verification - TypeScript
DESCRIPTION: Method to complete the domain verification process using a one-time code sent to the affiliated email address.

LANGUAGE: typescript
CODE:
function attemptAffiliationVerification(
  params: AttemptAffiliationVerificationParams,
): Promise<OrganizationDomain>

----------------------------------------

TITLE: Implementing SVG Geometric Logo
DESCRIPTION: Creates an SVG icon with multiple path elements defining geometric shapes. The SVG uses a 32x32 viewBox and includes styled paths with specific fill colors and dynamic theme-based coloring using CSS variables.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 32 32">
  <path
    fill="#F44250"
    d="M25.6 15.568a3.196 3.196 0 0 1-3.2 3.19 3.193 3.193 0 0 0-3.2 3.189 3.196 3.196 0 0 1-3.2 3.19 3.193 3.193 0 0 1-2.263-.935 3.172 3.172 0 0 1-.937-2.255 3.193 3.193 0 0 1 3.2-3.19 3.196 3.196 0 0 0 3.2-3.189 3.194 3.194 0 0 0-3.2-3.19 3.193 3.193 0 0 1-3.2-3.189A3.193 3.193 0 0 1 16 6c1.767.001 3.2 1.429 3.2 3.19a3.193 3.193 0 0 0 3.2 3.19c1.768 0 3.2 1.427 3.2 3.19Z"
  />

  <path
    style={{ fill: 'var(--light, #121212) var(--dark, #fff)' }}
    d="M12.8 15.568a3.195 3.195 0 0 0-3.2-3.19 3.195 3.195 0 0 0-3.2 3.19 3.195 3.195 0 0 0 3.2 3.19c1.767 0 3.2-1.428 3.2-3.19ZM6.4 21.947a3.195 3.195 0 0 0-3.2-3.19 3.195 3.195 0 0 0-3.2 3.19 3.195 3.195 0 0 0 3.2 3.19c1.767 0 3.2-1.429 3.2-3.19ZM32 21.947a3.195 3.195 0 0 0-3.2-3.19 3.195 3.195 0 0 0-3.2 3.19 3.195 3.195 0 0 0 3.2 3.19c1.767 0 3.2-1.429 3.2-3.19Z"
  />
</svg>

----------------------------------------

TITLE: Rendering Apple Logo SVG with Dynamic Theming
DESCRIPTION: This SVG component defines the Apple logo with a viewBox and a path element. It uses CSS variables for fill color to support both light and dark themes.

LANGUAGE: SVG
CODE:
<svg viewBox="-73 0 960 1000">
  <path
    d="M788.1 340.9c-5.8 4.5-108.2 62.2-108.2 190.5 0 148.4 130.3 200.9 134.2 202.2-.6 3.2-20.7 71.9-68.7 141.9-42.8 61.6-87.5 123.1-155.5 123.1s-85.5-39.5-164-39.5c-76.5 0-103.7 40.8-165.9 40.8s-105.6-57-155.5-127C46.7 790.7 0 663 0 541.8c0-194.4 126.4-297.5 250.8-297.5 66.1 0 121.2 43.4 162.7 43.4 39.5 0 101.1-46 176.3-46 28.5 0 130.9 2.6 198.3 99.2zm-234-181.5c31.1-36.9 53.1-88.1 53.1-139.3 0-7.1-.6-14.3-1.9-20.1-50.6 1.9-110.8 33.7-147.1 75.8-28.5 32.4-55.1 83.6-55.1 135.5 0 7.8 1.3 15.6 1.9 18.1 3.2.6 8.4 1.3 13.6 1.3 45.4 0 102.5-30.4 135.5-71.3z"
    style={{ fill: 'var(--light, black) var(--dark, white)' }}
  />
</svg>

----------------------------------------

TITLE: HTML Structure for Organization Invitations
DESCRIPTION: HTML template for organization invitations management interface, including a form for new invitations and a container for the invitations list.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>
  <body>
    <div id="app"></div>

    <h2>Invitations List</h2>
    <ul id="invitations_list"></ul>

    <h2>Send a new invitation</h2>
    <form id="new_invitation">
      <div>
        <label>Email address</label>

        <input type="email" id="email_address" name="email_address" />
      </div>
      <button>Invite</button>
    </form>

    <script type="module" src="/src/main.js" async crossorigin="anonymous"></script>
  </body>
</html>

----------------------------------------

TITLE: Installing Latest @clerk/clerk-expo
DESCRIPTION: Command to install the latest version of @clerk/clerk-expo using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/clerk-expo

LANGUAGE: bash
CODE:
yarn add @clerk/clerk-expo

LANGUAGE: bash
CODE:
pnpm add @clerk/clerk-expo

LANGUAGE: bash
CODE:
bun add @clerk/clerk-expo

----------------------------------------

TITLE: Defining BAPIEndpointDeprecated Error Structure in JSON
DESCRIPTION: This JSON snippet defines the structure of the 'BAPIEndpointDeprecated' error returned by Clerk when a deprecated API endpoint is accessed. It includes a short message, a long message (represented by a placeholder), and an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "endpoint is deprecated and pending removal",
  "longMessage": "<DeprecationMessage>",
  "code": "api_operation_deprecated_code"
}

----------------------------------------

TITLE: Updating Organization.getPendingInvitations method
DESCRIPTION: Example of updating the Organization.getPendingInvitations method to use the new getInvitations method with a status parameter.

LANGUAGE: javascript
CODE:
Organization.getPendingInvitations()
Organization.getInvitations({ status: 'pending' })

----------------------------------------

TITLE: Express.js Token Generation Implementation
DESCRIPTION: Example showing token generation in an Express.js application with authentication middleware.

LANGUAGE: javascript
CODE:
import { clerkClient } from '@clerk/express'

app.get('/api/get-token', async (req, res) => {
  const sessionId = req.auth.sessionId

  if (!sessionId) {
    res.status(401).json({ error: 'Unauthorized' })
    return
  }

  const template = 'test'
  const token = await clerkClient.sessions.getToken(sessionId, template)

  res.json({ token })
})

----------------------------------------

TITLE: Initialize npm Project
DESCRIPTION: Command to create a new npm project with default settings.

LANGUAGE: bash
CODE:
npm init -y

----------------------------------------

TITLE: Installing Clerk SDK via Bundler
DESCRIPTION: Executes bundle install command to install the Clerk Ruby SDK and its dependencies.

LANGUAGE: sh
CODE:
$ bundle install

----------------------------------------

TITLE: Defining TooManyRequests Error in JSON for Clerk
DESCRIPTION: This snippet defines the JSON structure for a 'TooManyRequests' error in Clerk. It includes short and long messages, as well as an error code.

LANGUAGE: json
CODE:
{
  "shortMessage": "Too many requests",
  "longMessage": "Too many requests, retry later",
  "code": "too_many_requests"
}

----------------------------------------

TITLE: Defining C# Logo SVG
DESCRIPTION: This SVG code defines the C# programming language logo. It includes path elements for the logo shape and text, as well as a gradient definition for coloring. The logo consists of a hexagonal shape with the C# symbol inside.

LANGUAGE: SVG
CODE:
<svg viewBox="0 0 160 178" fill="none">
  <path
    fill="url(#c-sharp-logo-gradient)"
    d="M0 55.847v65.985a22.844 22.844 0 0 0 11.429 19.791l57.143 32.997a22.848 22.848 0 0 0 22.857 0l57.143-32.997A22.854 22.854 0 0 0 160 121.831V55.847a22.848 22.848 0 0 0-11.428-19.794L91.429 3.065a22.842 22.842 0 0 0-22.857 0L11.429 36.053A22.856 22.856 0 0 0 0 55.847Z"
  />

  <path
    fill="#fff"
    d="M40.552 78.02v22.774a5.68 5.68 0 0 0 3.514 5.263 5.684 5.684 0 0 0 2.18.431 5.7 5.7 0 0 0 4.028-1.667 5.694 5.694 0 0 0 1.667-4.027 5.693 5.693 0 1 1 11.385 0 17.08 17.08 0 0 1-34.159 0v-22.77a17.08 17.08 0 1 1 34.159 0 5.693 5.693 0 0 1-11.385 0 5.693 5.693 0 0 0-11.386 0l-.003-.004Zm91.088 22.774a5.68 5.68 0 0 1-3.514 5.262 5.681 5.681 0 0 1-2.18.432h-5.694v5.691a5.68 5.68 0 0 1-1.668 4.026 5.683 5.683 0 0 1-6.204 1.238 5.707 5.707 0 0 1-3.513-5.264v-5.691H97.481v5.691a5.682 5.682 0 0 1-5.694 5.694 5.682 5.682 0 0 1-5.69-5.694v-5.691h-5.698a5.695 5.695 0 0 1-5.693-5.693 5.693 5.693 0 0 1 5.693-5.692h5.694V83.718h-5.694a5.693 5.693 0 0 1 0-11.386h5.694v-5.694a5.693 5.693 0 1 1 11.385 0v5.691h11.385v-5.69a5.691 5.691 0 0 1 9.718-4.026 5.691 5.691 0 0 1 1.668 4.025v5.691h5.694c1.508 0 2.957.598 4.023 1.668a5.68 5.68 0 0 1 0 8.05 5.692 5.692 0 0 1-4.023 1.67h-5.694v11.386h5.694a5.71 5.71 0 0 1 5.697 5.691Zm-22.773-17.076H97.481v11.385h11.386V83.718Z"
  />

  <defs>
    <linearGradient
      id="c-sharp-logo-gradient"
      x1="15.713"
      x2="92.858"
      y1="38.841"
      y2="173.129"
      gradientUnits="userSpaceOnUse"
    >
      <stop stopColor="#927BE5" />

      <stop offset="1" stopColor="#512BD4" />
    </linearGradient>
  </defs>
</svg>

----------------------------------------

TITLE: Installing Clerk Remix SDK
DESCRIPTION: Commands for installing the latest version of @clerk/remix using different package managers

LANGUAGE: bash
CODE:
npm install @clerk/remix

LANGUAGE: bash
CODE:
yarn add @clerk/remix

LANGUAGE: bash
CODE:
pnpm add @clerk/remix

LANGUAGE: bash
CODE:
bun add @clerk/remix

----------------------------------------

TITLE: Implementing Organization Member Role Management in JavaScript
DESCRIPTION: This JavaScript code demonstrates how to use the Clerk API to manage organization memberships, including listing members, updating roles, and removing members.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

if (!pubKey) {
  throw new Error('Add your VITE_CLERK_PUBLISHABLE_KEY to .env file')
}

const clerk = new Clerk('{{pub_key}}')
await clerk.load()

if (clerk.user) {
  // Check for an active organization
  if (clerk.organization) {
    // Render list of organization memberships
    async function renderMemberships(organization, isAdmin) {
      try {
        const { data } = await organization.getMemberships()
        const memberships = data
        console.log(`getMemberships:`, memberships)

        memberships.map((membership) => {
          const membershipTable = document.getElementById('memberships-table-body')
          const row = membershipTable.insertRow()
          row.insertCell().textContent = membership.publicUserData.userId
          row.insertCell().textContent = membership.publicUserData.identifier
          row.insertCell().textContent = membership.createdAt.toLocaleDateString()
          row.insertCell().textContent = membership.role

          // Add administrative actions:
          // Add and remove a member, and update a member's role.
          if (isAdmin) {
            // Show update and remove member buttons
            document.getElementById('update-role-head').removeAttribute('hidden')
            document.getElementById('remove-member-head').removeAttribute('hidden')

            // Get the user ID of the member
            const userId = membership.publicUserData.userId

            // Update a member's role
            const updateBtn = document.createElement('button')
            updateBtn.textContent = 'Change role'
            updateBtn.addEventListener('click', async function (e) {
              e.preventDefault()

              const role = membership.role === 'org:admin' ? 'org:member' : 'org:admin'

              await organization
                .updateMember({ userId, role })
                .then((res) => console.log(`updateMember response:`, res))
                .catch((error) => console.log('An error occurred:', error))
            })
            row.insertCell().appendChild(updateBtn)

            // Remove a member
            const removeBtn = document.createElement('button')
            removeBtn.textContent = 'Remove'
            removeBtn.addEventListener('click', async function (e) {
              e.preventDefault()

              await organization
                .removeMember(userId)
                .then((res) => console.log(`removeMember response:`, res))
                .catch((error) => console.log('An error occurred:', error))
            })
            row.insertCell().appendChild(removeBtn)
          }
        })
      } catch (error) {
        console.log('An error occurred:', error)
      }
    }

    /**
     * Checks if a user is an admin of the
     * currently active organization and
     * renders the organization's memberships.
     */
    async function checkAdminAndRenderMemberships() {
      const organizationId = clerk.organization.id

      const { data } = await clerk.user.getOrganizationMemberships()

      const organizationMemberships = data

      const currentMembership = organizationMemberships.find(
        (membership) => membership.organization.id === organizationId,
      )
      const currentOrganization = currentMembership.organization

      if (!currentOrganization) return

      const isAdmin = currentMembership.role === 'org:admin'

      console.log(`Current organization:`, currentOrganization)

      renderMemberships(currentOrganization, isAdmin)
    }

    checkAdminAndRenderMemberships()
  } else {
    // If there is no active organization,
    // mount Clerk's <OrganizationSwitcher />
    // to allow the user to set an organization as active
    document.getElementById('app').innerHTML = `
      <h2>Select an organization to set it as active</h2>
      <div id="org-switcher"></div>
    `

    const orgSwitcherDiv = document.getElementById('org-switcher')

    clerk.mountOrganizationSwitcher(orgSwitcherDiv)
  }
} else {
  // If there is no active user, mount Clerk's <SignIn />
  document.getElementById('app').innerHTML = `
    <div id="sign-in"></div>
  `

  const signInDiv = document.getElementById('sign-in')

  clerk.mountSignIn(signInDiv)
}

----------------------------------------

TITLE: Configuring New Clerk Middleware
DESCRIPTION: Example of using the new clerkMiddleware() with route protection and authorization checks.

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

const isDashboardRoute = createRouteMatcher(['/dashboard(.*)'])
const isAdminRoute = createRouteMatcher(['/admin(.*)'])

export default clerkMiddleware(async (auth, req) => {
  // Restrict admin route to users with specific role
  if (isAdminRoute(req)) await auth.protect({ role: 'org:admin' })

  // Restrict dashboard routes to signed in users
  if (isDashboardRoute(req)) await auth.protect()
})

export const config = {
  matcher: [
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Adding Phone Numbers in iOS with Clerk
DESCRIPTION: A SwiftUI implementation for adding and verifying phone numbers using Clerk's iOS SDK. The view handles phone number creation, verification code sending, and verification confirmation using Clerk's phone number methods.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct AddPhoneView: View {
  @State private var phone = ""
  @State private var code = ""
  @State private var isVerifying = false
  // Create a reference to the phone number that we'll be creating
  @State private var newPhoneNumber: PhoneNumber?

  var body: some View {
    if newPhoneNumber?.verification?.status == .verified {
      Text("Phone added!")
    }

    if isVerifying {
      TextField("Enter code", text: $code)
      Button("Verify") {
        Task { await verifyCode(code) }
      }
    } else {
      TextField("Enter phone number", text: $phone)
      Button("Continue") {
        Task { await createPhone(phone) }
      }
    }
  }
}

extension AddPhoneView {

  func createPhone(_ phone: String) async {
    do {
      guard let user = Clerk.shared.user else { return }

      // Add an unverified phone number to user,
      // then send the user an sms message with the verification code
      self.newPhoneNumber = try await user
        .createPhoneNumber(phone)
        .prepareVerification()

      // Set to true to display second form
      // and capture the OTP code
      isVerifying = true
    } catch {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      dump(error)
    }
  }

  func verifyCode(_ code: String) async {
    do {
      guard let newPhoneNumber else { return }

      // Verify that the code entered matches the code sent to the user
      self.newPhoneNumber = try await newPhoneNumber.attemptVerification(code: code)

      // If the status is not complete, check why. User may need to
      // complete further steps.
      dump(self.newPhoneNumber?.verification?.status)
    } catch {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      dump(error)
    }
  }
}

----------------------------------------

TITLE: Updating Pagination Parameters
DESCRIPTION: Example showing the new pagination parameter names for list operations.

LANGUAGE: javascript
CODE:
// Old
const { data } = await organization.getRoles({
  limit: 10,
  offset: 10
})

// New
const { data } = await organization.getRoles({
  pageSize: 10,
  initialPage: 2
})

----------------------------------------

TITLE: Creating Testing Token Function Signature
DESCRIPTION: TypeScript function signature for creating a testing token that returns a Promise of TestingToken type.

LANGUAGE: typescript
CODE:
function createTestingToken(): Promise<TestingToken>

----------------------------------------

TITLE: Example Header Forwarding Output
DESCRIPTION: Sample console output showing the expected format of forwarded headers when properly configured. The host should match the domain configured in Clerk Dashboard, and proto should be 'https' for production.

LANGUAGE: log
CODE:
=========================
Request Headers
x-forwarded-host example.com
x-forwarded-proto https
=========================

----------------------------------------

TITLE: Setting Clerk Publishable Key in Environment Variables
DESCRIPTION: This snippet demonstrates how to set the Clerk Publishable Key as an environment variable in a .env file for use in a React application.

LANGUAGE: env
CODE:
VITE_CLERK_PUBLISHABLE_KEY={{pub_key}}

----------------------------------------

TITLE: Implementing Root Layout with Clerk Provider and React Router
DESCRIPTION: Creates a RootLayout component that wraps the application with ClerkProvider and includes navigation based on authentication state.

LANGUAGE: tsx
CODE:
import { Link, Outlet, useNavigate } from 'react-router-dom'
import { ClerkProvider, SignedIn, SignedOut, UserButton } from '@clerk/chrome-extension'

const PUBLISHABLE_KEY = process.env.PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY

if (!PUBLISHABLE_KEY) {
  throw new Error('Please add the PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY to the .env.development file')
}

export const RootLayout = () => {
  const navigate = useNavigate()

  return (
    <ClerkProvider
      routerPush={(to) => navigate(to)}
      routerReplace={(to) => navigate(to, { replace: true })}
      publishableKey={PUBLISHABLE_KEY}
      afterSignOutUrl="/"
    >
      <div className="plasmo-w-[785px] plasmo-h-[600px]">
        <main>
          <Outlet />
        </main>
        <footer>
          <SignedIn>
            <Link to="/settings">Settings</Link>
            <UserButton />
          </SignedIn>
          <SignedOut>
            <Link to="/">Home</Link>
            <Link to="/sign-in">Sign In</Link>
            <Link to="/sign-up">Sign Up</Link>
          </SignedOut>
        </footer>
      </div>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Updating UserButton Component
DESCRIPTION: Example of updating the UserButton component to remove the unnecessary afterSignOutUrl prop.

LANGUAGE: jsx
CODE:
<UserButton />

----------------------------------------

TITLE: Using Clerk Link Component
DESCRIPTION: Demonstrates how to use the Link component to navigate between sign-in and sign-up flows.

LANGUAGE: tsx
CODE:
<SignIn.Root>
  <SignIn.Step name="start">
    <Clerk.Link navigate="sign-up">Sign up</Clerk.Link>
  </SignIn.Step>
</SignIn.Root>

----------------------------------------

TITLE: Checking Sign-Up State with useSignUp() in Next.js
DESCRIPTION: This snippet shows how to use the useSignUp() hook in a Next.js application to access the current sign-up attempt status. It includes the 'use client' directive and handles the loading state.

LANGUAGE: tsx
CODE:
'use client'

import { useSignUp } from '@clerk/nextjs'

export default function SignUpPage() {
  const { isLoaded, signUp } = useSignUp()

  if (!isLoaded) {
    // Handle loading state
    return null
  }

  return <div>The current sign-up attempt status is {signUp?.status}.</div>
}

----------------------------------------

TITLE: Implementing Custom Sign-in Flow with Email Links in Next.js
DESCRIPTION: This code snippet demonstrates how to create a custom sign-in flow using email links in a Next.js application. It uses Clerk's useSignIn hook and handles the email link verification process for sign-in.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useSignIn } from '@clerk/nextjs'
import { EmailLinkFactor, SignInFirstFactor } from '@clerk/types'

export default function SignInPage() {
  const [emailAddress, setEmailAddress] = React.useState('')
  const [verified, setVerified] = React.useState(false)
  const [verifying, setVerifying] = React.useState(false)
  const [error, setError] = React.useState('')
  const { signIn, isLoaded } = useSignIn()

  if (!isLoaded) return null

  const { startEmailLinkFlow } = signIn.createEmailLinkFlow()

  async function submit(e: React.FormEvent) {
    e.preventDefault()
    // Reset states in case user resubmits form mid sign-in
    setVerified(false)
    setError('')

    if (!isLoaded && !signIn) return null

    // Start the sign-in process using the email provided
    try {
      const { supportedFirstFactors } = await signIn.create({
        identifier: emailAddress,
      })

      setVerifying(true)

      // Filter the returned array to find the 'email_link' entry
      const isEmailLinkFactor = (factor: SignInFirstFactor): factor is EmailLinkFactor => {
        return factor.strategy === 'email_link'
      }
      const emailLinkFactor = supportedFirstFactors?.find(isEmailLinkFactor)

      if (!emailLinkFactor) {
        setError('Email link factor not found')
        return
      }

      const { emailAddressId } = emailLinkFactor

      // Dynamically set the host domain for dev and prod
      // You could instead use an environment variable or other source for the host domain
      const protocol = window.location.protocol
      const host = window.location.host

      // Send the user an email with the email link
      const signInAttempt = await startEmailLinkFlow({
        emailAddressId,
        redirectUrl: `${protocol}//${host}/sign-in/verify`,
      })

      // Check the verification result
      const verification = signInAttempt.firstFactorVerification

      // Handle if verification expired
      if (verification.status === 'expired') {
        setError('The email link has expired.')
      }

      // Handle if user visited the link and completed sign-in from /sign-in/verify
      if (verification.verifiedFromTheSameClient()) {
        setVerifying(false)
        setVerified(true)
      }
    } catch (err: any) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
      setError('An error occurred.')
    }
  }

  async function reset(e: React.FormEvent) {
    e.preventDefault()
    setVerifying(false)
  }

  if (error) {
    return (
      <div>
        <p>Error: {error}</p>
        <button onClick={() => setError('')}>Try again</button>
      </div>
    )
  }

  if (verifying) {
    return (
      <div>
        <p>Check your email and visit the link that was sent to you.</p>
        <form onSubmit={reset}>
          <button type="submit">Restart</button>
        </form>
      </div>
    )
  }

  if (verified) {
    return <div>Signed in successfully!</div>
  }

  return (
    <div>
      <h1>Sign in</h1>
      <form onSubmit={submit}>
        <input
          type="email"
          placeholder="Enter email address"
          value={emailAddress}
          onChange={(e) => setEmailAddress(e.target.value)}
        />
        <button type="submit">Continue</button>
      </form>
    </div>
  )
}

----------------------------------------

TITLE: Installing Express SDK Dependencies
DESCRIPTION: Commands to uninstall the Node SDK and install the Express SDK using different package managers.

LANGUAGE: shell
CODE:
npm uninstall @clerk/clerk-sdk-node
npm install @clerk/express

----------------------------------------

TITLE: Using getEmailAddress with Clerk Client
DESCRIPTION: Example showing how to use the getEmailAddress method with clerkClient to retrieve an email address using its ID.

LANGUAGE: tsx
CODE:
const emailAddressId = 'idn_123'

const response = await clerkClient.emailAddresses.getEmailAddress(emailAddressId)

----------------------------------------

TITLE: Configuring Custom User ID in Clerk Sessions
DESCRIPTION: JSON configuration for customizing the session token to use external_id as userId when available, falling back to Clerk's native user.id. This helps maintain compatibility with legacy system IDs during migration.

LANGUAGE: json
CODE:
{
  "userId": "{{user.external_id || user.id}}"
}

----------------------------------------

TITLE: Installing react-router-dom for Chrome Extension
DESCRIPTION: Command to install react-router-dom package using pnpm in a Plasmo-based Chrome Extension project.

LANGUAGE: bash
CODE:
pnpm add react-router-dom

----------------------------------------

TITLE: Handling updated return signatures
DESCRIPTION: Example of handling the updated return signature for list methods.

LANGUAGE: javascript
CODE:
const { data, totalCount } = await clerkClient.users.getOrganizationMembershipList()

----------------------------------------

TITLE: Implementing Google OAuth Sign-in with Clerk Elements
DESCRIPTION: Implementation of Google OAuth sign-in flow using Clerk Elements. Features a styled Google sign-in button with proper branding and error handling.

LANGUAGE: tsx
CODE:
'use client'

import * as Clerk from '@clerk/elements/common'
import * as SignIn from '@clerk/elements/sign-in'

export default function SignInPage() {
  return (
    <div className="grid w-full flex-grow items-center bg-black px-4 sm:justify-center">
      <SignIn.Root>
        <SignIn.Step
          name="start"
          className="w-full flex-grow space-y-6 rounded-2xl bg-neutral-900 bg-[radial-gradient(circle_at_50%_0%,theme(colors.white/10%),transparent)] px-4 py-10 ring-1 ring-inset ring-white/5 sm:w-96 sm:px-8"
        >
          <!-- Component implementation details -->
        </SignIn.Step>
      </SignIn.Root>
    </div>
  )
}

----------------------------------------

TITLE: Configuring Grafbase Schema with Private Access
DESCRIPTION: GraphQL schema configuration for enabling access to Grafbase data for any signed-in user using the private access rule.

LANGUAGE: graphql
CODE:
schema
  @auth(providers: [{ type: oidc, issuer: "{{ env.ISSUER_URL }}" }], rules: [{ allow: private }]) {
  query: Query
}

----------------------------------------

TITLE: Handling Email Link Verification for Sign-up in Next.js
DESCRIPTION: This code snippet shows how to handle email link verification for the sign-up process in a Next.js application. It uses Clerk's useClerk hook and handles various verification statuses.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useClerk } from '@clerk/nextjs'
import { EmailLinkErrorCodeStatus, isEmailLinkError } from '@clerk/nextjs/errors'
import Link from 'next/link'

export default function VerifyEmailLink() {
  const [verificationStatus, setVerificationStatus] = React.useState('loading')

  const { handleEmailLinkVerification, loaded } = useClerk()

  async function verify() {
    try {
      // Dynamically set the host domain for dev and prod
      // You could instead use an environment variable or other source for the host domain
      const protocol = window.location.protocol
      const host = window.location.host

      await handleEmailLinkVerification({
        // URL to navigate to if sign-up flow needs more requirements, such as MFA
        redirectUrl: `${protocol}//${host}/sign-up`,
      })

      // If not redirected at this point,
      // the flow has completed
      setVerificationStatus('verified')
    } catch (err: any) {
      let status = 'failed'

      if (isEmailLinkError(err)) {
        // If link expired, set status to expired
        if (err.code === EmailLinkErrorCodeStatus.Expired) {
          status = 'expired'
        } else if (err.code === EmailLinkErrorCodeStatus.ClientMismatch) {
          // OPTIONAL: This check is only required if you have
          // the 'Require the same device and browser' setting
          // enabled in the Clerk Dashboard
          status = 'client_mismatch'
        }
      }

      setVerificationStatus(status)
    }
  }

  React.useEffect(() => {
    if (!loaded) return

    verify()
  }, [handleEmailLinkVerification, loaded])

  if (verificationStatus === 'loading') {
    return <div>Loading...</div>
  }

  if (verificationStatus === 'failed') {
    return (
      <div>
        <h1>Verify your email</h1>
        <p>The email link verification failed.</p>
        <Link href="/sign-up">Sign up</Link>
      </div>
    )
  }

  if (verificationStatus === 'expired') {
    return (
      <div>
        <h1>Verify your email</h1>
        <p>The email link has expired.</p>
        <Link href="/sign-up">Sign up</Link>
      </div>
    )
  }

  // OPTIONAL: This check is only required if you have
  // the 'Require the same device and browser' setting
  // enabled in the Clerk Dashboard
  if (verificationStatus === 'client_mismatch') {
    return (
      <div>
        <h1>Verify your email</h1>
        <p>
          You must complete the email link sign-up on the same device and browser that you started
          it on.
        </p>
        <Link href="/sign-up">Sign up</Link>
      </div>
    )
  }

  return (
    <div>
      <h1>Verify your email</h1>
      <p>Successfully signed up. Return to the original tab to continue.</p>
    </div>
  )
}

----------------------------------------

TITLE: Configuring Next.js Clerk Authentication URLs
DESCRIPTION: Next.js-specific environment variables for configuring Clerk authentication URLs and redirect behavior. These variables are prefixed with NEXT_PUBLIC_ and control the same functionality as the general variables but are specific to Next.js implementations.

LANGUAGE: plaintext
CODE:
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
NEXT_PUBLIC_CLERK_SIGN_IN_FORCE_REDIRECT_URL=/dashboard
NEXT_PUBLIC_CLERK_SIGN_UP_FORCE_REDIRECT_URL=/dashboard
NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/dashboard
NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/dashboard

----------------------------------------

TITLE: Defining createOrganizationMembership Function in TypeScript
DESCRIPTION: Function signature for createOrganizationMembership, which creates a membership to an organization for a user directly. It returns a Promise resolving to an OrganizationMembership object.

LANGUAGE: typescript
CODE:
function createOrganizationMembership(
  params: CreateOrganizationMembershipParams,
): Promise<OrganizationMembership>

----------------------------------------

TITLE: Reordering Default Routes in OrganizationProfile for Next.js
DESCRIPTION: Shows how to reorder default routes and add custom pages and links to the OrganizationProfile component in Next.js. The example adds a custom page, a custom link, and reorders the default members and general pages.

LANGUAGE: tsx
CODE:
'use client'

import { OrganizationSwitcher } from '@clerk/nextjs'

const DotIcon = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" />
    </svg>
  )
}

const CustomPage = () => {
  return (
    <div>
      <h1>Custom page</h1>
      <p>This is the content of the custom page.</p>
    </div>
  )
}

const Header = () => (
  <header>
    <OrganizationSwitcher>
      <OrganizationSwitcher.OrganizationProfilePage
        label="Custom Page"
        url="custom"
        labelIcon={<DotIcon />}
      >
        <CustomPage />
      </OrganizationSwitcher.OrganizationProfilePage>
      <OrganizationSwitcher.OrganizationProfileLink
        label="Homepage"
        url="/"
        labelIcon={<DotIcon />}
      />
      <OrganizationSwitcher.OrganizationProfilePage label="members" />
      <OrganizationSwitcher.OrganizationProfilePage label="general" />
    </OrganizationSwitcher>
  </header>
)

export default Header

----------------------------------------

TITLE: Defining getAuth() Function Parameters in TypeScript
DESCRIPTION: This snippet defines the parameters for the getAuth() function, including the required request object and an optional configuration object.

LANGUAGE: typescript
CODE:
getAuth(request: Request, opts?: {
  secretKey?: string
}): Auth

----------------------------------------

TITLE: Creating Invitation with Redirect URL in Clerk
DESCRIPTION: This example shows how to create an invitation with a specified redirect URL using cURL. The redirect_url parameter is included in the request body to specify where the user should be redirected after clicking the invitation link.

LANGUAGE: bash
CODE:
curl https://api.clerk.com/v1/invitations -X POST -d '{"email_address": "email@example.com", "redirect_url": "https://www.example.com/accept-invitation"}' -H "Authorization:Bearer {{secret}}" -H 'Content-Type:application/json'

----------------------------------------

TITLE: Implementing Sign-up Flow with Clerk Elements and shadcn/ui
DESCRIPTION: React component for a custom sign-up flow using Clerk Elements and shadcn/ui components. Includes social login options, email/password fields, and email verification.

LANGUAGE: tsx
CODE:
'use client'
import * as Clerk from '@clerk/elements/common'
import * as SignUp from '@clerk/elements/sign-up'
import Link from 'next/link'
import { Button } from '@/components/ui/button'
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Icons } from '@/components/ui/icons'
import { cn } from '@/lib/utils'

export default function SignUpPage() {
  return (
    <div className="grid w-full grow items-center px-4 sm:justify-center">
      <SignUp.Root>
        <Clerk.Loading>
          {(isGlobalLoading) => (
            <>
              <SignUp.Step name="start">
                <Card className="w-full sm:w-96">
                  <CardHeader>
                    <CardTitle>Create your account</CardTitle>
                    <CardDescription>
                      Welcome! Please fill in the details to get started.
                    </CardDescription>
                  </CardHeader>
                  <CardContent className="grid gap-y-4">
                    <div className="grid grid-cols-2 gap-x-4">
                      <Clerk.Connection name="github" asChild>
                        <Button
                          size="sm"
                          variant="outline"
                          type="button"
                          disabled={isGlobalLoading}
                        >
                          <Clerk.Loading scope="provider:github">
                            {(isLoading) =>
                              isLoading ? (
                                <Icons.spinner className="size-4 animate-spin" />
                              ) : (
                                <>
                                  <Icons.gitHub className="mr-2 size-4" />
                                  GitHub
                                </>
                              )
                            }
                          </Clerk.Loading>
                        </Button>
                      </Clerk.Connection>
                      <Clerk.Connection name="google" asChild>
                        <Button
                          size="sm"
                          variant="outline"
                          type="button"
                          disabled={isGlobalLoading}
                        >
                          <Clerk.Loading scope="provider:google">
                            {(isLoading) =>
                              isLoading ? (
                                <Icons.spinner className="size-4 animate-spin" />
                              ) : (
                                <>
                                  <Icons.google className="mr-2 size-4" />
                                  Google
                                </>
                              )
                            }
                          </Clerk.Loading>
                        </Button>
                      </Clerk.Connection>
                    </div>
                    <p className="flex items-center gap-x-3 text-sm text-muted-foreground before:h-px before:flex-1 before:bg-border after:h-px after:flex-1 after:bg-border">
                      or
                    </p>
                    <Clerk.Field name="emailAddress" className="space-y-2">
                      <Clerk.Label asChild>
                        <Label>Email address</Label>
                      </Clerk.Label>
                      <Clerk.Input type="email" required asChild>
                        <Input />
                      </Clerk.Input>
                      <Clerk.FieldError className="block text-sm text-destructive" />
                    </Clerk.Field>
                    <Clerk.Field name="password" className="space-y-2">
                      <Clerk.Label asChild>
                        <Label>Password</Label>
                      </Clerk.Label>
                      <Clerk.Input type="password" required asChild>
                        <Input />
                      </Clerk.Input>
                      <Clerk.FieldError className="block text-sm text-destructive" />
                    </Clerk.Field>
                  </CardContent>
                  <CardFooter>
                    <div className="grid w-full gap-y-4">
                      <SignUp.Captcha className="empty:hidden" />
                      <SignUp.Action submit asChild>
                        <Button disabled={isGlobalLoading}>
                          <Clerk.Loading>
                            {(isLoading) => {
                              return isLoading ? (
                                <Icons.spinner className="size-4 animate-spin" />
                              ) : (
                                'Continue'
                              )
                            }}
                          </Clerk.Loading>
                        </Button>
                      </SignUp.Action>
                      <Button variant="link" size="sm" asChild>
                        <Clerk.Link navigate="sign-in">Already have an account? Sign in</Clerk.Link>
                      </Button>
                    </div>
                  </CardFooter>
                </Card>
              </SignUp.Step>

              <SignUp.Step name="continue">
                <Card className="w-full sm:w-96">
                  <CardHeader>
                    <CardTitle>Continue registration</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <Clerk.Field name="username" className="space-y-2">
                      <Clerk.Label>
                        <Label>Username</Label>
                      </Clerk.Label>
                      <Clerk.Input type="text" required asChild>
                        <Input />
                      </Clerk.Input>
                      <Clerk.FieldError className="block text-sm text-destructive" />
                    </Clerk.Field>
                  </CardContent>
                  <CardFooter>
                    <div className="grid w-full gap-y-4">
                      <SignUp.Action submit asChild>
                        <Button disabled={isGlobalLoading}>
                          <Clerk.Loading>
                            {(isLoading) => {
                              return isLoading ? (
                                <Icons.spinner className="size-4 animate-spin" />
                              ) : (
                                'Continue'
                              )
                            }}
                          </Clerk.Loading>
                        </Button>
                      </SignUp.Action>
                    </div>
                  </CardFooter>
                </Card>
              </SignUp.Step>

              <SignUp.Step name="verifications">
                <SignUp.Strategy name="email_code">
                  <Card className="w-full sm:w-96">
                    <CardHeader>
                      <CardTitle>Verify your email</CardTitle>
                      <CardDescription>
                        Use the verification link sent to your email address
                      </CardDescription>
                    </CardHeader>
                    <CardContent className="grid gap-y-4">
                      <div className="grid items-center justify-center gap-y-2">
                        <Clerk.Field name="code" className="space-y-2">
                          <Clerk.Label className="sr-only">Email address</Clerk.Label>
                          <div className="flex justify-center text-center">
                            <Clerk.Input
                              type="otp"
                              className="flex justify-center has-[:disabled]:opacity-50"
                              autoSubmit
                              render={({ value, status }) => {
                                return (
                                  <div
                                    data-status={status}
                                    className={cn(
                                      'relative flex size-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md',
                                      {
                                        'z-10 ring-2 ring-ring ring-offset-background':
                                          status === 'cursor' || status === 'selected',
                                      },
                                    )}
                                  >
                                    {value}
                                    {status === 'cursor' && (
                                      <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
                                        <div className="animate-caret-blink h-4 w-px bg-foreground duration-1000" />
                                      </div>
                                    )}
                                  </div>
                                )
                              }}
                            />
                          </div>
                          <Clerk.FieldError className="block text-center text-sm text-destructive" />
                        </Clerk.Field>
                        <SignUp.Action
                          asChild
                          resend
                          className="text-muted-foreground"
                          fallback={({ resendableAfter }) => (
                            <Button variant="link" size="sm" disabled>
                              Didn&apos;t receive a code? Resend (
                              <span className="tabular-nums">{resendableAfter}</span>)
                            </Button>
                          )}
                        >
                          <Button type="button" variant="link" size="sm">
                            Didn&apos;t receive a code? Resend
                          </Button>
                        </SignUp.Action>
                      </div>
                    </CardContent>
                    <CardFooter>
                      <div className="grid w-full gap-y-4">
                        <SignUp.Action submit asChild>
                          <Button disabled={isGlobalLoading}>
                            <Clerk.Loading>
                              {(isLoading) => {
                                return isLoading ? (
                                  <Icons.spinner className="size-4 animate-spin" />
                                ) : (
                                  'Continue'
                                )
                              }}
                            </Clerk.Loading>
                          </Button>
                        </SignUp.Action>
                      </div>
                    </CardFooter>
                  </Card>
                </SignUp.Strategy>
              </SignUp.Step>
            </>
          )}
        </Clerk.Loading>
      </SignUp.Root>
    </div>
  )
}

----------------------------------------

TITLE: Client-Side Form Component for Adding Tasks
DESCRIPTION: React component for adding tasks, to be used with server-side rendered Supabase and Clerk integration.

LANGUAGE: tsx
CODE:
'use client'
import React, { useState } from 'react'
import { addTask } from './actions'
import { useRouter } from 'next/navigation'

function AddTaskForm() {
  const [taskName, setTaskName] = useState('')
  const router = useRouter()

  async function onSubmit() {
    await addTask(taskName)
    setTaskName('')
    router.refresh()
  }

  return (
    <form action={onSubmit}>
      <input
        autoFocus
        type="text"
        name="name"
        placeholder="Enter new task"
        onChange={(e) => setTaskName(e.target.value)}
        value={taskName}
      />
      <button type="submit">Add</button>
    </form>
  )
}
export default AddTaskForm

----------------------------------------

TITLE: Creating API Route for Actor Token Generation in Expo
DESCRIPTION: This code creates an API route in Expo to generate actor tokens using Clerk's Backend API. It handles the POST request to create an actor token for user impersonation.

LANGUAGE: tsx
CODE:
export async function POST(req: Request) {
  const { actorId, userId } = await req.json()

  try {
    // Create an actor token using Clerk's Backend API
    const res = await fetch('https://api.clerk.com/v1/actor_tokens', {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${process.env.CLERK_SECRET_KEY}`,
        'Content-type': 'application/json',
      },
      body: JSON.stringify({
        user_id: userId,
        actor: {
          sub: actorId,
        },
      }),
    })

    const data = await res.json()

    return Response.json(data)
  } catch (err) {
    return Response.json({ error: 'Failed to generate actor token' }, { status: 500 })
  }
}

----------------------------------------

TITLE: Implementing Protected Routes with Clerk and Fastify in TypeScript
DESCRIPTION: Sets up a Fastify server with Clerk authentication to protect routes and retrieve user data. Uses getAuth() to check authentication status and clerkClient to fetch user details. Includes error handling for unauthorized access and server errors.

LANGUAGE: typescript
CODE:
// dotenv must be imported before @clerk/fastify
import 'dotenv/config'
import Fastify from 'fastify'
import { clerkClient, clerkPlugin, getAuth } from '@clerk/fastify'

const fastify = Fastify({ logger: true })

fastify.register(clerkPlugin)

// Use `getAuth()` to protect this route
fastify.get('/protected', async (request, reply) => {
  try {
    // Use `getAuth()` to get the user's ID
    const { userId } = getAuth(request)

    // If user isn't authenticated, return a 401 error
    if (!userId) {
      return reply.code(401).send({ error: 'User not authenticated' })
    }

    // Use `clerkClient` to access Clerk's Backend SDK methods
    // and get the user's User object
    const user = userId ? await clerkClient.users.getUser(userId) : null

    return reply.send({
      message: 'User retrieved successfully',
      user,
    })
  } catch (error) {
    fastify.log.error(error)
    return reply.code(500).send({ error: 'Failed to retrieve user' })
  }
})

const start = async () => {
  try {
    await fastify.listen({ port: 8080 })
  } catch (error) {
    fastify.log.error(error)
    process.exit(1)
  }
}

start()

----------------------------------------

TITLE: Using getClient Function with Clerk Backend SDK in TypeScript
DESCRIPTION: Example of how to use the getClient function to retrieve a client by its ID using the Clerk Backend SDK.

LANGUAGE: tsx
CODE:
const clientId = 'client_123'

const response = await clerkClient.clients.getClient(clientId)

----------------------------------------

TITLE: Adding Custom Pages to OrganizationProfile in JavaScript
DESCRIPTION: Shows how to add custom pages to the OrganizationProfile component using the JavaScript SDK. It uses the customPages property with the mountOrganizationProfile() or openOrganizationProfile() method.

LANGUAGE: js
CODE:
import { Clerk } from '@clerk/clerk-js'

const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(pubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="organization-profile"></div>
`

const orgProfileDiv = document.getElementById('organization-profile')

clerk.openOrganizationProfile(orgProfileDiv, {
  customPages: [
    {
      url: 'custom-page',
      label: 'Custom Page',
      mountIcon: (el) => {
        el.innerHTML = '👋'
      },
      unmountIcon: (el) => {
        el.innerHTML = ''
      },
      mount: (el) => {
        el.innerHTML = `
          <h1><b>Custom Page</b></h1>
          <p>This is the content of the custom page.</p>
          `
      },
      unmount: (el) => {
        el.innerHTML = ''
      },
    },
    {
      url: '/other-page',
      label: 'Other Page',
      mountIcon: (el) => {
        el.innerHTML = '🌐'
      },
      unmountIcon: (el) => {
        el.innerHTML = ''
      },
    },
  ],
})

----------------------------------------

TITLE: Creating SignUp Component in React Router
DESCRIPTION: Implementation of a basic sign-up page component using Clerk's SignUp component in React Router.

LANGUAGE: typescript
CODE:
import { SignUp } from '@clerk/react-router'

export default function SignUpPage() {
  return (
    <div>
      <h1>Sign up route</h1>
      <SignUp />
    </div>
  )
}

----------------------------------------

TITLE: Implementing Clerk Testing Token in Tests
DESCRIPTION: Example test implementation showing how to use setupClerkTestingToken() in a Cypress test file.

LANGUAGE: typescript
CODE:
import { setupClerkTestingToken } from '@clerk/testing/cypress'

it('sign up', () => {
  setupClerkTestingToken()

  cy.visit('/sign-up')
  // Add any other actions to test
})

----------------------------------------

TITLE: Unmounting OrganizationSwitcher with JavaScript
DESCRIPTION: Example of how to unmount the OrganizationSwitcher component using JavaScript. This snippet demonstrates the usage of the unmountOrganizationSwitcher method from the Clerk instance.

LANGUAGE: js
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="organization-switcher"></div>
`

const orgSwitcherDiv = document.getElementById('organization-switcher')

clerk.mountOrganizationSwitcher(orgSwitcherDiv)

// ...

clerk.unmountOrganizationSwitcher(orgSwitcherDiv)

----------------------------------------

TITLE: Auth Object Example Without Active Organization
DESCRIPTION: This snippet shows the structure of the Auth object when there is no active organization. It includes properties like sessionId, userId, and various null values for organization-related fields.

LANGUAGE: javascript
CODE:
{
  sessionId: 'sess_123',
  userId: 'user_123',
  orgId: null,
  orgRole: null,
  orgSlug: null,
  orgPermissions: null,
  has: [Function (anonymous)],
  getToken: [AsyncFunction (anonymous)],
  claims: {
    azp: 'http://localhost:3000',
    exp: 1666622607,
    iat: 1666622547,
    iss: 'https://clerk.quiet.muskox-85.lcl.dev',
    nbf: 1666622537,
    sid: 'sess_123',
    sub: 'user_123',
  },
}

----------------------------------------

TITLE: Creating Custom Hook for Fetching Users in Expo
DESCRIPTION: This custom hook fetches a list of users for the application in an Expo app. It handles loading states and errors, and returns the list of users along with loading and error states.

LANGUAGE: tsx
CODE:
import { UserJSON } from '@clerk/types'
import { useEffect, useState } from 'react'

type UseUsersReturn = {
  users: UserJSON[] | null
  isLoading: boolean
  error: Error | null
}

export default function useUsers(): UseUsersReturn {
  const [users, setUsers] = useState<UserJSON[] | null>(null)
  const [isLoading, setIsLoading] = useState(true)
  const [error, setError] = useState<Error | null>(null)

  useEffect(() => {
    const getUsers = async () => {
      try {
        const res = await fetch('/getUsers')
        if (!res.ok) {
          throw new Error('Failed to fetch users')
        }
        const data = await res.json()
        setUsers(data)
      } catch (err) {
        setError(err instanceof Error ? err : new Error('Unknown error'))
      } finally {
        setIsLoading(false)
      }
    }

    getUsers()
  }, [])

  return { users, isLoading, error }
}

----------------------------------------

TITLE: Using Interpolation and Conditional Expressions in JWT Template Shortcodes
DESCRIPTION: This example demonstrates how to use interpolation to combine multiple shortcodes and conditional expressions to provide fallback values in JWT templates.

LANGUAGE: json
CODE:
{
  "full_name": "{{user.last_name}} {{user.first_name}}",
  "has_verified_contact_info": "{{user.email_verified || user.phone_number_verified}}",
  "full_name": "{{user.full_name || 'Awesome User'}}",
  "age": "{{user.public_metadata.age || user.unsafe_metadata.age || 30 }}"
}

----------------------------------------

TITLE: Authorization with Clerk JavaScript SDK
DESCRIPTION: Shows how to perform authorization checks using the Clerk JavaScript SDK in a vanilla JavaScript environment.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

if (clerk.user) {
  const canManageSettings = clerk.session.checkAuthorization({
    permission: 'org:team_settings:manage',
  })
}

----------------------------------------

TITLE: Configuring Clerk Layout in Vue
DESCRIPTION: Example showing how to configure Clerk layout options in a Vue application's main entry point, including social button customization.

LANGUAGE: typescript
CODE:
import { createApp } from 'vue'
import App from './App.vue'
import { clerkPlugin } from '@clerk/vue'

const app = createApp(App)
app.use(clerkPlugin, {
  appearance: {
    layout: {
      socialButtonsPlacement: 'bottom',
      socialButtonsVariant: 'iconButton',
      termsPageUrl: 'https://clerk.com/terms',
    },
  },
})
app.mount('#app')

----------------------------------------

TITLE: Configuring ClerkApp with Options
DESCRIPTION: Shows how to pass configuration options to ClerkApp when wrapping the App component. This example sets the publishableKey using an environment variable.

LANGUAGE: tsx
CODE:
// Wrap your app in ClerkApp(app)
export default ClerkApp(App, {
  publishableKey: import.meta.env.VITE_CLERK_PUBLISHABLE_KEY,
})

----------------------------------------

TITLE: Implementing Clerk Sign In with Cypress
DESCRIPTION: Example of using the clerkSignIn command to authenticate a user using phone code strategy and accessing a protected route.

LANGUAGE: typescript
CODE:
it('sign in', () => {
  cy.visit(`/`)
  cy.clerkSignIn({ strategy: 'phone_code', identifier: '+15555550100' })
  cy.visit('/protected')
  // user is signed in from here on
})

----------------------------------------

TITLE: Mounting CreateOrganization with JavaScript
DESCRIPTION: Example of mounting the CreateOrganization component using JavaScript. The Clerk instance is initialized, and the mountCreateOrganization method is used to render the component.

LANGUAGE: js
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="create-organization"></div>
`

const createOrgDiv = document.getElementById('create-organization')

clerk.mountCreateOrganization(createOrgDiv)

----------------------------------------

TITLE: Deleting Users with Clerk Backend SDK in TypeScript
DESCRIPTION: Demonstrates how to delete a user using the JavaScript Backend SDK's deleteUser() method from the clerkClient instance. The code handles the deletion process and returns appropriate responses for success and error cases.

LANGUAGE: typescript
CODE:
export async function DELETE() {
  const userId = 'user_123'

  try {
    await clerkClient.users.deleteUser(userId)
    return Response.json({ message: 'User deleted' })
  } catch (error) {
    console.log(error)
    return Response.json({ error: 'Error deleting user' })
  }
}

----------------------------------------

TITLE: Configuring ClerkProvider for Primary Domain
DESCRIPTION: React component configuration for the primary domain with allowed redirect origins

LANGUAGE: typescript
CODE:
import { ClerkProvider } from '@clerk/nextjs'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <ClerkProvider allowedRedirectOrigins={['http://localhost:3001']}>{children}</ClerkProvider>
      </body>
    </html>
  )
}

----------------------------------------

TITLE: Hotlinking an Image in HTML
DESCRIPTION: Shows an example of hotlinking an image from facebook.com on a different website. This is used to illustrate potential privacy concerns with cross-site cookies.

LANGUAGE: html
CODE:
<!doctype html>
<html>
  <body>
    <p>Check out this cool picture of me on vacation that I posted on FB</p>
    <img src='http://facebook.com/images/h0e208whe8r0.jpg alt='Me on vacation' />
  <body>
</html>

----------------------------------------

TITLE: Authorization in Next.js Pages Router with Clerk
DESCRIPTION: Shows how to perform authorization checks in a Next.js Pages Router application using Clerk's getAuth() and has() functions.

LANGUAGE: tsx
CODE:
import { getAuth } from '@clerk/nextjs/server'

export default async function handler(req: NextApiRequest) {
  const { userId, has } = await getAuth(req)

  if (!userId) return res.status(401)

  const canRead = has({ permission: 'org:team_settings:read' })

  if (!canRead) return res.status(403)

  return users.getTeams(userId)
}

----------------------------------------

TITLE: Configuring Clerk Layout in Next.js
DESCRIPTION: Example of setting up ClerkProvider with custom layout options in a Next.js application, including social button placement and terms page URL configuration.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/nextjs';

<ClerkProvider
  appearance={{
    layout: {
      socialButtonsPlacement: 'bottom',
      socialButtonsVariant: 'iconButton',
      termsPageUrl: 'https://clerk.com/terms'
    }
  }}
>
  {/* ... */}
</ClerkProvider>;

----------------------------------------

TITLE: Custom Authentication Behavior in Sinatra
DESCRIPTION: Shows how to customize the authentication behavior by overriding the default auth filter. This example redirects unauthenticated users to the homepage instead of the sign-in page.

LANGUAGE: ruby
CODE:
require "clerk/sinatra"
require "sinatra/base"

class App < Sinatra::Base
  register Sinatra::Clerk

  # Set `auth` to perform custom behavior
  set(:auth) do |active|
    condition do
      # If the user is not authenticated, redirect to the homepage
      if active && !clerk.session
        puts "User is not authenticated, redirecting to the homepage"
        redirect '/'
      end
    end
  end

  get "/" do
    erb :index, format: :html5
  end

  # Protect the "/admin" route with the `auth` filter
  # which will perform the custom behavior set in `set(:auth)`
  get "/admin", auth: true do
    @user = clerk.user
    erb :admin, format: :html5
  end

  run! if app_file == $0
end

----------------------------------------

TITLE: Paginating Organization Memberships with useOrganization() in Vue
DESCRIPTION: This example shows how to use useOrganization() to access and paginate through organization memberships. It implements pagination by fetching pages of memberships when 'Previous page' or 'Next page' buttons are clicked.

LANGUAGE: vue
CODE:
<script setup>
import { ref, watchEffect } from 'vue'
import { OrganizationSwitcher, useOrganization } from '@clerk/vue'

const memberships = ref([])
const currentPage = ref(1)
const { organization, isLoaded } = useOrganization()

const pageSize = 5

async function fetchMemberships() {
  if (!organization.value) {
    return
  }

  // Use the `getMemberships()` method on the `organization` object to fetch the organization's memberships.
  const { data } = await organization.value.getMemberships({
    initialPage: currentPage.value,
    pageSize: pageSize,
  })
  memberships.value = data
}

watchEffect(() => {
  if (!organization.value) {
    return
  }

  fetchMemberships()
})

const fetchPrevious = () => currentPage.value--
const fetchNext = () => currentPage.value++
</script>

<template>
  <div v-if="!organization">
    <OrganizationSwitcher />
  </div>

  <div v-else-if="isLoaded">
    <h2>Organization members</h2>

    <ul>
      <li v-for="membership in memberships" :key="membership.id">
        {{ membership.publicUserData.firstName }} {{ membership.publicUserData.lastName }} &lt;{{
          membership.publicUserData.identifier
        }}&gt; :: {{ membership.role }}
      </li>
    </ul>

    <div>
      <button :disabled="currentPage === 1" @click="fetchPrevious">Previous</button>
      <button :disabled="memberships.length < pageSize" @click="fetchNext">Next</button>
    </div>
  </div>

  <div v-else>
    <p>Loading...</p>
  </div>
</template>

----------------------------------------

TITLE: Custom Usage of SignInWithMetamaskButton in Remix
DESCRIPTION: Shows how to use a custom button with SignInWithMetamaskButton in Remix. The component wraps a custom button element and uses the 'modal' mode for sign-in.

LANGUAGE: jsx
CODE:
import { SignInWithMetamaskButton } from '@clerk/remix'

export default function Home() {
  return (
    <div>
      <SignInWithMetamaskButton mode="modal">
        <button>Custom sign in button</button>
      </SignInWithMetamaskButton>
    </div>
  )
}

----------------------------------------

TITLE: Implementing MultisessionAppSupport as a Client Component in Next.js
DESCRIPTION: This snippet shows the implementation of MultisessionAppSupport as a client component in Next.js. It uses the useSession hook from Clerk to access the current session and force re-renders when the session changes.

LANGUAGE: tsx
CODE:
'use client'

import React from 'react'
import { useSession } from '@clerk/nextjs'

export default function MultisessionAppSupport({ children }: { children: React.ReactNode }) {
  const { session } = useSession()

  return <React.Fragment key={session ? session.id : 'no-users'}>{children}</React.Fragment>
}

----------------------------------------

TITLE: Setting a Tracking Cookie via HTTP Response
DESCRIPTION: Illustrates how a server (in this case, Facebook) might set a tracking cookie with SameSite=none, allowing it to be sent with both cross-site and same-site requests.

LANGUAGE: http
CODE:
HTTP/2 200
Set-Cookie: fb_tracker=user123; SameSite=none

...the content of the image

----------------------------------------

TITLE: Setting Clerk Publishable Key in Environment Variables
DESCRIPTION: Example of setting the Clerk Publishable Key in the .env file for use in the application.

LANGUAGE: env
CODE:
VITE_CLERK_PUBLISHABLE_KEY={{pub_key}}

----------------------------------------

TITLE: Implementing Localization in Next.js App Router
DESCRIPTION: Demonstrates how to import and use a localization (French in this case) with the ClerkProvider in a Next.js app using the App Router.

LANGUAGE: typescript
CODE:
import { ClerkProvider } from '@clerk/nextjs'
import './globals.css'
// fr-FR locale is imported as frFR
import { frFR } from '@clerk/localizations'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider localization={frFR}>
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Using getToken() in Swift Application
DESCRIPTION: Example demonstrating how to use getToken() to retrieve a JWT token and add it to request headers. Shows proper error handling with try-await pattern.

LANGUAGE: swift
CODE:
let session = Clerk.shared.session

if let token = try await session?.getToken()?.jwt { // => "eyJhbGciOiJSUzI1NiIsImtpZC..."
  headers["Authorization"] = "Bearer \(token)"
}

----------------------------------------

TITLE: Updating useClerk() usage in Vue component
DESCRIPTION: Example of updating a Vue component to use the new @clerk/vue SDK. This includes changing the import path and accessing Clerk methods through the reactive ref.

LANGUAGE: vue
CODE:
<script setup>
import { useClerk } from '@clerk/vue'
const clerk = useClerk()
function signIn() {
  clerk.value.openSignIn()
}
</script>
<template>
  <button @click="signIn">Sign in</button>
</template>

----------------------------------------

TITLE: Unmounting UserProfile Component with JavaScript
DESCRIPTION: Example of how to unmount the <UserProfile /> component using the Clerk JavaScript SDK.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="user-profile"></div>
`

const userProfileDiv = document.getElementById('user-profile')

clerk.mountUserProfile(userProfileDiv)

// ...

clerk.unmountUserProfile(userProfileDiv)

----------------------------------------

TITLE: Implementing Sign in with Apple Button and Clerk Authentication in SwiftUI
DESCRIPTION: This code snippet demonstrates how to create a SwiftUI view that implements Sign in with Apple functionality and authenticates with Clerk. It uses Apple's built-in SignInWithAppleButton to obtain an Apple ID Credential and then calls Clerk's SignIn.authenticateWithIdToken method to complete the authentication process.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk
import AuthenticationServices

struct SignInWithAppleView: View {
  var body: some View {
    // Use Apple's built-in SignInWithAppleButton
    SignInWithAppleButton { request in
      request.requestedScopes = [.email, .fullName]
      request.nonce = UUID().uuidString // Setting the nonce is mandatory
    } onCompletion: { result in
      Task {
        // Access the Apple ID Credential
        guard let credential = try result.get().credential as? ASAuthorizationAppleIDCredential else {
          dump("Unable to get credential of type ASAuthorizationAppleIDCredential")
          return
        }

        // Access the necessary identity token on the Apple ID Credential
        guard let idToken = credential.identityToken.flatMap({ String(data: $0, encoding: .utf8) }) else {
          dump("Unable to get ID token from Apple ID Credential.")
          return
        }

        // Authenticate with Clerk
        let authResult = try await SignIn.authenticateWithIdToken(provider: .apple, idToken: idToken)
      }
    }
  }
}

----------------------------------------

TITLE: Implementing MFA Enforcement Middleware in Nuxt
DESCRIPTION: Create a custom middleware for Nuxt to check if the user has MFA enabled and handle redirection accordingly. This middleware also manages sign-in page access for authenticated users.

LANGUAGE: tsx
CODE:
import { clerkMiddleware } from '@clerk/nuxt/server'

export default clerkMiddleware(async (event) => {
  const isMFARoute = event.path.startsWith('/account/manage-mfa/add')
  const isSignInRoute = event.path.startsWith('/sign-in')

  const { userId, sessionClaims } = event.context.auth

  // Redirect to homepage if the user is signed in and on the sign-in page
  if (userId !== null && isSignInRoute) {
    throw createError({
      statusMessage: 'You are already signed in.',
    })
  }

  // Redirect to MFA setup page if MFA is not enabled
  if (userId !== null && !isMFARoute) {
    if (sessionClaims.isMfa === undefined) {
      throw createError({
        statusMessage: 'You need to add the `isMfa` claim to your session token.',
      })
    }
    if (sessionClaims.isMfa === false) {
      throw createError({
        statusMessage: 'You need to enable MFA for your account.',
      })
    }
  }
})

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Configuring Middleware for Webhook Routes in Next.js
DESCRIPTION: This snippet demonstrates how to configure the Clerk middleware in Next.js to allow public access to webhook routes. It uses a matcher to exclude certain paths and always run for API routes.

LANGUAGE: typescript
CODE:
import { clerkMiddleware } from '@clerk/nextjs/server'

// Make sure that the `/api/webhooks/(.*)` route is not protected here
export default clerkMiddleware()

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Configuring ClerkApp Wrapper in Remix Root Component
DESCRIPTION: Implementation of the ClerkApp wrapper in the root component of a Remix application, including importing the Publishable Key and setting up the wrapper.

LANGUAGE: typescript
CODE:
import { ClerkApp } from '@clerk/remix'
import { Links, Meta, Outlet, Scripts, ScrollRestoration } from '@remix-run/react'

function App() {
  return (
    <html lang="en">
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <Meta />
        <Links />
      </head>
      <body>
        <Outlet />
        <ScrollRestoration />
        <Scripts />
      </body>
    </html>
  )
}

// Import your Publishable Key
const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

// Wrap your app with `ClerkApp`
export default ClerkApp(App, {
  publishableKey: PUBLISHABLE_KEY,
})

----------------------------------------

TITLE: Styling Static Control Components with Flex Layout
DESCRIPTION: Example demonstrating how to properly style Clerk control components when using isStatic={true}, showing both incorrect and correct flex styling approaches.

LANGUAGE: jsx
CODE:
<div className="flex items-center">
  <SignedIn isStatic={true}>
    <span>You are signed in!</span>
  </SignedIn>
  <span>This content is always visible.</span>
</div>

LANGUAGE: html
CODE:
<div className="flex items-center">
  <clerk-signed-in>
    <span>You are signed in!</span>
  </clerk-signed-in>
  <span>This content is always visible.</span>
</div>

LANGUAGE: jsx
CODE:
<div class="flex items-center">
  <SignedIn isStatic={true} class="flex items-center">
    <span>User</span>
  </SignedIn>
  <span>Always visible</span>
</div>

----------------------------------------

TITLE: Configuring ClerkProvider
DESCRIPTION: Setting up the ClerkProvider wrapper with waitlist configuration in the root layout.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/nextjs'
import './globals.css'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider waitlistUrl="/">
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Adding Clerk Middleware to Rack Application in Ruby
DESCRIPTION: This snippet demonstrates how to add the Clerk middleware to a Rack application by updating the config.ru file. It requires the necessary modules and uses the Clerk::Rack::Middleware.

LANGUAGE: ruby
CODE:
require "rack"
require "clerk/rack"

require_relative "app"

use Clerk::Rack::Middleware
run App.new

----------------------------------------

TITLE: Implementing SignIn Component in Vue
DESCRIPTION: Example showing how to implement the SignIn component in a Vue application using script setup syntax.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { SignIn } from '@clerk/vue'
</script>

<template>
  <SignIn />
</template>

----------------------------------------

TITLE: Attempting Email Verification with SignUp Class
DESCRIPTION: Method to validate an email verification code during sign-up. Used specifically with the email_code strategy to verify the one-time code sent to the user's email address.

LANGUAGE: typescript
CODE:
function attemptEmailAddressVerification(
  params: AttemptEmailAddressVerificationParams,
): Promise<SignUpResource>

----------------------------------------

TITLE: Defining a JWT Template with Static and Dynamic Values in JSON
DESCRIPTION: This example demonstrates a JWT template with both static values and dynamic shortcodes. It shows how to define audience, interests, name, surname, and email claims.

LANGUAGE: json
CODE:
{
  "aud": "https://example.com",
  "interests": ["hiking", "knitting"],
  "name": "{{user.first_name}}",
  "surname": "{{user.last_name}}",
  "email": "{{user.primary_email_address}}"
}

----------------------------------------

TITLE: Disabling Telemetry via ClerkProvider Props
DESCRIPTION: Demonstrates how to disable telemetry by passing a prop to the ClerkProvider component in React applications.

LANGUAGE: tsx
CODE:
<ClerkProvider telemetry={false} />

----------------------------------------

TITLE: Accessing Organization Data with $organizationStore in Vue
DESCRIPTION: This snippet shows how to use the $organizationStore store in a Vue component to access the current active organization's attributes. It handles loading and null states using v-if directives, and displays the organization name when available.

LANGUAGE: vue
CODE:
<script setup>
import { useStore } from '@nanostores/vue'
import { $organizationStore } from '@clerk/astro/client'

const organization = useStore($organizationStore)
</script>

<template>
  <div v-if="organization === undefined">
    <!-- Add logic to handle loading state -->
  </div>
  <div v-else-if="organization === null">
    <!-- Add logic to handle no active organization state -->
  </div>
  <div v-else>
    <p>This current organization is {{ organization.name }}</p>
  </div>
</template>

----------------------------------------

TITLE: Accessing SignUp State in Svelte
DESCRIPTION: Example showing how to use the $signUpStore with Svelte to check the current sign-up status. Demonstrates proper aliasing to avoid conflicts with Svelte's reactivity system.

LANGUAGE: svelte
CODE:
<script>
  // The $ prefix is reserved in Svelte for its own reactivity system.
  // Alias the imports to avoid conflicts.
  import { $signUpStore as signUp } from '@clerk/astro/client'
</script>

{#if $signUp === undefined}
  <!-- Add logic to handle loading state -->
{:else}
  <div>The current sign-up attempt status is {$signUp.status}.</div>
{/if}

----------------------------------------

TITLE: Implementing Clerk Middleware
DESCRIPTION: Setting up Clerk middleware for authentication state management and route protection.

LANGUAGE: tsx
CODE:
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware()

export const config = {
  matcher: [
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Running Remix Development Server
DESCRIPTION: These commands show how to start the Remix development server using different package managers (npm, yarn, pnpm, bun).

LANGUAGE: bash
CODE:
npm run dev

LANGUAGE: bash
CODE:
yarn dev

LANGUAGE: bash
CODE:
pnpm dev

LANGUAGE: bash
CODE:
bun dev

----------------------------------------

TITLE: Defining Global TypeScript Types for Custom Claims
DESCRIPTION: TypeScript type definitions for custom session claims to enable autocompletion and type checking when working with custom claims.

LANGUAGE: typescript
CODE:
export {}

declare global {
  interface CustomJwtSessionClaims {
    fullName?: string
    primaryEmail?: string
  }
}

----------------------------------------

TITLE: Accessing Clerk with Axios in TypeScript
DESCRIPTION: Shows how to integrate getClerkInstance() with Axios, including setting up an interceptor to automatically add authentication tokens to all requests. Includes error handling for API responses.

LANGUAGE: typescript
CODE:
import axios from 'axios'
import { getClerkInstance } from '@clerk/clerk-expo'

export async function fetchFoo() {
  try {
    const data = await axios.get('/api/foo')
    return data
  } catch (error) {
    if (axios.isAxiosError(error) && error.response) {
      throw new Error(`API Error: ${error.response.status} ${error.response.statusText}`)
    }

    throw new Error('Unknown error')
  }
}

axios.interceptors.request.use(async (config) => {
  const clerkInstance = getClerkInstance()
  const token = await clerkInstance.session?.getToken()

  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }

  return config
})

----------------------------------------

TITLE: Backend API Rate Limits
DESCRIPTION: Backend API request rate limits are enforced per application instance, identified by Secret Key. Includes user creation and general endpoint limits.

LANGUAGE: plaintext
CODE:
POST /v1/users - 20 requests per 10 seconds\nAll other endpoints - 100 requests per 10 seconds\nGET /v1/jwks - No rate limit

----------------------------------------

TITLE: Configuring Clerk Middleware for Organization Activation
DESCRIPTION: This code demonstrates how to configure clerkMiddleware to set the active organization based on URL patterns in a Next.js application.

LANGUAGE: tsx
CODE:
import { clerkMiddleware } from '@clerk/nextjs/server'

export default clerkMiddleware(
  (auth, req) => {
    // Add your middleware checks
  },
  {
    organizationSyncOptions: {
      organizationPatterns: [
        '/orgs/:slug', // Match the org slug
        '/orgs/:slug/(.*)', // Wildcard match for optional trailing path segments
      ],
      personalAccountPatterns: [
        '/me', // Match the personal account
        '/me/(.*)', // Wildcard match for optional trailing path segments
      ],
    },
  },
)

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Creating Sign-Up Page Component in TanStack Start with Clerk
DESCRIPTION: This snippet shows how to create a dedicated sign-up page using Clerk's <SignUp /> component and TanStack Router's catch-all route. It defines a new route and renders the SignUp component.

LANGUAGE: typescript
CODE:
import { SignUp } from '@clerk/tanstack-start'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/sign-up/$')({
  component: Page,
})

function Page() {
  return <SignUp />
}

----------------------------------------

TITLE: Implementing Auth Store in Vue
DESCRIPTION: Shows how to implement the $authStore in Vue components using the composition API. Handles different authentication states through template conditionals.

LANGUAGE: vue
CODE:
<script setup>
import { useStore } from '@nanostores/vue'
import { $authStore } from '@clerk/astro/client'

const auth = useStore($authStore)
</script>

<template>
  <div v-if="auth.userId === undefined">Loading...</div>
  <div v-else-if="auth.userId === null">Sign in to view this page</div>
  <div v-else>...</div>
</template>

----------------------------------------

TITLE: Setting Clerk Redirect URLs in Environment Variables
DESCRIPTION: Environment variable configuration for Clerk redirect URLs. These variables set the fallback and force redirect URLs for sign-in and sign-up processes.

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/dashboard
NEXT_PUBLIC_CLERK_SIGN_UP_FORCE_REDIRECT_URL=/onboarding

----------------------------------------

TITLE: Installing Clerk Next.js SDK
DESCRIPTION: Command line instructions for installing the @clerk/nextjs package using different package managers.

LANGUAGE: bash
CODE:
npm install @clerk/nextjs

LANGUAGE: bash
CODE:
yarn add @clerk/nextjs

LANGUAGE: bash
CODE:
pnpm add @clerk/nextjs

LANGUAGE: bash
CODE:
bun add @clerk/nextjs

----------------------------------------

TITLE: Creating an Actor Token with Clerk Backend API
DESCRIPTION: This snippet demonstrates how to create an actor token using Clerk's Backend API. The token is valid for 600 seconds and allows one user to impersonate another.

LANGUAGE: bash
CODE:
curl -X POST https://api.clerk.com/v1/actor_tokens -d '{ \
  "user_id": "user_1o4qfak5AdI2qlXSXENGL05iei6", \
  "expires_in_seconds": 600 \
  "actor": { \
    "sub": "user_21Ufcy98STcA11s3QckIwtwHIES", \
  } \
}'

----------------------------------------

TITLE: OrganizationMembership Type Definition
DESCRIPTION: Type definition for the Backend OrganizationMembership object showing all available properties including identifiers, role, metadata, timestamps, and organization information.

LANGUAGE: typescript
CODE:
type OrganizationMembership = {
  id: string;
  role: OrganizationMembershipRole;
  publicMetadata: OrganizationMembershipPublicMetadata;
  privateMetadata: OrganizationMembershipPrivateMetadata;
  createdAt: number;
  updatedAt: number;
  organization: Organization;
  publicUserData?: OrganizationMembershipPublicUserData;
}

----------------------------------------

TITLE: Protecting Next.js Route Handlers with Clerk's auth.protect()
DESCRIPTION: Demonstrates how to use auth.protect() to protect a Next.js Route Handler from unauthorized access.

LANGUAGE: tsx
CODE:
import { auth } from '@clerk/nextjs/server'

export const GET = async () => {
  const { userId } = await auth.protect({
    permission: 'org:team_settings:manage',
  })

  return Response.json({ userId })
}

----------------------------------------

TITLE: Using useSignUp Composable in Vue Component
DESCRIPTION: Demonstrates how to implement sign-up state checking using Clerk's useSignUp composable in a Vue component. The example shows proper handling of loading states and displaying the current sign-up status.

LANGUAGE: vue
CODE:
<script setup>
import { useSignUp } from '@clerk/vue'

const { isLoaded, signUp } = useSignUp()
</script>

<template>
  <div v-if="!isLoaded">
    <!-- Handle loading state -->
  </div>

  <div v-else>The current sign-up attempt status is {{ signUp?.status }}.</div>
</template>

----------------------------------------

TITLE: Renaming User Passkeys with Clerk API in React
DESCRIPTION: This code snippet demonstrates how to rename a user's passkey using the Clerk API. It uses the useUser hook to access the user's passkeys and calls the update() method on a specific passkey object.

LANGUAGE: tsx
CODE:
export function RenamePasskeyUI() {
  const { user } = useUser()
  const { passkeys } = user

  const passkeyToUpdateId = useRef<HTMLInputElement>(null)
  const newPasskeyName = useRef<HTMLInputElement>(null)
  const [success, setSuccess] = useState(false)

  const renamePasskey = async () => {
    try {
      const passkeyToUpdate = passkeys?.find(
        (pk: PasskeyResource) => pk.id === passkeyToUpdateId.current?.value,
      )

      await passkeyToUpdate?.update({
        name: newPasskeyName.current?.value,
      })

      setSuccess(true)
    } catch (err) {
      console.error('Error:', JSON.stringify(err, null, 2))
      setSuccess(false)
    }
  }

  return (
    <>
      <p>Passkeys:</p>
      <ul>
        {passkeys?.map((pk: PasskeyResource) => {
          return (
            <li key={pk.id}>
              Name: {pk.name} | ID: {pk.id}
            </li>
          )
        })}
      </ul>
      <input ref={passkeyToUpdateId} type="text" placeholder="Enter the passkey ID" />
      <input type="text" placeholder="Enter the passkey's new name" ref={newPasskeyName} />
      <button onClick={renamePasskey}>Rename passkey</button>
      <p>Passkey updated: {success ? 'Yes' : 'No'}</p>
    </>
  )
}

----------------------------------------

TITLE: Paginating Organization Memberships in Vue
DESCRIPTION: This snippet demonstrates how to implement pagination for organization memberships using Vue. It uses the $organizationStore to access the organization data and implements a fetchMemberships function to retrieve paginated data. The component includes previous and next buttons for navigation.

LANGUAGE: vue
CODE:
<script setup>
import { useStore } from '@nanostores/vue'
import { $organization } from '@clerk/astro/client'
import { ref, watchEffect } from 'vue'

const memberships = ref([])
const currentPage = ref(1)
const organization = useStore($organizationStore)

const pageSize = 10

const fetchMemberships = async () => {
  if (!organization.value) {
    return
  }

  const { data } = await organization.value.getMemberships({
    initialPage: currentPage.value,
    pageSize: 5,
  })
  memberships.value = data
}

watchEffect(() => {
  if (!organization.value) {
    return
  }

  fetchMemberships()
})

const fetchPrevious = () => currentPage.value--
const fetchNext = () => currentPage.value++
</script>

<template>
  <div v-if="organization === undefined">
    <!-- Handle loading state -->
  </div>
  <div v-else-if="organization === null">
    <!-- Handle no organization state -->
  </div>
  <div v-else>
    <h2>Organization members</h2>
    <ul>
      <li v-for="membership in memberships" :key="membership.id">
        {{ membership.publicUserData.firstName }} {{ membership.publicUserData.lastName }} &lt;{{
          membership.publicUserData.identifier
        }}&gt; :: {{ membership.role }}
      </li>
    </ul>
    <div>
      <button @click="fetchPrevious" :disabled="currentPage === 1">Previous</button>
      <button @click="fetchNext">Next</button>
    </div>
  </div>
</template>

----------------------------------------

TITLE: Setting Up Clerk Environment Variables
DESCRIPTION: Configuration of essential Clerk environment variables for sign-in and redirect URLs.

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/
NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/

----------------------------------------

TITLE: Setting Up Clerk Environment Variables
DESCRIPTION: Configuration of essential Clerk environment variables for sign-in and redirect URLs.

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/
NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/

----------------------------------------

TITLE: Configuring Clerk Middleware Authorization
DESCRIPTION: Example showing how to set authorized parties in Clerk middleware for enhanced security against CSRF attacks

LANGUAGE: typescript
CODE:
clerkMiddleware({
  authorizedParties: ['https://example.com'],
})

----------------------------------------

TITLE: Decoding JWT Payload in JSON
DESCRIPTION: This snippet demonstrates a simple decoded JWT payload, containing a subject identifier and an issued-at timestamp.

LANGUAGE: json
CODE:
{
  "sub": "user_123",
  "iat": 1516239022
}

----------------------------------------

TITLE: Implementing Image Optimization in React with Clerk
DESCRIPTION: Shows how to optimize user profile images using query parameters in a React component. Uses useClerk hook from @clerk/clerk-react to access the user's image URL and apply optimization parameters for width, height, quality, and fit.

LANGUAGE: tsx
CODE:
import { useClerk } from '@clerk/clerk-react'
import React from 'react'

export default function ImageOptimization() {
  const clerk = useClerk()
  const { user } = clerk
  if (!user) return <p>No Image URL found</p>

  const { imageUrl } = user
  const params = new URLSearchParams()

  params.set('height', '200')
  params.set('width', '200')
  params.set('quality', '100')
  params.set('fit', 'crop')

  const imageSrc = `${imageUrl}?${params.toString()}`

  return (
    <div>
      <h1>Image source:</h1>
      <p>{imageSrc}</p>
      <h2>Image:</h2>
      <img src={imageSrc} alt="User image" />
    </div>
  )
}

----------------------------------------

TITLE: Customizing Session Token with MFA Status in Clerk
DESCRIPTION: Add a key-value pair to the Claims object in the Clerk Dashboard to include the user's MFA status in the session token.

LANGUAGE: json
CODE:
{
  "isMfa": "{{user.two_factor_enabled}}"
}

----------------------------------------

TITLE: Reloading User Data with $userStore in Svelte
DESCRIPTION: This snippet demonstrates how to reload the current user's data using the $userStore in a Svelte component. It includes error handling and displays the user's role from public metadata.

LANGUAGE: svelte
CODE:
<script>
  // The $ prefix is reserved in Svelte for its own reactivity system.
  // Alias the imports to avoid conflicts.
  import { useStore } from '@nanostores/svelte'
  import { $userStore as userStore } from '@clerk/astro/client'

  const user = useStore(userStore)

  const updateUser = async () => {
    if ($user) {
      try {
        // Update data via an API endpoint
        const response = await fetch('/api/updateMetadata')
        const updateMetadata = await response.json()

        // Check if the update was successful
        if (updateMetadata.message !== 'success') {
          throw new Error('Error updating')
        }

        // If the update was successful, reload the user data
        await $user.reload()
      } catch (error) {
        console.error('Failed to update metadata:', error)
        // Handle the error appropriately
      }
    }
  }
</script>

{#if $user === undefined}
  <!-- Handle loading state however you like -->
{:else if $user !== null}
  <button on:click={updateUser}>Click me to update your metadata</button>
  <p>user role: {$user.publicMetadata?.role}</p>
{/if}

----------------------------------------

TITLE: Updating import paths
DESCRIPTION: Example of updating import paths to use the top-level @clerk/clerk-sdk-node import.

LANGUAGE: javascript
CODE:
import { ... } from '@clerk/clerk-sdk-node'

----------------------------------------

TITLE: Protecting API Routes and Fetching User Data with Clerk Backend SDK in TypeScript
DESCRIPTION: This server-side TypeScript snippet shows how to protect an API route by checking the user's authentication status and fetching the full Backend User object using the Clerk Backend SDK. It uses the userId from the auth context to retrieve detailed user information.

LANGUAGE: typescript
CODE:
import { clerkClient } from '@clerk/nuxt/server'

export default defineEventHandler(async (event) => {
  // Use `auth` to get the user's ID
  const { userId } = event.context.auth

  // Protect the API route by checking if the user is signed in
  if (!userId) {
    throw createError({
      statusCode: 401,
      statusMessage: 'Unauthorized: No user ID provided',
    })
  }

  // Get the user's full `Backend User` object
  const user = await clerkClient(event).users.getUser(userId)

  return user
})

----------------------------------------

TITLE: Displaying User Data with useUser() Composable in Vue
DESCRIPTION: This snippet demonstrates how to use the useUser() composable to access and display the current user's first name in a Vue component. It checks if Clerk has finished initializing and if a user is signed in before rendering the appropriate content.

LANGUAGE: vue
CODE:
<script setup>
const { isLoaded, isSignedIn, user } = useUser()
</script>

<template>
  <div v-if="!isLoaded">Loading...</div>
  <div v-else-if="!isSignedIn">Sign in to access this page</div>
  <div v-else>Hello, {{ user.firstName }}!</div>
</template>

----------------------------------------

TITLE: Structured Markdown Tutorial for Xero OAuth Setup
DESCRIPTION: Markdown documentation showing the process of configuring Xero as a social connection provider in Clerk, including both development and production setup steps.

LANGUAGE: markdown
CODE:
---
title: Add Xero as a social connection
description: Learn how to allow users to sign up and sign in to your Clerk app with their Xero account using OAuth.
---

<TutorialHero
  beforeYouStart={[
    {
      title: "A Clerk app is required.",
      link: "/docs/quickstarts/setup-clerk",
      icon: "clerk",
    },
    {
      title: "A Xero Developer account is required.",
      link: "https://developer.xero.com/",
      icon: "user-circle",
    }
  ]}
>
  - Use Xero to authenticate users with OAuth
</TutorialHero>

----------------------------------------

TITLE: Updating components with path routing
DESCRIPTION: Examples of updating various components to use the new path prop for path routing.

LANGUAGE: jsx
CODE:
<SignIn path="/sign-in" />
<SignUp path="/sign-up" />
<UserProfile path="/user-profile" />
<CreateOrganization path="/create-org" />
<OrganizationProfile path="/org-profile" />

----------------------------------------

TITLE: Configuring Environment Variables for Clerk-Fauna Integration
DESCRIPTION: Environment variables setup for Clerk Frontend API and JWKS URLs required for Fauna integration.

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_FRONTEND_API_URL={{fapi_url}}
NEXT_PUBLIC_CLERK_JWKS_URL={{jwks_url}}

----------------------------------------

TITLE: Server Action for Adding Tasks with Supabase and Clerk
DESCRIPTION: Next.js server action to add tasks to Supabase using Clerk authentication.

LANGUAGE: ts
CODE:
'use server'

import { createClerkSupabaseClientSsr } from './client'

const client = createClerkSupabaseClientSsr()

export async function addTask(name: string) {
  try {
    const response = await client.from('tasks').insert({
      name,
    })

    console.log('Task successfully added!', response)
  } catch (error: any) {
    console.error('Error adding task:', error.message)
    throw new Error('Failed to add task')
  }
}

----------------------------------------

TITLE: Code Block Props Interface
DESCRIPTION: TypeScript interface defining props for code block components including line marking and file naming options.

LANGUAGE: typescript
CODE:
type LineNumber = number
type Mark = LineNumber | [start: LineNumber, end: LineNumber]

interface CodeBlockProps {
  filename?: string
  mark?: Array<Mark>
  ins?: Array<Mark>
  del?: Array<Mark>
}

----------------------------------------

TITLE: Updating Component Routing
DESCRIPTION: Examples of using the new default path routing for various Clerk components.

LANGUAGE: jsx
CODE:
<SignIn path="/sign-in" />
<SignUp path="/sign-up" />
<UserProfile path="/user-profile" />
<CreateOrganization path="/create-org" />
<OrganizationProfile path="/org-profile" />

----------------------------------------

TITLE: Detecting Impersonated Sessions in JavaScript
DESCRIPTION: This JavaScript snippet uses the Clerk object to access the session and detect if it's an impersonated session.

LANGUAGE: js
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const pubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(pubKey)
await clerk.load()

const { session } = clerk

if (session.actor) {
  const { actor, user } = session

  console.log(`User ${actor.sub} is signed in as user ${user.id}.`)
}

----------------------------------------

TITLE: Configuring Package.json for Chrome Extension
DESCRIPTION: Updates the package.json manifest configuration to include the public key, required permissions, and host permissions for the Chrome extension.

LANGUAGE: json
CODE:
{
    "manifest": {
      "key": "$CRX_PUBLIC_KEY",
      "permissions": ["cookies", "storage"],
      "host_permissions": ["http://localhost/*", "$CLERK_FRONTEND_API/*"]
    }
  }

----------------------------------------

TITLE: Implementing RedirectToOrganizationProfile in Next.js
DESCRIPTION: This snippet demonstrates how to use the RedirectToOrganizationProfile component in a Next.js application. It's wrapped in a SignedIn component to ensure the redirect only occurs for authenticated users.

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, RedirectToOrganizationProfile } from '@clerk/nextjs'
import { AppProps } from 'next/app'

function MyApp({ Component, pageProps }: AppProps) {
  return (
    <ClerkProvider {...pageProps}>
      <SignedIn>
        <RedirectToOrganizationProfile />
      </SignedIn>
      <SignedOut>You need to sign in to view your organization profile.</SignedOut>
    </ClerkProvider>
  )
}

export default MyApp

----------------------------------------

TITLE: Installing Clerk Astro SDK
DESCRIPTION: Commands to install the @clerk/astro package using various package managers.

LANGUAGE: bash
CODE:
npm install @clerk/astro

LANGUAGE: bash
CODE:
yarn add @clerk/astro

LANGUAGE: bash
CODE:
pnpm add @clerk/astro

LANGUAGE: bash
CODE:
bun add @clerk/astro

----------------------------------------

TITLE: Updating ClerkProvider for Passkey Support in Expo
DESCRIPTION: This snippet shows how to update the ClerkProvider component in an Expo application to enable passkey support by passing the passkeys object to the __experimental_passkeys property.

LANGUAGE: tsx
CODE:
import { ClerkProvider } from '@clerk/clerk-expo'
import { Slot } from 'expo-router'
import { tokenCache } from '@clerk/clerk-expo/token-cache'
import { passkeys } from '@clerk/clerk-expo/passkeys'

export default function RootLayout() {
  return (
    <ClerkProvider
      tokenCache={tokenCache}
      publishableKey={publishableKey}
      __experimental_passkeys={passkeys}
    >
      <Slot />
    </ClerkProvider>
  )
}

----------------------------------------

TITLE: Custom SignInButton Usage in React
DESCRIPTION: Shows how to create a custom sign-in button by wrapping a custom button element inside the SignInButton component in a React application.

LANGUAGE: jsx
CODE:
import { SignInButton } from '@clerk/clerk-react'

export default function Example() {
  return (
    <SignInButton>
      <button>Custom sign in button</button>
    </SignInButton>
  )
}

----------------------------------------

TITLE: Rendering UserProfile Component in Astro
DESCRIPTION: Example of how to use the <UserProfile /> component in an Astro application.

LANGUAGE: astro
CODE:
---
import { UserProfile } from '@clerk/astro/components'
---

<UserProfile />

----------------------------------------

TITLE: Setting Clerk Environment Variables
DESCRIPTION: Configuration of Clerk authentication keys in the environment file.

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_SECRET_KEY={{secret}}

----------------------------------------

TITLE: Getting Active Session and User in Clerk
DESCRIPTION: Demonstrates how to retrieve the currently active session and user information using Clerk's API across different platforms.

LANGUAGE: jsx
CODE:
import { useClerk } from '@clerk/clerk-react'

// Get the active session and user
const { session, user } = useClerk()

LANGUAGE: javascript
CODE:
// Get the active session
const activeSession = window.Clerk.session

// Get the active user
const activeUser = window.Clerk.user

LANGUAGE: swift
CODE:
// Get the active session
var activeSession: Session? { Clerk.shared.session }

// Get the active user
var user: User? { Clerk.shared.user }

----------------------------------------

TITLE: Implementing Sign-Up Route Component with Clerk
DESCRIPTION: Creates a SignUpPage component using Clerk's SignUp component for the sign-up route.

LANGUAGE: tsx
CODE:
import { SignUp } from '@clerk/chrome-extension'

export const SignUpPage = () => {
  return (
    <>
      <p>Sign Up</p>
      <SignUp routing="virtual" />
    </>
  )
}

----------------------------------------

TITLE: Creating Storage Directory for Clerk Authentication State
DESCRIPTION: These commands create a directory to store Clerk authentication state and add it to .gitignore.

LANGUAGE: bash
CODE:
mkdir -p playwright/.clerk
echo $'\nplaywright/.clerk' >> .gitignore

----------------------------------------

TITLE: Client-side Organization Detection using Clerk Hooks
DESCRIPTION: Client-side implementation to detect active organization using Clerk's useAuth hook.

LANGUAGE: tsx
CODE:
'use client'
import { useAuth } from '@clerk/nextjs'

export default function Layout() {
  const { orgId } = useAuth()

  const hasActiveOrg = orgId !== null
  // ...
}

----------------------------------------

TITLE: Client-side Organization Detection using Clerk Hooks
DESCRIPTION: Client-side implementation to detect active organization using Clerk's useAuth hook.

LANGUAGE: tsx
CODE:
'use client'
import { useAuth } from '@clerk/nextjs'

export default function Layout() {
  const { orgId } = useAuth()

  const hasActiveOrg = orgId !== null
  // ...
}

----------------------------------------

TITLE: Setting Clerk Publishable Key in Environment
DESCRIPTION: Example of setting the Clerk Publishable Key in a .env file.

LANGUAGE: env
CODE:
VITE_CLERK_PUBLISHABLE_KEY={{pub_key}}

----------------------------------------

TITLE: Mounting OrganizationSwitcher with JavaScript
DESCRIPTION: Example of how to mount the OrganizationSwitcher component using JavaScript. This snippet demonstrates the usage of the mountOrganizationSwitcher method from the Clerk instance.

LANGUAGE: js
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="organization-switcher"></div>
`

const orgSwitcherDiv = document.getElementById('organization-switcher')

clerk.mountOrganizationSwitcher(orgSwitcherDiv)

----------------------------------------

TITLE: Basic Usage of SignInWithMetamaskButton in React
DESCRIPTION: Shows how to implement the SignInWithMetamaskButton component in a React application. The component is imported from '@clerk/clerk-react' and used within a functional component.

LANGUAGE: jsx
CODE:
import { SignInWithMetamaskButton } from '@clerk/clerk-react'

export default function Example() {
  return (
    <div>
      <SignInWithMetamaskButton />
    </div>
  )
}

----------------------------------------

TITLE: Destroying OrganizationMembership in TypeScript
DESCRIPTION: This method deletes the membership from the organization it belongs to. It returns a Promise that resolves to an OrganizationMembership object.

LANGUAGE: typescript
CODE:
function destroy(): Promise<OrganizationMembership>

----------------------------------------

TITLE: Creating Home Route Component in React
DESCRIPTION: Defines a simple Home component for the root route of the Chrome Extension.

LANGUAGE: tsx
CODE:
export const Home = () => {
  return (
    <>
      <h1>Clerk + Chrome Extension + React Router</h1>
    </>
  )
}

----------------------------------------

TITLE: Implementing Credential Reverification Check with Clerk in Next.js API Route
DESCRIPTION: API route handler that checks if a user has verified their credentials within the last 10 minutes using Clerk's auth system. If verification is outdated, returns an error response using reverificationErrorResponse utility.

LANGUAGE: typescript
CODE:
import { auth, reverificationErrorResponse } from '@clerk/nextjs/server'

export const POST = async (req: Request) => {
  const { has } = await auth()

  // Check if the user has *not* verified their credentials within the past 10 minutes.
  const shouldUserRevalidate = !has({ reverification: 'strict' })

  // If the user hasn't reverified, return an error with the matching configuration (e.g., `strict`)
  if (shouldUserRevalidate) {
    return reverificationErrorResponse('strict')
  }

  // If the user has verified credentials, return a successful response
  return new Response({ success: true })
}

----------------------------------------

TITLE: Configuring Custom JWT Signing Key in Nhost
DESCRIPTION: JSON configuration for setting up a custom signing key in Nhost's JWT secret environment variable

LANGUAGE: json
CODE:
{ "type": "HS256", "key": "<YOUR_SIGNING_KEY>" }

----------------------------------------

TITLE: Using Stored Clerk Auth State in Playwright Test File
DESCRIPTION: This TypeScript code demonstrates how to use the stored Clerk authentication state directly in a Playwright test file.

LANGUAGE: typescript
CODE:
import { test } from '@playwright/test'

// Use prepared Clerk auth state
test.use({ storageState: 'playwright/.clerk/user.json' })

test('user test', async ({ page }) => {
  // page is authenticated
})

----------------------------------------

TITLE: Implementing CreateOrganization in Tanstack Start
DESCRIPTION: Example of using the CreateOrganization component in a Tanstack Start application. The component is imported from '@clerk/tanstack-start' and used to create a route.

LANGUAGE: tsx
CODE:
import { CreateOrganization } from '@clerk/tanstack-start'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/create-organization')({
  component: CreateOrganization,
})

function CreateOrganization() {
  return <CreateOrganization />
}

----------------------------------------

TITLE: Basic Usage of useOrganization Hook
DESCRIPTION: Examples of different ways to fetch and paginate organization invitations data using the useOrganization hook.

LANGUAGE: jsx
CODE:
// invitations.data will never be populated.
const { invitations } = useOrganization()

// Use default values to fetch invitations, such as initialPage = 1 and pageSize = 10
const { invitations } = useOrganization({
  invitations: true,
})

// Pass your own values to fetch invitations
const { invitations } = useOrganization({
  invitations: {
    pageSize: 20,
    initialPage: 2, // skips the first page
  },
})

// Aggregate pages in order to render an infinite list
const { invitations } = useOrganization({
  invitations: {
    infinite: true,
  },
})

----------------------------------------

TITLE: Basic Organization Membership List Retrieval
DESCRIPTION: Basic example of retrieving organization memberships for a user using the Clerk Backend SDK.

LANGUAGE: tsx
CODE:
const userId = 'user_123'

const response = await clerkClient.users.getOrganizationMembershipList({ userId })

----------------------------------------

TITLE: Rendering Clerk SVG Icon with Dynamic Fill
DESCRIPTION: This snippet defines an SVG icon for the Clerk project. It uses a viewBox of 20x20 and includes two path elements to create the icon shape. The fill color is dynamically set using a CSS variable that changes based on light or dark mode.

LANGUAGE: SVG
CODE:
<svg viewBox="0 0 20 20" style={{ fill: 'var(--light, black) var(--dark, white)' }}>
  <path d="M6.504 7.181c1.47 0 1.812 1.29 1.812 2.108H4.5c.103-.906.683-2.108 2.004-2.108Z" />

  <path
    fillRule="evenodd"
    d="M10 20a10 10 0 1 0 0-20 10 10 0 0 0 0 20Zm-3.05-7.291c-1.321 0-2.438-.728-2.464-2.492l5.032.013c.04-.2.062-.405.058-.61 0-1.32-.621-3.37-2.955-3.37-2.109 0-3.385 1.737-3.385 3.875 0 2.137 1.328 3.625 3.535 3.625a5.738 5.738 0 0 0 2.39-.475l-.223-.938a4.65 4.65 0 0 1-1.988.372Zm5.833-4.78L11.759 6.4h-1.455l2.437 3.505-2.555 3.666h1.439l1.04-1.604a26.7 26.7 0 0 1 .261-.425c.171-.274.336-.538.494-.837h.031l.023.037c.245.413.479.807.75 1.225l1.067 1.604h1.471L14.238 9.86l2.45-3.46h-1.425l-.995 1.514c-.096.157-.194.312-.293.47-.146.231-.294.465-.435.704h-.03l-.165-.273c-.176-.291-.35-.58-.563-.887Z"
  />
</svg>

----------------------------------------

TITLE: Defining Custom JWT Claims in TypeScript
DESCRIPTION: Example showing how to override the CustomJwtSessionClaims interface globally to add custom fields like firstName, primaryEmail, and metadata with onboarding status.

LANGUAGE: typescript
CODE:
export {}

declare global {
  interface CustomJwtSessionClaims {
    firstName?: string
    primaryEmail?: string
    metadata: {
      onboardingComplete?: boolean
    }
  }
}

----------------------------------------

TITLE: Signing Out with Clerk in Playwright Tests
DESCRIPTION: Shows how to use the clerk.signOut() function to log out a user in a Playwright test. It includes signing in, accessing a protected page, signing out, and then attempting to access the protected page again.

LANGUAGE: typescript
CODE:
import { clerk } from '@clerk/testing/playwright'

test('sign out', async ({ page }) => {
  // Navigate to an unprotected page that loads Clerk
  await page.goto('/')

  await clerk.signIn({
    page,
    signInParams: { strategy: 'phone_code', identifier: '+15555550100' },
  })

  await page.goto('/protected')
  await clerk.signOut({ page })
  await page.goto('/protected')
  // should redirect to sign in page
})

----------------------------------------

TITLE: Opening CreateOrganization Overlay with JavaScript
DESCRIPTION: Example of opening the CreateOrganization component as an overlay using JavaScript. The Clerk instance's openCreateOrganization method is used to display the component.

LANGUAGE: js
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="create-organization"></div>
`

const createOrgDiv = document.getElementById('create-organization')

clerk.openCreateOrganization(createOrgDiv)

----------------------------------------

TITLE: Installing Dependencies for Biometric Authentication
DESCRIPTION: Commands for installing required peer dependencies expo-local-authentication and expo-secure-store using different package managers.

LANGUAGE: bash
CODE:
npm install expo-local-authentication expo-secure-store

LANGUAGE: bash
CODE:
yarn add expo-local-authentication expo-secure-store

LANGUAGE: bash
CODE:
pnpm add expo-local-authentication expo-secure-store

LANGUAGE: bash
CODE:
bun add expo-local-authentication expo-secure-store

----------------------------------------

TITLE: Implementing OAuth Sign-In/Sign-Up with Expo
DESCRIPTION: This snippet demonstrates how to create a custom OAuth sign-in and sign-up flow using Clerk in an Expo application. It uses the useSSO hook to start the SSO flow and handle authentication.

LANGUAGE: tsx
CODE:
import React, { useCallback, useEffect } from 'react'
import * as WebBrowser from 'expo-web-browser'
import * as AuthSession from 'expo-auth-session'
import { useSSO } from '@clerk/clerk-expo'
import { View, Button } from 'react-native'

export const useWarmUpBrowser = () => {
  useEffect(() => {
    // Preloads the browser for Android devices to reduce authentication load time
    // See: https://docs.expo.dev/guides/authentication/#improving-user-experience
    void WebBrowser.warmUpAsync()
    return () => {
      // Cleanup: closes browser when component unmounts
      void WebBrowser.coolDownAsync()
    }
  }, [])
}

// Handle any pending authentication sessions
WebBrowser.maybeCompleteAuthSession()

export default function Page() {
  useWarmUpBrowser()

  // Use the `useSSO()` hook to access the `startSSOFlow()` method
  const { startSSOFlow } = useSSO()

  const onPress = useCallback(async () => {
    try {
      // Start the authentication process by calling `startSSOFlow()`
      const { createdSessionId, setActive, signIn, signUp } = await startSSOFlow({
        strategy: 'oauth_google',
        // For web, defaults to current path
        // For native, you must pass a scheme, like AuthSession.makeRedirectUri({ scheme, path })
        // For more info, see https://docs.expo.dev/versions/latest/sdk/auth-session/#authsessionmakeredirecturioptions
        redirectUrl: AuthSession.makeRedirectUri(),
      })

      // If sign in was successful, set the active session
      if (createdSessionId) {
        setActive!({ session: createdSessionId })
      } else {
        // If there is no `createdSessionId`,
        // there are missing requirements, such as MFA
        // Use the `signIn` or `signUp` returned from `startSSOFlow`
        // to handle next steps
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }, [])

  return (
    <View>
      <Button title="Sign in with Google" onPress={onPress} />
    </View>
  )
}

----------------------------------------

TITLE: Defining SessionStatus Type in TypeScript
DESCRIPTION: Type definition for SessionStatus, which enumerates possible states of a session including 'abandoned', 'active', 'ended', 'expired', 'removed', 'replaced', and 'revoked'.

LANGUAGE: typescript
CODE:
type SessionStatus =
  | 'abandoned'
  | 'active'
  | 'ended'
  | 'expired'
  | 'removed'
  | 'replaced'
  | 'revoked'

----------------------------------------

TITLE: Deleting Phone Numbers with Clerk Backend SDK - Usage Example
DESCRIPTION: Example usage of the deletePhoneNumber method from the Clerk Backend SDK. Demonstrates how to delete a phone number using its ID.

LANGUAGE: tsx
CODE:
const phoneNumberId = 'idn_123'

const response = await clerkClient.phoneNumbers.deletePhoneNumber(phoneNumberId)

----------------------------------------

TITLE: Implementing Vue.js Logo in SVG
DESCRIPTION: SVG markup that creates the Vue.js logo using two path elements. The first path creates the outer green triangle while the second path creates the inner dark gray triangle, together forming the distinctive Vue.js logo design.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 196.32 170.02">
  <path fill="#42b883" d="M120.83 0L98.16 39.26 75.49 0H0l98.16 170.02L196.32 0h-75.49z" />

  <path fill="#35495e" d="M120.83 0L98.16 39.26 75.49 0H39.26l58.9 102.01L157.06 0h-36.23z" />
</svg>

----------------------------------------

TITLE: Configuring Request Authentication
DESCRIPTION: Example demonstrating how to set authorized parties when authenticating requests using ClerkClient

LANGUAGE: typescript
CODE:
clerkClient.authenticateRequest(req, {
  authorizedParties: ['https://example.com'],
})

----------------------------------------

TITLE: Installing React Dependencies
DESCRIPTION: Commands to install the latest versions of React and React DOM using different package managers.

LANGUAGE: bash
CODE:
npm install react@latest react-dom@latest

LANGUAGE: bash
CODE:
yarn add react@latest react-dom@latest

LANGUAGE: bash
CODE:
pnpm add react@latest react-dom@latest

LANGUAGE: bash
CODE:
bun add react@latest react-dom@latest

----------------------------------------

TITLE: Handling Basic Reverification Flow in React
DESCRIPTION: Demonstrates how to implement basic reverification handling in a React component using the useReverification hook. Shows how to handle cases where users cancel the reverification process.

LANGUAGE: tsx
CODE:
import { useReverification } from '@clerk/react'

export function MyButton() {
  const [enhancedFetcher] = useReverification(myFetcher)

  const handleClick = async () => {
    const myData = await enhancedFetcher()
    // If `myData` is null, the user canceled the reverification process
    // You can choose how your app responds. This example returns null.
    if (!myData) return
  }

  return <button onClick={handleClick}>Update User</button>
}

----------------------------------------

TITLE: Managing Stored Credentials
DESCRIPTION: Component for managing stored biometric credentials, including the ability to remove stored credentials for the current user.

LANGUAGE: tsx
CODE:
import { useUser, useClerk } from '@clerk/clerk-expo'
import { useLocalCredentials } from '@clerk/clerk-expo/local-credentials'
import { View, Text, Button } from 'react-native'

export default function Page() {
  const { user } = useUser()
  const { signOut } = useClerk()

  const { userOwnsCredentials, clearCredentials } = useLocalCredentials()

  return (
    <View>
      <Text>Settings, {user?.emailAddresses[0].emailAddress}</Text>
      <Button title="Sign out" onPress={() => signOut()} />
      {userOwnsCredentials && (
        <Button title="Remove biometric credentials" onPress={() => clearCredentials()} />
      )}
    </View>
  )

----------------------------------------

TITLE: Implementing Python Logo using SVG with Gradients
DESCRIPTION: SVG vector implementation of the Python logo using two main paths with custom gradient definitions. The first path represents the bottom snake in blue tones, while the second path represents the top snake in yellow tones. Includes definitions for two linear gradients that provide the characteristic Python logo coloring.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 112 114" height="114" fill="none">
  <path
    fill="url(#python-logo-gradient-1)"
    d="M55.333 0c-4.618.022-9.029.416-12.91 1.103-11.43 2.02-13.507 6.247-13.507 14.043V25.44h27.015v3.432H18.778c-7.851 0-14.726 4.72-16.876 13.697-2.48 10.29-2.59 16.71 0 27.455 1.92 7.998 6.506 13.696 14.357 13.696h9.288V71.38c0-8.917 7.715-16.782 16.877-16.782h26.983c7.511 0 13.508-6.184 13.508-13.728V15.146c0-7.322-6.177-12.821-13.508-14.043C64.767.33 59.951-.021 55.333 0Zm-14.61 8.282c2.791 0 5.07 2.316 5.07 5.163 0 2.838-2.279 5.133-5.07 5.133-2.8 0-5.069-2.295-5.069-5.133 0-2.847 2.27-5.163 5.07-5.163Z"
  />

  <path
    fill="url(#python-logo-gradient-2)"
    d="M86.284 28.873V40.87c0 9.3-7.885 17.128-16.876 17.128H42.424c-7.39 0-13.507 6.326-13.507 13.728v25.723c0 7.322 6.366 11.628 13.507 13.728 8.552 2.515 16.752 2.969 26.984 0 6.8-1.969 13.507-5.932 13.507-13.728V87.154H55.932v-3.432h40.49c7.852 0 10.777-5.477 13.508-13.697 2.82-8.462 2.7-16.6 0-27.455-1.941-7.816-5.646-13.697-13.508-13.697H86.284ZM71.108 94.018c2.8 0 5.07 2.294 5.07 5.132 0 2.847-2.27 5.163-5.07 5.163-2.79 0-5.07-2.316-5.07-5.163 0-2.838 2.28-5.133 5.07-5.133Z"
  />

  <defs>
    <linearGradient
      id="python-logo-gradient-1"
      x1="0"
      x2="62.293"
      y1="0"
      y2="53.082"
      gradientUnits="userSpaceOnUse"
    >
      <stop stopColor="#5A9FD4" />

      <stop offset="1" stopColor="#306998" />
    </linearGradient>

    <linearGradient
      id="python-logo-gradient-2"
      x1="70.459"
      x2="48.11"
      y1="98.284"
      y2="66.967"
      gradientUnits="userSpaceOnUse"
    >
      <stop stopColor="#FFD43B" />

      <stop offset="1" stopColor="#FFE873" />
    </linearGradient>
  </defs>
</svg>

----------------------------------------

TITLE: Retrieving Sessions for a User in TypeScript
DESCRIPTION: Example of using getSessionList to retrieve sessions for a specific user ID. This demonstrates basic usage of the function.

LANGUAGE: typescript
CODE:
const userId = 'user_123'

const response = await clerkClient.sessions.getSessionList({ userId })

----------------------------------------

TITLE: Implementing $sessionStore in Svelte
DESCRIPTION: Svelte component using $sessionStore (aliased to avoid conflicts with Svelte's reactivity system) to display session information with conditional rendering.

LANGUAGE: svelte
CODE:
<script>
  // The $ prefix is reserved in Svelte for its own reactivity system.
  // Alias the imports to avoid conflicts.
  import { $sessionStore as session } from '@clerk/astro/client'
</script>

{#if $session === undefined}
  <!-- Add logic to handle loading state -->
{:else if $session === null}
  <!-- Add logic to handle not signed in state -->
{:else}
  <div>
    <p>This session has been active since {$session.lastActiveAt.toLocaleString()}</p>
  </div>
{/if}

----------------------------------------

TITLE: Configuring Clerk Middleware for Onboarding Flow in Next.js
DESCRIPTION: Next.js middleware configuration using Clerk to handle authentication and onboarding flow. It redirects users based on their authentication and onboarding status.

LANGUAGE: typescript
CODE:
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'
import { NextRequest, NextResponse } from 'next/server'

const isOnboardingRoute = createRouteMatcher(['/onboarding'])
const isPublicRoute = createRouteMatcher(['/public-route-example'])

export default clerkMiddleware(async (auth, req: NextRequest) => {
  const { userId, sessionClaims, redirectToSignIn } = await auth()

  // For users visiting /onboarding, don't try to redirect
  if (userId && isOnboardingRoute(req)) {
    return NextResponse.next()
  }

  // If the user isn't signed in and the route is private, redirect to sign-in
  if (!userId && !isPublicRoute(req)) return redirectToSignIn({ returnBackUrl: req.url })

  // Catch users who do not have `onboardingComplete: true` in their publicMetadata
  // Redirect them to the /onboarding route to complete onboarding
  if (userId && !sessionClaims?.metadata?.onboardingComplete) {
    const onboardingUrl = new URL('/onboarding', req.url)
    return NextResponse.redirect(onboardingUrl)
  }

  // If the user is logged in and the route is protected, let them view.
  if (userId && !isPublicRoute(req)) return NextResponse.next()
})

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}

----------------------------------------

TITLE: Implementing Enterprise SSO Authentication with Expo
DESCRIPTION: Expo implementation of enterprise SSO authentication using Clerk's useSSO hook. Includes browser warm-up optimization and handles both sign-up and sign-in flows with proper session management.

LANGUAGE: typescript
CODE:
import React, { useEffect, useState } from 'react'
import * as WebBrowser from 'expo-web-browser'
import * as AuthSession from 'expo-auth-session'
import { useSSO } from '@clerk/clerk-expo'
import { View, Button, TextInput } from 'react-native'

export const useWarmUpBrowser = () => {
  useEffect(() => {
    void WebBrowser.warmUpAsync()
    return () => {
      void WebBrowser.coolDownAsync()
    }
  }, [])
}

WebBrowser.maybeCompleteAuthSession()

export default function Page() {
  useWarmUpBrowser()

  const [email, setEmail] = useState('')
  const { startSSOFlow } = useSSO()

  const onPress = async () => {
    try {
      const { createdSessionId, setActive, signIn, signUp } = await startSSOFlow({
        strategy: 'enterprise_sso',
        identifier: email,
        redirectUrl: AuthSession.makeRedirectUri(),
      })

      if (createdSessionId) {
        setActive!({ session: createdSessionId })
      }
    } catch (err) {
      console.error(JSON.stringify(err, null, 2))
    }
  }

  return (
    <View>
      <TextInput
        value={email}
        onChangeText={setEmail}
        placeholder="Enter email"
        placeholderTextColor="#666666"
      />
      <Button title="Sign in with SAML" onPress={onPress} />
    </View>
  )
}

----------------------------------------

TITLE: Installing Dependencies for Next.js and React
DESCRIPTION: Commands to install the latest version of Clerk dependencies for Next.js and React/Redwood frameworks.

LANGUAGE: sh
CODE:
npm install @clerk/nextjs@latest

LANGUAGE: sh
CODE:
npm install @clerk/clerk-react@latest

----------------------------------------

TITLE: Retrieving Session List with useSessionList() in React
DESCRIPTION: This snippet demonstrates how to use the useSessionList() hook in a React component to retrieve and display the number of user sessions.

LANGUAGE: tsx
CODE:
import { useSessionList } from '@clerk/clerk-react'

export default function Home() {
  const { isLoaded, sessions } = useSessionList()

  if (!isLoaded) {
    // Handle loading state
    return null
  }

  return (
    <div>
      <p>Welcome back. You've been here {sessions.length} times before.</p>
    </div>
  )
}

----------------------------------------

TITLE: Configuring Clerk Environment Variables for SSR Mode
DESCRIPTION: This snippet demonstrates how to set up environment variables for Clerk in SSR mode. It includes settings for the sign-up URL and fallback redirect URLs for both sign-up and sign-in.

LANGUAGE: env
CODE:
CLERK_SIGN_UP_URL=/sign-up
CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/
CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/

----------------------------------------

TITLE: Chrome Logo SVG Implementation
DESCRIPTION: Complete SVG markup for the Google Chrome browser logo. Uses linear gradients for the three main color segments (green, yellow, red) and defines paths for the circular structure. The logo consists of a white background circle, three colored segments, and a blue center circle.

LANGUAGE: svg
CODE:
<svg viewBox="0 0 63 63" fill="none">
  <linearGradient id="chrome-logo-a" x1="34.909" x2="7.632" y1="61.029" y2="13.785" gradientUnits="userSpaceOnUse">
    <stop offset="0" stopColor="#1e8e3e" />

    <stop offset="1" stopColor="#34a853" />
  </linearGradient>

  <linearGradient id="chrome-logo-b" x1="26.904" x2="54.181" y1="63.079" y2="15.835" gradientUnits="userSpaceOnUse">
    <stop offset="0" stopColor="#fcc934" />

    <stop offset="1" stopColor="#fbbc04" />
  </linearGradient>

  <linearGradient id="chrome-logo-c" x1="4.221" x2="58.775" y1="19.688" y2="19.688" gradientUnits="userSpaceOnUse">
    <stop offset="0" stopColor="#d93025" />

    <stop offset="1" stopColor="#ea4335" />
  </linearGradient>

  <path
    fill="#fff"
    d="M31.499 47.247c8.698 0 15.75-7.052 15.75-15.75s-7.052-15.75-15.75-15.75-15.75 7.051-15.75 15.75 7.051 15.75 15.75 15.75z"
  />

  <path
    fill="url(#chrome-logo-a)"
    d="M17.86 39.375 4.22 15.754a31.492 31.492 0 0 0 27.28 47.242l13.638-23.62v-.005a15.746 15.746 0 0 1-27.28.004z"
  />

  <path
    fill="url(#chrome-logo-b)"
    d="M45.138 39.374 31.5 62.995A31.491 31.491 0 0 0 58.773 15.75H31.498l-.003.002a15.747 15.747 0 0 1 13.643 23.623z"
  />

  <path
    fill="#1a73e8"
    d="M31.499 43.969c6.886 0 12.469-5.583 12.469-12.469s-5.583-12.469-12.469-12.469S19.03 24.614 19.03 31.5 24.613 43.969 31.5 43.969z"
  />

  <path
    fill="url(#chrome-logo-c)"
    d="M31.5 15.75h27.274a31.493 31.493 0 0 0-54.553.004L17.86 39.375l.004.002A15.747 15.747 0 0 1 31.499 15.75z"
  />
</svg>

----------------------------------------

TITLE: Basic Usage of getOrganizationInvitationList in TypeScript
DESCRIPTION: Demonstrates the basic usage of getOrganizationInvitationList function to retrieve organization invitations. It requires an organizationId parameter.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const response = await clerkClient.organizations.getOrganizationInvitationList({ organizationId })

----------------------------------------

TITLE: Accessing Organization Data with $organizationStore in React
DESCRIPTION: This snippet demonstrates how to use the $organizationStore store in a React component to access the current active organization's attributes. It handles loading and null states, and displays the organization name when available.

LANGUAGE: tsx
CODE:
import { useStore } from '@nanostores/react'
import { $organizationStore } from '@clerk/astro/client'

export default function Home() {
  const organization = useStore($organizationStore)

  if (organization === undefined) {
    // Add logic to handle loading state
    return null
  }

  if (organization === null) {
    // Add logic to handle no active organization state
    return null
  }

  return (
    <div>
      <p>This current organization is {organization.name}</p>
    </div>
  )
}

----------------------------------------

TITLE: Configuring Webpack in Next.js Config
DESCRIPTION: Webpack configuration in next.config.js to ignore unused Next.js modules for compatibility with older versions. This configuration prevents loading of modules specific to newer Next.js versions.

LANGUAGE: javascript
CODE:
const webpack = require('webpack')

/** @type {import('next').NextConfig} */
const nextConfig = {
  webpack(config) {
    config.plugins.push(
      new webpack.IgnorePlugin({
        resourceRegExp: /^next\/(navigation|headers|compat\/router)$/,
      }),
    )
    return config
  },
}

module.exports = nextConfig

----------------------------------------

TITLE: Conditionally Rendering Menu Items in UserButton for Next.js
DESCRIPTION: This example demonstrates how to conditionally render menu items in the UserButton component based on user permissions in a Next.js application.

LANGUAGE: tsx
CODE:
'use client'

import { UserButton, useAuth } from '@clerk/nextjs'

const DotIcon = () => {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
      <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512z" />
    </svg>
  )
}

export default function Home() {
  const { has, isLoaded } = useAuth()

  if (!isLoaded) {
    return <span>Loading...</span>
  }

  const isAdmin = has({ permission: 'org:app:admin' })

  return (
    <header>
      <UserButton>
        {isAdmin && (
          <UserButton.MenuItems>
            <UserButton.Link
              label="Create organization"
              labelIcon={<DotIcon />}
              href="/create-organization"
            />
          </UserButton.MenuItems>
        )}
      </UserButton>
    </header>
  )
}

----------------------------------------

TITLE: Verifying Email Address with Clerk in Next.js
DESCRIPTION: This component handles the email verification process. It uses the useClerk hook to access the handleEmailLinkVerification method, which is called to verify the email address. The component also handles various verification statuses and error cases.

LANGUAGE: tsx
CODE:
'use client'

import * as React from 'react'
import { useClerk } from '@clerk/nextjs'
import { EmailLinkErrorCode, isEmailLinkError } from '@clerk/nextjs/errors'
import Link from 'next/link'

export type VerificationStatus =
  | 'expired'
  | 'failed'
  | 'loading'
  | 'verified'
  | 'verified_switch_tab'
  | 'client_mismatch'

export default function VerifyEmailLink() {
  const [verificationStatus, setVerificationStatus] = React.useState('loading')

  const { handleEmailLinkVerification, loaded } = useClerk()

  async function verify() {
    try {
      await handleEmailLinkVerification({})
      setVerificationStatus('verified')
    } catch (err: any) {
      let status: VerificationStatus = 'failed'

      if (isEmailLinkError(err)) {
        // If link expired, set status to expired
        if (err.code === EmailLinkErrorCode.Expired) {
          status = 'expired'
        } else if (err.code === EmailLinkErrorCode.ClientMismatch) {
          // OPTIONAL: This check is only required if you have
          // the 'Require the same device and browser' setting
          // enabled in the Clerk Dashboard
          status = 'client_mismatch'
        }
      }

      setVerificationStatus(status)
      return
    }
  }

  React.useEffect(() => {
    if (!loaded) return

    verify()
  }, [handleEmailLinkVerification, loaded])

  if (verificationStatus === 'loading') {
    return <div>Loading...</div>
  }

  if (verificationStatus === 'failed') {
    return (
      <div>
        <h1>Verify your email</h1>
        <p>The email link verification failed.</p>
        <Link href="/account/add-email">Return to add email</Link>
      </div>
    )
  }

  if (verificationStatus === 'expired') {
    return (
      <div>
        <h1>Verify your email</h1>
        <p>The email link has expired.</p>
        <Link href="/account/add-email">Return to add email</Link>
      </div>
    )
  }

  // OPTIONAL: This check is only required if you have
  // the 'Require the same device and browser' setting
  // enabled in the Clerk Dashboard
  if (verificationStatus === 'client_mismatch') {
    return (
      <div>
        <h1>Verify your email</h1>
        <p>
          You must complete the email link verification on the same device and browser as you
          started it on.
        </p>
        <Link href="/account/add-email">Return to add email</Link>
      </div>
    )
  }

  return (
    <div>
      <h1>Verify your email</h1>
      <p>Successfully added email!</p>
    </div>
  )
}

----------------------------------------

TITLE: Configuring Root Authentication Options in Remix
DESCRIPTION: Advanced implementation of rootAuthLoader that includes both a callback function and configuration options for customizing authentication behavior.

LANGUAGE: tsx
CODE:
// Your imports

export const loader: LoaderFunction = (args) => {
  return rootAuthLoader(
    args,
    ({ req }) => {
      const { sessionId, userId, getToken } = req.auth
      // Add logic to fetch data
      return { yourData: 'here' }
    },
    {
      signInForceRedirectUrl: '/dashboard',
    },
  )
}

// The rest of your code

----------------------------------------

TITLE: Setting Clerk Environment Variables
DESCRIPTION: This snippet shows the necessary environment variables to configure Clerk's sign-up and sign-in behavior in a Next.js application. It sets the sign-up URL and fallback redirect URLs for sign-up and sign-in.

LANGUAGE: env
CODE:
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/
NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/

----------------------------------------

TITLE: Defining Clerk Logo SVG with Dynamic Colors
DESCRIPTION: This SVG code defines the Clerk logo with two main paths and a gradient definition. It uses dynamic color filling based on light/dark themes and includes a linear gradient for a portion of the logo.

LANGUAGE: SVG
CODE:
<svg viewBox="0 0 95 107">
  <path
    fill="url(#d59103f7)"
    d="M32.589 91.136c-4.834-4.418-6.245-13.703-4.231-20.429 3.492 4.24 8.33 5.584 13.342 6.343 7.737 1.17 15.335.732 22.523-2.804.822-.405 1.582-.944 2.48-1.489.675 1.957.85 3.932.615 5.942-.573 4.897-3.01 8.679-6.885 11.546-1.55 1.146-3.19 2.171-4.79 3.253-4.917 3.323-6.248 7.22-4.4 12.888.044.139.083.277.183.614-2.51-1.124-4.345-2.76-5.742-4.911-1.476-2.27-2.178-4.781-2.215-7.498-.018-1.323-.018-2.657-.196-3.96-.434-3.178-1.926-4.602-4.737-4.683-2.885-.085-5.166 1.699-5.772 4.507-.046.216-.113.428-.18.679l.005.002Z"
  />

  <path
    style={{ fill: 'var(--light, #17191E) var(--dark, white)' }}
    d="M5 69.587s14.314-6.973 28.668-6.973L44.49 29.12c.405-1.62 1.588-2.72 2.924-2.72 1.335 0 2.518 1.1 2.924 2.72L61.16 62.614c17 0 28.668 6.973 28.668 6.973S65.514 3.352 65.467 3.219C64.769 1.261 63.591 0 62.003 0H32.827c-1.588 0-2.718 1.261-3.464 3.22C29.311 3.35 5 69.586 5 69.586Z"
  />

  <defs>
    <linearGradient id="d59103f7" x1="27.47" x2="74.145" y1="107" y2="84.947" gradientUnits="userSpaceOnUse">
      <stop stopColor="#D83333" />

      <stop offset="1" stopColor="#F041FF" />
    </linearGradient>
  </defs>
</svg>

----------------------------------------

TITLE: Using getOrganizationInvitation Function with Clerk Backend SDK in TypeScript
DESCRIPTION: Example of using the getOrganizationInvitation function from the Clerk Backend SDK. It demonstrates how to retrieve an organization invitation by providing the organization ID and invitation ID.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const invitationId = 'orginv_123'

const response = await clerkClient.organizations.getOrganizationInvitation({
  organizationId,
  invitationId,
})

----------------------------------------

TITLE: Server-side Rendering with Dynamic Control Components in Astro
DESCRIPTION: Example of server-side rendering a page using Clerk's SignedIn component with isStatic={false} in hybrid output mode.

LANGUAGE: astro
CODE:
---
export const prerender = false
---

<SignedIn isStatic={false}> You are signed in! </SignedIn>

----------------------------------------

TITLE: Running the Clerk upgrade CLI tool
DESCRIPTION: Command to run the @clerk/upgrade CLI tool to assist with the upgrade process.

LANGUAGE: bash
CODE:
npx @clerk/upgrade --from=core-1

----------------------------------------

TITLE: Implementing Localization in Remix
DESCRIPTION: Demonstrates how to import and use a localization (French) with the ClerkApp in a Remix application.

LANGUAGE: typescript
CODE:
import type { MetaFunction, LoaderFunction } from '@remix-run/node'
import { Links, Meta, Outlet, Scripts, ScrollRestoration } from '@remix-run/react'
import { rootAuthLoader } from '@clerk/remix/ssr.server'
// Import ClerkApp
import { ClerkApp } from '@clerk/remix'
// fr-FR locale is imported as frFR
import { frFR } from '@clerk/localizations'

export const meta: MetaFunction = () => [
  {
    charset: 'utf-8',
    title: 'New Remix App',
    viewport: 'width=device-width,initial-scale=1',
  },
]

export const loader: LoaderFunction = (args) => rootAuthLoader(args)

export function Layout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <head>
        <Meta />
        <Links />
      </head>
      <body>
        {children}
        <ScrollRestoration />
        <Scripts />
      </body>
    </html>
  )
}

function App() {
  return <Outlet />
}

export default ClerkApp(App, {
  localization: frFR,
})

----------------------------------------

TITLE: Permission Checking Method Reference
DESCRIPTION: Reference to the has() method usage for checking permissions on server-side, noting that it only works with custom permissions and not system permissions. For system permissions, role verification is required instead.

LANGUAGE: text
CODE:
has()

----------------------------------------

TITLE: Rendering Clerk SignUp Component in Remix
DESCRIPTION: This snippet shows how to create a dedicated sign-up page in a Remix application using Clerk's SignUp component. It uses Remix's optional route feature.

LANGUAGE: tsx
CODE:
import { SignUp } from '@clerk/remix'

export default function Page() {
  return <SignUp />
}

----------------------------------------

TITLE: Implementing ClerkProvider with Sync Host in React
DESCRIPTION: React component implementation showing ClerkProvider setup with sync host configuration and routing integration.

LANGUAGE: tsx
CODE:
import { ClerkProvider, SignedIn, SignedOut, UserButton } from '@clerk/chrome-extension'
import { Link, Outlet, useNavigate } from 'react-router-dom'

const PUBLISHABLE_KEY = process.env.PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY
const SYNC_HOST = process.env.PLASMO_PUBLIC_CLERK_SYNC_HOST

if (!PUBLISHABLE_KEY || !SYNC_HOST) {
  throw new Error(
    'Please add the PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY and PLASMO_PUBLIC_CLERK_SYNC_HOST to the .env.development file',
  )
}

export const RootLayout = () => {
  const navigate = useNavigate()

  return (
    <ClerkProvider
      routerPush={(to) => navigate(to)}
      routerReplace={(to) => navigate(to, { replace: true })}
      publishableKey={PUBLISHABLE_KEY}
      afterSignOutUrl="/"
      syncHost={SYNC_HOST}
    >
      <div className="plasmo-w-[785px] plasmo-h-[600px]">
        <main>
          <Outlet />
        </main>
        <footer>
          <SignedIn>
            <Link to="/settings">Settings</Link>
            <UserButton />
          </SignedIn>
          <SignedOut>
            <Link to="/">Home</Link>
            <Link to="/sign-in">Sign In</Link>
            <Link to="/sign-up">Sign Up</Link>
          </SignedOut>
        </footer>
      </div>
    </ClerkProvider>
  )

----------------------------------------

TITLE: Rendering OrganizationProfile in Next.js
DESCRIPTION: Example of using the <OrganizationProfile /> component in a Next.js application using an optional catch-all route.

LANGUAGE: jsx
CODE:
import { OrganizationProfile } from '@clerk/nextjs'

export default function OrganizationProfilePage() {
  return <OrganizationProfile />
}

----------------------------------------

TITLE: Limiting Results in getInvitationList Query
DESCRIPTION: Demonstrates how to limit the number of results returned by getInvitationList using the 'limit' parameter. This example retrieves the first 10 revoked invitations.

LANGUAGE: tsx
CODE:
const { data, totalCount } = await clerkClient.invitations.getInvitationList({
  status: 'revoked',
  // returns the first 10 results
  limit: 10,
})

----------------------------------------

TITLE: Implementing Root Authentication Loader
DESCRIPTION: Configuration of the root authentication loader in root.tsx to provide authentication state

LANGUAGE: typescript
CODE:
import type { MetaFunction, LoaderFunction } from '@remix-run/node'
import { Links, Meta, Outlet, Scripts, ScrollRestoration } from '@remix-run/react'

// Import `rootAuthLoader()`
import { rootAuthLoader } from '@clerk/remix/ssr.server'

export const meta: MetaFunction = () => [
  {
    charset: 'utf-8',
    title: 'New Remix App',
    viewport: 'width=device-width,initial-scale=1',
  },
]

// Export `rootAuthLoader()` as the root route `loader`
export const loader: LoaderFunction = (args) => rootAuthLoader(args)

export function Layout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <head>
        <Meta />
        <Links />
      </head>
      <body>
        {children}
        <ScrollRestoration />
        <Scripts />
      </body>
    </html>
  )
}

export default function App() {
  return <Outlet />
}

----------------------------------------

TITLE: Updating Organization Creation Method
DESCRIPTION: Example of changing the Organization.create method to use an object parameter instead of a string.

LANGUAGE: javascript
CODE:
Organization.create({ name: '...' })

----------------------------------------

TITLE: Continue Step Implementation
DESCRIPTION: Demonstrates the continue step implementation for collecting additional required fields like username during sign-up.

LANGUAGE: tsx
CODE:
<SignUp.Step name="continue">
  <Clerk.Field name="username">
    <Clerk.Label>Username</Clerk.Label>
    <Clerk.Input />
    <Clerk.FieldError />
  </Clerk.Field>

  <SignUp.Action submit>Sign up</SignUp.Action>
</SignUp.Step>

----------------------------------------

TITLE: Defining Clerk Logo SVG
DESCRIPTION: This SVG code defines the Clerk logo using multiple path elements. It creates a stylized character face with various shapes and colors, including eyes, mouth, and decorative elements.

LANGUAGE: SVG
CODE:
<svg viewBox="0 0 32 32" fill="none">
  <path
    fill="#384E54"
    d="M24.93 7.577c-.972-1.721-.27-3.958 1.567-4.995 1.837-1.038 4.115-.484 5.087 1.238.972 1.721.27 3.958-1.567 4.995-1.838 1.038-4.115.483-5.087-1.238ZM7.164 7.577c.972-1.721.27-3.958-1.567-4.995C3.759 1.544 1.482 2.098.51 3.82-.462 5.54.24 7.778 2.077 8.815c1.838 1.038 4.115.483 5.087-1.238Z"
  />

  <path
    fill="#384E54"
    d="M16.092 1.002c-1.106.01-2.21.049-3.316.09C6.842 1.312 2 6.032 2 12v20h28V12c0-5.968-4.667-10.491-10.59-10.908a42.248 42.248 0 0 0-3.318-.09Z"
  />

  <path
    fill="#76E1FE"
    d="M4.608 4.683c.46.26 1.818 1.202 1.981 1.649.183.503.16 1.065-.115 1.55-.346.614-1.005.95-1.696.937-.34-.01-1.72-.637-2.043-.82-.977-.551-1.35-1.74-.833-2.657.517-.916 1.728-1.21 2.706-.659Z"
  />

  <path
    fill="#000"
    fillOpacity=".329"
    d="M16.869 15.321H15.03a.624.624 0 0 0-.625.625v2.282c0 .345.28.625.624.625h1.839c.344 0 .624-.28.624-.625v-2.282a.624.624 0 0 0-.624-.625Z"
  />

  <path fill="#76E1FE" d="M16 3C7 3 4 6.715 4 12v20h24c-.049-7.356 0-18 0-20 0-5.285-3-9-12-9Z" />

  <path
    fill="#76E1FE"
    d="M27.074 4.683c-.46.26-1.819 1.202-1.981 1.649a1.848 1.848 0 0 0 .114 1.55c.347.614 1.006.95 1.697.937.34-.01 1.72-.637 2.042-.82.978-.551 1.351-1.74.834-2.657-.517-.916-1.729-1.21-2.706-.659Z"
  />

  <path
    fill="#fff"
    d="M21.176 14.645a4.654 4.654 0 1 0 0-9.307 4.654 4.654 0 0 0 0 9.307ZM10.34 14.823a4.832 4.832 0 1 0 0-9.663 4.832 4.832 0 0 0 0 9.663Z"
  />

  <path
    fill="#000"
    fillOpacity=".329"
    d="M17.058 15.555h-2.216c-.4 0-.726.325-.726.726v2.654c0 .401.325.726.726.726h2.216c.4 0 .726-.325.726-.726v-2.654c0-.401-.325-.726-.726-.726Z"
  />

  <path
    fill="#FFFCFB"
    d="M17.058 14.862h-2.216c-.4 0-.726.325-.726.726v2.655c0 .4.325.726.726.726h2.216c.4 0 .726-.325.726-.726v-2.655c0-.4-.325-.726-.726-.726Z"
  />

  <path
    fill="#000"
    fillOpacity=".329"
    d="M20 16.166c0 .838-.872 1.268-2.145 1.166-.024 0-.048-.6-.255-.583-.503.042-1.095-.02-1.686-.02-.612 0-1.206.183-1.685.017-.11-.038-.178.584-.261.582-1.244-.034-2.08-.339-2.08-1.162 0-1.212 1.816-2.194 4.056-2.194s4.055.982 4.055 2.194Z"
  />

  <path
    fill="#C38C74"
    d="M19.977 15.338c0 .568-.433.855-1.138 1-.292.06-.63.096-1.004.116-.564.032-1.207.031-1.89.031-.674 0-1.308 0-1.866-.029a8.216 8.216 0 0 1-.843-.084c-.814-.131-1.325-.417-1.325-1.034 0-1.16 1.806-2.1 4.033-2.1 2.228 0 4.033.94 4.033 2.1Z"
  />

  <path
    fill="#23201F"
    d="M15.944 14.831c1.15 0 2.08-.602 2.08-1.344 0-.742-.93-1.343-2.08-1.343-1.148 0-2.08.601-2.08 1.343s.932 1.344 2.08 1.344Z"
  />

  <path
    fill="#171311"
    d="M12.414 11.954a1.963 1.963 0 1 0 0-3.926 1.963 1.963 0 0 0 0 3.926ZM23.11 11.954a1.963 1.963 0 1 0 0-3.926 1.963 1.963 0 0 0 0 3.926Z"
  />

  <path stroke="#384E54" strokeLinecap="round" strokeWidth=".397" d="M5.006 6.91c-1.17-1.084-2.027-.772-2.044-.747" />

  <path
    stroke="#384E54"
    strokeLinecap="round"
    strokeWidth=".397"
    d="M4.385 6.553c-1.159.036-1.347.63-1.339.652M26.63 6.81c1.171-1.083 2.028-.772 2.045-.746"
  />

  <path stroke="#384E54" strokeLinecap="round" strokeWidth=".397" d="M27.322 6.31c1.159.037 1.347.63 1.34.653" />
</svg>

----------------------------------------

TITLE: Implementing SignUp Component in Expo Web
DESCRIPTION: Creates a basic sign-up page using Clerk's prebuilt SignUp component. This code should be placed in a platform-specific file for web implementation using Expo Router.

LANGUAGE: typescript
CODE:
import { SignUp } from '@clerk/clerk-expo/web'

export default function Page() {
  return <SignUp />
}

----------------------------------------

TITLE: Creating getAuth Helper Function in TypeScript
DESCRIPTION: This snippet defines a utility function getAuth that retrieves the stored authentication state from the context. It's used to access the Auth object in route handlers.

LANGUAGE: typescript
CODE:
export const getAuth = (context) => context.get('clerkAuth')

----------------------------------------

TITLE: Forcing Organization Usage
DESCRIPTION: Example of implementing the OrganizationList component with forced organization usage by hiding personal accounts.

LANGUAGE: tsx
CODE:
export default function OrganizationListPage() {
  return (
    <OrganizationList
      hidePersonal={true}
      // ...
    />
  )
}

----------------------------------------

TITLE: Querying User List with Partial Matching
DESCRIPTION: Shows how to use the query parameter to perform a broader search across multiple user attributes.

LANGUAGE: tsx
CODE:
// Matches users with the string `test` matched in multiple user attributes.
const { data, totalCount } = await clerkClient.users.getUserList({
  query: 'test',
})

----------------------------------------

TITLE: Running a Nuxt Development Server
DESCRIPTION: Commands to start a Nuxt development server using different package managers.

LANGUAGE: bash
CODE:
npm run dev

LANGUAGE: bash
CODE:
yarn dev

LANGUAGE: bash
CODE:
pnpm dev

LANGUAGE: bash
CODE:
bun dev

----------------------------------------

TITLE: Updating authenticateRequest Parameters
DESCRIPTION: Breaking change example showing how to update the authenticateRequest function parameters structure.

LANGUAGE: javascript
CODE:
// Old
clerkClient.authenticateRequest({ ...opts, request })

// New
clerkClient.authenticateRequest(request, { ...opts })

----------------------------------------

TITLE: Clerk Password Reset Implementation
DESCRIPTION: Demonstrates the password reset flow implementation with email verification and alternative sign-in options.

LANGUAGE: tsx
CODE:
<SignIn.Step name="reset-password">
  <Clerk.Field name="password">
    <Clerk.Label>New password</Clerk.Label>
    <Clerk.Input />
    <Clerk.FieldError />
  </Clerk.Field>
  <Clerk.Field name="confirmPassword">
    <Clerk.Label>Confirm password</Clerk.Label>
    <Clerk.Input />
    <Clerk.FieldError />
  </Clerk.Field>
  <SignIn.Action submit>Update password</SignIn.Action>
</SignIn.Step>

----------------------------------------

TITLE: Rendering Clerk Logo SVG with Dynamic Theming
DESCRIPTION: This SVG code defines the Clerk logo with a circular mask and theme-aware coloring. It uses CSS variables to dynamically switch between light and dark themes, and includes gradients for visual effects.

LANGUAGE: SVG
CODE:
<svg viewBox="0 0 180 180">
  <mask
    height="180"
    id=":r8:mask0_408_134"
    maskUnits="userSpaceOnUse"
    width="180"
    x="0"
    y="0"
    style={{maskType:'alpha'}}
  >
    <circle cx="90" cy="90" style={{ fill: 'var(--light, black) var(--dark, white)' }} r="90" />
  </mask>

  <g mask="url(#:r8:mask0_408_134)">
    <circle cx="90" cy="90" style={{ fill: 'var(--light, black) var(--dark, white)' }} r="90" />

    <path
      d="M149.508 157.52L69.142 54H54V125.97H66.1136V69.3836L139.999 164.845C143.333 162.614 146.509 160.165 149.508 157.52Z"
      fill="url(#:r8:paint0_linear_408_134)"
    />

    <rect fill="url(#:r8:paint1_linear_408_134)" height="72" width="12" x="115" y="54" />
  </g>

  <defs>
    <linearGradient
      gradientUnits="userSpaceOnUse"
      id=":r8:paint0_linear_408_134"
      x1="109"
      x2="144.5"
      y1="116.5"
      y2="160.5"
    >
      <stop style={{ stopColor: 'var(--light, white) var(--dark, black)' }} />

      <stop offset="1" style={{ stopColor: 'var(--light, white) var(--dark, black)' }} stopOpacity="0" />
    </linearGradient>

    <linearGradient
      gradientUnits="userSpaceOnUse"
      id=":r8:paint1_linear_408_134"
      x1="121"
      x2="120.799"
      y1="54"
      y2="106.875"
    >
      <stop style={{ stopColor: 'var(--light, white) var(--dark, black)' }} />

      <stop offset="1" style={{ stopColor: 'var(--light, white) var(--dark, black)' }} stopOpacity="0" />
    </linearGradient>
  </defs>
</svg>

----------------------------------------

TITLE: Implementing Clerk Middleware in TypeScript
DESCRIPTION: This code snippet shows how to create a middleware function that authenticates requests using the Clerk client. It sets the authenticated state and Clerk client in the context for later use.

LANGUAGE: typescript
CODE:
import { clerkClient as defaultClerkClient } from './client.ts'

const clerkMiddleware = (options) => {
  return async (context, next) => {
    const clerkClient = options.clerkClient || defaultClerkClient

    const requestState = await clerkClient.authenticateRequest(context.req, {
      authorizedParties: ['https://example.com'],
    })

    context.set('clerkAuth', requestState.toAuth())
    context.set('clerk', clerkClient)

    await next()
  }
}

----------------------------------------

TITLE: Creating README for Clerk SDK
DESCRIPTION: A template for creating a README file for a Clerk SDK, including sections for overview, prerequisites, installation, usage, and license information.

LANGUAGE: markdown
CODE:
# clerk-sdk-name

<!-- Give an overview. Explain what the SDK does and what one can use it for. Link out to clerk.com when mentioning Clerk -->

## Getting started

### Prerequisites

- If you haven't already, [sign up for an account](https://dashboard.clerk.com/sign-up) and create a new application. Go to the [**API keys**](https://dashboard.clerk.com/last-active?path=api-keys) page to retrieve your Publishable Key and/or Secret Key.

<!-- Mention any other necessary steps a user has to perform before continuing. Mention any hard requirements e.g. like minimum supported Node.js version. -->

### Installation

```shell
# Install command for SDK
```

## Usage

<!-- Explain how to use the Publishable Key and/or Secret Key, e.g. by placing them into an .env file -->

<!-- Explain how to use your SDK! -->

## License

<!-- State which license your library falls under, Clerk recommends MIT -->

----------------------------------------

TITLE: Basic Usage of SignInWithMetamaskButton in Next.js
DESCRIPTION: Demonstrates how to use the SignInWithMetamaskButton component in a Next.js application. It imports the component from '@clerk/nextjs' and renders it within a div element.

LANGUAGE: jsx
CODE:
import { SignInWithMetamaskButton } from '@clerk/nextjs'

export default function Home() {
  return (
    <div>
      <SignInWithMetamaskButton />
    </div>
  )
}

----------------------------------------

TITLE: Declaring deleteUserProfileImage Function Type in TypeScript
DESCRIPTION: TypeScript function signature for deleting a user's profile image. Takes a userId parameter and returns a Promise that resolves to a User object.

LANGUAGE: typescript
CODE:
function deleteUserProfileImage(userId: string): Promise<User>

----------------------------------------

TITLE: Implementing Custom Sign-Up Flow
DESCRIPTION: Creating a custom sign-up page with email verification using Clerk's useSignUp hook.

LANGUAGE: tsx
CODE:
import * as React from 'react'
import { Text, TextInput, TouchableOpacity, View } from 'react-native'
import { useSignUp } from '@clerk/clerk-expo'
import { Link, useRouter } from 'expo-router'

export default function SignUpScreen() {
  const { isLoaded, signUp, setActive } = useSignUp()
  const router = useRouter()

  const [emailAddress, setEmailAddress] = React.useState('')
  const [password, setPassword] = React.useState('')
  const [pendingVerification, setPendingVerification] = React.useState(false)
  const [code, setCode] = React.useState('')

  // Handle submission of sign-up form
  const onSignUpPress = async () => {
    if (!isLoaded) return

    console.log(emailAddress, password)

    // Start sign-up process using email and password provided
    try {
      await signUp.create({
        emailAddress,
        password,
      })

      // Send user an email with verification code
      await signUp.prepareEmailAddressVerification({ strategy: 'email_code' })

      // Set 'pendingVerification' to true to display second form
      // and capture OTP code
      setPendingVerification(true)
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }

  // Handle submission of verification form
  const onVerifyPress = async () => {
    if (!isLoaded) return

    try {
      // Use the code the user provided to attempt verification
      const signUpAttempt = await signUp.attemptEmailAddressVerification({
        code,
      })

      // If verification was completed, set the session to active
      // and redirect the user
      if (signUpAttempt.status === 'complete') {
        await setActive({ session: signUpAttempt.createdSessionId })
        router.replace('/')
      } else {
        // If the status is not complete, check why. User may need to
        // complete further steps.
        console.error(JSON.stringify(signUpAttempt, null, 2))
      }
    } catch (err) {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      console.error(JSON.stringify(err, null, 2))
    }
  }

  if (pendingVerification) {
    return (
      <>
        <Text>Verify your email</Text>
        <TextInput
          value={code}
          placeholder="Enter your verification code"
          onChangeText={(code) => setCode(code)}
        />
        <TouchableOpacity onPress={onVerifyPress}>
          <Text>Verify</Text>
        </TouchableOpacity>
      </>
    )
  }

  return (
    <View>
      <>
        <Text>Sign up</Text>
        <TextInput
          autoCapitalize="none"
          value={emailAddress}
          placeholder="Enter email"
          onChangeText={(email) => setEmailAddress(email)}
        />
        <TextInput
          value={password}
          placeholder="Enter password"
          secureTextEntry={true}
          onChangeText={(password) => setPassword(password)}
        />
        <TouchableOpacity onPress={onSignUpPress}>
          <Text>Continue</Text>
        </TouchableOpacity>
        <View style={{ display: 'flex', flexDirection: 'row', gap: 3 }}>
          <Text>Already have an account?</Text>
          <Link href="/sign-in">
            <Text>Sign in</Text>
          </Link>
        </View>
      </>
    </View>
  )
}

----------------------------------------

TITLE: New Localization Keys in Clerk Core 2
DESCRIPTION: This code snippet shows the new localization keys added in Clerk Core 2. These keys provide additional customization options for various components and should be added to your localization object if you want to override the default English values.

LANGUAGE: javascript
CODE:
const newValues = {
  formButtonPrimary__verify: 'Verify',
  formFieldInputPlaceholder__confirmDeletionUserAccount: 'Delete account',
  organizationProfile: {
    invitePage: {
      selectDropdown__role: 'Select role',
    },
    navbar: {
      description: 'Manage your organization.',
      general: 'General',
      members: 'Members',
      title: 'Organization',
    },
    profilePage: {
      domainSection: {
        menuAction__manage: 'Manage',
        menuAction__remove: 'Delete',
        menuAction__verify: 'Verify',
      },
    },
    start: {
      headerTitle__general: 'General',
      profileSection: {
        primaryButton: 'Edit profile',
        title: 'Organization Profile',
        uploadAction__title: 'Logo',
      },
    },
    verifiedDomainPage: {
      title: 'Update {{domain}}',
    },
  },
  signIn: {
    accountSwitcher: {
      action__addAccount: 'Add account',
      action__signOutAll: 'Sign out of all accounts',
      subtitle: 'Select the account with which you wish to continue.',
      title: 'Choose an account',
    },
    alternativeMethods: {
      actionText: 'Don't have any of these?',
      subtitle: 'Facing issues? You can use any of these methods to sign in.',
    },
    forgotPassword: {
      subtitle_email: 'First, enter the code sent to your email ID',
      subtitle_phone: 'First, enter the code sent to your phone',
      title: 'Reset password',
    },
  },
  unstable__errors: {
    form_param_format_invalid__phone_number: 'Phone number must be in a valid international format',
  },
  userProfile: {
    emailAddressPage: {
      verifyTitle: 'Verify email address',
    },
    formButtonPrimary__add: 'Add',
    formButtonPrimary__remove: 'Remove',
    formButtonPrimary__save: 'Save',
    mfaPhoneCodePage: {
      backButton: 'Use existing number',
      successMessage1:
        'When signing in, you will need to enter a verification code sent to this phone number as an additional step.',
      successMessage2:
        'Save these backup codes and store them somewhere safe. If you lose access to your authentication device, you can use backup codes to sign in.',
      successTitle: 'SMS code verification enabled',
    },
    navbar: {
      account: 'Profile',
      description: 'Manage your account info.',
      security: 'Security',
      title: 'Account',
    },
    phoneNumberPage: {
      verifySubtitle: 'Enter the verification code sent to {{identifier}}',
      verifyTitle: 'Verify phone number',
    },
    start: {
      profileSection: {
        primaryButton: 'Edit profile',
      },
    },
  },
}

----------------------------------------

TITLE: Adding Clerk SDK to Gemfile
DESCRIPTION: Adds the Clerk Ruby SDK gem to the application's Gemfile with proper require statement.

LANGUAGE: ruby
CODE:
gem 'clerk-sdk-ruby', require: "clerk"

----------------------------------------

TITLE: Paginating Organization Memberships in React
DESCRIPTION: This snippet shows how to implement pagination for organization memberships using React. It uses the $organizationStore to access the organization data and implements a fetchMemberships function to retrieve paginated data. The component includes previous and next buttons for navigation.

LANGUAGE: tsx
CODE:
import { useState, useEffect } from 'react'
import { $organizationStore } from '@clerk/astro/client'
import { useStore } from '@nanostores/react'

export default function OrganizationMembers() {
  const [memberships, setMemberships] = useState([])
  const [currentPage, setCurrentPage] = useState(1)
  const organization = useStore($organizationStore)

  const pageSize = 10

  useEffect(() => {
    fetchMemberships()
  }, [currentPage, organization])

  const fetchMemberships = async () => {
    if (!organization) {
      return
    }

    const { data } = await organization.getMemberships({
      initialPage: currentPage,
      pageSize: 5,
    })
    setMemberships(data)
  }

  const fetchPrevious = () => setCurrentPage(currentPage - 1)
  const fetchNext = () => setCurrentPage(currentPage + 1)

  if (organization === undefined) {
    // Handle loading state
    return null
  }

  if (organization === null) {
    // Handle no organization state
    return null
  }

  return (
    <div>
      <h2>Organization members</h2>
      <ul>
        {memberships.map((membership) => (
          <li key={membership.id}>
            {membership.publicUserData.firstName} {membership.publicUserData.lastName} &lt;
            {membership.publicUserData.identifier}&gt; :: {membership.role}
          </li>
        ))}
      </ul>
      <div>
        <button onClick={fetchPrevious} disabled={currentPage === 1}>
          Previous
        </button>
        <button onClick={fetchNext}>Next</button>
      </div>
    </div>
  )
}

----------------------------------------

TITLE: Listing Firebase Projects
DESCRIPTION: Command to list all Firebase projects associated with the authenticated account.

LANGUAGE: bash
CODE:
firebase projects:list

----------------------------------------

TITLE: Closing UserProfile Component with JavaScript
DESCRIPTION: Example of how to close the <UserProfile /> component overlay using the Clerk JavaScript SDK.

LANGUAGE: javascript
CODE:
import { Clerk } from '@clerk/clerk-js'

// Initialize Clerk with your Clerk Publishable Key
const clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

const clerk = new Clerk(clerkPubKey)
await clerk.load()

document.getElementById('app').innerHTML = `
  <div id="user-profile"></div>
`

const userProfileDiv = document.getElementById('user-profile')

clerk.closeUserProfile(userProfileDiv)

----------------------------------------

TITLE: Defining getEmailAddress Function in TypeScript
DESCRIPTION: Type definition for the getEmailAddress function that retrieves a single EmailAddress object using an email address ID.

LANGUAGE: typescript
CODE:
function getEmailAddress(emailAddressId: string): Promise<EmailAddress>

----------------------------------------

TITLE: Configuring Hasura Core Environment Variables
DESCRIPTION: YAML configuration for docker-compose.yml showing both admin secret and JWT secret setup for Hasura Core

LANGUAGE: yaml
CODE:
HASURA_GRAPHQL_ADMIN_SECRET: myadminsecretkey
HASURA_GRAPHQL_JWT_SECRET: '{"jwk_url":"https://{{fapi}}/.well-known/jwks.json"}'

----------------------------------------

TITLE: Billing Account Without Customer ID Error Response
DESCRIPTION: Error response returned when attempting to perform an operation on a billing account that requires a Stripe Customer ID, but the ID is missing.

LANGUAGE: json
CODE:
{
  "shortMessage": "Billing account without customer ID",
  "longMessage": "Billing account <baID> does not have a Stripe Customer ID",
  "code": "billing_account_without_customer_id_code"
}

----------------------------------------

TITLE: Using OrganizationSwitcher with Tanstack Start
DESCRIPTION: Example of how to implement the OrganizationSwitcher component in a Tanstack Start application. This snippet demonstrates the usage within a route component.

LANGUAGE: tsx
CODE:
import { OrganizationSwitcher } from '@clerk/tanstack-start'
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/organization-switcher')({
  component: OrganizationSwitcher,
})

function OrganizationSwitcher() {
  return <OrganizationSwitcher />
}

----------------------------------------

TITLE: Interacting with Clerk's Backend API in Astro Endpoints
DESCRIPTION: This example shows how to use the clerkClient to interact with Clerk's Backend API in an Astro endpoint, specifically updating a user's information.

LANGUAGE: typescript
CODE:
import { clerkClient } from '@clerk/astro/server'

export async function POST(context) {
  const { userId } = context.locals.auth()

  if (!userId) {
    return new Response('Unauthorized', { status: 401 })
  }

  const params = { firstName: 'Clerk', lastName: 'Cookie' }

  const user = await clerkClient(context).users.updateUser(userId, params)

  return new Response(JSON.stringify({ user }))
}

----------------------------------------

TITLE: Retrieving User List with JavaScript Backend SDK
DESCRIPTION: This snippet demonstrates how to use the getUserList() method from the Clerk JavaScript Backend SDK to retrieve a list of users. This method provides a programmatic way to safely export user data.

LANGUAGE: javascript
CODE:
getUserList()

----------------------------------------

TITLE: Rendering UserProfile Component in Remix
DESCRIPTION: Example of how to use the <UserProfile /> component in a Remix application.

LANGUAGE: tsx
CODE:
import { UserProfile } from '@clerk/remix'

export default function UserProfilePage() {
  return <UserProfile />
}

----------------------------------------

TITLE: Email Address Update Example Usage
DESCRIPTION: Demonstrates how to use the updateEmailAddress method to modify an email address's verification status using the Clerk client.

LANGUAGE: tsx
CODE:
const emailAddressId = 'idn_123'

const params = { verified: false }

const response = await clerkClient.emailAddresses.updateEmailAddress(emailAddressId, params)

----------------------------------------

TITLE: Handling Basic Reverification Flow in Next.js
DESCRIPTION: Shows how to implement basic reverification handling in a Next.js client component using the useReverification hook. Includes handling of user cancellation.

LANGUAGE: tsx
CODE:
'use client'

import { useReverification } from '@clerk/nextjs'

export function MyButton() {
  const [enhancedFetcher] = useReverification(myFetcher)

  const handleClick = async () => {
    const myData = await enhancedFetcher()
    // If `myData` is null, the user canceled the reverification process
    // You can choose how your app responds. This example returns null.
    if (!myData) return
  }

  return <button onClick={handleClick}>Update User</button>
}

----------------------------------------

TITLE: FormInvalidEntitlementKey Error Response Structure
DESCRIPTION: Error response when an entitlement key doesn't match the required format of <scope>:<feature>. The key must contain only alphanumeric characters without spaces for both scope and feature components.

LANGUAGE: json
CODE:
{
  "shortMessage": "invalid key format",
  "longMessage": "<value> cannot be used as an entitlement key. An entitlement key should have the following format: <scope>:<feature> Both `scope` and `feature` should only contain alphanumeric characters without any spaces.",
  "code": "form_invalid_entitlement_key_code"
}

----------------------------------------

TITLE: Implementing User Session Management in Vue
DESCRIPTION: Vue component implementation using $sessionListStore to create a user button with session management capabilities. Uses Vue 3 composition API with Clerk's authentication system.

LANGUAGE: vue
CODE:
<script setup>
import { useStore } from '@nanostores/vue'
import { $sessionListStore, $clerkStore } from '@clerk/astro/client'

const sessions = useStore($sessionListStore)
const clerk = useStore($clerkStore)
</script>

<template>
  <div v-if="sessions === undefined">Loading sessions...</div>
  <div v-else>
    <div>{{ clerk.session.user.primaryEmailAddress }}</div>
    <div role="menu">
      <button
        v-for="sess in sessions"
        :key="sess.id"
        role="menuitem"
        @click="clerk.setActive({ session: sess.id })"
      >
        {{ sess.user.primaryEmailAddress }}
      </button>
      <button role="menuitem" @click="clerk.signOut">Sign out of all accounts</button>
    </div>
  </div>
</template>

----------------------------------------

TITLE: Configuring Production Environment Variables for Clerk Chrome Extension
DESCRIPTION: This snippet shows how to set up the .env.production file with the necessary Clerk API keys and Sync Host URL for a Chrome Extension in production.

LANGUAGE: env
CODE:
PLASMO_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
CLERK_FRONTEND_API={{fapi_url}}
PLASMO_PUBLIC_CLERK_SYNC_HOST=https://yourdomain.com

----------------------------------------

TITLE: Implementing ClerkLoaded in Expo
DESCRIPTION: Shows how to integrate ClerkLoaded component in a React Native Expo application.

LANGUAGE: tsx
CODE:
import { ClerkLoaded } from '@clerk/clerk-expo'
import { Text, View } from 'react-native'

export default function Screen() {
  return (
    <View>
      <ClerkLoaded>
        <Text>Clerk is loaded</Text>
        <Text>{window.Clerk?.version}</Text>
      </ClerkLoaded>
    </View>
  )
}

----------------------------------------

TITLE: Defining createPhoneNumber Function in TypeScript
DESCRIPTION: Function signature for creating a phone number for a specified user. It takes CreatePhoneNumberParams as input and returns a Promise resolving to a PhoneNumber object.

LANGUAGE: typescript
CODE:
function createPhoneNumber(params: CreatePhoneNumberParams): Promise<PhoneNumber>

----------------------------------------

TITLE: iOS Swift Authentication Implementation
DESCRIPTION: SwiftUI implementation of email/password authentication using Clerk's iOS SDK. Includes sign-up and sign-in flows with email verification.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct EmailPasswordSignUpView: View {
  // Swift implementation...

----------------------------------------

TITLE: Deleting SAML Connection Example in TypeScript React
DESCRIPTION: Example usage of the deleteSamlConnection function. It demonstrates how to call the function with a SAML connection ID and await the response.

LANGUAGE: tsx
CODE:
const samlConnectionId = 'samlc_123'

const response = await clerkClient.samlConnections.deleteSamlConnection(samlConnectionId)

----------------------------------------

TITLE: Configuring Nuxt for Manual Middleware Setup
DESCRIPTION: Update the Nuxt configuration to skip the automatic clerkMiddleware() and allow for manual configuration.

LANGUAGE: tsx
CODE:
export default defineNuxtConfig({
  modules: ['@clerk/nuxt'],
  clerk: {
    skipServerMiddleware: true,
  },
})

----------------------------------------

TITLE: Retrieving Auth Object with getAuth() in TanStack Start
DESCRIPTION: The getAuth() function returns an Auth object containing session data, user ID, and organization ID. It is used in TanStack Start server functions and API routes for integrating Clerk features.

LANGUAGE: javascript
CODE:
const auth = getAuth();

----------------------------------------

TITLE: Installing @clerk/react-router SDK
DESCRIPTION: Command to install the Clerk React Router SDK using various package managers.

LANGUAGE: bash
CODE:
npm install @clerk/react-router

LANGUAGE: bash
CODE:
yarn add @clerk/react-router

LANGUAGE: bash
CODE:
pnpm add @clerk/react-router

LANGUAGE: bash
CODE:
bun add @clerk/react-router

----------------------------------------

TITLE: Implementing ClerkLoading in React
DESCRIPTION: Example of using ClerkLoading in a standard React application with ClerkProvider configuration using publishable key. Shows how to combine ClerkLoading with other components.

LANGUAGE: tsx
CODE:
import { ClerkLoaded, ClerkLoading, ClerkProvider } from '@clerk/clerk-react'

function App() {
  return (
    <ClerkProvider publishableKey={`{{pub_key}}`}>
      <ClerkLoading>
        <div>Clerk is loading</div>
      </ClerkLoading>
      <ClerkLoaded>
        <Page />
      </ClerkLoaded>
      <div>This div is always visible</div>
    </ClerkProvider>
  )
}

function Page() {
  return <div>The content</div>
}

export default App

----------------------------------------

TITLE: Implementing ClerkLoading in React
DESCRIPTION: Example of using ClerkLoading in a standard React application with ClerkProvider configuration using publishable key. Shows how to combine ClerkLoading with other components.

LANGUAGE: tsx
CODE:
import { ClerkLoaded, ClerkLoading, ClerkProvider } from '@clerk/clerk-react'

function App() {
  return (
    <ClerkProvider publishableKey={`{{pub_key}}`}>
      <ClerkLoading>
        <div>Clerk is loading</div>
      </ClerkLoading>
      <ClerkLoaded>
        <Page />
      </ClerkLoaded>
      <div>This div is always visible</div>
    </ClerkProvider>
  )
}

function Page() {
  return <div>The content</div>
}

export default App

----------------------------------------

TITLE: Using deleteDomain Method with Clerk Client
DESCRIPTION: Example showing how to use the deleteDomain method to remove a satellite domain using the Clerk client.

LANGUAGE: tsx
CODE:
const id = 'test_123'

const response = await clerkClient.users.deleteDomain(id)

----------------------------------------

TITLE: Starting Inngest Dev Server
DESCRIPTION: This command starts the Inngest Dev Server for local development and testing of Inngest functions. It allows developers to run and test their functions on their own machine.

LANGUAGE: sh
CODE:
npx inngest-cli@latest dev

----------------------------------------

TITLE: Defining revokeSession Function in TypeScript
DESCRIPTION: Function signature for revoking a session given its ID. It takes a session ID as a string parameter and returns a Promise that resolves to a Session object.

LANGUAGE: typescript
CODE:
function revokeSession(sessionId: string): Promise<Session>

----------------------------------------

TITLE: Clerk OpenID Connect ID Token Claims
DESCRIPTION: JSON structure showing the standard and additional claims included in the ID token issued by Clerk during OpenID Connect authentication.

LANGUAGE: json
CODE:
{
  "iss": "string",
  "sub": "string",
  "aud": "string",
  "exp": "number",
  "iat": "number",
  "jti": "string",
  "nonce": "string",
  "family_name": "string",
  "given_name": "string",
  "name": "string",
  "picture": "string",
  "preferred_username": "string",
  "email": "string",
  "email_verified": "boolean",
  "public_metadata": "object",
  "private_metadata": "object",
  "unsafe_metadata": "object"
}

----------------------------------------

TITLE: Installing Clerk Vue SDK with package managers
DESCRIPTION: Commands for uninstalling the community SDK and installing the official Clerk Vue SDK using npm, yarn, pnpm, and bun.

LANGUAGE: bash
CODE:
npm uninstall vue-clerk
npm install @clerk/vue

LANGUAGE: bash
CODE:
yarn remove vue-clerk
yarn add @clerk/vue

LANGUAGE: bash
CODE:
pnpm remove vue-clerk
pnpm add @clerk/vue

LANGUAGE: bash
CODE:
bun remove vue-clerk
bun add @clerk/vue

----------------------------------------

TITLE: Updating Component Import Paths
DESCRIPTION: Code examples showing the updated import paths for various Clerk components in the official SDK.

LANGUAGE: javascript
CODE:
import { UserProfile } from '@clerk/astro/components'
import { Protect } from '@clerk/astro/components'
import { SignInButton } from '@clerk/astro/components'

----------------------------------------

TITLE: Using Clerk FieldState Component
DESCRIPTION: Shows how to use the FieldState component to access and display the field's state.

LANGUAGE: tsx
CODE:
<Clerk.Field name="emailAddress">
  <Clerk.Label>Email</Clerk.Label>
  <Clerk.Input />
  <Clerk.FieldState>{({ state }) => <p>Field's state is: {state}</p>}</Clerk.FieldState>
</Clerk.Field>

----------------------------------------

TITLE: Defining verifyPassword Function Signature in TypeScript
DESCRIPTION: Function signature for verifyPassword, which takes VerifyPasswordParams and returns a Promise resolving to an object with a 'verified' property.

LANGUAGE: typescript
CODE:
function verifyPassword(params: VerifyPasswordParams): Promise<{ verified: true }>

----------------------------------------

TITLE: Implementing Clerk Server Handler
DESCRIPTION: Server-side setup for Clerk authentication handler integrated with TanStack Start's createStartHandler.

LANGUAGE: tsx
CODE:
import { createStartHandler, defaultStreamHandler } from '@tanstack/start/server'
import { getRouterManifest } from '@tanstack/start/router-manifest'
import { createRouter } from './router'
import { createClerkHandler } from '@clerk/tanstack-start/server'

export default createClerkHandler(
  createStartHandler({
    createRouter,
    getRouterManifest,
  }),
)(defaultStreamHandler)

----------------------------------------

TITLE: Configuring Clerk Layout in Astro
DESCRIPTION: Implementation of Clerk layout configuration in an Astro application's config file, customizing social buttons and terms page URL.

LANGUAGE: javascript
CODE:
import clerk from '@clerk/astro'

export default defineConfig({
  integrations: [
    clerk({
      appearance: {
        layout: {
          socialButtonsPlacement: 'bottom',
          socialButtonsVariant: 'iconButton',
          termsPageUrl: 'https://clerk.com/terms',
        },
      },
    }),
  ],
})

----------------------------------------

TITLE: Configuring Environment Variables for Clerk Sign-Up in TanStack Start
DESCRIPTION: This snippet demonstrates how to set up environment variables for the custom sign-up page. It includes variables for the sign-up URL, fallback redirect URLs for sign-up and sign-in.

LANGUAGE: bash
CODE:
CLERK_SIGN_UP_URL=/sign-up
CLERK_SIGN_UP_FALLBACK_REDIRECT_URL=/
CLERK_SIGN_IN_FALLBACK_REDIRECT_URL=/

----------------------------------------

TITLE: Running Development Server
DESCRIPTION: Commands for starting the development server using different package managers.

LANGUAGE: bash
CODE:
npm run dev

LANGUAGE: bash
CODE:
yarn dev

LANGUAGE: bash
CODE:
pnpm dev

LANGUAGE: bash
CODE:
bun dev

----------------------------------------

TITLE: Example of a Complete JWT in Plaintext
DESCRIPTION: This snippet provides a real-world example of a complete JWT, including all three parts (header, payload, signature) encoded in base64.

LANGUAGE: plaintext
CODE:
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.Eci61G6w4zh_u9oOCk_v1M_sKcgk0svOmW4ZsL-rt4ojGUH2QY110bQTYNwbEVlowW7phCg7vluX_MCKVwJkxJT6tMk2Ij3Plad96Jf2G2mMsKbxkC-prvjvQkBFYWrYnKWClPBRCyIcG0dVfBvqZ8Mro3t5bX59IKwQ3WZ7AtGBYz5BSiBlrKkp6J1UmP_bFV3eEzIHEFgzRa3pbr4ol4TK6SnAoF88rLr2NhEz9vpdHglUMlOBQiqcZwqrI-Z4XDyDzvnrpujIToiepq9bCimPgVkP54VoZzy-mMSGbthYpLqsL_4MQXaI1Uf_wKFAUuAtzVn4-ebgsKOpvKNzVA

----------------------------------------

TITLE: Example Usage of deleteOrganization() in TypeScript React
DESCRIPTION: Demonstrates how to use the deleteOrganization() function from the Clerk Backend SDK. It shows setting the organization ID and calling the function using clerkClient.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const response = await clerkClient.organizations.deleteOrganization(organizationId)

----------------------------------------

TITLE: Updating async clerkClient
DESCRIPTION: Migration example for updating clerkClient() to use async/await syntax.

LANGUAGE: javascript
CODE:
import { clerkClient, clerkMiddleware } from '@clerk/nextjs/server';
import { NextResponse } from 'next/server';

- export default clerkMiddleware((auth, request) => {
-  const client = clerkClient();
+ export default clerkMiddleware(async (auth, request) => {
+  const client = await clerkClient();

  const count = await client.users?.getCount();

  if (count) {
    return NextResponse.redirect(new URL('/new-url', request.url));
  }
});

export const config = {
  matcher: [...],
};

----------------------------------------

TITLE: Implementing a Clerk SignIn Component in TypeScript React
DESCRIPTION: This snippet demonstrates how to create a SignIn component using Clerk in a TypeScript React environment. It shows how to mount and unmount the component, utilizing the Clerk instance stored in the SDK's state.

LANGUAGE: tsx
CODE:
import { $clerk } from './stores'

const SignInComponent = (props: SignInProps) => {
  const el = ref()

  function onMount() {
    $clerk.mountSignIn(el, props)
  }

  function onUnMount() {
    $clerk.unmountSignIn(el)
  }
}

----------------------------------------

TITLE: Configuring React Router with createMemoryRouter for Chrome Extension
DESCRIPTION: Sets up the routing configuration using createMemoryRouter and defines the main PopupIndex component for the Chrome Extension.

LANGUAGE: ts
CODE:
import React from 'react'

import '../style.css'

import { createMemoryRouter, RouterProvider } from 'react-router-dom'

import { RootLayout } from './layouts/root-layout'
import { Home } from './routes/home'
import { Settings } from './routes/settings'
import { SignInPage } from './routes/sign-in'
import { SignUpPage } from './routes/sign-up'

const router = createMemoryRouter([
  {
    // Wraps the entire app in the root layout
    element: <RootLayout />,
    // Mounted where the <Outlet /> component is inside the root layout
    children: [
      { path: '/', element: <Home /> },
      { path: '/sign-in', element: <SignInPage /> },
      { path: '/sign-up', element: <SignUpPage /> },
      { path: '/settings', element: <Settings /> },
    ],
  },
])

export default function PopupIndex() {
  return <RouterProvider router={router} />
}

----------------------------------------

TITLE: Basic Usage of useOrganizationList Hook
DESCRIPTION: Examples of different ways to initialize and use the useOrganizationList hook, demonstrating default values and custom configurations for fetching organization memberships.

LANGUAGE: jsx
CODE:
// userMemberships.data will never be populated
const { userMemberships } = useOrganizationList()

// Use default values to fetch userMemberships, such as initialPage = 1 and pageSize = 10
const { userMemberships } = useOrganizationList({
  userMemberships: true,
})

// Pass your own values to fetch userMemberships
const { userMemberships } = useOrganizationList({
  userMemberships: {
    pageSize: 20,
    initialPage: 2, // skips the first page
  },
})

// Aggregate pages in order to render an infinite list
const { userMemberships } = useOrganizationList({
  userMemberships: {
    infinite: true,
  },
})

----------------------------------------

TITLE: Updating Organization Membership Example in TypeScript React
DESCRIPTION: Example usage of the updateOrganizationMembership function. It demonstrates how to update a user's role within an organization using the Clerk Backend SDK.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const userId = 'user_123'

const role = 'org:admin'

const response = await clerkClient.organizations.updateOrganizationMembership({
  organizationId,
  userId,
  role,
})

----------------------------------------

TITLE: Updating Organization Example in React/TypeScript
DESCRIPTION: Example showing how to update an organization's name using the Clerk Backend SDK. Demonstrates the usage of organizationId and name parameters.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const name = 'Test Updated'

const response = await clerkClient.organizations.updateOrganization(organizationId, { name })

----------------------------------------

TITLE: Configuring Clerk API for Chrome Extension Integration
DESCRIPTION: cURL command to update Clerk instance configuration with Chrome Extension's allowed origins.

LANGUAGE: bash
CODE:
curl -X PATCH https://api.clerk.com/v1/instance \
  -H "Authorization: Bearer {{secret}}" \
  -H "Content-type: application/json" \
  -d '{"allowed_origins": ["chrome-extension://<CHROME_EXTENSION_ID>"]}'

----------------------------------------

TITLE: Integrating OrganizationSwitcher in Vue
DESCRIPTION: Demonstration of how to use the OrganizationSwitcher component in a Vue application. This snippet shows the component usage within a Vue single-file component.

LANGUAGE: vue
CODE:
<script setup lang="ts">
import { OrganizationSwitcher } from '@clerk/vue'
</script>

<template>
  <OrganizationSwitcher />
</template>

----------------------------------------

TITLE: Basic Usage of getOrganizationList in TypeScript
DESCRIPTION: A simple example of how to use the getOrganizationList function to retrieve a list of organizations using Clerk's Backend SDK.

LANGUAGE: tsx
CODE:
const response = await clerkClient.organizations.getOrganizationList()

----------------------------------------

TITLE: Updating Organization Membership Metadata Example in TSX
DESCRIPTION: This example demonstrates how to use the updateOrganizationMembershipMetadata function to update the public metadata of an organization membership. It requires the organization ID and user ID, and updates a specific field in the public metadata.

LANGUAGE: tsx
CODE:
const organizationId = 'org_123'

const userId = 'user_123'

const response = await clerkClient.organizations.updateOrganizationMembershipMetadata({
  organizationId,
  userId,
  publicMetadata: {
    example: 'this value is updated!',
  },
})

----------------------------------------

TITLE: Signing In with Passkey using Clerk API in React
DESCRIPTION: This code snippet shows how to implement a sign-in flow using passkeys with the Clerk API. It uses the useSignIn hook and calls the authenticateWithPasskey() method to initiate the sign-in process.

LANGUAGE: tsx
CODE:
export function SignInWithPasskeyButton() {
  const { signIn } = useSignIn()
  const router = useRouter()

  const signInWithPasskey = async () => {
    try {
      const signInAttempt = await signIn?.authenticateWithPasskey({
        flow: 'discoverable',
      })

      if (signInAttempt?.status === 'complete') {
        await setActive({ session: signInAttempt.createdSessionId })
        router.push('/')
      } else {
        console.error(JSON.stringify(signInAttempt, null, 2))
      }
    } catch (err) {
      console.error('Error:', JSON.stringify(err, null, 2))
    }
  }

  return <button onClick={signInWithPasskey}>Sign in with a passkey</button>
}

----------------------------------------

TITLE: Implementing MultisessionAppSupport Component in React
DESCRIPTION: This snippet defines a MultisessionAppSupport component that wraps children components and forces a full re-render when the session ID changes. It uses the useSession hook from Clerk to access the current session.

LANGUAGE: tsx
CODE:
function MultisessionAppSupport({ children }: { children: React.ReactNode }) {
  const { session } = useSession()

  return <React.Fragment key={session ? session.id : 'no-users'}>{children}</React.Fragment>
}

----------------------------------------

TITLE: Creating Allowlist Identifier using Clerk Backend SDK in TypeScript
DESCRIPTION: This example demonstrates how to use the createAllowlistIdentifier function from the Clerk Backend SDK. It adds an email address to the allowlist without sending a notification.

LANGUAGE: tsx
CODE:
const response = await clerkClient.allowlistIdentifiers.createAllowlistIdentifier({
  identifier: 'test@example.com',
  notify: false,
})

----------------------------------------

TITLE: Example Usage of createInvitation() in TypeScript/React
DESCRIPTION: Demonstrates how to use the createInvitation() function from Clerk's Backend SDK. It creates an invitation for a specific email address, sets a redirect URL, and includes public metadata.

LANGUAGE: tsx
CODE:
const response = await clerkClient.invitations.createInvitation({
  emailAddress: 'invite@example.com',
  redirectUrl: 'https://www.example.com/my-sign-up',
  publicMetadata: {
    example: 'metadata',
    example_nested: {
      nested: 'metadata',
    },
  },
})

----------------------------------------

TITLE: Implementing SMS OTP Sign-In Flow in iOS (SwiftUI)
DESCRIPTION: This code snippet shows how to implement a custom SMS OTP sign-in flow using Clerk in an iOS application with SwiftUI. It handles collecting the phone number, sending the OTP, verifying the code, and managing the sign-in process.

LANGUAGE: swift
CODE:
import SwiftUI
import Clerk

struct SMSOTPSignInView: View {
  @State private var phoneNumber = ""
  @State private var code = ""
  @State private var isVerifying = false

  var body: some View {
    if isVerifying {
      TextField("Enter your verification code", text: $code)
      Button("Verify") {
        Task { await verify(code: code) }
      }
    } else {
      TextField("Enter phone number", text: $phoneNumber)
      Button("Continue") {
        Task { await submit(phoneNumber: phoneNumber) }
      }
    }
  }
}

extension SMSOTPSignInView {

  func submit(phoneNumber: String) async {
    do {
      // Start the sign-in process using the phone number method.
      let signIn = try await SignIn.create(strategy: .identifier(phoneNumber))

      // Find the phoneNumberId from all the available first factors for the current sign-in
      guard
        let phoneNumberFactor = signIn.supportedFirstFactors?.first(where: { factor in
          factor.strategy == "phone_code" && factor.safeIdentifier == signIn.identifier
        }),
        let phoneNumberId = phoneNumberFactor.phoneNumberId
      else {
        return
      }

      // Send the OTP code to the user.
      try await signIn.prepareFirstFactor(for: .phoneCode(phoneNumberId: phoneNumberId))

      // Set isVerifying to true to display second form
      // and capture the OTP code.
      isVerifying = true
    } catch {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      dump(error)
    }
  }

  func verify(code: String) async {
    do {
      // Access the in progress sign in stored on the client object.
      guard let inProgressSignIn = Clerk.shared.client?.signIn else { return }

      // Use the code provided by the user and attempt verification.
      let signIn = try await inProgressSignIn.attemptFirstFactor(for: .phoneCode(code: code))

      switch signIn.status {
      case .complete:
        // If verification was completed, navigate the user as needed.
        dump(Clerk.shared.session)
      default:
        // If the status is not complete, check why. User may need to
        // complete further steps.
        dump(signIn.status)
      }
    } catch {
      // See https://clerk.com/docs/custom-flows/error-handling
      // for more info on error handling
      dump(error)
    }
  }
}

----------------------------------------

TITLE: Error Handling in Backend SDK
DESCRIPTION: Example of handling errors thrown by Backend SDK functions using try/catch blocks.

LANGUAGE: typescript
CODE:
try {
  const res = await someBackendApiCall()
} catch (error) {
  // Error handling
}

----------------------------------------

TITLE: Defining IsomorphicClerkOptions Type in React/TypeScript
DESCRIPTION: Type definition showing the interface structure for IsomorphicClerkOptions with React children nodes

LANGUAGE: typescript
CODE:
{/* IsomorphicClerkOptions & children: React.ReactNode */}

----------------------------------------

TITLE: Defining deleteDomain Function Signature in TypeScript
DESCRIPTION: Function signature for the deleteDomain method that accepts a domain ID and returns a Promise of DeletedObject type.

LANGUAGE: typescript
CODE:
function deleteDomain(id: string): Promise<DeletedObject>

----------------------------------------

TITLE: Setting Up HTML Structure for Clerk JavaScript Integration
DESCRIPTION: This HTML snippet sets up the basic structure for a web page that will use Clerk for authentication. It includes a sign-out button and links to the main JavaScript file.

LANGUAGE: html
CODE:
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/clerk.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clerk + JavaScript App</title>
  </head>

  <body>
    <div id="app"></div>
    <button id="sign-out">Sign out</button>
    <script type="module" src="main.js" async crossorigin="anonymous"></script>
  </body>
</html>

----------------------------------------

TITLE: Delete Allowlist Identifier Usage Example
DESCRIPTION: Example showing how to delete an allowlist identifier using the Clerk client. Demonstrates passing an identifier ID and awaiting the response.

LANGUAGE: tsx
CODE:
const allowlistIdentifierId = 'alid_123'

const response =
  await clerkClient.allowlistIdentifiers.deleteAllowlistIdentifier(allowlistIdentifierId)

----------------------------------------

TITLE: Implementing Page Protection with Clerk Components in Remix
DESCRIPTION: Example of using Clerk's prebuilt control components to protect content based on user authentication state in a Remix route component.

LANGUAGE: typescript
CODE:
import {
  SignInButton,
  SignOutButton,
  SignUpButton,
  SignedIn,
  SignedOut,
  UserButton,
} from '@clerk/remix'

export default function Index() {
  return (
    <div>
      <h1>Index Route</h1>
      <SignedIn>
        <p>You are signed in!</p>

        <UserButton />
      </SignedIn>
      <SignedOut>
        <p>You are signed out</p>

        <SignInButton />
      </SignedOut>
    </div>
  )
}

----------------------------------------

TITLE: Preparing PhoneNumber Verification in TypeScript
DESCRIPTION: Initiates the verification process for the phone number by sending an SMS with a one-time code.

LANGUAGE: typescript
CODE:
function prepareVerification(): Promise<PhoneNumber>

----------------------------------------

TITLE: Initiating SSO Authentication with Clerk in React
DESCRIPTION: This code snippet shows how to create a sign-in page that initiates the SSO authentication flow using Clerk's useSignIn hook. It demonstrates how to set up a button that triggers the authentication process with a redirect.

LANGUAGE: jsx
CODE:
import { useSignIn } from "@clerk/nextjs";
import { useRouter } from "next/router";

export default function SignInPage() {
  const { signIn } = useSignIn();
  const router = useRouter();

  const handleSignInWithSSO = async () => {
    await signIn.authenticateWithRedirect({
      strategy: "oauth_google",
      redirectUrl: "/sso-callback",
      redirectUrlComplete: "/",
    });
  };

  return (
    <div>
      <h1>Sign in</h1>
      <button onClick={handleSignInWithSSO}>Sign in with Google</button>
    </div>
  );
}